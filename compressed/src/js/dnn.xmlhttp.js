Type.registerNamespace("dnn.xmlhttp"),dnn.xmlhttp.callbackType=function(){},dnn.xmlhttp.callbackType.prototype={simple:0,processPage:1,callBackMethod:2,processPageCallbackMethod:3},dnn.xmlhttp.callbackType.registerEnum("dnn.xmlhttp.callbackType"),dnn.xmlhttp.callbackStatus=function(){},dnn.xmlhttp.callbackStatus.prototype={ok:200,genericFailure:400,controlNotFound:404,interfactNotSupported:501},dnn.xmlhttp.callbackStatus.registerEnum("dnn.xmlhttp.callbackStatus"),dnn.extend(dnn.xmlhttp,{pns:"dnn",ns:"xmlhttp",parserName:null,contextId:0,requests:[],cleanUpTimer:null,callBackMethods:null,init:function(){this.parserName=this._getParser()},onload:function(){dnn.xmlhttp._fillCallBackMethods()},doCallBack:function(sControlId,sArg,pSuccessFunc,sContext,pFailureFunc,pStatusFunc,bAsync,sPostChildrenId,iType){var oReq=dnn.xmlhttp.createRequestObject(),sURL=document.location.href;return oReq.successFunc=pSuccessFunc,oReq.failureFunc=pFailureFunc,oReq.statusFunc=pStatusFunc,oReq.context=sContext,null==bAsync&&(bAsync=!0),sURL.indexOf("#")!=-1&&(sURL=sURL.substring(0,sURL.indexOf("#"))),oReq.open("POST",sURL,bAsync),sArg="JS"==this.parserName?dnn.encode(sArg,!1):dnn.encode(sArg,!0),sPostChildrenId&&(sArg+="&"+dnn.dom.getFormPostString($get(sPostChildrenId))),0!=iType&&(sArg+="&__DNNCAPISCT="+iType),oReq.send("__DNNCAPISCI="+sControlId+"&__DNNCAPISCP="+sArg),oReq},callControlMethod:function(ns,method,args,successFunc,failFunc,context,type){if(null==this.callBackMethods&&this._fillCallBackMethods(),null==type&&(type=dnn.xmlhttp.callbackType.callBackMethod),this.callBackMethods[ns]){null==args&&(args={});var callContext={context:context,success:successFunc,fail:failFunc},payload=Sys.Serialization.JavaScriptSerializer.serialize({method:method,args:args});dnn.xmlhttp.doCallBack(this.callBackMethods[ns],payload,dnn.xmlhttp.callBackMethodComplete,callContext,dnn.xmlhttp.callBackMethodError,null,!0,null,type)}else alert("Namespace not registered")},callBackMethodComplete:function(result,context,req){result=Sys.Serialization.JavaScriptSerializer.deserialize(result),context.success&&context.success(result.result,context.context,req)},callBackMethodError:function(message,context,req){context.fail&&context.fail(message,context.context,req)},createRequestObject:function(){if("ActiveX"==this.parserName){var o=new ActiveXObject("Microsoft.XMLHTTP");return dnn.xmlhttp.requests[dnn.xmlhttp.requests.length]=new dnn.xmlhttp.XmlHttpRequest(o),dnn.xmlhttp.requests[dnn.xmlhttp.requests.length-1]}if("Native"==this.parserName)return new dnn.xmlhttp.XmlHttpRequest(new XMLHttpRequest);var oReq=new dnn.xmlhttp.XmlHttpRequest(new dnn.xmlhttp.JsXmlHttpRequest);return dnn.xmlhttp.requests[oReq._request.contextId]=oReq,oReq},_getParser:function(){return null!=dnn.xmlhttp.JsXmlHttpRequest?"JS":dnn.dom.browser.isType(dnn.dom.browser.InternetExplorer)?"ActiveX":"undefined"!=typeof XMLHttpRequest?"Native":"JS"},_fillCallBackMethods:function(){this.callBackMethods=[];var pair,methods=dnn.getVar("__dnncbm","").split(" ");if(methods)for(var i=0;i<methods.length;i++)methods[i].length>0&&(pair=methods[i].split("="),this.callBackMethods[pair[0]]=pair[1])},_cleanupxmlhttp:function(){for(var i=0;i<dnn.xmlhttp.requests.length;i++)null!=dnn.xmlhttp.requests[i]&&dnn.xmlhttp.requests[i].completed&&(dnn.xmlhttp.requests[i].dispose(),1==dnn.xmlhttp.requests.length?dnn.xmlhttp.requests=new Array:dnn.xmlhttp.requests.splice(i,i))}}),dnn.xmlhttp.XmlHttpRequest=function(o){this._request=o,this.successFunc=null,this.failureFunc=null,this.statusFunc=null,this._request.onreadystatechange=dnn.dom.getObjMethRef(this,"onreadystatechange"),this.context=null,this.completed=!1},dnn.xmlhttp.XmlHttpRequest.prototype={dispose:function(){null!=this._request&&(this._request.onreadystatechange=new function(){},this._request.abort(),this._request=null,this.successFunc=null,this.failureFunc=null,this.statusFunc=null,this.context=null,this.completed=null,this.postData=null)},open:function(sMethod,sURL,bAsync){return this._request.open(sMethod,sURL,bAsync),"undefined"!=typeof this._request.setRequestHeader&&this._request.setRequestHeader("Content-type","application/x-www-form-urlencoded; charset=UTF-8"),!0},send:function(postData){return this.postData=postData,"ActiveX"==dnn.xmlhttp.parserName?this._request.send(postData):this._request.send(postData),!0},onreadystatechange:function(){null!=this.statusFunc&&this.statusFunc(this._request.readyState,this.context,this),"4"==this._request.readyState&&(this.complete(this._request.responseText),"ActiveX"==dnn.xmlhttp.parserName&&window.setTimeout(dnn.xmlhttp._cleanupxmlhttp,1))},complete:function(res){var statusCode=this.getResponseHeader("__DNNCAPISCSI");if(this.completed=!0,new Number(statusCode)==dnn.xmlhttp.callbackStatus.ok){var ret=Sys.Serialization.JavaScriptSerializer.deserialize(res);this.successFunc(ret.d,this.context,this)}else{var statusDesc=this.getResponseHeader("__DNNCAPISCSDI");null!=this.failureFunc?this.failureFunc(statusCode+" - "+statusDesc,this.context,this):alert(statusCode+" - "+statusDesc)}},getResponseHeader:function(key){return this._request.getResponseHeader(key)}},dnn.xmlhttp.XmlHttpRequest.registerClass("dnn.xmlhttp.XmlHttpRequest"),dnn.xmlhttp.init(),Sys.Application.add_load(dnn.xmlhttp.onload);