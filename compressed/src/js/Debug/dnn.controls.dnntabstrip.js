Type.registerNamespace("dnn.controls"),dnn.extend(dnn.controls,{initTabStrip:function(ctl){if(ctl&&null==dnn.controls.controls[ctl.id]){var ts=new dnn.controls.DNNTabStrip(ctl);return ts.initialize(),ts}}}),dnn.controls.DNNTabStrip=function(o){dnn.controls.DNNTabStrip.initializeBase(this,[o]),this.contentContainer=$get(o.id+"_c"),this.resultCtr=null,this.workImg=this.getProp("workImage",""),this.tabRenderMode=new Number(this.getProp("trm","0")),this.callBack=this.getProp("callback",""),this.callBackStatFunc=this.getProp("callbackSF",""),this.callBackStatFunc.length>0&&this.add_handler("callBackStatus",eval(this.callBackStatFunc)),this.callbackType=this.getProp("cbtype","0"),this.tabClickFunc=this.getProp("tabClickF",""),this.tabClickFunc.length>0&&this.add_handler("tabClick",eval(this.tabClickFunc)),this.selectedIndexFunc=this.getProp("selIdxF",""),this.selectedIndexFunc.length>0&&this.add_handler("selectedIndexChanged",eval(this.selectedIndexFunc)),this.lblCss=this.getProp("css",""),this.lblCssSel=this.getProp("csssel",this.lblCss),this.lblCssHover=this.getProp("csshover",""),this.lblCssDisabled=this.getProp("cssdisabled",""),this.pendingLookupId=null;var json=dnn.evalJSON(dnn.getVar(this.ns+"_json"));json&&(this.tabData=json.tabs,this.tabLabelData=json.tablabels),this.tabs=[],this.tabIds=[],this.selectedIndex=-1,this.selectedTab=null;for(var clientId,tabId,tab,i=0;i<this.tabData.length;i++)clientId=this.tabData[i].tcid,tabId=this.tabData[i].tid,tab=new dnn.controls.DNNTab(this,i,tabId,clientId),tab.selected=null!=tab.container&&"none"!=tab.container.style.display,this.tabIds.push(tab.tabId),this.tabs[tabId]=tab,this.addHandlers(tab.tab,{click:this.tabClick,mouseover:this.tabMouseOver,mouseout:this.tabMouseOut},tab),tab.selected&&(this.selectedIndex=i,this.selectedTab=tab);this.update()},dnn.controls.DNNTabStrip.prototype={tabClick:function(evt,element){var tab=this,ts=tab.strip;if(tab.enabled){var arg=new dnn.controls.DNNTabStripEventArgs(tab);ts.invoke_handler("tabClick",arg),0==arg.get_cancel()&&ts.showTab(tab.tabId)}},tabMouseOver:function(evt,element){"undefined"!=typeof dnn&&(this.hovered=!0,this.assignCss())},tabMouseOut:function(evt,element){"undefined"!=typeof dnn&&(this.hovered=!1,this.assignCss())},setSelectedIndex:function(index){return this.showTab(this.tabIds[index])},showTab:function(tabId){var tab;if(this.needsLookup(tabId)){if(null==this.pendingLookupId){if(tab=this.tabs[tabId],tab.showWork(!0),this.pendingLookupId=tabId,"1"==this.tabRenderMode){for(var i=0;i<this.tabIds.length;i++)tab=this.tabs[this.tabIds[i]],tab.tabId==tabId?(tab.selected=!0,this.selectedIndex=i,this.selectedTab=tab,this.invoke_compatHandler("selectedIndexChanged",null,this)):tab.selected=!1;this.update()}eval(this.callBack.replace("[TABID]",tabId).replace("'[POST]'",tab.postMode).replace("[CBTYPE]",tab.callbackType))}}else{for(var i=0;i<this.tabIds.length;i++)tab=this.tabs[this.tabIds[i]],tab.tabId==tabId?(tab.showWork(!1),tab.selected=!0,tab.rendered=!0,tab.hovered=!1,tab.container.style.display="",tab.assignCss(),this.selectedIndex=i,this.selectedTab=tab,this.invoke_compatHandler("selectedIndexChanged",null,this)):(null!=tab.container&&(tab.container.style.display="none"),tab.selected=!1,tab.assignCss());this.update()}return tab},raiseEvent:function(sFunc,evt,element){if(this[sFunc].length>0){var oPointerFunc=eval(this[sFunc]);return 0!=oPointerFunc(evt,element)}return!0},update:function(){for(var ary=[],i=0;i<this.tabIds.length;i++)ary[ary.length]=this.tabs[this.tabIds[i]].serialize();dnn.setVar(this.ns+"_tabs",ary.join(","))},createTab:function(html,id){var span=dnn.dom.createElement("span");span.innerHTML=html;var ctr=span.childNodes[0];return ctr.id!=this.tabs[id].clientId&&(ctr=dnn.dom.getById(this.tabs[id].clientId,span)),this.tabs[id].container=ctr,this.contentContainer.appendChild(ctr),this.tabs[id]},resetTab:function(id){var tab=this.tabs[id];null!=tab.container&&(dnn.dom.removeChild(tab.container),tab.container=null)},needsLookup:function(tabId){return null==this.tabs[tabId].container},callBackStatus:function(result,ctx,req){var ts=ctx;ts.invoke_compatHandler("callBackStatus",result,ctx,req)},callBackSuccess:function(result,ctx,req){var ts=ctx;ts.invoke_compatHandler("callBackStatus",result,ctx,req),ctx.invoke_handler("callBackSuccess",new dnn.controls.DNNCallbackEventArgs(result,ctx,req));var ret=dnn.evalJSON(result),vars=(ts.createTab(ret.text,ts.pendingLookupId),dnn.evalJSON(ret.vars));for(var key in vars)dnn.setVar(key,vars[key]);if(null!=ret.scripts){var scripts=dnn.evalJSON(ret.scripts),inlineScripts=[],refScripts=[];for(var s in scripts)scripts[s].src&&scripts[s].src.length>0?""==dnn.dom.scriptStatus(scripts[s].src)&&refScripts.push(scripts[s].src):inlineScripts.push(scripts[s].__text);dnn.dom.loadScripts(refScripts,inlineScripts,dnn.createDelegate(ts,ts.callBackScriptComplete))}else ts.callBackScriptComplete()},callBackScriptComplete:function(){var tabId=this.pendingLookupId;this.pendingLookupId=null,this.showTab(tabId)},callBackFail:function(result,ctx,req){ctx.invoke_handler("callBackFail",new dnn.controls.DNNCallbackEventArgs(result,ctx,req))},_getTabFromTabElement:function(element){},_getLabelData:function(index,prop,def){var data=this.tabLabelData[index];return null!=data[prop]&&data[prop].length>0?data[prop]:def},_getTabData:function(index,prop,def){var data=this.tabData[index];return null!=data[prop]&&data[prop].length>0?data[prop]:def}},dnn.controls.DNNTabStrip.registerClass("dnn.controls.DNNTabStrip",dnn.controls.control),dnn.controls.DNNTab=function(strip,index,id,clientId){var tab=$get(clientId+"_l");null!=tab&&(this.tab=tab,this.container=$get(clientId),this.icon=$get(clientId+"_i"),this.work=$get(clientId+"_w"),this.rendered=null!=this.container,this.selected=!1,this.hovered=!1,this.tabIndex=index,this.strip=strip,this.text=this.tab.innerHTML,this.clientId=clientId,this.tabId=id,this.css=this.strip._getLabelData(index,"css",strip.lblCss),this.cssSel=this.strip._getLabelData(index,"csssel",strip.lblCssSel),this.cssHover=this.strip._getLabelData(index,"csshover",strip.lblCssHover),this.cssDisabled=this.strip._getLabelData(index,"cssdisabled",strip.lblCssDisabled),this.postMode=this.strip._getTabData(index,"postmode",null),this.enabled="1"==this.strip._getTabData(index,"enabled","1"),this.callbackType=this.strip._getTabData(index,"cbtype",strip.callbackType),this.postMode&&(this.postMode="'"+this.postMode+"'"))},dnn.controls.DNNTab.prototype={serialize:function(){return this.tabId+"="+((this.rendered?1:0)+(this.selected?2:0)+(this.enabled?4:0))},showWork:function(show){null!=this.work&&(show?(this.work.style.display="",null!=this.icon&&(this.icon.style.display="none")):(this.work.style.display="none",null!=this.icon&&(this.icon.style.display="")))},enable:function(){this.enabled=!0},disable:function(){this.enabled=!1},assignCss:function(){var sCss="";sCss=0==this.enabled&&this.cssDisabled.length>0?this.cssDisabled:this.hovered&&this.cssHover.length>0?this.cssHover:this.selected?this.cssSel:this.css,this.tab.className=sCss}},dnn.controls.DNNTab.registerClass("dnn.controls.DNNTab");