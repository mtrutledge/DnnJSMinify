function __dt_DNNTreeNode(ctl){var node=dnn.controls.controls[ctl.ns].rootNode.findNode(ctl.nodeid);if(null!=node){var tNode=new dnn.controls.DNNTreeNode(node);this.ctl=ctl,this.id=ctl.id,this.key=tNode.key,this.nodeID=ctl.nodeid,this.text=tNode.text,this.serverName=ctl.name}}Type.registerNamespace("dnn.controls"),dnn.extend(dnn.controls,{initTree:function(ctl){if(ctl){var tree=new dnn.controls.DNNTree(ctl);return tree.initialize(),tree}}}),dnn.controls.DNNTree=function(o){dnn.controls.DNNTree.initializeBase(this,[o]),this.rootNode=null,this.nodes=[],this._loadNodes(),this.hoverTreeNode=null,this.selTreeNode=null,this.css=this.getProp("css",""),this.cssChild=this.getProp("csschild",""),this.cssHover=this.getProp("csshover",""),this.cssSel=this.getProp("csssel",""),this.cssIcon=this.getProp("cssicon",""),this.sysImgPath=this.getProp("sysimgpath","images/"),this.imageList=this.getProp("imagelist","").split(","),this.expandImg=this.getProp("expimg",""),this.workImg=this.getProp("workimg","dnnanim.gif"),this.animf=new Number(this.getProp("animf","5")),this.collapseImg=this.getProp("colimg",""),this.indentWidth=new Number(this.getProp("indentw","10")),0==this.indentWidth&&(this.indentWidth=10),this.checkBoxes="1"==this.getProp("checkboxes","0"),this.checkBoxMode=new Number(this.getProp("cbm","0")),this.target=this.getProp("target",""),this.defaultJS=this.getProp("js",""),this.postBack=this.getProp("postback",""),this.callBack=this.getProp("callback",""),this.callBackStatFunc=this.getProp("callbackSF",""),this.callBackStatFunc.length>0&&this.add_handler("callBackStatus",eval(this.callBackStatFunc)),this.expImgWidth=new Number(this.getProp("expcolimgw","12")),kbCtl=this.container,this.container.tabIndex<=0?this.container.tabIndex=0:(kbCtl=document.createElement("input"),kbCtl.type="text",kbCtl.style.width=0,kbCtl.style.height=0,kbCtl.style.background="transparent",kbCtl.style.border=0,kbCtl.style.positioning="absolute",kbCtl.style.left="-999em",this.container.parentNode.appendChild(kbCtl)),this.addHandlers(kbCtl,{keydown:this.keydownHandler,focus:this.focusHandler},this),this._onsubmitDelegate=Function.createDelegate(this,this._onsubmit),dnn.controls.submitComp.add_handler(this._onsubmitDelegate)},dnn.controls.DNNTree.prototype={initialize:function(){dnn.controls.DNNTree.callBaseMethod(this,"initialize"),this.generateTreeHTML()},focusHandler:function(e){var tNode=this.hoverTreeNode;null==tNode&&(tNode=new dnn.controls.DNNTreeNode(this.rootNode.childNodes(0))),this.hoverNode(tNode),this.container.onfocus=null},keydownHandler:function(e){var dir=0,axis="";if(e.keyCode==KEY_UP_ARROW&&(dir=-1,axis="y"),e.keyCode==KEY_DOWN_ARROW&&(dir=1,axis="y"),e.keyCode==KEY_LEFT_ARROW&&(dir=-1,axis="x"),e.keyCode==KEY_RIGHT_ARROW&&(dir=1,axis="x"),0!=dir){var node,tNode=this.hoverTreeNode;if(null==tNode&&(tNode=new dnn.controls.DNNTreeNode(this.rootNode.childNodes(0))),"x"==axis)dir==-1&&(tNode.hasNodes&&tNode.expanded?this.collapseNode(tNode):node=tNode.node.parentNode()),1==dir&&(tNode.hasNodes||tNode.hasPendingNodes)&&(1!=tNode.expanded?this.expandNode(tNode):node=tNode.node.childNodes(0));else if("y"==axis){var iNodeIndex=tNode.node.getNodeIndex("id"),parentNode=tNode.node.parentNode();if(tNode.hasNodes&&tNode.expanded&&dir>0)node=tNode.node.childNodes(0);else if(iNodeIndex+dir<0)node=parentNode;else if(iNodeIndex+dir<parentNode.childNodeCount()){if(node=parentNode.childNodes(iNodeIndex+dir),dir==-1)for(var tNode2=new dnn.controls.DNNTreeNode(node);tNode2.expanded&&0!=tNode2.node.childNodeCount();)node=tNode2.node.childNodes(tNode2.node.childNodeCount()-1),tNode2=new dnn.controls.DNNTreeNode(node)}else if("root"!=parentNode.nodeName()){var iNodeIndex=parentNode.getNodeIndex("id"),tempParent=parentNode;if(1==dir)for(;"root"!=tempParent.nodeName()&&iNodeIndex+dir>=tempParent.parentNode().childNodeCount();)tempParent=tempParent.parentNode(),iNodeIndex=tempParent.getNodeIndex("id");"root"!=tempParent.nodeName()&&(node=tempParent.parentNode().childNodes(iNodeIndex+1))}}return null!=node&&"root"!=node.nodeName()&&this.hoverNode(new dnn.controls.DNNTreeNode(node)),!1}if(e.keyCode==KEY_RETURN&&null!=this.hoverTreeNode)return this.selectNode(this.hoverTreeNode),!1},hoverNode:function(tNode){null!=this.hoverTreeNode&&(this.hoverTreeNode.hover=!1,this.assignCss(this.hoverTreeNode)),tNode.hover=!0,this.assignCss(tNode),this.hoverTreeNode=tNode},getXml:function(){return this.rootNode.getXml()},expandNode:function(tNode){var ctr=this.getChildControl(tNode.id,"pctr"),expandCol=this.getChildControl(tNode.id,"expcol");if(expandCol.src=this.expandImg,tNode.expanded=!0,tNode.update(),this.update(),tNode.hasPendingNodes){var sXml=tNode.node.getXml();if(tNode.tree=this,null!=this.workImg){var icon=this.getChildControl(tNode.id,"icn");icon&&(icon.src=this.sysImgPath+this.workImg)}this.callBack.indexOf("[NODEXML]")>-1?eval(this.callBack.replace("[NODEXML]",dnn.escapeForEval(sXml))):eval(this.callBack.replace("[NODEID]",tNode.id)),tNode.hasPendingNodes=!1,tNode.hasNodes=!0,this.hoverTreeNode=tNode}else dnn.dom.expandElement(ctr,this.animf);return!0},collapseNode:function(tNode){var ctr=this.getChildControl(tNode.id,"pctr"),expandCol=this.getChildControl(tNode.id,"expcol");return dnn.dom.collapseElement(ctr,this.animf),expandCol.src=this.collapseImg,tNode.expanded=null,tNode.update(),this.update(),!0},selectNode:function(tNode){var arg=new dnn.controls.DNNNodeEventArgs(tNode);if(this.invoke_handler("click",arg),!arg.get_cancel()){null!=this.selTreeNode&&0==this.checkBoxes&&(this.selTreeNode.selected=null,this.assignCss(this.selTreeNode),this.selTreeNode.update("selected")),tNode.selected?(tNode.selected=null,this.assignCss(tNode)):(tNode.selected=!0,this.hoverTreeNode=tNode,this.assignCss(tNode)),tNode.update("selected"),this.selTreeNode=tNode,this.update();var chk=this.getChildControl(tNode.id,"chk");if(null!=chk&&(chk.checked=tNode.selected),tNode.selected){var js="";if(this.defaultJS.length>0&&(js=this.defaultJS),tNode.js.length>0&&(js=tNode.js),js.length>0&&0==eval(js))return;null==tNode.clickAction||tNode.clickAction==dnn.controls.action.postback?eval(this.postBack.replace("[NODEID]",tNode.id)):tNode.clickAction==dnn.controls.action.nav?dnn.dom.navigate(tNode.url,tNode.target.length>0?tNode.target:this.target):tNode.clickAction==dnn.controls.action.expand&&(tNode.hasNodes||tNode.hasPendingNodes)&&(tNode.expanded?this.collapseNode(tNode):this.expandNode(tNode))}return!0}},selectAllChildren:function(tNode){for(var childTNode,i=0;i<tNode.childNodeCount();i++)childTNode=tNode.childNodes(i),childTNode.selected!=tNode.selected&&this.selectNode(childTNode),this.selectAllChildren(childTNode)},assignCss:function(tNode){var oText=this.getChildControl(tNode.id,"t"),sNodeCss=this.css;tNode.level>0&&this.cssChild.length>0&&(sNodeCss=this.cssChild),tNode.css.length>0&&(sNodeCss=tNode.css),tNode.hover&&(sNodeCss+=" "+(tNode.cssHover.length>0?tNode.cssHover:this.cssHover)),tNode.selected&&(sNodeCss+=" "+(tNode.cssSel.length>0?tNode.cssSel:this.cssSel)),oText.className=sNodeCss},update:function(force){return force&&(this.selTreeNode&&dnn.setVar(this.ns+":selected",this.selTreeNode.id),dnn.setVar(this.ns+"_json",dnn.decodeHTML(this.rootNode.getJSON()))),!0},_onsubmit:function(){this.update(!0)},callBackStatus:function(result,ctx,req){var tNode=ctx,tree=tNode.tree;tree.invoke_compatHandler("callBackStatus",result,ctx,req)},callBackSuccess:function(result,ctx,req){var tNode=ctx,tree=tNode.tree,parent=tNode.node,json=dnn.evalJSON("{"+result+"}");if(parent.nodes=json.nodes,parent.setupJSONNodes(parent.rootNode(),parent,parent.nodes),null!=tree.workImg){var icon=tree.getChildControl(tNode.id,"icn");""!=tNode.image?icon.src=tNode.image:tNode.imageIndex>-1&&(icon.src=tree.imageList[tNode.imageIndex])}var ctr=tree.getChildControl(tNode.id,"pctr");tree.renderNode(tNode.node,ctr,!0),tree.update(),tree.expandNode(new dnn.controls.DNNTreeNode(tNode.node)),tree.invoke_compatHandler("callBackStatus",result,ctx,req),tree.invoke_handler("callBackSuccess",new dnn.controls.DNNCallbackEventArgs(result,ctx,req))},callBackFail:function(result,ctx,req){var tNode=ctx,tree=tNode.tree;tree.invoke_handler("callBackFail",new dnn.controls.DNNCallbackEventArgs(result,ctx,req))},nodeExpColClick:function(evt){var node=this._findEventNode(evt);if(null!=node){var tNode=new dnn.controls.DNNTreeNode(node);this.getChildControl(tNode.id,"pctr");tNode.expanded?this.collapseNode(tNode):this.expandNode(tNode)}},nodeCheck:function(evt){var node=this._findEventNode(evt);if(null!=node){var tNode=new dnn.controls.DNNTreeNode(node);2==this.checkBoxMode&&null!=this.selTreeNode&&this.selectNode(this.selTreeNode),this.selectNode(tNode),1==this.checkBoxMode&&this.selectAllChildren(tNode)}},nodeTextClick:function(evt){var node=this._findEventNode(evt);null!=node&&this.selectNode(new dnn.controls.DNNTreeNode(node))},nodeTextMOver:function(evt){var node=this._findEventNode(evt);null!=node&&this.hoverNode(new dnn.controls.DNNTreeNode(node))},nodeTextMOut:function(evt){var node=this._findEventNode(evt);null!=node&&this.assignCss(new dnn.controls.DNNTreeNode(node))},dispose:function(){this._onsubmitDelegate=null,dnn.controls.DNNTree.callBaseMethod(this,"dispose")},generateTreeHTML:function(){this.renderNode(null,this.container)},renderNode:function(node,oCont,bExists){var tNode,oChildCont=oCont;if(1!=bExists){if(null!=node){tNode=new dnn.controls.DNNTreeNode(node);var oNewContainer;if(oNewContainer=this.createChildControl("DIV",tNode.id,"ctr"),null==document.getElementById(oNewContainer.id)){oNewContainer.appendChild(this.renderSpacer(this.indentWidth*tNode.level+(tNode.hasNodes||tNode.hasPendingNodes?0:this.expImgWidth))),(tNode.hasNodes||tNode.hasPendingNodes)&&oNewContainer.appendChild(this.renderExpCol(tNode)),this.checkBoxes&&oNewContainer.appendChild(this.renderCheckbox(tNode));var oIconCont=this.renderIconCont(tNode);oNewContainer.appendChild(oIconCont),(tNode.imageIndex>-1||""!=tNode.image)&&oIconCont.appendChild(this.renderIcon(tNode)),oNewContainer.appendChild(this.renderText(tNode)),oCont.appendChild(oNewContainer),this.assignCss(tNode)}}else node=this.rootNode;null!=tNode&&(tNode.hasNodes||tNode.hasPendingNodes)&&(oChildCont=this.createChildControl("DIV",tNode.id,"pctr"),1!=tNode.expanded&&(oChildCont.style.display="none"),oCont.appendChild(oChildCont))}for(var i=0;i<node.childNodeCount();i++)this.renderNode(node.childNodes(i),oChildCont)},renderExpCol:function(tNode){var img=this.createChildControl("IMG",tNode.id,"expcol");return(tNode.hasNodes||tNode.hasPendingNodes)&&this.expandImg.length&&(tNode.expanded?img.src=this.expandImg:img.src=this.collapseImg),img.style.cursor="pointer",this.addHandlers(img,{click:this.nodeExpColClick},this),img},renderIconCont:function(tNode){var span=this.createChildControl("SPAN",tNode.id,"icnc");return tNode.cssIcon.length>0?span.className=tNode.cssIcon:this.cssIcon.length>0&&(span.className=this.cssIcon),span},renderIcon:function(tNode){var img=this.createChildControl("IMG",tNode.id,"icn");return""!=tNode.image?img.src=tNode.image:tNode.imageIndex>-1&&(img.src=this.imageList[tNode.imageIndex]),img},renderCheckbox:function(tNode){var chk=this.createChildControl("INPUT",tNode.id,"chk");return chk.type="checkbox",chk.defaultChecked=tNode.selected,chk.checked=tNode.selected,this.addHandlers(chk,{click:this.nodeCheck},this),chk},renderSpacer:function(width){var img=document.createElement("IMG");return img.src=this.sysImgPath+"spacer.gif",img.width=width,img.height=1,img.style.width=width+"px",img.style.height="1px",img},renderText:function(tNode){var span=this.createChildControl("SPAN",tNode.id,"t");return span.innerHTML=tNode.text,span.style.cursor="pointer",tNode.toolTip.length>0&&(span.title=tNode.toolTip),(tNode.enabled||tNode.clickAction==dnn.controls.action.expand)&&(this.checkBoxes?this.addHandlers(span,{click:this.nodeCheck},this):this.addHandlers(span,{click:this.nodeTextClick},this),this.cssHover.length>0&&this.addHandlers(span,{mouseover:this.nodeTextMOver,mouseout:this.nodeTextMOut},this)),tNode.selected&&(this.selTreeNode=tNode,this.hoverTreeNode=tNode),span},_findEventNode:function(evt){return this.rootNode.findNode(this.getChildControlBaseId(evt.target))},_loadNodes:function(){var json=dnn.evalJSON(dnn.getVar(this.ns+"_json"));json&&(this.nodes=json.nodes,this.rootNode={},this.rootNode.nodes=this.nodes,this.rootNode.id=this.ns,this.rootNode=new dnn.controls.JSONNode(this.rootNode,"root",0))}},dnn.controls.DNNTree.registerClass("dnn.controls.DNNTree",dnn.controls.control),dnn.controls.DNNTreeNode=function(node){dnn.controls.DNNTreeNode.initializeBase(this,[node]),this.hover=!1,this.expanded="1"==node.getAttribute("expanded","0")||null,this.selected="1"==node.getAttribute("selected","0")||null,this.clickAction=node.getAttribute("ca",dnn.controls.action.postback),this.imageIndex=new Number(node.getAttribute("imgIdx","-1"))},dnn.controls.DNNTreeNode.prototype={childNodes:function(iIndex){if(null!=this.node.childNodes(iIndex))return new dnn.controls.DNNTreeNode(this.node.childNodes(iIndex))}},dnn.controls.DNNTreeNode.registerClass("dnn.controls.DNNTreeNode",dnn.controls.DNNNode);var DT_ACTION_POSTBACK=0,DT_ACTION_EXPAND=1,DT_ACTION_NONE=2,DT_ACTION_NAV=3;