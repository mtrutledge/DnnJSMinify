window.dnn=window.dnn||{},window.dnn.editBar=window.dnn.editBar||{},function(){var PersonaBarDialogClass;PersonaBarDialogClass=function(){"use strict";function PersonaBarDialog(options,htmlForPannels,koObserveCallback,afterBindCallback,afterShowDialogCallback){return PersonaBarDialog.active?void console.log("PersonaBarDialog already opened"):(PersonaBarDialog.active=!0,options||(options={scrollPrevented:!0,inObject:$(document.body),animation:!0,width:650,title:"Notice",innerTitle:"",showAcceptBtn:!0,acceptBtnLbl:"Accept",showCancelBtn:!0,cancelBtnLbl:"Cancel",onAcceptCallback:null,onCloseCallback:null,closeOnAccept:!0}),_options=options,options.scrollPrevented!==!1&&(options.scrollPrevented=!0),_options.scrollPrevented=options.scrollPrevented,options.width||(_options.width=650),options.title||(_options.title="Notice"),options.inObject||(_options.inObject=$(document.body)),options.animation||(_options.animation=!0),options.innerTitle||(_options.innerTitle=""),options.acceptBtnLbl||(_options.acceptBtnLbl="Accept"),options.showAcceptBtn||(_options.showAcceptBtn=!0),options.cancelBtnLbl||(_options.cancelBtnLbl="Cancel"),options.showCancelBtn||(_options.showCancelBtn=!0),options.animation||(_options.animation=!0),options.closeOnAccept||"boolean"==typeof options.closeOnAccept||(_options.closeOnAccept=!0),_options.onAcceptCallback=options.onAcceptCallback,_options.onCancelCallback=options.onCancelCallback,_options.onCloseCallback=options.onCloseCallback,_options.afterShowDialogCallback=function(){"function"==typeof afterShowDialogCallback&&afterShowDialogCallback()},_viewModel={},htmlForPannels||(htmlForPannels=""),addDialog(),void setTimeout(function(){initDialog();var personaBarDialog=$(".personaBarDialog");personaBarDialog.width(_options.width),personaBarDialog.css("margin-left",-1*personaBarDialog.width()/2),htmlForPannels&&personaBarDialog.find(".panels").prepend(htmlForPannels),setTimeout(function(){applyBindings("function"==typeof koObserveCallback?koObserveCallback():void 0),"function"==typeof afterBindCallback&&afterBindCallback(),showDialog()},0)},0))}var _options,_html,_viewModel,_personaBarDialogMask,_personaBarDialog,_originalHeight,_top,_win,addDialog,applyBindings,closeDialog,acceptDialog,initDialog,showDialog,updateHeight;return PersonaBarDialog.class="PersonaBarDialog",PersonaBarDialog.type="Class",PersonaBarDialog.active=!1,_html='<div class="personaBarDialogMask" style="display:none;"></div>\t\t\t\t\t<div class="personaBarDialog" style="display:none;">\t\t\t\t\t\t<div class="dialogContainer">\t\t\t\t\t\t\t<div class="dialogTitle">\t\t\t\t\t\t\t\t<span class="dialogTitle" data-bind="html: title"></span>\t\t\t\t\t\t\t\t<span class="btn-close" data-bind="click: closeDialog"></span>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t\t<div class="dialogContent">\t\t\t\t\t\t\t\t<div class="dialogTitle" data-bind="html: innerTitle"></div>\t\t\t\t\t\t\t\t<div class="panels" data-bind="with: dialogHTML"></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="actions">\t\t\t\t\t\t\t<span class="btn btn-accept" data-bind="visible: showAcceptBtn, text: acceptBtnLbl, click: acceptDialog"></span>\t\t\t\t\t\t\t<span class="btn btn-cancel" data-bind="visible: showCancelBtn, text: cancelBtnLbl, click: closeDialog"></span>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',_options=null,_viewModel=null,_personaBarDialog=null,_personaBarDialogMask=null,applyBindings=function(viewModel){setTimeout(function(){_viewModel={dialogHTML:"",title:ko.observable(_options.title),innerTitle:ko.observable(_options.innerTitle),acceptBtnLbl:ko.observable(_options.acceptBtnLbl),showAcceptBtn:ko.observable(_options.showAcceptBtn),cancelBtnLbl:ko.observable(_options.cancelBtnLbl),showCancelBtn:ko.observable(_options.showCancelBtn),acceptDialog:acceptDialog,closeDialog:closeDialog,enableAccept:ko.observable(!0)},"object"==typeof viewModel&&(_viewModel.dialogHTML=viewModel,viewModel.enableAcceptForDialog&&(_viewModel.enableAccept=viewModel.enableAcceptForDialog)),ko.applyBindings(_viewModel,_personaBarDialog[0])},0)},addDialog=function(){return $("body").prepend(_html)},closeDialog=function(){var node;_win&&_win.off(".personaBarDialog"),_personaBarDialog&&_options.scrollPrevented&&_personaBarDialog.off("DOMMouseScroll mousewheel"),node=$(".personaBarDialog"),"function"==typeof _options.beforeCloseCallback&&_options.beforeCloseCallback(),node.length>0&&ko.cleanNode($(".personaBarDialog")[0]),_options.inObject.height(_originalHeight),_personaBarDialog.remove(),_personaBarDialogMask.remove(),"function"==typeof _options.onCloseCallback&&_options.onCloseCallback(),PersonaBarDialog.active=!1},acceptDialog=function(){("boolean"!=typeof _viewModel.enableAccept||_viewModel.enableAccept)&&("function"!=typeof _viewModel.enableAccept||_viewModel.enableAccept())&&("function"==typeof _options.onAcceptCallback&&_options.onAcceptCallback(),_options.closeOnAccept===!0&&closeDialog())},initDialog=function(){var doc,bottom,left,top;_win=$(window),doc=$(document),_personaBarDialogMask=$(".personaBarDialogMask"),_personaBarDialog=$(".personaBarDialog"),_personaBarDialog.draggable({handle:".dialogTitle",cursor:"move"}),left="-"+Math.round(_options.width/2)+"px",top=100+doc.scrollTop()+"px",bottom="40px",_personaBarDialog.css({top:top,"margin-left":left,"margin-bottom":bottom}),_personaBarDialogMask.css({height:doc.height()+_personaBarDialog.height()}),setTimeout(function(){_top=doc.scrollTop(),_personaBarDialogMask.css({"min-height":doc.scrollTop()+_personaBarDialog.height()+100+"px"})},0),_win.off("scroll.personaBarDialog").on("scroll.personaBarDialog",function(){doc.scrollTop()<_top&&doc.scrollTop(_top)}),_win.off("keydown.personaBarDialog").on("keydown.personaBarDialog",function(evt){27===evt.keyCode&&closeDialog()}),_options.scrollPrevented&&_personaBarDialog.off("DOMMouseScroll mousewheel").on("DOMMouseScroll mousewheel",function(evt){var self,scrollTop,scrollHeight,height,delta,up,prevent;return self=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=self.height(),delta=evt.originalEvent.wheelDelta,up=delta>0,prevent=function(){return evt.stopPropagation(),evt.preventDefault(),evt.returnValue=!1,!1},!up&&-delta>scrollHeight-height-scrollTop?(self.scrollTop(scrollHeight),prevent()):up&&delta>scrollTop?(self.scrollTop(0),prevent()):void 0})},showDialog=function(){_personaBarDialogMask.show(),_options.animation?_personaBarDialog.fadeIn(100,function(){_options.afterShowDialogCallback()}):(_personaBarDialog.show(),_options.afterShowDialogCallback())},updateHeight=function(){_personaBarDialogMask.css({"min-height":$(document).scrollTop()+_personaBarDialog.height()+400+"px"})},PersonaBarDialog.prototype.updateHeight=updateHeight,PersonaBarDialog.prototype.close=closeDialog,PersonaBarDialog}(),window.dnn.editBar.PersonaBarDialog=PersonaBarDialogClass}.call(this);