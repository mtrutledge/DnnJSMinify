!function($){$.fn.EditBarWorkflowImageUpload=function(options){function supportAjaxUpload(){var xhr=new XMLHttpRequest;return!!(xhr&&"upload"in xhr&&"onprogress"in xhr.upload)}function browserSupportsDragDrop(){return"draggable"in document.createElement("span")}function getResult(data){var result;try{result=supportAjaxUpload()?JSON.parse(data.result):JSON.parse($("pre",data.result).html())}catch(e){return null}return result}var $dropZone,$imageInputFile,url,antiForgeryToken;return browserSupportsDragDrop()||$("span.dragMessage").hide(),$dropZone=this,$imageInputFile=$(".uploadFileInput",$dropZone),$imageInputFile.dnnFileInput({buttonClass:"dnnPrimaryAction",showSelectedFileNameAsButtonText:!1}),url=options.url,supportAjaxUpload()||(antiForgeryToken=$('input[name="__RequestVerificationToken"]').val(),url+="?__RequestVerificationToken="+antiForgeryToken),$imageInputFile.fileupload({url:url,beforeSend:options.servicesFramework.setModuleHeaders,dropZone:$dropZone,paramName:options.paramName,sequentialUpload:!0,progressInterval:20,dragover:function(){options.addElementDragover&&options.addElementDragover.addClass("dragover"),$dropZone.addClass("dragover")},drop:function(){options.addElementDragover&&options.addElementDragover.removeClass("dragover"),$dropZone.removeClass("dragover")},submit:function(e,data){return options.paintInObj?options.paintInObj.addClass("uploading"):$dropZone.addClass("uploading"),data.formData={type:options.param},data.formData=$.extend(data.formData,options.request),$(document).trigger(options.param+"BeginUpload",data.result),!0},done:function(e,data){var result,value;result=getResult(data),"success"==data.textStatus?(value=result.FilePath&&""!==result.FilePath?'url("'+result.FilePath+'")':"",options.paintInObj?(options.paintInObj.css("background-image",value),options.paintInObj.removeClass("uploading"),options.paintInObj.addClass("withImage")):($dropZone.css("background-image",value),$dropZone.removeClass("uploading"),$dropZone.addClass("withImage")),options.imageCallbackInfo.fileId=result.FileId,options.imageCallbackInfo.filePath=result.FilePath):$.dnnAlert({title:data.response().errorThrown,text:$.parseJSON(data.response().jqXHR.responseText).Message})},fail:function(e,data){options.paintInObj?options.paintInObj.removeClass("uploading"):$dropZone.removeClass("uploading"),$.dnnAlert({title:data.response().errorThrown,text:$.parseJSON(data.response().jqXHR.responseText).Message})}}),$dropZone.on("dragleave",function(){options.addElementDragover&&options.addElementDragover.removeClass("dragover"),$(this).removeClass("dragover")}),$dropZone.on("logoUpload",function(e,logoUrl){var value=logoUrl&&""!==logoUrl?'url("'+logoUrl+'")':"";$("#uploadLogoFileDropZone").css("background-image",value)}),this}}(jQuery);