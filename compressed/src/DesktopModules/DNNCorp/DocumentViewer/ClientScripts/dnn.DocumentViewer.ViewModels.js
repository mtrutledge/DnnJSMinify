function TagsViewModel(options){var self=this;self.isLoadingTags=ko.observable(!1),self.tags=ko.observableArray(),self.totalCount=ko.observable(0),self.pageSize=ko.observable(15),self.startIndex=ko.observable(0),self.sortedBy=ko.observable("alpha"),self.sortedOrder=ko.observable("asc"),self.sortBy=function(sortByParameter){self.sortedBy()==sortByParameter?(self.sortedBy(sortByParameter),"asc"==self.sortedOrder()?self.sortedOrder("desc"):self.sortedOrder("asc")):(self.sortedBy(sortByParameter),self.sortedOrder("asc")),self.startIndex(0),options.documentViewer._getTags()},self.contextMenuClick=function(tag,event){var $menu=$("#"+options.contextMenuId);$menu.hide(),self.contextMenuTag(tag);var $fileItems=$("#"+options.contextMenuId+"> .onlyFiles");$fileItems.hide(),$menu.css({left:event.pageX,top:event.pageY}).slideDown(200),$(document).on("click.dnnDocumentViewer",function(){$menu.hide(),$(document).off("click.dnnDocumentViewer")})},self.tagUrl=function(tag){var siteUrl=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");return siteUrl+location.pathname+"?tagName="+encodeURIComponent(tag.Name)},self.hasMultiplePages=ko.computed(function(){return self.totalCount()>self.pageSize()}),self.pagerLabel=ko.computed(function(){return options.resources.tagPagerText.replace("[FIRST]",self.startIndex()+1).replace("[LAST]",self.startIndex()+self.tags().length).replace("[TOTAL]",self.totalCount())}),self.isFirstPage=ko.computed(function(){return 0==self.startIndex()}),self.isLastPage=ko.computed(function(){return self.startIndex()+self.pageSize()>=self.totalCount()}),self.prevPage=function(){if(!self.isFirstPage()){var startIndex=self.startIndex()-self.pageSize();self.startIndex(startIndex),options.documentViewer._getTags()}},self.nextPage=function(){if(!self.isLastPage()){var startIndex=self.startIndex()+self.pageSize();self.startIndex(startIndex),options.documentViewer._getTags()}},self.selectedTag=ko.observable(null),self.contextMenuTag=ko.observable(null),self.selectTag=function(data){self.selectedTag(data),options.documentViewer._getGridContent("Tags")}}function ColumnViewModel(name,key,align,width,grid){var self=this;self.name=name,self.key=key,self.align=align,self.width=width,self.columnWidth=ko.computed(function(){return 0==width?"inherit":width+"px"}),self.columnCss=ko.computed(function(){var result="";return 0==width&&(result="dnnModuleDocumentViewerNoWidthFixedColumn "),"left"==align&&(result+="dnnModuleDocumentViewerLeftAlignColumn"),"right"==align&&(result+="dnnModuleDocumentViewerRightAlignColumn"),result}),self.sortCss=ko.computed(function(){if(grid.sortedByColumnName()==key){if("asc"==grid.sortedByOrder())return"sortAsc";if("desc"==grid.sortedByOrder())return"sortDesc"}return"noSort"})}function GridViewModel(options){function getTimeStamp(){var timestamp=new Date;return timestamp=timestamp.getTime(),"timestamp="+timestamp}function setTimeStamp(url){return url.indexOf("?")==-1?url+"?"+getTimeStamp():url+"&"+getTimeStamp()}var self=this;self.selectedItem=ko.observable(null),self.selectItem=function(item){self.selectedItem(self.selectedItem()&&self.selectedItem().ItemId==item.ItemId?null:item)},self.itemAction=function(item){item.IsFolder?options.documentViewer.openFolder(item.ItemId):item.ViewPermission&&window.open(setTimeStamp(self.itemUrl(item)))},self.downloadSelectedItem=function(){var url=options.documentViewer._serviceUrl+"ContentService/Download?fileId="+self.selectedItem().ItemId+"&ModuleId="+options.documentViewer.$dnnSF.getModuleId()+"&TabId="+options.documentViewer.$dnnSF.getTabId()+"&forceDownload=true",$idown=$("#dnnDocumentViewerDownloadIframe");0==$idown.length&&($idown=$("<iframe>",{id:"idown"}).hide().appendTo("body")),$idown.attr("src",url)},self.itemUrl=function(item){if(0==item.Url.indexOf("http://")||0==item.Url.indexOf("https://"))return item.Url;var siteUrl=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");return item.IsFolder?siteUrl+location.pathname+"?folderId="+item.ItemId:siteUrl+item.Url},self.getUrlSelectedItem=function(){var url=self.itemUrl(self.selectedItem());$("#dnnDocumentViewerGetUrlModal input").val(url).select(),$("#dnnDocumentViewerGetUrlModal").dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:500,height:250,resizable:!1,title:options.resources.getUrlTitle,buttons:[{id:"close_button",text:options.resources.closeText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}]})},self.contextMenuClick=function(item,event){var $menu=$("#"+options.contextMenuId);$menu.hide(),self.selectedItem(item);var $fileItems=$("#"+options.contextMenuId+"> .onlyFiles");self.selectedItem().IsFolder?$fileItems.hide():$fileItems.show(),self.canViewItemOptions()&&self.openContextMenu($menu,event)},self.openContextMenu=function($menu,event){$menu.css({left:event.pageX,top:event.pageY}).slideDown(200),$(document).on("click.dnnDocumentViewer",function(){$menu.hide(),$(document).off("click.dnnDocumentViewer")})},self.canViewFile=ko.computed(function(){return!!self.selectedItem()&&(self.selectedItem().ViewPermission&&!self.selectedItem().IsFolder)}),self.canViewItemOptions=ko.computed(function(){return!!self.selectedItem()&&(self.canViewFile()||self.selectedItem().IsFolder)}),self.sortedByColumnName=ko.observable(options.gridSettings.defaultSortColumnName),self.sortedByOrder=ko.observable(options.gridSettings.defaultSortOrder),self.sortExpression=ko.computed(function(){return self.sortedByColumnName()+" "+self.sortedByOrder()});for(var columns=[],i=0;i<options.gridSettings.columns.length;i++){var column=options.gridSettings.columns[i];columns.push(new ColumnViewModel(column.name,column.key,column.align,column.width,self))}self.columns=columns,self.sortColumn=function(selectedColumn){var sort="";self.sortedByColumnName()==selectedColumn.key?("asc"==self.sortedByOrder()&&(sort="desc"),""==self.sortedByOrder()&&(sort="asc")):(sort="asc",self.sortedByColumnName(selectedColumn.key)),self.sortedByOrder(sort),self.currentPage(0),options.documentViewer._getGridContent()},self.toggleSort=function(){var sort="asc"==self.sortedByOrder()?"desc":"asc";self.sortedByOrder(sort),self.currentPage(0),options.documentViewer._getGridContent()},self.sortColumnChange=function(){self.currentPage(0),self.sortedByOrder("asc"),options.documentViewer._getGridContent()},self.items=ko.observableArray(),self.items.subscribe(function(){if(self.selectedItem()){var selectedItem=ko.utils.arrayFirst(self.items(),function(item){return item.ItemId==self.selectedItem().ItemId});selectedItem||self.selectedItem(null)}}),self.totalCount=ko.observable(0),self.pageSize=ko.observable(options.gridSettings.pageSize),self.currentPage=ko.observable(0),self.pageSlide=ko.observable(2),self.lastPage=ko.computed(function(){return Math.ceil(self.totalCount()/self.pageSize())}),self.pages=ko.computed(function(){var pageCount=self.lastPage(),pageFrom=Math.max(1,self.currentPage()-self.pageSlide()),pageTo=Math.min(pageCount,self.currentPage()+self.pageSlide());pageFrom=Math.max(1,Math.min(pageTo-2*self.pageSlide(),pageFrom)),pageTo=Math.min(pageCount,Math.max(pageFrom+2*self.pageSlide(),pageTo));for(var result=[],i=pageFrom;i<=pageTo;i++)result.push(i);return result}),self.changePage=function(page){return self.currentPage(page),options.documentViewer._getGridContent(),page},self.totalItemsText=ko.computed(function(){return 1==self.totalCount()?options.resources.oneItem:self.totalCount()<self.pageSize()?options.resources.items.replace("[ITEMS]",self.totalCount()):options.resources.itemsOnPage.replace("[ITEMS]",self.totalCount()).replace("[PAGES]",Math.ceil(self.totalCount()/self.pageSize()))}),self.refresh=function(){self.currentPage(0),options.documentViewer._getGridContent()}}