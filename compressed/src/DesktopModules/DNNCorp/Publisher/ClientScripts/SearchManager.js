window.dnn=dnn||{},window.dnn.modules=dnn.modules||{},window.dnn.modules.publisher=dnn.modules.publisher||{},window.dnn.modules.publisher.SearchManager=function($,ko){"use strict";function updateViewing(){disableEvent=!0,viewModel.viewing.removeAll();for(var tags=viewModel.selectedTags(),i=0;i<tags.length;i++)viewModel.viewing.push({type:"tag",id:tags[i],name:tags[i]});null!==viewModel.selectedAuthor()&&viewModel.viewing.push({type:"author",id:viewModel.selectedAuthor().key,name:viewModel.selectedAuthor().name}),disableEvent=!1}function init(config){configuration=config,viewModel.searchText=config.searchText,viewModel.selectedTags=config.selectedTags,viewModel.selectedAuthor=config.selectedAuthor;var text=dnn.modules.publisher.RequestUtils.getQueryParameters().text;viewModel.inputSearchText(text),updateViewing();var viewModelBinding=$(config.bindingElementSelector),node=viewModelBinding[0];ko.applyBindings(viewModel,node),viewModel.selectedTags.subscribe(updateViewing),viewModel.selectedAuthor.subscribe(updateViewing)}var configuration,viewModel={inputSearchText:ko.observable(),viewing:ko.observableArray()};viewModel.throttledInputSearchText=ko.computed(function(){return viewModel.inputSearchText()}).extend({throttle:500}),viewModel.throttledInputSearchText.subscribe(function(){viewModel.searchText(viewModel.inputSearchText())}),viewModel.keyPress=function(d,event){var keyCode=event.which?event.which:event.keyCode;return 13!==keyCode||(viewModel.doSearch(),!1)},viewModel.doSearch=function(){viewModel.searchText(viewModel.inputSearchText())};var disableEvent=!1;return viewModel.onRemovedFilter=function(value){if(!disableEvent)if("tag"===value.type){var index=viewModel.selectedTags.indexOf(value.id);viewModel.selectedTags.splice(index,1)}else"author"===value.type&&viewModel.selectedAuthor(null)},{init:init}}(jQuery||$,ko);