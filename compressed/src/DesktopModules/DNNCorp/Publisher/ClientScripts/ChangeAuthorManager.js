window.dnn=dnn||{},window.dnn.modules=dnn.modules||{},window.dnn.modules.publisher=dnn.modules.publisher||{},window.dnn.modules.publisher.ChangeAuthorManager=function($,ko){"use strict";var viewModel,configuration,setAuthor,sort,sortColumnClass,show,hide,createViewModel,loadAuthors,sortUserList;createViewModel=function(){viewModel={visible:ko.observable(!1),users:ko.observableArray([]),author:ko.observable(),orderBy:ko.observable("displayName"),orderAsc:ko.observable(!0),setAuthor:setAuthor,sort:sort,sortColumnClass:sortColumnClass,hide:hide}};var init=function(config){configuration=config,createViewModel(),viewModel.author({userId:config.authorUserId,avatar:config.authorAvatar,displayName:config.authorDisplayName}),viewModel.author.subscribe(function(){$.dnnNotif({dialogClass:"noTittle",height:50,styleBlue:!0,text:configuration.resx.authorSuccessfullyChanged})});var viewModelBinding=$(config.bindingElementSelector);ko.applyBindings(viewModel,viewModelBinding[0])};return loadAuthors=function(){dnn.modules.publisher.RequestUtils.request("Publisher","Author","GetAuthors","GET",null,function(data){ko.utils.arrayPushAll(viewModel.users,data),sortUserList(viewModel.orderBy(),viewModel.orderAsc())})},show=function(){0===viewModel.users().length&&loadAuthors(),viewModel.visible(!0)},hide=function(){viewModel.visible(!1)},sort=function(d,e){var column=$(e.target).attr("data-column");viewModel.orderBy()===column?viewModel.orderAsc(!viewModel.orderAsc()):(viewModel.orderBy(column),viewModel.orderAsc(!0)),sortUserList(viewModel.orderBy(),viewModel.orderAsc())},sortUserList=function(column,ascending){var operator=ascending?"<":">",sortFunction=new Function("left","right","return left."+column+" == right."+column+" ? 0 : (left."+column+" "+operator+" right."+column+" ? -1 : 1);");viewModel.users.sort(sortFunction)},sortColumnClass=function(column){return column===viewModel.orderBy()?viewModel.orderAsc()?"asc":"desc":""},setAuthor=function(author){if(viewModel.author().userId!==author.userId){if(0===configuration.contentItemId)return void viewModel.author(author);var params={contentItemId:configuration.contentItemId,userId:author.userId};dnn.modules.publisher.RequestUtils.request("Publisher","Author","SetPostAuthor","POST",params,function(){viewModel.author(author)})}},{init:init,show:show,hide:hide,getAuthorUserId:function(){return viewModel.author().userId}}}(jQuery||$,ko);