window.dnn=window.dnn||{},window.dnn.editBar=window.dnn.editBar||{},function(){var EditBarDialogClass;EditBarDialogClass=function(){"use strict";function EditBarDialog(options,htmlForPannels,koObserveCallback,afterBindCallback,afterShowDialogCallback){return EditBarDialog.active?void console.log("EditBarDialog already opened"):(EditBarDialog.active=!0,options||(options={scrollPrevented:!0,inObject:$(document.body),animation:!0,width:650,title:"Notice",innerTitle:"",showAcceptBtn:!0,acceptBtnLbl:"Accept",showCancelBtn:!0,cancelBtnLbl:"Cancel",onAcceptCallback:null,onCloseCallback:null,closeOnAccept:!0}),_options=options,options.scrollPrevented!==!1&&(options.scrollPrevented=!0),_options.scrollPrevented=options.scrollPrevented,options.width||(_options.width=650),options.title||(_options.title="Notice"),options.inObject||(_options.inObject=$(document.body)),options.animation||(_options.animation=!0),options.innerTitle||(_options.innerTitle=""),options.acceptBtnLbl||(_options.acceptBtnLbl="Accept"),options.showAcceptBtn||(_options.showAcceptBtn=!0),options.cancelBtnLbl||(_options.cancelBtnLbl="Cancel"),options.showCancelBtn||(_options.showCancelBtn=!0),options.animation||(_options.animation=!0),options.closeOnAccept||"boolean"==typeof options.closeOnAccept||(_options.closeOnAccept=!0),options.maxWidth&&(_options.maxWidth=options.maxWidth),_options.onAcceptCallback=options.onAcceptCallback,_options.onCancelCallback=options.onCancelCallback,_options.onCloseCallback=options.onCloseCallback,_options.afterShowDialogCallback=function(){"function"==typeof afterShowDialogCallback&&afterShowDialogCallback()},_viewModel={},htmlForPannels||(htmlForPannels=""),addDialog(),void setTimeout(function(){initDialog();var editBarDialog=$(".editBarDialog");editBarDialog.width(_options.width),_options.maxWidth&&editBarDialog.css("max-width",_options.maxWidth),editBarDialog.css("margin-left",-1*editBarDialog.width()/2),htmlForPannels&&editBarDialog.find(".panels").prepend(htmlForPannels),setTimeout(function(){applyBindings("function"==typeof koObserveCallback?koObserveCallback():void 0),"function"==typeof afterBindCallback&&afterBindCallback(),showDialog()},0)},0))}var _options,_html,_viewModel,_editBarDialogMask,_editBarDialog,_originalHeight,_top,_win,addDialog,applyBindings,closeDialog,acceptDialog,initDialog,showDialog,updateHeight;return EditBarDialog.class="EditBarDialog",EditBarDialog.type="Class",EditBarDialog.active=!1,_html='<div class="editBarDialogMask" style="display:none;"></div><div class="editBarDialog" style="display:none;"><div class="dialogContainer"><div class="dialogTitle"><span class="dialogTitle" data-bind="html: title"></span><span class="btn-close" data-bind="click: closeDialog"></span></div><div class="dialogContent"><div class="dialogTitle" data-bind="html: innerTitle"></div><div class="panels" data-bind="with: dialogHTML"></div></div></div><div class="actions"><span class="btn btn-accept" data-bind="visible: showAcceptBtn, text: acceptBtnLbl, click: acceptDialog"></span><span class="btn btn-cancel" data-bind="visible: showCancelBtn, text: cancelBtnLbl, click: closeDialog"></span></div></div>',_options=null,_viewModel=null,_editBarDialog=null,_editBarDialogMask=null,applyBindings=function(viewModel){setTimeout(function(){_viewModel={dialogHTML:"",title:ko.observable(_options.title),innerTitle:ko.observable(_options.innerTitle),acceptBtnLbl:ko.observable(_options.acceptBtnLbl),showAcceptBtn:ko.observable(_options.showAcceptBtn),cancelBtnLbl:ko.observable(_options.cancelBtnLbl),showCancelBtn:ko.observable(_options.showCancelBtn),acceptDialog:acceptDialog,closeDialog:closeDialog,enableAccept:ko.observable(!0)},"object"==typeof viewModel&&(_viewModel.dialogHTML=viewModel,viewModel.enableAcceptForDialog&&(_viewModel.enableAccept=viewModel.enableAcceptForDialog)),ko.applyBindings(_viewModel,_editBarDialog[0])},0)},addDialog=function(){return $("body").prepend(_html)},closeDialog=function(){var node;_win&&_win.off(".editBarDialog"),_editBarDialog&&_options.scrollPrevented&&_editBarDialog.off("DOMMouseScroll mousewheel"),node=$(".editBarDialog"),"function"==typeof _options.beforeCloseCallback&&_options.beforeCloseCallback(),node.length>0&&ko.cleanNode($(".editBarDialog")[0]),_options.inObject.height(_originalHeight),_editBarDialog.remove(),_editBarDialogMask.remove(),"function"==typeof _options.onCloseCallback&&_options.onCloseCallback(),EditBarDialog.active=!1},acceptDialog=function(){("boolean"!=typeof _viewModel.enableAccept||_viewModel.enableAccept)&&("function"!=typeof _viewModel.enableAccept||_viewModel.enableAccept())&&("function"==typeof _options.onAcceptCallback&&_options.onAcceptCallback(),_options.closeOnAccept===!0&&closeDialog())},initDialog=function(){var doc,bottom,left,top;_win=$(window),doc=$(document),_editBarDialogMask=$(".editBarDialogMask"),_editBarDialog=$(".editBarDialog"),_editBarDialog.draggable({handle:".dialogTitle",cursor:"move",start:function(){$(this).data("startingScrollTop",$(this).parent().parent().scrollTop())},drag:function(event,ui){var st=parseInt($(this).data("startingScrollTop"));ui.position.top-=st}}),left="-"+Math.round(_options.width/2)+"px",top=100+doc.scrollTop()+"px",bottom="40px",_editBarDialog.css({top:top,"margin-left":left,"margin-bottom":bottom}),_editBarDialogMask.css({height:doc.height()+_editBarDialog.height()}),setTimeout(function(){_top=doc.scrollTop(),_editBarDialogMask.css({"min-height":doc.scrollTop()+_editBarDialog.height()+100+"px"})},0),_win.off("scroll.editBarDialog").on("scroll.editBarDialog",function(){doc.scrollTop()<_top&&doc.scrollTop(_top)}),_win.off("keydown.editBarDialog").on("keydown.editBarDialog",function(evt){27===evt.keyCode&&closeDialog()}),_options.scrollPrevented&&_editBarDialog.off("DOMMouseScroll mousewheel").on("DOMMouseScroll mousewheel",function(evt){var self,scrollTop,scrollHeight,height,delta,up,prevent;return self=$(this),scrollTop=this.scrollTop,scrollHeight=this.scrollHeight,height=self.height(),delta=evt.originalEvent.wheelDelta,up=delta>0,prevent=function(){return evt.stopPropagation(),evt.preventDefault(),evt.returnValue=!1,!1},!up&&-delta>scrollHeight-height-scrollTop?(self.scrollTop(scrollHeight),prevent()):up&&delta>scrollTop?(self.scrollTop(0),prevent()):void 0})},showDialog=function(){_editBarDialogMask.show(),_options.animation?_editBarDialog.fadeIn(100,function(){_options.afterShowDialogCallback()}):(_editBarDialog.show(),_options.afterShowDialogCallback())},updateHeight=function(){_editBarDialogMask.css({"min-height":$(document).scrollTop()+_editBarDialog.height()+400+"px"})},EditBarDialog.prototype.updateHeight=updateHeight,EditBarDialog.prototype.close=closeDialog,EditBarDialog}(),window.dnn.editBar.EditBarDialog=EditBarDialogClass}.call(this);