window.dnn=window.dnn||{},window.dnn.HTMLPro=window.dnn.HTMLPro||{},function(){var ImageEditingClass;ImageEditingClass=function(){"use strict";function ImageEditing(moduleWithRedactor,redactorFacade,siteRoot,sfImage,saveImageURL,proxyImageUrl,resx){_redactorFacade=redactorFacade;var images;if(!moduleWithRedactor)throw"Module not provided";if(_module=moduleWithRedactor,_module.addClass(IMAGE_INLINE_EDIT_CLASS),!siteRoot)throw"No site root provided";if(_siteRoot=siteRoot.replace(dnn.getVar("sf_siteRoot","/"),"/"),!sfImage)throw"No image service framwork provided";if(_sfImage=sfImage,!saveImageURL)throw"No save image URL provided";if(_saveImageURL=saveImageURL,!proxyImageUrl)throw"No proxy image URL provided";_proxyImageUrl=proxyImageUrl,_moduleInitialWidth=_module.css("width"),resx&&"object"==typeof resx&&Object.keys(resx).length>0&&(_resx=resx),_editImageToolbarTemplateUnlocalized=_editImageToolbarTemplateUnlocalized.replace(/\{i0\}/g,_siteRoot),localizeTemplates(),_activeImage=null,_redactorBox=_module.closest(".redactor-box"),_redactorToolbar=_redactorBox.find(".redactor-toolbar"),initTemplate(),_history=[],initImages(),_module.on("click.imageEditing",function(evt){if(!$(evt.target).hasClass(LAYER_WRAPPER)){if(_activeJcrop)return void evt.stopPropagation();if(!isCropping(evt)&&null!==_activeImage&&"IMG"!==evt.target.nodeName){if(_imageIsResizing)return;setTimeout(function(){addWrappersToAllImages()},0),hideToolbar(),enableContentEditable()}}}),images=_module.find("img"),_module.on("scroll.imageEditing",function(){images.each(function(idx,image){image=$(image),image.parent().hasClass(IMAGE_WRAPPER)&&image.prev().offset(image.offset())})})}var CROP_ACTIONS_SIZE,ANGLE_90_DEGREES,DEGREES,ENTER,ESC,KEY_NUMBER_0,KEY_NUMBER_9,KEY_BACKSPACE,KEY_SHIFT,KEY_CTRL,KEY_LEFT_ARROW,KEY_RIGHT_ARROW,KEY_LEFT_WNDOW_KEY,NOTIF_PROCESS_HEIGHT,NOTIF_PROCESS_PROGRESS_TIME,FROM_EXTERNAL_URL_UPDATE_GUI_TIME,TIME_TO_SHOW_PROGRESS_AT_100,MAX_IMAGE_WIDTH,MAX_IMAGE_HEIGHT,ALTTEXT_PANEL_WIDTH,IMAGE_TOOLBAR_BUTTON_HEIGHT,IMAGE_WRAPPER,LAYER_WRAPPER,IMAGE_TOOL_WRAPPER,REDACTOR_IMAGE_BOX_ID,IMAGE_INLINE_EDIT_CLASS,UPDATE_IMAGE_WRAPPER_SIZES_MAX_NUMBER_OF_RETRIES,MIN_TOP_TO_SHOW_CROP_ACTION_BUTTONS,initTemplate,initImages,getLastImageHistObj,removeLastHistObj,getImageActionRotate,getImageActionResize,getImageActionCrop,getImageActions,setImageActionRotate,setImageActionResize,setImageActionCrop,getLocation,getImageHistIdx,setImageHistIdx,disableFloatButtons,disableFloatLeftButton,disableFloatRightButton,enableFloatLeftButton,enableFloatRightButton,enableIfNededFloatBtn,disableCrop,removeActionsWithWrappers,ensureClean,enableResizable,disableEditingImage,destroy,getResizeHistObject,rotateImage,addActionToImageHistChanges,enableUndo,disableUndo,showToolbar,hideToolbar,getImageSize,setImageSizes,applyResizeWithCanvas,resize,notifCantSaveImage,getFloatObject,setImageFloat,disableResizable,restoreOriginalInlineStyle,disableFloat,undoResize,undoFloat,undoDelete,undoPadding,updatePaddingPanelValues,undoAction,undoRotate,undoAltText,undoCrop,bindCropKeys,showNotifWithProgressBar,closeNotif,addWrappersToAllImages,removeWrappersOfAllImages,removeWrappersOfOneImage,enableContentEditable,getImageSizesForWrappers,updateImageWrappersSize,updateImageWrappers,isCropping,addWrappersToAnImage,imageSizeExceded,localizeTemplates,notifCannotProcessProxyImage,changeStyleBeforeResizeAction,changeStyleBeforeCropAction,changeStyleAfterAction,isBase64Image,isCrossDomainImage,processProxyImage,getImageProxyUrl,showImageSavingLayer,hideImageSavingLayer,saveImage,forceEditorToSelectImage,bindRotateBtn,bindCropBtn,bindCropButtons,bindUndoBtn,bindPaddingBtn,bindAltTextBtn,bindDeleteBtn,bindAlignLeftBtn,bindAlignRightBtn,alignButtonAction,bindResizeBtn,bindToolbarButtonsActions,activeBtn,disableActiveBtn,disablePanel,enablePanel,bindPaddingLockUnlockBtn,bindAreasAndInputsSelection,unbindAreasAndInputsSelection,bindPaddingInputsKeydown,unbindPaddingInputsKeydown,bindPaddingPlusMinusButtons,enablePaddingInputs,addPaddingHistory,setDefaultPaddingPanelConfig,bindAltTextSaveBtn,addRotateHistoryObject,cropImage,addCropHistoryObject,getElementToBeFocused,addAltTextHistory,_editImageToolbarTemplateUnlocalized,_savingLayerTemplateUnlocalized,_editImageToolbarTemplate,_module,_redactorBox,_redactorToolbar,_resx,_defaultResx,_siteRoot,_sfImage,_saveImageURL,_proxyImageUrl,_history,_activeImage,_activeImageStyle,_activeImageFloat,_disabled,_floatApplied,_activePaddingInput,_activeJcrop,_cropActions,_canvas,_imageIsResizing,_imageIsResized,_imageEditingWillBeDestroyed,_savingImage,_notif,_savingLayer,_savingLayerTemplate,_moduleInitialWidth,_redactorFacade,_isProcessingProxyImage,_isRotating,_toolbar,_toolbarRotateBtn,_toolbarUndoBtn,_toolbarDeleteBtn,_toolbarDeleteIcon,_activeToolbarBtn,_activeToolbarPanel,_toolbarCropBtn,_toolbarCropIcon,_cropButtons,_jcropSelection,_jcropChanging,_toolbarResizeBtn,_toolbarResizeIcon,bindResizeKeys,_toolbarPaddingBtn,_toolbarPaddingIcon,_toolbarPaddingPanel,_toolbarPaddingLock,_toolbarPaddingInputs,_toolbarPaddingButtons,_toolbarPaddingAreas,_toolbarPaddingImages,_toolbarAltTextBtn,_toolbarAltTextIcon,_toolbarAltTextPanel,_toolbarAltTextInput,_toolbarAltTextSaveBtn,_toolbarAlignLeftBtn,_toolbarAlignLeftIcon,_toolbarAlignRightBtn,_toolbarAlignRightIcon,_removeAlign;ImageEditing.class="ImageEditing",ImageEditing.type="Class",CROP_ACTIONS_SIZE=30,ANGLE_90_DEGREES=.5*Math.PI,DEGREES=90,KEY_NUMBER_0=48,KEY_NUMBER_9=57,KEY_BACKSPACE=8,KEY_SHIFT=16,KEY_CTRL=17,KEY_LEFT_ARROW=37,KEY_RIGHT_ARROW=39,KEY_LEFT_WNDOW_KEY=91,ENTER=13,ESC=27,NOTIF_PROCESS_PROGRESS_TIME=4e3,NOTIF_PROCESS_HEIGHT=80,FROM_EXTERNAL_URL_UPDATE_GUI_TIME=500,TIME_TO_SHOW_PROGRESS_AT_100=70,MAX_IMAGE_WIDTH=2560,MAX_IMAGE_HEIGHT=1600,ALTTEXT_PANEL_WIDTH=340,IMAGE_TOOLBAR_BUTTON_HEIGHT=35,IMAGE_WRAPPER="dnnImageWrapper",LAYER_WRAPPER="dnnLayerWrapper",IMAGE_TOOL_WRAPPER="dnnImageToolWrapper",REDACTOR_IMAGE_BOX_ID="redactor-image-box",IMAGE_INLINE_EDIT_CLASS="imageInlineEdit",UPDATE_IMAGE_WRAPPER_SIZES_MAX_NUMBER_OF_RETRIES=5,MIN_TOP_TO_SHOW_CROP_ACTION_BUTTONS=30,_resx=_defaultResx={alignLeft:"Align Left",alignRight:"Align Right",cancel:"Cancel",cantSaveImage:"Error saving image",crop:"Crop",delete:"Delete",padding:"Padding",resize:"Resize",rotate:"Rotate",save:"Save",savingImageChanges:"Saving image changes...",titleAndAltText:"Title and alt text",undo:"Undo",rotating:"Rotating...",resizing:"Resizing...",cropping:"Cropping...",fileSizeExceed:"This operation cannot be done on images bigger than "+MAX_IMAGE_WIDTH+"x"+MAX_IMAGE_HEIGHT+".",cannotProcessImage:"An error occurred during the image processing."},_editImageToolbarTemplateUnlocalized='<div id="image-edit-bar"><span class="rotate" title="{0}"><span class="image-edit-btns"></span></span><span class="crop" title="{1}"><span class="image-edit-btns"></span></span><span class="resize" title="{2}"><span class="image-edit-btns"></span></span><span class="undo disabled" title="{3}"><span class="image-edit-btns"></span></span><span class="padding"><span class="popper padding-popover image-edit-btns" title="{4}"></span><div class="padding-popcontent popper-content"><h5>{4}</h5><img src="{i0}images/ImageEditing/padding-img.jpg" usemap="#Map" class="padding-area all" id="padding-area"/><img src="{i0}images/ImageEditing/area-top.jpg" usemap="#Map" class="padding-area top" id="padding-area" style="display: none;"/><img src="{i0}images/ImageEditing/area-left.jpg" usemap="#Map" class="padding-area left" id="padding-area" style="display: none;"/><img src="{i0}images/ImageEditing/area-right.jpg" usemap="#Map" class="padding-area right" id="padding-area" style="display: none;"/><img src="{i0}images/ImageEditing/area-bottom.jpg" usemap="#Map" class="padding-area bottom" id="padding-area" style="display: none;"/><map name="Map"><area shape="poly" coords="90, 23, 116, 0, -5, -7, 26, 24" class="area-top" id="top"><area shape="poly" coords="116, 2, 91, 24, 92, 84, 115, 106, 116, 105" class="area-right" id="right"><area shape="poly" coords="27, 85, 3, 108, 113, 105, 90, 85" class="area-bottom" id="bottom"><area shape="poly" coords="25, 24, 25, 86, 0, 108, 0, 2" class="area-left" id="left"></map><span class="padding-lock-unlock lock"></span><div class="padding-value"><span class="padding-top"><input type="text" value="0" name="paddingTop" id="paddingTop" data-padding="top" disabled/></span><span class="padding-right"><input type="text" value="0" name="paddingRight" id="paddingRight" data-padding="right" disabled/></span><span class="padding-bottom"><input type="text" value="0" name="paddingBottom" id="paddingBottom" data-padding="bottom" disabled/></span><span class="padding-left"><input type="text" value="0" name="paddingLeft" id="paddingLeft" data-padding="left" disabled/></span></div><div class="padding-buttons"><span class="padding-down"><span>-</span></span><span class="padding-up"><span>+</span></span></div></div></span><span class="tag"><span class="popper padding-tag image-edit-btns" title="{5}"></span><div class="alttext-popcontent popper-content"><h5>{5}</h5><input type="text" class="form-control alttext-field"><button class="btn" type="button">{6}</button></div></span><span class="align-left image-align"><span class="image-edit-btns" title="{7}"></span></span><span class="align-right image-align"><span class="image-edit-btns" title="{8}"></span></span><span class="delete"><span class="image-edit-btns" title="{9}"></span></span></div>',_cropActions='<div class="actions"><div class="cropBtn ok"></div><div class="cropBtn cancel"></div></div>',_savingLayerTemplateUnlocalized='<div class="dnnImageEditingSavingLayer"><div class="loopBar"><div class="progressA" style="width: 0;"></div></div><div class="optacityLayer"><h1 style="">{0}</h1></div></div>',_canvas=document.createElement("canvas"),isCropping=function(evt){return!!$(evt.target).hasClass("cropBtn")||!!_jcropChanging},enableContentEditable=function(){_module.find("."+LAYER_WRAPPER).show(),_module.attr("contenteditable",!0)},initTemplate=function(){_toolbar=_redactorBox.find("#image-edit-bar"),0===_toolbar.length&&(_redactorToolbar.after(_editImageToolbarTemplate),_toolbar=_redactorBox.find("#image-edit-bar")),_toolbarRotateBtn=_toolbar.find(".rotate:first"),_toolbarRotateBtn.data("paddingLeft",_toolbarRotateBtn.css("padding-left")),_toolbarCropBtn=_toolbar.find(".crop:first"),_toolbarCropIcon=_toolbarCropBtn.find(".image-edit-btns:first"),_toolbarResizeBtn=_toolbar.find(".resize:first"),_toolbarResizeIcon=_toolbarResizeBtn.find(".image-edit-btns:first"),_toolbarUndoBtn=_toolbar.find(".undo:first"),_toolbarPaddingBtn=_toolbar.find(".padding-popover:first"),_toolbarPaddingIcon=_toolbarPaddingBtn,_toolbarPaddingPanel=_toolbar.find(".padding-popcontent:first"),_toolbarPaddingLock=_toolbar.find(".padding-lock-unlock:first"),_toolbarPaddingAreas=_toolbar.find("map:first area"),_toolbarPaddingInputs=_toolbar.find(".padding-value:first input"),_toolbarPaddingButtons=_toolbar.find(".padding-buttons:first > span"),_toolbarPaddingImages=_toolbar.find("img.padding-area"),_toolbarAltTextBtn=_toolbar.find(".tag:first"),_toolbarAltTextIcon=_toolbarAltTextBtn.find(".image-edit-btns:first"),_toolbarAltTextPanel=_toolbar.find(".alttext-popcontent:first"),_toolbarAltTextInput=_toolbarAltTextPanel.find("input:first"),_toolbarAltTextSaveBtn=_toolbarAltTextPanel.find("button:first"),_toolbarAlignLeftBtn=_toolbar.find(".align-left:first"),_toolbarAlignLeftIcon=_toolbarAlignLeftBtn.find(".image-edit-btns:first"),_toolbarAlignRightBtn=_toolbar.find(".align-right:first"),_toolbarAlignRightIcon=_toolbarAlignRightBtn.find(".image-edit-btns:first"),_toolbarDeleteBtn=_toolbar.find(".delete:first"),_toolbarDeleteIcon=_toolbarDeleteBtn.find(".image-edit-btns:first"),bindToolbarButtonsActions(),$(document.body).on("drop.redactor",$.proxy(function(e){_activeImage&&hideToolbar()},this))};var getOrCreateWrapper=function(image){var wrapperOrUiResizeWrapper,wrapperIfResizing,newWrapper;return wrapperOrUiResizeWrapper=image.parent(),wrapperOrUiResizeWrapper.hasClass(IMAGE_TOOL_WRAPPER)?wrapperOrUiResizeWrapper:(wrapperIfResizing=wrapperOrUiResizeWrapper.parent(),wrapperIfResizing.hasClass(IMAGE_TOOL_WRAPPER)?wrapperIfResizing:(newWrapper=$('<div class="'+IMAGE_TOOL_WRAPPER+'" contenteditable="false"></div>'),image.wrap(newWrapper),newWrapper=_activeImage.parent(),newWrapper.css("float",_activeImage.css("float")),newWrapper))},drawImageToolbar=function(){var style,finalWidth,rows,height;if(_activeImage){switch(style="z-index: 100 !important; ",finalWidth=_redactorToolbar.width(),!0){case finalWidth>299:rows=1;break;case finalWidth>163:rows=2;break;case finalWidth>101:rows=3;break;case finalWidth>95:rows=4;break;case finalWidth>67:rows=5;break;case finalWidth>61:rows=8;break;case finalWidth<62:rows=9}height=34*rows,style+="height: "+height+"px !important;",_toolbar.attr("style",style),_toolbar.is(":visible")||(_toolbar.show(),_toolbar.width(_redactorToolbar.width()-2),_redactorFacade.updateToolbarPosition(_toolbar))}};showToolbar=function(){drawImageToolbar(),getOrCreateWrapper(_activeImage),_isProcessingProxyImage=!1,_module.data("padding-top",parseInt(_module.css("padding-top"),10)),_module.css("padding-top",0),_module.on("keydown.imageEditingToolbar",$.proxy(function(e){e.keyCode===KEY_BACKSPACE&&(e.stopPropagation(),e.preventDefault())},this))};var removeImageToolWrapper=function(){_activeImage&&removeImageToolWrapperFromImage(_activeImage)},removeImageToolWrapperFromImage=function(image){var $image=$(image);if($image.parent()){var parent=$image.parent();if(parent.hasClass(IMAGE_TOOL_WRAPPER)){var wrapperContent=parent.contents();parent.replaceWith(wrapperContent)}}},ensureRemoveAnyImageToolWrapper=function(){if(_module){var images=_module.find("img");$.each(images,function(idx,image){var $image=$(image);removeImageToolWrapperFromImage($image)})}};hideToolbar=function(){_module&&(enableContentEditable(),disableEditingImage(_activeImage),_activeImage=null,_activeToolbarBtn&&(_activeToolbarBtn.removeClass("active"),_activeToolbarBtn=null),_toolbar.attr("style",""),_module.trigger("hideToolbar.imageEditing"),_module.off("keydown.imageEditingToolbar"))},initImages=function(){addWrappersToAllImages(),_module.on("click.imageEditing","img",function(evt){var self,histIdx,src,name,imageLocation;self=$(this),removeWrappersOfOneImage(self),evt.preventDefault(),evt.stopPropagation(),forceEditorToSelectImage(self),_module.attr("contenteditable",!1),setImageHistIdx(self),self.hasClass("ui-resizable")||(_redactorToolbar.find(".redactor-act").removeClass("redactor-act"),_activeImage&&!self.hasClass("highlighted")&&(disableEditingImage(_activeImage),addWrappersToAnImage(_activeImage),_activeImage=null,_activeImageStyle=null,disableFloatButtons()),disableActiveBtn(),_activeImage=self,_activeImage.addClass("highlighted"),_activeImage.css("opacity","1"),_activeImageStyle=self.attr("style"),_activeImageFloat=self.css("float"),_activeImageStyle||(_activeImageStyle=""),self.data("original-src")||(src=self.attr("src"),self.data("original-src",src),name=src.match(/[^\/\\]+$/),name&&name[0]&&("string"==typeof name?self.data("name",name):self.data("name",name[0]))),showToolbar(),self.data("action-rotate")||self.data("action-rotate","0"),self.data("action-resize-h")||(self.data("action-resize-h","0"),self.data("action-resize-w","0")),self.data("action-crop-h")||(self.data("action-crop-h","0"),self.data("action-crop-w","0")),imageLocation=getLocation(self.attr("src")),imageLocation&&imageLocation.host!==window.location.host?self.data("is-local","NO"):self.data("is-local","YES"),disablePanel(),enableIfNededFloatBtn(self),histIdx=getLastImageHistObj(self),histIdx&&enableUndo())})},forceEditorToSelectImage=function(element){setTimeout(function(){_redactorFacade.selectElement(element)},0)},addWrappersToAllImages=function(){!_module||_activeImage||_activeJcrop||_module.find("img").each(function(idx,image){image=$(image),addWrappersToAnImage(image)})},addWrappersToAnImage=function(image){var imageWrapper,layerWrapper,sizes;image.parent().hasClass(IMAGE_WRAPPER)||(imageWrapper=$('<span class="'+IMAGE_WRAPPER+'" style="overflow: hidden; position: relative;" contenteditable="false"></span>'),layerWrapper=$('<span class="'+LAYER_WRAPPER+'" style="z-index:99;" contenteditable="false"></span>'),sizes=getImageSizesForWrappers(image),image.width()>0&&image.height()>0?(imageWrapper.width(sizes.width),imageWrapper.height(sizes.height)):(imageWrapper.width("100%"),imageWrapper.height("100%")),image.wrap(imageWrapper),imageWrapper=image.parent(),imageWrapper.prepend(layerWrapper),layerWrapper=imageWrapper.children(":first"),layerWrapper.attr("style","z-index:99; background-color: transparent !important; opacity: 0.9;"),updateImageWrappers(image),layerWrapper.css("left",image.position().left),imageWrapper.one("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),image.trigger("click")}))},removeWrappersOfAllImages=function(){function removeWrapperFromImage(idx,image){var $image=$(image);removeWrappersOfOneImage($image)}_module&&(_module.find("img").each(removeWrapperFromImage),_module.find("."+IMAGE_WRAPPER).each(function(idx,wrapper){var $wrapper=$(wrapper);$wrapper.find("img").each(removeWrapperFromImage),$(wrapper).remove()}),_module.find("."+LAYER_WRAPPER).each(function(idx,wrapper){$(wrapper).remove()}))},removeWrappersOfOneImage=function(image){var layer,parent;parent=image.parent(),parent[0].id===REDACTOR_IMAGE_BOX_ID&&(image=parent,parent=image.parent()),layer=image.prev(),layer.hasClass(LAYER_WRAPPER)&&layer.remove(),parent.hasClass(IMAGE_WRAPPER)&&(parent.before(image),parent.remove())},imageSizeExceded=function(image){var width,height,ratio,maxDimensionsExceeded;return width=image[0].naturalWidth,height=image[0].naturalHeight,ratio=width/height,maxDimensionsExceeded=ratio<1?width>MAX_IMAGE_HEIGHT||height>MAX_IMAGE_WIDTH:width>MAX_IMAGE_WIDTH||height>MAX_IMAGE_HEIGHT,!!maxDimensionsExceeded&&(_notif=$.dnnNotif({text:_resx.fileSizeExceed,styleBlue:!0,dialogClass:"noCloseIcon",height:70}),!0)},getImageActionRotate=function(image){var turns;return turns=parseInt(image.data("action-rotate"),10),isNaN(turns)?0:turns},getImageActionResize=function(image){var width,height;return width=parseInt(image.data("action-resize-w"),10),height=parseInt(image.data("action-resize-h"),10),isNaN(width)&&(width=0),isNaN(height)&&(height=0),{width:width,height:height}},getImageActionCrop=function(image){var width,height;return width=parseInt(image.data("action-crop-w"),10),height=parseInt(image.data("action-crop-h"),10),isNaN(width)&&(width=0),isNaN(height)&&(height=0),{width:width,height:height}},getImageActions=function(image){var actions;return actions={},actions.rotated=getImageActionRotate(image)*DEGREES,actions.resized=getImageActionResize(image),actions.cropped=getImageActionCrop(image),actions},setImageActionRotate=function(image,value){value<0&&(value=0),image.data("action-rotate",value)},setImageActionResize=function(image,width,height){image.data("action-resize-w",width),image.data("action-resize-h",height)},setImageActionCrop=function(image,width,height){image.data("action-crop-w",width),image.data("action-crop-h",height)},getLocation=function(url){var match;return match=url.match(/^(https?\:)\/\/(([^:\/?#]*)(?:\:([0-9]+))?)(\/[^?#]*)(\?[^#]*|)(#.*|)$/),match&&{protocol:match[1],host:match[2],hostname:match[3],port:match[4],pathname:match[5],search:match[6],hash:match[7]}},disableFloatButtons=function(){disableFloatLeftButton(),disableFloatRightButton()},disableFloatLeftButton=function(){_toolbarAlignLeftIcon.removeClass("active")},enableFloatLeftButton=function(){_toolbarAlignLeftIcon.addClass("active")},disableFloatRightButton=function(){_toolbarAlignRightIcon.removeClass("active")},enableFloatRightButton=function(){_toolbarAlignRightIcon.addClass("active")},enableIfNededFloatBtn=function(image){switch(image.css("float")){case"left":enableFloatLeftButton();break;case"right":enableFloatRightButton()}},getImageHistIdx=function(image){return image.data("dnn-hist-idx")},setImageHistIdx=function(image){var tsIndex;tsIndex=getImageHistIdx(image),void 0!==tsIndex&&_history[tsIndex]||(tsIndex||(tsIndex=(new Date).getTime()),image.data("dnn-hist-idx",tsIndex),_history[tsIndex]={imgHist:[]})},addActionToImageHistChanges=function(histIdx,histObj){var lastHistElement;lastHistElement=_history[histIdx].imgHist.slice(-1)[0],_history[histIdx].imgHist.push(histObj)},getLastImageHistObj=function(image){var histIdx,lastHistElement;return histIdx=getImageHistIdx(image),void 0===histIdx?null:(lastHistElement=_history[histIdx].imgHist.slice(-1)[0],lastHistElement?lastHistElement:null)},removeLastHistObj=function(image){var histIdx;return histIdx=getImageHistIdx(image),void 0===histIdx?null:(_history[histIdx].imgHist.pop(),void(0===_history[histIdx].imgHist.length&&disableUndo()))},isBase64Image=function($image){return $image.attr("src").search("data:image/png;base64,")!==-1},isCrossDomainImage=function($image){return"NO"===$image.data("is-local")},processProxyImage=function(image,actionName,loadCallback,errorCallback){function loadHandler(){image.off(".proxyImage"),closeNotif(),"function"==typeof loadCallback&&loadCallback(),_isProcessingProxyImage=!1}function errorHandler(){image.off(".proxyImage"),notifCannotProcessProxyImage(),"function"==typeof errorCallback&&errorCallback(),_isProcessingProxyImage=!1}_isProcessingProxyImage||(_isProcessingProxyImage=!0,image.on("load.proxyImage",loadHandler).on("error.proxyImage",errorHandler),showNotifWithProgressBar(actionName),image[0].src=getImageProxyUrl(image))},notifCannotProcessProxyImage=function(){closeNotif(),_notif=$.dnnNotif({dialogClass:"noTittle",text:_resx.cannotProcessImage,styleBlue:!0,height:50})},showNotifWithProgressBar=function(actionName){var progress;closeNotif(),_notif=$.dnnNotif({dialogClass:"noTittle",text:'<div class="title" style="text-align: center;"><h2 style="color:white;">{0}</h2></div>'.replace("{0}",actionName)+'<div class="loopBar"><div class="progressA"></div></div>',styleBlue:!0,noIcon:!0,manualClose:!0,height:NOTIF_PROCESS_HEIGHT}),progress=_notif.find(".progressA"),progress.css("width","0"),progress.animate({width:"95%"},NOTIF_PROCESS_PROGRESS_TIME)},notifCantSaveImage=function(){closeNotif(),_notif=$.dnnNotif({dialogClass:"noTittle",text:_resx.cantSaveImage,styleBlue:!0,height:50})},closeNotif=function(){_notif&&(_notif.find(".progressA").stop(!0,!0).css("width","100%"),_notif.dialog("close"))},getImageSize=function(image){return{width:image.width(),height:image.height()}},setImageSizes=function(image){image.css({"min-width":"","min-height":"","max-width":"100%"})},getFloatObject=function(image,floatValue){var histObj;return histObj={type:"float",prop:{float:floatValue}}},changeStyleBeforeResizeAction=function(image){image&&image.css("max-width","100%")};var areCropButtonsVisible=function(image){return image.offset().top-_module.offset().top>MIN_TOP_TO_SHOW_CROP_ACTION_BUTTONS};changeStyleBeforeCropAction=function(image){var imageToolWrapper,topNeededToShowButtons;image&&(image.css("max-width",image.parent().width()),areCropButtonsVisible(image)||(image.data("setTopToZeroAfterCrop",!0),imageToolWrapper=image.parent(),topNeededToShowButtons=MIN_TOP_TO_SHOW_CROP_ACTION_BUTTONS-(image.offset().top-_module.offset().top),imageToolWrapper.css("top",topNeededToShowButtons)))},changeStyleAfterAction=function(image){var imageToolWrapper;setImageSizes(image),image.data("setTopToZeroAfterCrop")&&(image.data("setTopToZeroAfterCrop",null),imageToolWrapper=image.parent(),imageToolWrapper.css("top",""))},setImageFloat=function(image,floatValue){var toolbarWrapper;floatValue="none"!==floatValue?floatValue:"",_activeImage.css("float",floatValue),toolbarWrapper=_activeImage.parent(),toolbarWrapper.css("float",floatValue),_activeImageFloat=floatValue},disableEditingImage=function(image){if(image){if(!image.is(":visible")&&!_jcropSelection)return void image.remove();hideAndMoveToolbar(),removeActionsWithWrappers(image),removeImageToolWrapperFromImage(image),image.removeClass("highlighted"),image.css("opacity",""),""===image.attr("class")&&image.removeAttr("class"),disableFloat(image),disableFloatButtons(),disableUndo(),isBase64Image(image)&&"YES"===image.data("need-save")&&saveImage(image)}},saveImage=function(image){var completeCallback=function(){_savingImage=!1,hideImageSavingLayer(),$(window).trigger("saved.inlineEditing")},errorCallback=function(){notifCantSaveImage(),completeCallback()},successCallback=function(data){data.success?(image.load(function imageLoaded(){image.off("load",imageLoaded),completeCallback()}),image.attr("src",data.filelink),image.data("original-src",data.filelink)):errorCallback()};_savingImage=!0,showImageSavingLayer(),$.ajax({type:"POST",url:_saveImageURL,beforeSend:_sfImage.setModuleHeaders,data:{image:image.attr("src").replace("data:image/png;base64,",""),name:image.data("name"),actions:getImageActions(image)},success:successCallback,error:errorCallback})},showImageSavingLayer=function(){var progress;_savingLayer=$(_savingLayerTemplate),$("body").append(_savingLayer),_savingLayer=$(".dnnImageEditingSavingLayer"),progress=_savingLayer.find(".progressA"),_savingLayer.css({width:_redactorBox.css("width"),height:_redactorBox.css("height")}),_savingLayer.offset(_redactorBox.offset()),progress.animate({width:"99%"},NOTIF_PROCESS_PROGRESS_TIME)},hideImageSavingLayer=function(){_savingLayer&&(_savingLayer.find(".progressA").css("width: 100%"),setTimeout(function(){_savingLayer.remove(),_savingLayer=null},TIME_TO_SHOW_PROGRESS_AT_100))},disableResizable=function(image,preventResize){var size;image.hasClass("ui-resizable")&&(image.resizable("destroy"),size=getImageSize(image),restoreOriginalInlineStyle(image),!preventResize&&_imageIsResized&&(_activeImageStyle=image.attr("style"),resize(image,size),_imageIsResized=!1),changeStyleAfterAction(image),$(window).off("keydown.inlineEditing"))},disableCrop=function(image){image||(image=_activeImage),image&&image.data("Jcrop")&&(disableActiveBtn(),_jcropSelection=null,_activeJcrop=null,image.data("Jcrop").destroy(),changeStyleAfterAction(image),image.css("display","").css("visibility",""),restoreOriginalInlineStyle(image),_cropButtons&&2===_cropButtons.length&&(_cropButtons[0].off(".imageEditing"),_cropButtons[1].off(".imageEditing")),$(window).off("keydown.inlineEditing"))},removeActionsWithWrappers=function(image){disableResizable(image,!_imageIsResized),disableCrop(image)},restoreOriginalInlineStyle=function(image){image.attr("style",_activeImageStyle)},disableFloat=function(image){_activeImageFloat&&(image.css("float")!==_activeImageFloat&&image.css("float",_activeImageFloat),_activeImageFloat=null)},disableUndo=function(){_toolbarUndoBtn.addClass("disabled")},enableUndo=function(){_toolbarUndoBtn.removeClass("disabled")},bindToolbarButtonsActions=function(){_toolbar.on("click.imageEditing",function(evt){_activeToolbarBtn&&(evt.preventDefault(),evt.stopPropagation())}),bindRotateBtn(),bindCropBtn(),bindResizeBtn(),bindUndoBtn(),bindPaddingBtn(),bindAltTextBtn(),bindAltTextSaveBtn(),bindAlignLeftBtn(),bindAlignRightBtn(),bindDeleteBtn(),bindPaddingLockUnlockBtn(),bindPaddingPlusMinusButtons()},bindRotateBtn=function(){_toolbarRotateBtn.on("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),null!==_activeImage&&(disablePanel(),rotateImage(_activeImage))})},rotateImage=function(image){if(!imageSizeExceded(image)&&!_isRotating){_isRotating=!0;var rotateImageInternal=function(image){var context,w,h,diff,w2,h2,diff2,turns;removeActionsWithWrappers(image),w=image[0].naturalWidth,h=image[0].naturalHeight,w2=w/2,h2=h/2,diff=w-h,diff2=diff/2,_canvas.width=h,_canvas.height=w,context=_canvas.getContext("2d"),context.save(),context.translate(w2,h2),context.rotate(ANGLE_90_DEGREES),context.translate(-w2+diff2,-h2+diff2),context.drawImage(image[0],0,0),context.restore(),_canvas.toDataURL().search("data:image/png;base64,")!==-1&&(image.attr("src",_canvas.toDataURL()),turns=getImageActionRotate(image)+1,setImageActionRotate(image,turns),image.data("need-save","YES"),updateImageWrappers(image)),_isRotating=!1};return addRotateHistoryObject(image,{width:image.width(),height:image.height()}),isCrossDomainImage(image)&&!isBase64Image(image)?void processProxyImage(image,_resx.rotating,function(){rotateImageInternal(image)},function(){_isRotating=!1,undoAction()}):void rotateImageInternal(image)}},getImageProxyUrl=function(image){return _proxyImageUrl+"?imageUrl="+encodeURIComponent(image[0].src)},addRotateHistoryObject=function(image,size){var histObj,histIdx;histIdx=getImageHistIdx(image),histObj={type:"rotate",prop:{src:image.attr("src"),width:size.width,height:size.height}},addActionToImageHistChanges(histIdx,histObj),enableUndo()},bindCropBtn=function(){_toolbarCropBtn.on("click.imageEditing",function(evt){if(evt.stopPropagation(),evt.preventDefault(),null!==_activeImage&&(disablePanel(),!imageSizeExceded(_activeImage))){if(_activeJcrop)return disableActiveBtn(),void disableCrop();removeActionsWithWrappers(_activeImage),changeStyleBeforeCropAction(_activeImage),_jcropChanging=!1,_activeJcrop=_activeImage.Jcrop({setSelect:[0,0,50,50],allowSelect:!1,onChange:function(selection){_jcropSelection=selection,_jcropChanging=!0},onSelect:function(){setTimeout(function(){_jcropChanging=!1},0)}}),setTimeout(function(){var jcropHolderFirstDiv,jcropHolder;jcropHolder=_activeJcrop.parent(),jcropHolder.on("click.imageEditing",function(evt){var $el=$(evt.target);$el.closest("a").length>0&&(evt.stopPropagation(),evt.preventDefault())}),jcropHolderFirstDiv=jcropHolder.find(".jcrop-holder div:first"),jcropHolderFirstDiv.prepend(_cropActions),_cropButtons=[jcropHolderFirstDiv.find(".ok"),jcropHolderFirstDiv.find(".cancel")],bindCropButtons(_cropButtons[0],_cropButtons[1]),bindCropKeys()},0),activeBtn(_toolbarCropIcon)}})},bindCropButtons=function(okBtn,cancelBtn){okBtn.on("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),cropImage(_activeImage)}),cancelBtn.on("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),disableActiveBtn(),disableCrop()})},bindCropKeys=function(){$(window).on("keydown.inlineEditing",function(evt){if(!_activeJcrop)return void _module.off("keydown.inlineEditing");switch(evt.keyCode){case ENTER:cropImage(_activeImage);break;case ESC:disableCrop()}})},cropImage=function(image){if(_activeJcrop&&image&&_jcropSelection){addCropHistoryObject(image);var cropImageInternal=function(image){var context,jcropData,bounds,wRatio,hRatio;jcropData=image.data("Jcrop"),bounds=jcropData.tellSelect(),wRatio=image[0].naturalWidth/image.width(),hRatio=image[0].naturalHeight/image.height(),_canvas.width=bounds.w*wRatio,_canvas.height=bounds.h*hRatio,context=_canvas.getContext("2d"),context.drawImage(image[0],bounds.x*wRatio,bounds.y*hRatio,bounds.w*wRatio,bounds.h*hRatio,0,0,_canvas.width,_canvas.height),_canvas.toDataURL().search("data:image/png;base64,")!==-1&&(image.attr("src",_canvas.toDataURL()),setImageActionCrop(image,_canvas.width,_canvas.height),image.data("need-save","YES"),updateImageWrappers(image)),disableActiveBtn(),disableCrop()};isCrossDomainImage(image)&&!isBase64Image(image)?processProxyImage(image,_resx.cropping,function(){cropImageInternal(image)},function(){undoAction()}):cropImageInternal(image)}},addCropHistoryObject=function(image){var histObj,histIdx;histIdx=getImageHistIdx(image),histObj={type:"crop",prop:{src:image.attr("src"),width:image.width(),height:image.height()}},addActionToImageHistChanges(histIdx,histObj),enableUndo()},bindResizeBtn=function(){_toolbarResizeBtn.on("click.imageEditing",function(evt){if(evt.stopPropagation(),evt.preventDefault(),null!==_activeImage){if(disablePanel(),_activeToolbarBtn===_toolbarResizeIcon)return disableResizable(_activeImage,!0),void disableActiveBtn();removeActionsWithWrappers(_activeImage),enableResizable(_activeImage);
}})},enableResizable=function(image){var histIdx;imageSizeExceded(image)||(changeStyleBeforeResizeAction(image),activeBtn(_toolbarResizeIcon),histIdx=getImageHistIdx(image),_imageIsResized=!1,setTimeout(function(){image.resizable({handles:"n, e, s, w, se, sw, nw, ne",start:function(evt,ui){var histObj;histObj=getResizeHistObject(image,ui.size),addActionToImageHistChanges(histIdx,histObj),enableUndo()},resize:function(){_imageIsResized=!0},stop:function(evt,ui){resize(image,ui.size)}})},100),image.css("display","inline"),bindResizeKeys())},bindResizeKeys=function(){$(window).on("keydown.inlineEditing",function(evt){switch(evt.keyCode){case ENTER:disableResizable(_activeImage),disableActiveBtn();break;case ESC:_imageIsResized&&(_imageIsResized=!1,_toolbarUndoBtn.trigger("click")),disableResizable(_activeImage,!0),disableActiveBtn()}})},resize=function(image,size){if(!_imageIsResizing){if(_imageIsResizing=!0,isCrossDomainImage(image)&&!isBase64Image(image))return void processProxyImage(image,_resx.resizing,function(){applyResizeWithCanvas(image,size),_imageIsResizing=!1},function(){_imageIsResizing=!1,undoAction()});applyResizeWithCanvas(image,size),_imageIsResizing=!1}},applyResizeWithCanvas=function(image,size){var context;removeImageToolWrapper(),_canvas.width=size.width,_canvas.height=size.height,context=_canvas.getContext("2d"),context.save(),context.drawImage(image[0],0,0,size.width,size.height),context.restore(),_canvas.toDataURL().search("data:image/png;base64,")!==-1&&(image.attr("src",_canvas.toDataURL()),image.removeAttr("width"),+image.removeAttr("height"),setImageActionResize(image,size.width,size.height),image.data("need-save","YES"),setImageSizes(image),updateImageWrappers(image))},getResizeHistObject=function(image,size){var histObj,width,height,widthAttribute,heightAttribute;return width=size.width,height=size.height,widthAttribute=image.attr("width"),heightAttribute=image.attr("height"),histObj={type:"resize",prop:{width:width,height:height,widthAttribute:widthAttribute,heightAttribute:heightAttribute,src:image.attr("src")}}},bindUndoBtn=function(){_toolbarUndoBtn.on("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),undoAction()})},undoAction=function(){var histObj;if(null!==_activeImage&&(disableActiveBtn(),disablePanel(),histObj=getLastImageHistObj(_activeImage)))switch(removeActionsWithWrappers(_activeImage),histObj.type){case"resize":undoResize(_activeImage,histObj.prop);break;case"float":undoFloat(_activeImage,histObj.prop.float);break;case"delete":undoDelete(_activeImage);break;case"padding":undoPadding(_activeImage,histObj.prop);break;case"altText":undoAltText(_activeImage,histObj.prop.text);break;case"crop":undoCrop(_activeImage,histObj.prop);break;case"rotate":undoRotate(_activeImage,histObj.prop)}},undoResize=function(image,prop){setImageSizes(image),image.attr("src",prop.src),prop.widthAttribute?image.attr("width",prop.widthAttribute):image.removeAttr("width"),prop.heightAttribute?image.attr("height",prop.heightAttribute):image.removeAttr("height"),setImageActionResize(image,prop.width,prop.height),removeLastHistObj(image),updateImageWrappers(image)},undoFloat=function(image,float){switch(disableFloatButtons(),setImageFloat(image,float),removeLastHistObj(image),_activeImageFloat=float,float){case"left":enableFloatLeftButton();break;case"right":enableFloatRightButton()}updateImageWrappers(image)},undoDelete=function(image){image.parent().show(),enableIfNededFloatBtn(image),removeLastHistObj(image),updateImageWrappers(image)},undoPadding=function(image,prop){image.css({"padding-top":prop.top,"padding-left":prop.left,"padding-right":prop.right,"padding-bottom":prop.bottom}),removeLastHistObj(image),updateImageWrappers(image)},undoAltText=function(image,text){image.attr({alt:text,title:text}),removeLastHistObj(image),updateImageWrappers(image)},undoCrop=function(image,prop){image.attr("src",prop.src),setImageActionCrop(image,prop.width,prop.height),removeLastHistObj(image),updateImageWrappers(image)},undoRotate=function(image,prop){var turns;image.attr("src",prop.src),turns=getImageActionRotate(image)-1,setImageActionRotate(image,turns),removeLastHistObj(image),updateImageWrappers(image)},updateImageWrappers=function(image){var dnnLayerWrapper,dnnImageWrapper,imageFloat;dnnLayerWrapper=image.prev(),dnnLayerWrapper.hasClass(LAYER_WRAPPER)&&(dnnImageWrapper=image.parent(),imageFloat=image.css("float"),dnnImageWrapper.css({padding:0,float:imageFloat}),dnnLayerWrapper.css({padding:0,position:"absolute",float:imageFloat}),updateImageWrappersSize(image),dnnLayerWrapper.css("left",image.position().left))},updateImageWrappersSize=function(image){var interval,i;i=0,interval=setInterval(function(){var dnnLayerWrapper,dnnImageWrapper,sizes;return sizes=getImageSizesForWrappers(image),"0px"===sizes.width||"0px"===sizes.height?(i===UPDATE_IMAGE_WRAPPER_SIZES_MAX_NUMBER_OF_RETRIES&&clearInterval(interval),void i++):(clearInterval(interval),dnnLayerWrapper=image.prev(),dnnImageWrapper=image.parent(),void(dnnLayerWrapper.hasClass(LAYER_WRAPPER)&&dnnImageWrapper.hasClass(IMAGE_WRAPPER)&&(dnnLayerWrapper.css("width",sizes.width),dnnImageWrapper.css("width",sizes.width),dnnLayerWrapper.css("height",sizes.height),dnnImageWrapper.css("height",sizes.height),dnnLayerWrapper.offset(image.offset()))))},200)},getImageSizesForWrappers=function(image){var width,height,imageWidth,imageHeight,marginTop,marginLeft,marginRight,marginBottom,paddingTop,paddingLeft,paddingRight,paddingBottom;return imageWidth=image.width(),imageHeight=image.height(),marginTop=parseInt(image.css("margin-top"),10),marginTop=isNaN(marginTop)?0:marginTop,marginLeft=parseInt(image.css("margin-left"),10),marginLeft=isNaN(marginLeft)?0:marginLeft,marginRight=parseInt(image.css("margin-right"),10),marginRight=isNaN(marginRight)?0:marginRight,marginBottom=parseInt(image.css("margin-bottom"),10),marginBottom=isNaN(marginBottom)?0:marginBottom,paddingTop=parseInt(image.css("padding-top"),10),paddingTop=isNaN(paddingTop)?0:paddingTop,paddingRight=parseInt(image.css("padding-right"),10),paddingRight=isNaN(paddingRight)?0:paddingRight,paddingLeft=parseInt(image.css("padding-left"),10),paddingLeft=isNaN(paddingLeft)?0:paddingLeft,paddingBottom=parseInt(image.css("padding-Bottom"),10),paddingBottom=isNaN(paddingBottom)?0:paddingBottom,width=imageWidth+marginLeft+marginRight+paddingLeft+paddingRight+"px",height=imageHeight+marginTop+marginBottom+paddingTop+paddingBottom+"px",{width:width,height:height}},bindPaddingBtn=function(){_toolbarPaddingBtn.on("click.imageEditing",function(evt){if(evt.stopPropagation(),evt.preventDefault(),null!==_activeImage){if(_activeToolbarBtn===_toolbarPaddingIcon)return disablePanel(),void disableActiveBtn();removeActionsWithWrappers(_activeImage),activeBtn(_toolbarPaddingIcon),_toolbarPaddingLock.hasClass("lock")||(_toolbarPaddingLock.addClass("lock"),setDefaultPaddingPanelConfig()),_activePaddingInput="all",enablePanel(_toolbarPaddingPanel),updatePaddingPanelValues(_activeImage)}})},setDefaultPaddingPanelConfig=function(){_toolbarPaddingInputs.attr("disabled",!0),unbindAreasAndInputsSelection(),unbindPaddingInputsKeydown(),_activePaddingInput="all",_toolbarPaddingImages.hide(),_toolbarPaddingImages.filter(".all").show()},bindPaddingLockUnlockBtn=function(){_toolbarPaddingLock.on("click.imageEditing",function(){_toolbarPaddingLock.toggleClass("lock"),_toolbarPaddingLock.hasClass("lock")?setDefaultPaddingPanelConfig():(_toolbarPaddingInputs.attr("disabled",!1),bindAreasAndInputsSelection(),bindPaddingInputsKeydown(),_toolbarPaddingImages.hide(),_toolbarPaddingImages.filter(".all").show())})},updatePaddingPanelValues=function(image){_toolbarPaddingInputs.each(function(idx,input){var padding;padding=parseInt(image.css("padding-"+$(input).data("padding")),10),isNaN(padding)&&(padding=0),input.value=padding})},bindAreasAndInputsSelection=function(){_toolbarPaddingInputs.on("click.imageEditing",function(){var self,position;self=$(this),position=self.data("padding"),enablePaddingInputs(position)}),_toolbarPaddingAreas.on("click.imageEditing",function(){var self,position;self=$(this),position=self.attr("id"),enablePaddingInputs(position)})},enablePaddingInputs=function(position){var inputButton;inputButton=_toolbarPaddingInputs.filter("#padding"+position[0].toUpperCase()+position.slice(1).toLowerCase()),inputButton.attr("disabled",!1),inputButton.select(),_activePaddingInput=position,_toolbarPaddingImages.hide(),_toolbarPaddingImages.filter("."+position).show()},unbindAreasAndInputsSelection=function(){_toolbarPaddingAreas.off("click.imageEditing"),_toolbarPaddingInputs.off("click.imageEditing")},bindPaddingInputsKeydown=function(){_toolbarPaddingInputs.on("keydown.inlineEditing",function(evt){var self,allowedKeys;if(allowedKeys=[KEY_BACKSPACE,KEY_SHIFT,KEY_CTRL,KEY_LEFT_ARROW,KEY_RIGHT_ARROW,KEY_LEFT_WNDOW_KEY],allowedKeys.indexOf(evt.keyCode)===-1){if(evt.keyCode<KEY_NUMBER_0||evt.keyCode>KEY_NUMBER_9)return void evt.preventDefault();self=$(this),addPaddingHistory(_activeImage),setTimeout(function(){_activePaddingInput=self.data("padding"),_activeImage.css("padding-"+_activePaddingInput,self.val()+"px")},0)}})},unbindPaddingInputsKeydown=function(){_toolbarPaddingInputs.off("keydown.inlineEditing")},bindPaddingPlusMinusButtons=function(){_toolbarPaddingButtons.on("click.imageEditing",function(){var self,value,values,inputButton;switch(self=$(this),value=self.hasClass("padding-up")?1:-1,addPaddingHistory(_activeImage),values={},_activePaddingInput){case"all":values.top=parseInt(_activeImage.css("padding-top"),10)+value,values.left=parseInt(_activeImage.css("padding-left"),10)+value,values.right=parseInt(_activeImage.css("padding-right"),10)+value,values.bottom=parseInt(_activeImage.css("padding-bottom"),10)+value,(isNaN(values.top)||values.top<1)&&(values.top=value>0?value:0),(isNaN(values.left)||values.left<1)&&(values.left=value>0?value:0),(isNaN(values.right)||values.right<1)&&(values.right=value>0?value:0),(isNaN(values.bottom)||values.bottom<1)&&(values.bottom=value>0?value:0),_activeImage.css({"padding-top":values.top+"px","padding-left":values.left+"px","padding-right":values.right+"px","padding-bottom":values.bottom+"px"}),_toolbarPaddingInputs.each(function(idx,input){var padding;input=$(input),padding=input.data("padding"),input.val(values[padding])});break;case"top":values.top=parseInt(_activeImage.css("padding-top"),10)+value,(isNaN(values.top)||values.top<1)&&(values.top=value>0?value:0),_activeImage.css("padding-top",values.top+"px"),inputButton=_toolbarPaddingInputs.filter("#paddingTop"),inputButton.val(values.top);break;case"left":values.left=parseInt(_activeImage.css("padding-left"),10)+value,(isNaN(values.left)||values.left<1)&&(values.left=value>0?value:0),_activeImage.css("padding-left",values.left+"px"),inputButton=_toolbarPaddingInputs.filter("#paddingLeft"),inputButton.val(values.left);break;case"right":values.right=parseInt(_activeImage.css("padding-right"),10)+value,(isNaN(values.right)||values.right<1)&&(values.right=value>0?value:0),_activeImage.css("padding-right",values.right+"px"),inputButton=_toolbarPaddingInputs.filter("#paddingRight"),inputButton.val(values.right);break;case"bottom":values.bottom=parseInt(_activeImage.css("padding-bottom"),10)+value,(isNaN(values.bottom)||values.bottom<1)&&(values.bottom=value>0?value:0),_activeImage.css("padding-bottom",values.bottom+"px"),inputButton=_toolbarPaddingInputs.filter("#paddingBottom"),inputButton.val(values.bottom)}})},addPaddingHistory=function(image){var histObj,histIdx;histIdx=getImageHistIdx(image),histObj={type:"padding",prop:{}},_toolbarPaddingInputs.each(function(idx,input){var paddingPosition;input=$(input),paddingPosition=input.data("padding"),histObj.prop[paddingPosition]=image.css("padding-"+paddingPosition)}),addActionToImageHistChanges(histIdx,histObj),enableUndo()},bindAltTextBtn=function(){_toolbarAltTextIcon.on("click.imageEditing",function(evt){if(evt.stopPropagation(),evt.preventDefault(),null!==_activeImage){if(_activeToolbarBtn===_toolbarAltTextIcon)return disablePanel(),void disableActiveBtn();removeActionsWithWrappers(_activeImage),activeBtn(_toolbarAltTextIcon),enablePanel(_toolbarAltTextPanel),_toolbarAltTextInput.off("keyup").on("keyup",function(e){e.stopPropagation()}).off("keydown").on("keydown",function(e){e.stopPropagation(),e.keyCode===ENTER&&(e.preventDefault(),_toolbarAltTextSaveBtn.trigger("click"))}).off("paste").on("paste",function(e){e.stopPropagation()}),_toolbarAltTextInput.val(_activeImage.attr("alt")).focus()}})},bindAltTextSaveBtn=function(){_toolbarAltTextSaveBtn.on("click.imageEditing",function(e){e.stopPropagation(),e.preventDefault(),addAltTextHistory(_activeImage),_activeImage.attr({alt:_toolbarAltTextInput.val(),title:_toolbarAltTextInput.val()}),disablePanel(),disableActiveBtn()})},addAltTextHistory=function(image){var histIdx=getImageHistIdx(image),histObj={type:"altText",prop:{text:image.attr("alt")}};addActionToImageHistChanges(histIdx,histObj),enableUndo()},bindAlignLeftBtn=function(){_toolbarAlignLeftBtn.on("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),null!==_activeImage&&alignButtonAction("left")})},bindAlignRightBtn=function(){_toolbarAlignRightBtn.on("click.imageEditing",function(evt){evt.stopPropagation(),evt.preventDefault(),null!==_activeImage&&alignButtonAction("right")})},alignButtonAction=function(align){var histIdx,histObj,float;null!==_activeImage&&(disablePanel(),removeActionsWithWrappers(_activeImage),histIdx=getImageHistIdx(_activeImage),histObj=getFloatObject(_activeImage,_activeImage.css("float")),addActionToImageHistChanges(histIdx,histObj),disableFloatButtons(),_activeImageFloat===align?float="none":(float=align,"left"===float?enableFloatLeftButton():enableFloatRightButton()),setImageFloat(_activeImage,float),enableUndo())};var hideAndMoveToolbar=function(){_toolbar.hide(),_toolbar.attr("style","")};return bindDeleteBtn=function(){_toolbarDeleteBtn.on("click.imageEditing",function(evt){var imageParent,elementToBeFocused,redactorImageSpan;evt.stopPropagation(),evt.preventDefault(),null!==_activeImage&&_toolbarDeleteIcon!==_activeToolbarBtn&&(hideAndMoveToolbar(),disablePanel(),disableFloatButtons(),removeActionsWithWrappers(_activeImage),removeImageToolWrapper(),redactorImageSpan=_activeImage.parent("#"+REDACTOR_IMAGE_BOX_ID),imageParent=0!==redactorImageSpan.length?redactorImageSpan.parent():_activeImage.parent(),elementToBeFocused=getElementToBeFocused(imageParent),_activeImage.hide(),_history[getImageHistIdx(_activeImage)]=null,_activeImage.remove(),redactorImageSpan.remove(),hideToolbar(),_redactorFacade.focusOnElement(elementToBeFocused))})},getElementToBeFocused=function(imageParent){var parentHasOnlyOneChild,next,prev;return(parentHasOnlyOneChild=1===imageParent.children().length)?(next=imageParent.next(),0!==next.length?next:(prev=imageParent.prev(),0!==prev.length?prev:imageParent.parent())):imageParent},activeBtn=function(btnToActive){_activeToolbarBtn&&_activeToolbarBtn.removeClass("active"),btnToActive.addClass("active"),_activeToolbarBtn=btnToActive},disableActiveBtn=function(){_activeToolbarBtn&&(_activeToolbarBtn.removeClass("active"),_activeToolbarBtn=null)},disablePanel=function(){_activeToolbarPanel&&(_activeToolbarPanel.closest("span").removeClass("openPanel"),_activeToolbarPanel.removeClass("active"))},enablePanel=function(panelToActive){disablePanel(),panelToActive.closest("span").addClass("openPanel"),panelToActive.addClass("active"),_activeToolbarPanel=panelToActive,panelToActive===_toolbarAltTextPanel&&setTimeout(function(){panelToActive.width(ALTTEXT_PANEL_WIDTH)},0)},localizeTemplates=function(resx){resx&&"object"==typeof resx&&Object.keys(resx).length>0?_resx=resx:null==_resx&&(_resx=_defaultResx),_editImageToolbarTemplate=_editImageToolbarTemplateUnlocalized.replace(/(\{[0-9]+\})/g,function(str,match){switch(match){case"{0}":return _resx.rotate;case"{1}":return _resx.crop;case"{2}":return _resx.resize;case"{3}":return _resx.undo;case"{4}":return _resx.padding;case"{5}":return _resx.titleAndAltText;case"{6}":return _resx.save;case"{7}":return _resx.alignLeft;case"{8}":return _resx.alignRight;case"{9}":return _resx.delete;default:return match}}),_savingLayerTemplate=_savingLayerTemplateUnlocalized.replace("{0}",_resx.savingImageChanges)},destroy=function(){_module&&(hideToolbar(),_activeImage&&removeActionsWithWrappers(_activeImage),removeWrappersOfAllImages(),ensureRemoveAnyImageToolWrapper(),_savingLayer&&_savingLayer.remove(),closeNotif(),_module.removeClass(IMAGE_INLINE_EDIT_CLASS),_module.off(".imageEditing"),_module.find("img").off(".imageEditing"),$(window).off(".inlineEditing"),_toolbarRotateBtn.off(".imageEditing"),_toolbarCropBtn.off(".imageEditing"),_toolbarResizeBtn.off(".imageEditing"),_toolbarUndoBtn.off(".imageEditing"),_toolbarPaddingBtn.off(".imageEditing"),_toolbarPaddingLock.off(".imageEditing"),_toolbarPaddingInputs.off(".imageEditing"),_toolbarPaddingAreas.off(".imageEditing"),_toolbarPaddingButtons.off(".imageEditing"),_toolbarAltTextIcon.off(".imageEditing"),_toolbarAltTextSaveBtn.off(".imageEditing"),_toolbarAlignLeftBtn.off(".imageEditing"),_toolbarAlignRightBtn.off(".imageEditing"),_toolbarDeleteBtn.off(".imageEditing"),_toolbar.off("click.imageEditing"),_cropButtons&&2===_cropButtons.length&&(_cropButtons[0].off(".imageEditing"),_cropButtons[1].off(".imageEditing")),_module=null,_redactorBox=null,_redactorToolbar=null,_resx=null,_siteRoot=null,_sfImage=null,_saveImageURL=null,_proxyImageUrl=null,_history=null,_activeImage=null,_activeImageStyle=null,_activeImageFloat=null,_disabled=null,_floatApplied=null,_activePaddingInput=null,_activeJcrop=null,_imageIsResized=null,_imageIsResizing=null,_isProcessingProxyImage=null,_imageEditingWillBeDestroyed=null,_savingImage=null,_notif=null,_toolbar=null,_toolbarRotateBtn=null,_toolbarUndoBtn=null,_toolbarDeleteBtn=null,_toolbarDeleteIcon=null,_activeToolbarBtn=null,_activeToolbarPanel=null,_toolbarCropBtn=null,_toolbarCropIcon=null,_cropButtons=null,_jcropSelection=null,_jcropChanging=null,_toolbarResizeBtn=null,_toolbarResizeIcon=null,_toolbarPaddingBtn=null,_toolbarPaddingIcon=null,_toolbarPaddingPanel=null,_toolbarPaddingLock=null,_toolbarPaddingInputs=null,_toolbarPaddingButtons=null,_toolbarPaddingAreas=null,_toolbarPaddingImages=null,_toolbarAltTextBtn=null,_toolbarAltTextIcon=null,_toolbarAltTextPanel=null,_toolbarAltTextInput=null,_toolbarAltTextSaveBtn=null,_toolbarAlignLeftBtn=null,_toolbarAlignLeftIcon=null,_toolbarAlignRightBtn=null,_toolbarAlignRightIcon=null,_removeAlign=null)},ensureClean=function(){_module&&_module.find("img").each(function(idx,image){image=$(image),image.data("original-src")&&isBase64Image(image)&&image.attr("src",image.data("original-src"))})},ImageEditing.prototype.executeAfterSaving=function(callback){var win,needToBeSaved;needToBeSaved=_activeImage&&"YES"===_activeImage.data("need-save"),needToBeSaved||_isProcessingProxyImage?(win=$(window),win.on("saved.inlineEditing",function onInlineEditingSaved(){win.off("saved.inlineEditing",onInlineEditingSaved),"function"==typeof callback&&callback()})):"function"==typeof callback&&callback()},ImageEditing.prototype.destroy=function(callback){var win;_activeImage&&disableEditingImage(_activeImage),_imageEditingWillBeDestroyed||(_imageEditingWillBeDestroyed=!0,win=$(window),win.on("saved.inlineEditing",function onInlineEditingSaved(){win.off("saved.inlineEditing",onInlineEditingSaved),ensureClean(),destroy(),"function"==typeof callback&&callback()}),_savingImage||win.trigger("saved.inlineEditing"))},ImageEditing.prototype.isEditingInProcess=function(){return null!==_activeImage},ImageEditing.prototype.getActiveImage=function(){return _activeImage},ImageEditing.prototype.getHistory=function(){return _history},ImageEditing.prototype.setHistory=function(history){var tsIndex;for(tsIndex in _history)"object"==typeof history[tsIndex]&&(_history[tsIndex].imgHist=history[tsIndex].imgHist)},ImageEditing.prototype.stopEditingImage=function(){hideToolbar()},ImageEditing.prototype.removeWrappers=function(){removeWrappersOfAllImages()},ImageEditing.prototype.addWrappers=function(){addWrappersToAllImages()},ImageEditing.prototype.notifyRedactorReady=function(){_redactorFacade.synchronizeToolbarScroll(_toolbar)},ImageEditing.localize=function(resx){localizeTemplates(resx)},ImageEditing}(),window.dnn.HTMLPro.ImageEditing=ImageEditingClass}.call(this);