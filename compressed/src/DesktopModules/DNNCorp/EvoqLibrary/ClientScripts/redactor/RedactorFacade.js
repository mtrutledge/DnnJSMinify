window.dnn=dnn||{},window.dnn.HTMLPro=window.dnn.HTMLPro||{},window.dnn.HTMLPro.RedactorFacade=function(){"use strict";var initRedactor,setConfig,setModule,sync,toggle,get,destroy,isBlurCommingFromModal,hideIcons,setCustomToolbarEvent,getToolbar,getHTMLButton,setCustomHtmlToggle,onOnKeyDownIE,setCustomShowInsertLinkModal,wasInsertLinkClicked,hideModalInsertLinkTextElements,setCustomInsertLinkAction,setCustomRemoveLinkFromImage,wasRemoveLinkClicked,getModalRemoveLink,focusOnElement,selectElement,fadeInOutRedactor,synchronizeToolbarScroll,observeScroll,isRtlCulture,config,module,redactor,resxRedactor,previousToggle,TIME_NEEDED_AFTER_SYNC=100,ACTION_SYNC="code.sync",ACTION_TOGGLE="code.toggle",ACTION_GET="code.get",ACTION_DESTROY="core.destroy",BUTTON_INSERT_LINK_SELECTOR="redactor-dropdown-link",BUTTON_REMOVE_LINK_SELECTOR="redactor-dropdown-unlink",BUTTON_HTML_SELECTOR="li a.re-icon.re-html:first",REDACTOR_NAMESPACE="redactor",REDACTOR_BOX_CLASS=".redactor-box",REDACTOR_TOOLBAR_CLASS=".redactor-toolbar",REDACTOR_MODAL_LINK_INSERT_ID="#redactor-modal-link-insert",REDACTOR_FORMATTING_DROPDOWN_SELECTOR=".redactor-dropdown.redactor-dropdown-box-formatting",ICONS_SELECTOR=".redactor-toolbar li a",ON_SELECT_LINK_TOOLTIP_CLASS=".redactor-link-tooltip",CUSTOM_TOOLBAR_EVENTS_IDENTIFIER="click.customToolbarEvents",ON_KEYDOWN_IE_EVENT_IDENTIFIER="keydown.dnnRedactorIE",REDACTOR_LINK_BLACK_CHECKBOX_ID="#redactor-link-blank",REDACTOR_FADE_OPERATION_INIT_DURATION=100,REDACTOR_FADE_OPERATION_END_DURATION=400,DEFAULT_LANG_IN_REDACTOR="en",MODAL_REMOVE_LINK_SELECTORS={MAIN_MODAL:"#redactor-modal-link-insert",INNER_MODAL:"#redactor_modal_inner",BUTTON_CLOSE:".redactor_btn_modal_close"},RTL_CULTURES=["ar","arc","bcc","bqi","ckb","dv","fa","glk","he","mzn","pnb","ps","sd","ug","ur","yi"];fadeInOutRedactor=function(element,callbackFirstStep,callbackSecondStep){element.fadeOut(REDACTOR_FADE_OPERATION_INIT_DURATION,function(){"function"==typeof callbackFirstStep&&callbackFirstStep(),element.fadeIn(REDACTOR_FADE_OPERATION_END_DURATION,function(){"function"==typeof callbackSecondStep&&callbackSecondStep()})})},isRtlCulture=function(culture){for(var i=0;i<RTL_CULTURES.length;i++){var rtlCulture=RTL_CULTURES[i];if(0===culture.indexOf(rtlCulture))return!0}return!1},initRedactor=function(resxRedactor,postInitRedactorCallback,extraOptions){var options={maxFileSize:resxRedactor.maxFileSize};options=$.extend(options,extraOptions),isRtlCulture($.dnnRedactor.opts.lang)&&(options=$.extend(options,{direction:"rtl"})),fadeInOutRedactor(module,function(){redactor=module.dnnRedactor(options),postInitRedactorCallback()})},setConfig=function(configuration,resxSettings){config=configuration,$.dnnRedactor.opts.maxFileSize=config.maxFileSize,resxSettings&&resxSettings.culture&&Object.keys(resxSettings.resxRedactor).length>0&&(resxRedactor=resxSettings.resxRedactor,$.dnnRedactor.opts.langs[resxSettings.culture]=$.dnnRedactor.opts.langs[resxSettings.culture]||{},0===Object.keys($.dnnRedactor.opts.langs[resxSettings.culture]).length&&$.extend($.dnnRedactor.opts.langs[resxSettings.culture],$.dnnRedactor.opts.langs[DEFAULT_LANG_IN_REDACTOR]),$.extend($.dnnRedactor.opts.langs[resxSettings.culture],resxSettings.resxRedactor),$.dnnRedactor.opts.lang=resxSettings.culture)},setModule=function(intlineEditingModule){module=intlineEditingModule},sync=function(syncRedactorCallback){module.dnnRedactor(ACTION_SYNC),syncRedactorCallback&&setTimeout(function(){syncRedactorCallback()},TIME_NEEDED_AFTER_SYNC)},toggle=function(){var redactorData=redactor.data("redactor");"function"==typeof previousToggle?previousToggle.call(redactorData):module.dnnRedactor(ACTION_TOGGLE)},get=function(){return module.dnnRedactor(ACTION_GET)},destroy=function(destroyRedactorCallback){fadeInOutRedactor(module.parent().parent(),function(){module.dnnRedactor(ACTION_DESTROY)},function(){destroyRedactorCallback&&destroyRedactorCallback()})},isBlurCommingFromModal=function(event){var redactorModalLinkInsert,redactorLinkTooltip,redactorFormattingDropdown;return redactorModalLinkInsert=$(REDACTOR_MODAL_LINK_INSERT_ID),redactorFormattingDropdown=$(REDACTOR_FORMATTING_DROPDOWN_SELECTOR),redactorLinkTooltip=$(ON_SELECT_LINK_TOOLTIP_CLASS),event.namespace!==REDACTOR_NAMESPACE||redactorModalLinkInsert.length>0||redactorFormattingDropdown&&redactorFormattingDropdown.is(":visible")||redactorLinkTooltip.length>0&&redactorLinkTooltip.is(":visible")},hideIcons=function(){$(ICONS_SELECTOR).hide()},setCustomToolbarEvent=function(redactor,newCustomToolbarCallback){redactor.$toolbar.off(CUSTOM_TOOLBAR_EVENTS_IDENTIFIER).on(CUSTOM_TOOLBAR_EVENTS_IDENTIFIER,newCustomToolbarCallback)},getToolbar=function(redactor){return $(redactor.$element).closest(REDACTOR_BOX_CLASS).find(REDACTOR_TOOLBAR_CLASS)},getHTMLButton=function(redactor){return getToolbar(redactor).find(BUTTON_HTML_SELECTOR)},setCustomHtmlToggle=function(customHtmlToggleCallback){var redactorData=redactor.data("redactor");previousToggle=redactorData.code.toggle,redactorData.code.toggle=function(e){customHtmlToggleCallback(e)}},onOnKeyDownIE=function(callback){$(window).on(ON_KEYDOWN_IE_EVENT_IDENTIFIER,callback)},setCustomShowInsertLinkModal=function(showInsertLinkModalCallback){var redactorData=redactor.data("redactor"),previousShow=redactorData.link.show;redactorData.link.show=function(e){previousShow.call(redactorData,e),showInsertLinkModalCallback(e)}},setCustomRemoveLinkFromImage=function(removeLinkWithImageCallback){var redactorData=redactor.data("redactor"),previousUnlink=redactorData.link.unlink;redactorData.link.unlink=function(e){previousUnlink.call(redactorData,e),removeLinkWithImageCallback(e)}},wasInsertLinkClicked=function(eventTarget){return eventTarget.hasClass(BUTTON_INSERT_LINK_SELECTOR)},hideModalInsertLinkTextElements=function(){var redactorData=redactor.data("redactor");redactorData.link.$inputText.hide(),redactorData.link.$inputText.prev().hide()},setCustomInsertLinkAction=function(imageEditing,callback){var redactorData=redactor.data("redactor"),previousInsert=redactorData.link.insert;redactorData.link.insert=function(e){var openInANewPage=!1;return imageEditing.getActiveImage()?(openInANewPage=$(REDACTOR_LINK_BLACK_CHECKBOX_ID).prop("checked"),callback(redactorData.link.$inputUrl.val(),openInANewPage),void redactorData.modal.close()):void previousInsert.call(redactorData,e)}},wasRemoveLinkClicked=function(eventTarget){return eventTarget.hasClass(BUTTON_REMOVE_LINK_SELECTOR)},getModalRemoveLink=function(){var modalLink,innerModal;return modalLink=$(MODAL_REMOVE_LINK_SELECTORS.MAIN_MODAL),innerModal=modalLink.closest(MODAL_REMOVE_LINK_SELECTORS.INNER_MODAL),{modal:modalLink,innerModal:innerModal,closeButton:innerModal.find(MODAL_REMOVE_LINK_SELECTORS.BUTTON_CLOSE)}},focusOnElement=function(element){var redactorData=redactor.data("redactor");redactorData.utils.browser("msie")?redactorData.focus.setStart():redactorData.caret.setAfter(element)},selectElement=function(element){var redactorData;element&&0!==element.length&&(redactorData=redactor.data("redactor"),redactorData.selection.selectElement(element))};var isRedactorToolbarFloating=function(redactorToolbar){return"absolute"===redactorToolbar.css("position")},overrideToolbarAttributes=function(sourceToolbar,targetToolbar){var attributesToCopy;attributesToCopy=["position","left","visibility"];for(var i=0;i<attributesToCopy.length;i++)targetToolbar.css(attributesToCopy[i],sourceToolbar.css(attributesToCopy[i]))},calculateNewOffset=function(sourceToolbar,targetToolbar){isRedactorToolbarFloating(targetToolbar)?(targetToolbar.offset(sourceToolbar.offset()),targetToolbar.css("top",sourceToolbar.position().top+sourceToolbar.height()-2)):targetToolbar.css("top",0)};return observeScroll=function(toolbar){var redactorData,redactorToolbar;redactorData=redactor.data("redactor"),redactorToolbar=redactorData.$toolbar,overrideToolbarAttributes(redactorToolbar,toolbar),calculateNewOffset(redactorToolbar,toolbar)},synchronizeToolbarScroll=function(toolbar){var redactorData=redactor.data("redactor");redactorData.utils.isDesktop()&&(redactorData.opts.toolbarExternal||redactorData.opts.toolbarFixed&&(observeScroll(toolbar),$(redactorData.opts.toolbarFixedTarget).on("scroll.redactor."+redactorData.uuid,function(){observeScroll(toolbar)})))},{setConfig:setConfig,setModule:setModule,initRedactor:initRedactor,sync:sync,toggle:toggle,get:get,destroy:destroy,isBlurCommingFromModal:isBlurCommingFromModal,hideIcons:hideIcons,setCustomToolbarEvent:setCustomToolbarEvent,getToolbar:getToolbar,getHTMLButton:getHTMLButton,setCustomHtmlToggle:setCustomHtmlToggle,onOnKeyDownIE:onOnKeyDownIE,setCustomShowInsertLinkModal:setCustomShowInsertLinkModal,wasInsertLinkClicked:wasInsertLinkClicked,hideModalInsertLinkTextElements:hideModalInsertLinkTextElements,setCustomInsertLinkAction:setCustomInsertLinkAction,setCustomRemoveLinkFromImage:setCustomRemoveLinkFromImage,wasRemoveLinkClicked:wasRemoveLinkClicked,getModalRemoveLink:getModalRemoveLink,focusOnElement:focusOnElement,selectElement:selectElement,synchronizeToolbarScroll:synchronizeToolbarScroll,updateToolbarPosition:observeScroll}};