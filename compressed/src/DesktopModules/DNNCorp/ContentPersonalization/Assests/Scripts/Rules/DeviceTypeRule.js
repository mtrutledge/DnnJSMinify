window.dnn=dnn||{},window.dnn.personalizedTabs=dnn.personalizedTabs||{},window.dnn.personalizedTabs.rules=dnn.personalizedTabs.rules||{},function(){var DeviceTypeRuleClass;DeviceTypeRuleClass=function(){"use strict";function DeviceTypeRule(onDeleteRuleCallback,resx){_resx=resx,this._id="",this._viewModel={},this._ruleElement=null,this.onDeleteRuleCallback=onDeleteRuleCallback,_templateLoader=window.dnn.personalizedTabs.TemplateLoader,DeviceTypeRule.template||_templateLoader.readHtmlTemplate(dnn.getVar("dnn_content_personalization_resourceroot")+HTML_PATH,function(template){DeviceTypeRule.template=template})}var _templateLoader,_resx,getViewModel,remove,HTML_PATH="Assests/Html/Rules/DeviceTypeRuleTemplate.html";return DeviceTypeRule.class="DeviceTypeRule",DeviceTypeRule.type="Class",DeviceTypeRule.template,DeviceTypeRule.allowMultipleInstances=!1,getViewModel=function(self,data){self._viewModel={id:self._id,remove:remove,self:self,resx:_resx,mobileSelected:ko.observable(!1),tabletSelected:ko.observable(!1),pcSelected:ko.observable(!1),anyDeviceTypeSelected:ko.observable(0).extend({validation:{validator:function(){return!!self._viewModel.mobileSelected&&(self._viewModel.mobileSelected()||self._viewModel.tabletSelected()||self._viewModel.pcSelected())},message:_resx.RulesDeviceTypeValitationMessage}})},self._viewModel.mobileSelected.subscribe(function(){var oldValue=self._viewModel.anyDeviceTypeSelected();self._viewModel.anyDeviceTypeSelected(oldValue+1)}),self._viewModel.tabletSelected.subscribe(function(){var oldValue=self._viewModel.anyDeviceTypeSelected();self._viewModel.anyDeviceTypeSelected(oldValue+1)}),self._viewModel.pcSelected.subscribe(function(){var oldValue=self._viewModel.anyDeviceTypeSelected();self._viewModel.anyDeviceTypeSelected(oldValue+1)}),data&&(self._viewModel.mobileSelected(data.Mobile),self._viewModel.tabletSelected(data.Tablet),self._viewModel.pcSelected(data.Pc)),self._viewModel.validationObservable=ko.validatedObservable({anyDeviceTypeSelected:self._viewModel.anyDeviceTypeSelected})},remove=function(){this.self.onDeleteRuleCallback&&"function"==typeof this.self.onDeleteRuleCallback&&this.self.onDeleteRuleCallback(this.id)},DeviceTypeRule.getId=function(){return"DeviceTypeRule"},DeviceTypeRule.getName=function(resx){return resx.RulesDeviceTypeName},DeviceTypeRule.loadTemplate=function(callback){DeviceTypeRule.template?callback():_templateLoader.readHtmlTemplate(dnn.getVar("dnn_content_personalization_resourceroot")+HTML_PATH,function(template){DeviceTypeRule.template=template,callback()})},DeviceTypeRule.prototype.getId=function(){return this._id},DeviceTypeRule.prototype.injectRule=function(parentElement,afterInjectCallback,data){var self=this;DeviceTypeRule.loadTemplate(function(){var dateNow=(new Date).getTime(),html=DeviceTypeRule.template.replace(/\{0\}/g,dateNow);parentElement.append(html),self._id=dateNow,self._ruleElement=$("#{0}".replace(/\{0\}/g,self._id)),getViewModel(self,data),ko.applyBindings(self._viewModel,self._ruleElement[0],{decorateElement:!0,insertMessages:!0,deep:!0}),afterInjectCallback(self,parentElement,self._viewModel.validationObservable)})},DeviceTypeRule.prototype.getDataToBeSent=function(){if(this._viewModel)return{type:"DeviceTypeRule",Mobile:this._viewModel.mobileSelected(),Tablet:this._viewModel.tabletSelected(),Pc:this._viewModel.pcSelected()}},DeviceTypeRule.prototype.freeContext=function(){var element=$("#{0}".replace(/\{0\}/g,this._id));ko.cleanNode(element)},DeviceTypeRule.prototype.doesRuleAllowMultipleInstances=function(){return DeviceTypeRule.allowMultipleInstances},DeviceTypeRule.prototype.getRuleClass=function(){return DeviceTypeRule.class},DeviceTypeRule}(),window.dnn.personalizedTabs.rules.DeviceTypeRule=DeviceTypeRuleClass}.call(this);