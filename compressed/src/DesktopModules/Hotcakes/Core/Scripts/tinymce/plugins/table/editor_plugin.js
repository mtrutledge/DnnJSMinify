!function(d){function c(g,h){var k,j=h.ownerDocument,f=j.createRange();return f.setStartBefore(h),f.setEnd(g.endContainer,g.endOffset),k=j.createElement("body"),k.appendChild(f.cloneContents()),0==k.innerHTML.replace(/<(br|img|object|embed|input|textarea)[^>]*>/gi,"-").replace(/<[^>]+>/g,"").length}function a(g,f){return parseInt(g.getAttribute(f)||1)}function b(H,G,K){function A(N,M){return N=N.cloneNode(M),N.removeAttribute("id"),N}function t(){var M=0;g=[],e(["thead","tbody","tfoot"],function(N){var O=G.select("> "+N+" tr",H);e(O,function(P,Q){Q+=M,e(G.select("> td, > th",P),function(W,R){var S,T,U,V;if(g[Q])for(;g[Q][R];)R++;for(U=a(W,"rowspan"),V=a(W,"colspan"),T=Q;T<Q+U;T++)for(g[T]||(g[T]=[]),S=R;S<R+V;S++)g[T][S]={part:N,real:T==Q&&S==R,elm:W,rowspan:U,colspan:V}})}),M+=O.length})}function z(M,O){var N;if(N=g[O])return N[M]}function s(O,M,N){O&&(N=parseInt(N),1===N?O.removeAttribute(M,1):O.setAttribute(M,N,1))}function j(M){return M&&(G.hasClass(M.elm,"mceSelected")||M==o)}function k(){var M=[];return e(H.rows,function(N){e(N.cells,function(O){if(G.hasClass(O,"mceSelected")||O==o.elm)return M.push(N),!1})}),M}function r(){var M=G.createRng();M.setStartAfter(H),M.setEndAfter(H),K.setRng(M),G.remove(H)}function f(M){var N;return d.walk(M,function(P){var O;if(3==P.nodeType)return e(G.getParents(P.parentNode,null,M).reverse(),function(Q){Q=A(Q,!1),N?O&&O.appendChild(Q):N=O=Q,O=Q}),O&&(O.innerHTML=d.isIE?"&nbsp;":'<br data-mce-bogus="1" />'),!1},"childNodes"),M=A(M,!1),s(M,"rowSpan",1),s(M,"colSpan",1),N?M.appendChild(N):d.isIE||(M.innerHTML='<br data-mce-bogus="1" />'),M}function q(){var M=G.createRng();return e(G.select("tr",H),function(N){0==N.cells.length&&G.remove(N)}),0==G.select("tr",H).length?(M.setStartAfter(H),M.setEndAfter(H),K.setRng(M),void G.remove(H)):(e(G.select("thead,tbody,tfoot",H),function(N){0==N.rows.length&&G.remove(N)}),t(),row=g[Math.min(g.length-1,L.y)],void(row&&(K.select(row[Math.min(row.length-1,L.x)].elm,!0),K.collapse(!0))))}function u(S,Q,U,R){var P,N,M,O,T;for(P=g[Q][S].elm.parentNode,M=1;M<=U;M++)if(P=G.getNext(P,"tr")){for(N=S;N>=0;N--)if(T=g[Q+M][N].elm,T.parentNode==P){for(O=1;O<=R;O++)G.insertAfter(f(T),T);break}if(N==-1)for(O=1;O<=R;O++)P.insertBefore(f(P.cells[0]),P.cells[0])}}function C(){e(g,function(M,N){e(M,function(P,O){var S,R,Q;if(j(P)&&(P=P.elm,S=a(P,"colspan"),R=a(P,"rowspan"),S>1||R>1)){for(s(P,"rowSpan",1),s(P,"colSpan",1),Q=0;Q<S-1;Q++)G.insertAfter(f(P),P);u(O,N,R-1,S)}})})}function p(V,S,Y){var P,O,X,W,U,R,T,M,V,N,Q;if(V?(pos=F(V),P=pos.x,O=pos.y,X=P+(S-1),W=O+(Y-1)):(L=D=null,e(g,function(Z,aa){e(Z,function(ac,ab){j(ac)&&(L||(L={x:ab,y:aa}),D={x:ab,y:aa})})}),P=L.x,O=L.y,X=D.x,W=D.y),T=z(P,O),M=z(X,W),T&&M&&T.part==M.part){for(C(),t(),T=z(P,O).elm,s(T,"colSpan",X-P+1),s(T,"rowSpan",W-O+1),R=O;R<=W;R++)for(U=P;U<=X;U++)g[R]&&g[R][U]&&(V=g[R][U].elm,V!=T&&(N=d.grep(V.childNodes),e(N,function(Z){T.appendChild(Z)}),N.length&&(N=d.grep(T.childNodes),Q=0,e(N,function(Z){"BR"==Z.nodeName&&G.getAttrib(Z,"data-mce-bogus")&&Q++<N.length-1&&T.removeChild(Z)})),G.remove(V)));q()}}function l(Q){var M,S,P,R,T,U,N,V,O;for(e(g,function(W,X){if(e(W,function(Z,Y){if(j(Z)&&(Z=Z.elm,T=Z.parentNode,U=A(T,!1),M=X,Q))return!1}),Q)return!M}),R=0;R<g[0].length;R++)if(g[M][R]&&(S=g[M][R].elm,S!=P)){if(Q){if(M>0&&g[M-1][R]&&(V=g[M-1][R].elm,O=a(V,"rowSpan"),O>1)){s(V,"rowSpan",O+1);continue}}else if(O=a(S,"rowspan"),O>1){s(S,"rowSpan",O+1);continue}N=f(S),s(N,"colSpan",S.colSpan),U.appendChild(N),P=S}U.hasChildNodes()&&(Q?T.parentNode.insertBefore(U,T):G.insertAfter(U,T))}function h(N){var O,M;e(g,function(P,Q){if(e(P,function(S,R){if(j(S)&&(O=R,N))return!1}),N)return!O}),e(g,function(S,T){var P,Q,R;S[O]&&(P=S[O].elm,P!=M&&(R=a(P,"colspan"),Q=a(P,"rowspan"),1==R?N?(P.parentNode.insertBefore(f(P),P),u(O,T,Q-1,R)):(G.insertAfter(f(P),P),u(O,T,Q-1,R)):s(P,"colSpan",P.colSpan+1),M=P))})}function n(){var M=[];e(g,function(N,O){e(N,function(Q,P){j(Q)&&d.inArray(M,P)===-1&&(e(g,function(T){var S,R=T[P].elm;S=a(R,"colSpan"),S>1?s(R,"colSpan",S-1):G.remove(R)}),M.push(P))})}),q()}function m(){function M(Q){var P,R,O;P=G.getNext(Q,"tr"),e(Q.cells,function(S){var T=a(S,"rowSpan");T>1&&(s(S,"rowSpan",T-1),R=F(S),u(R.x,R.y,1,1))}),R=F(Q.cells[0]),e(g[R.y],function(S){var T;S=S.elm,S!=O&&(T=a(S,"rowSpan"),T<=1?G.remove(S):s(S,"rowSpan",T-1),O=S)})}var N;N=k(),e(N.reverse(),function(O){M(O)}),q()}function E(){var M=k();return G.remove(M),q(),M}function J(){var M=k();return e(M,function(O,N){M[N]=A(O,!0)}),M}function B(O,N){if(O){var P=k(),M=P[N?0:P.length-1],Q=M.cells.length;e(g,function(S){var R;if(Q=0,e(S,function(U,T){U.real&&(Q+=U.colspan),U.elm.parentNode==M&&(R=1)}),R)return!1}),N||O.reverse(),e(O,function(T){var R,S=T.cells.length;for(i=0;i<S;i++)R=T.cells[i],s(R,"colSpan",1),s(R,"rowSpan",1);for(i=S;i<Q;i++)T.appendChild(f(T.cells[S-1]));for(i=Q;i<S;i++)G.remove(T.cells[i]);N?M.parentNode.insertBefore(T,M):G.insertAfter(T,M)}),G.removeClass(G.select("td.mceSelected,th.mceSelected"),"mceSelected")}}function F(M){var N;return e(g,function(O,P){return e(O,function(R,Q){if(R.elm==M)return N={x:Q,y:P},!1}),!N}),N}function w(M){L=F(M)}function I(){var N,M;return N=M=0,e(g,function(P,Q){e(P,function(S,R){var U,T;j(S)&&(S=g[Q][R],R>N&&(N=R),Q>M&&(M=Q),S.real&&(U=S.colspan-1,T=S.rowspan-1,U&&R+U>N&&(N=R+U),T&&Q+T>M&&(M=Q+T)))})}),{x:N,y:M}}function v(S){var P,O,U,T,N,M,Q,R;if(D=F(S),L&&D){for(P=Math.min(L.x,D.x),O=Math.min(L.y,D.y),U=Math.max(L.x,D.x),T=Math.max(L.y,D.y),N=U,M=T,y=O;y<=M;y++)S=g[y][P],S.real||P-(S.colspan-1)<P&&(P-=S.colspan-1);for(x=P;x<=N;x++)S=g[O][x],S.real||O-(S.rowspan-1)<O&&(O-=S.rowspan-1);for(y=O;y<=T;y++)for(x=P;x<=U;x++)S=g[y][x],S.real&&(Q=S.colspan-1,R=S.rowspan-1,Q&&x+Q>N&&(N=x+Q),R&&y+R>M&&(M=y+R));for(G.removeClass(G.select("td.mceSelected,th.mceSelected"),"mceSelected"),y=O;y<=M;y++)for(x=P;x<=N;x++)g[y][x]&&G.addClass(g[y][x].elm,"mceSelected")}}var g,L,D,o;t(),o=G.getParent(K.getStart(),"th,td"),o&&(L=F(o),D=I(),o=z(L.x,L.y)),d.extend(this,{deleteTable:r,split:C,merge:p,insertRow:l,insertCol:h,deleteCols:n,deleteRows:m,cutRows:E,copyRows:J,pasteRows:B,getPos:F,setStartCell:w,setEndCell:v})}var e=d.each;d.create("tinymce.plugins.TablePlugin",{init:function(g,h){function l(p){var o=g.selection,n=g.dom.getParent(p||o.getNode(),"table");if(n)return new b(n,g.dom,o)}function k(){g.getBody().style.webkitUserSelect="",j&&(g.dom.removeClass(g.dom.select("td.mceSelected,th.mceSelected"),"mceSelected"),j=!1)}var f,m,j=!0;e([["table","table.desc","mceInsertTable",!0],["delete_table","table.del","mceTableDelete"],["delete_col","table.delete_col_desc","mceTableDeleteCol"],["delete_row","table.delete_row_desc","mceTableDeleteRow"],["col_after","table.col_after_desc","mceTableInsertColAfter"],["col_before","table.col_before_desc","mceTableInsertColBefore"],["row_after","table.row_after_desc","mceTableInsertRowAfter"],["row_before","table.row_before_desc","mceTableInsertRowBefore"],["row_props","table.row_desc","mceTableRowProps",!0],["cell_props","table.cell_desc","mceTableCellProps",!0],["split_cells","table.split_cells_desc","mceTableSplitCells",!0],["merge_cells","table.merge_cells_desc","mceTableMergeCells",!0]],function(n){g.addButton(n[0],{title:n[1],cmd:n[2],ui:n[3]})}),d.isIE||g.onClick.add(function(n,o){o=o.target,"TABLE"===o.nodeName&&(n.selection.select(o),n.nodeChanged())}),g.onPreProcess.add(function(o,p){var n,q,r,s,t=o.dom;for(n=t.select("table",p.node),q=n.length;q--;)r=n[q],t.setAttrib(r,"data-mce-style",""),(s=t.getAttrib(r,"width"))&&(t.setStyle(r,"width",s),t.setAttrib(r,"width","")),(s=t.getAttrib(r,"height"))&&(t.setStyle(r,"height",s),t.setAttrib(r,"height",""))}),g.onNodeChange.add(function(q,o,s){var r;s=q.selection.getStart(),r=q.dom.getParent(s,"td,th,caption"),o.setActive("table","TABLE"===s.nodeName||!!r),r&&"CAPTION"===r.nodeName&&(r=0),o.setDisabled("delete_table",!r),o.setDisabled("delete_col",!r),o.setDisabled("delete_table",!r),o.setDisabled("delete_row",!r),o.setDisabled("col_after",!r),o.setDisabled("col_before",!r),o.setDisabled("row_after",!r),o.setDisabled("row_before",!r),o.setDisabled("row_props",!r),o.setDisabled("cell_props",!r),o.setDisabled("split_cells",!r),o.setDisabled("merge_cells",!r)}),g.onInit.add(function(r){function o(D,z,A,F){var C,w,E,B=3,G=D.dom.getParent(z.startContainer,"TABLE");return G&&(C=G.parentNode),w=z.startContainer.nodeType==B&&0==z.startOffset&&0==z.endOffset&&F&&("TR"==A.nodeName||A==C),E=("TD"==A.nodeName||"TH"==A.nodeName)&&!F,w||E}function n(A){if(d.isWebKit){var z=A.selection.getRng(),C=A.selection.getNode(),B=A.dom.getParent(z.startContainer,"TD,TH");if(o(A,z,C,B)){B||(B=C);for(var w=B.lastChild;w.lastChild;)w=w.lastChild;z.setEnd(w,w.nodeValue.length),A.selection.setRng(z)}}}function v(C,N){function O(Y,U,S){var T=Y?"previousSibling":"nextSibling",Z=C.dom.getParent(U,"tr"),X=Z[T];if(X)return z(C,U,X,Y),d.dom.Event.cancel(S),!0;var aa=C.dom.getParent(Z,"table"),W=Z.parentNode,R=W.nodeName.toLowerCase();if("tbody"===R||R===(Y?"tfoot":"thead")){var V=w(Y,aa,W,"tbody");if(null!==V)return K(Y,V,U,S)}return M(Y,Z,T,aa,S)}function w(V,T,U,X){var S=C.dom.select(">"+X,T),R=S.indexOf(U);if(V&&0===R||!V&&R===S.length-1)return B(V,T);if(R===-1){var W="thead"===U.tagName.toLowerCase()?0:S.length-1;return S[W]}return S[R+(V?-1:1)]}function B(U,T){var S=U?"thead":"tfoot",R=C.dom.select(">"+S,T);return 0!==R.length?R[0]:null}function K(V,T,S,U){var R=J(T,V);return R&&z(C,S,R,V),d.dom.Event.cancel(U),!0}function M(Y,U,R,X,W){var S=X[R];if(S)return F(S),!0;var V=C.dom.getParent(X,"td,th");if(V)return O(Y,V,W);var T=J(U,!Y);return F(T),d.dom.Event.cancel(W)}function J(S,R){var T=S&&S[R?"lastChild":"firstChild"];return T&&"BR"===T.nodeName?C.dom.getParent(T,"td,th"):T}function F(R){C.selection.setCursorLocation(R,0)}function A(){return Q==L.UP||Q==L.DOWN}function D(R){var T=R.selection.getNode(),S=R.dom.getParent(T,"tr");return null!==S}function P(S){for(var R=0,T=S;T.previousSibling;)T=T.previousSibling,R+=a(T,"colspan");return R}function E(T,R){var U=0,S=0;return e(T.children,function(V,W){if(U+=a(V,"colspan"),S=W,U>R)return!1}),S}function z(T,W,Y,V){var X=P(T.dom.getParent(W,"td,th")),S=E(Y,X),R=Y.childNodes[S],U=J(R,V);F(U||R)}function H(R){var T=C.selection.getNode(),U=C.dom.getParent(T,"td,th"),S=C.dom.getParent(R,"td,th");return U&&U!==S&&I(U,S)}function I(S,R){return C.dom.getParent(S,"TABLE")===C.dom.getParent(R,"TABLE")}var L=d.VK,Q=N.keyCode;if(A()&&D(C)){var G=C.selection.getNode();setTimeout(function(){H(G)&&O(!N.shiftKey&&Q===L.UP,G,N)},0)}}function s(){var w;for(w=r.getBody().lastChild;w&&3==w.nodeType&&!w.nodeValue.length;w=w.previousSibling);w&&"TABLE"==w.nodeName&&(r.settings.forced_root_block?r.dom.add(r.getBody(),r.settings.forced_root_block,null,d.isIE?"&nbsp;":'<br data-mce-bogus="1" />'):r.dom.add(r.getBody(),"br",{"data-mce-bogus":"1"}))}var p,t,u,q=r.dom;f=r.windowManager,r.onMouseDown.add(function(w,z){2!=z.button&&(k(),t=q.getParent(z.target,"td,th"),p=q.getParent(t,"table"))}),q.bind(r.getDoc(),"mouseover",function(C){var A,z,B=C.target;if(t&&(u||B!=t)&&("TD"==B.nodeName||"TH"==B.nodeName)){z=q.getParent(B,"table"),z==p&&(u||(u=l(z),u.setStartCell(t),r.getBody().style.webkitUserSelect="none"),u.setEndCell(B),j=!0),A=r.selection.getSel();try{A.removeAllRanges?A.removeAllRanges():A.empty()}catch(w){}C.preventDefault()}}),r.onMouseUp.add(function(F,G){function D(J,L){var K=new d.dom.TreeWalker(J,J);do{if(3==J.nodeType&&0!=d.trim(J.nodeValue).length)return void(L?z.setStart(J,0):z.setEnd(J,J.nodeValue.length));if("BR"==J.nodeName)return void(L?z.setStartBefore(J):z.setEndBefore(J))}while(J=L?K.next():K.prev())}var z,H,w,C,A,E,B=F.selection;B.getSel();if(t){if(u&&(F.getBody().style.webkitUserSelect=""),H=q.select("td.mceSelected,th.mceSelected"),H.length>0){z=q.createRng(),C=H[0],E=H[H.length-1],z.setStartBefore(C),z.setEndAfter(C),D(C,1),w=new d.dom.TreeWalker(C,q.getParent(H[0],"table"));do if("TD"==C.nodeName||"TH"==C.nodeName){if(!q.hasClass(C,"mceSelected"))break;A=C}while(C=w.next());D(A),B.setRng(z)}F.nodeChanged(),t=u=p=null}}),r.onKeyUp.add(function(w,z){k()}),r.onKeyDown.add(function(w,z){n(w)}),r.onMouseDown.add(function(w,z){2!=z.button&&n(w)}),r.plugins.table.fixTableCellSelection=n,r&&r.plugins.contextmenu&&r.plugins.contextmenu.onContextMenu.add(function(A,w,C){var D,B=r.selection,z=B.getNode()||r.getBody();r.dom.getParent(C,"td")||r.dom.getParent(C,"th")||r.dom.select("td.mceSelected,th.mceSelected").length?(w.removeAll(),"A"!=z.nodeName||r.dom.getAttrib(z,"name")||(w.add({title:"advanced.link_desc",icon:"link",cmd:r.plugins.advlink?"mceAdvLink":"mceLink",ui:!0}),w.add({title:"advanced.unlink_desc",icon:"unlink",cmd:"UnLink"}),w.addSeparator()),"IMG"==z.nodeName&&z.className.indexOf("mceItem")==-1&&(w.add({title:"advanced.image_desc",icon:"image",cmd:r.plugins.advimage?"mceAdvImage":"mceImage",ui:!0}),w.addSeparator()),w.add({title:"table.desc",icon:"table",cmd:"mceInsertTable",value:{action:"insert"}}),w.add({title:"table.props_desc",icon:"table_props",cmd:"mceInsertTable"}),w.add({title:"table.del",icon:"delete_table",cmd:"mceTableDelete"}),w.addSeparator(),D=w.addMenu({title:"table.cell"}),D.add({title:"table.cell_desc",icon:"cell_props",cmd:"mceTableCellProps"}),D.add({title:"table.split_cells_desc",icon:"split_cells",cmd:"mceTableSplitCells"}),D.add({title:"table.merge_cells_desc",icon:"merge_cells",cmd:"mceTableMergeCells"}),D=w.addMenu({title:"table.row"}),D.add({title:"table.row_desc",icon:"row_props",cmd:"mceTableRowProps"}),D.add({title:"table.row_before_desc",icon:"row_before",cmd:"mceTableInsertRowBefore"}),D.add({title:"table.row_after_desc",icon:"row_after",cmd:"mceTableInsertRowAfter"}),D.add({title:"table.delete_row_desc",icon:"delete_row",cmd:"mceTableDeleteRow"}),D.addSeparator(),D.add({title:"table.cut_row_desc",icon:"cut",cmd:"mceTableCutRow"}),D.add({title:"table.copy_row_desc",icon:"copy",cmd:"mceTableCopyRow"}),D.add({title:"table.paste_row_before_desc",icon:"paste",cmd:"mceTablePasteRowBefore"}).setDisabled(!m),D.add({title:"table.paste_row_after_desc",icon:"paste",cmd:"mceTablePasteRowAfter"}).setDisabled(!m),D=w.addMenu({title:"table.col"}),D.add({title:"table.col_before_desc",icon:"col_before",cmd:"mceTableInsertColBefore"}),D.add({title:"table.col_after_desc",icon:"col_after",cmd:"mceTableInsertColAfter"}),D.add({title:"table.delete_col_desc",icon:"delete_col",cmd:"mceTableDeleteCol"})):w.add({title:"table.desc",icon:"table",cmd:"mceInsertTable"})}),d.isWebKit&&r.onKeyDown.add(v),d.isGecko&&r.onKeyDown.add(function(z,B){var w,A,C=z.dom;37!=B.keyCode&&38!=B.keyCode||(w=z.selection.getRng(),A=C.getParent(w.startContainer,"table"),A&&z.getBody().firstChild==A&&c(w,A)&&(w=C.createRng(),w.setStartBefore(A),w.setEndBefore(A),z.selection.setRng(w),B.preventDefault()))}),r.onKeyUp.add(s),r.onSetContent.add(s),r.onVisualAid.add(s),r.onPreProcess.add(function(w,A){var z=A.node.lastChild;z&&("BR"==z.nodeName||1==z.childNodes.length&&("BR"==z.firstChild.nodeName||" "==z.firstChild.nodeValue))&&z.previousSibling&&"TABLE"==z.previousSibling.nodeName&&w.dom.remove(z)}),s(),r.startContent=r.getContent({format:"raw"})}),e({mceTableSplitCells:function(n){n.split()},mceTableMergeCells:function(o){var p,q,n;n=g.dom.getParent(g.selection.getNode(),"th,td"),n&&(p=n.rowSpan,q=n.colSpan),g.dom.select("td.mceSelected,th.mceSelected").length?o.merge():f.open({url:h+"/merge_cells.htm",width:240+parseInt(g.getLang("table.merge_cells_delta_width",0)),height:110+parseInt(g.getLang("table.merge_cells_delta_height",0)),inline:1},{rows:p,cols:q,onaction:function(r){o.merge(n,r.cols,r.rows)},plugin_url:h})},mceTableInsertRowBefore:function(n){n.insertRow(!0)},mceTableInsertRowAfter:function(n){n.insertRow()},mceTableInsertColBefore:function(n){n.insertCol(!0)},mceTableInsertColAfter:function(n){n.insertCol()},mceTableDeleteCol:function(n){n.deleteCols()},mceTableDeleteRow:function(n){n.deleteRows()},mceTableCutRow:function(n){m=n.cutRows()},mceTableCopyRow:function(n){m=n.copyRows()},mceTablePasteRowBefore:function(n){n.pasteRows(m,!0)},mceTablePasteRowAfter:function(n){n.pasteRows(m)},mceTableDelete:function(n){n.deleteTable()}},function(o,n){g.addCommand(n,function(){var p=l();p&&(o(p),g.execCommand("mceRepaint"),k())})}),e({mceInsertTable:function(n){f.open({url:h+"/table.htm",width:400+parseInt(g.getLang("table.table_delta_width",0)),height:320+parseInt(g.getLang("table.table_delta_height",0)),inline:1},{plugin_url:h,action:n?n.action:0})},mceTableRowProps:function(){f.open({url:h+"/row.htm",width:400+parseInt(g.getLang("table.rowprops_delta_width",0)),height:295+parseInt(g.getLang("table.rowprops_delta_height",0)),inline:1},{plugin_url:h})},mceTableCellProps:function(){f.open({url:h+"/cell.htm",width:400+parseInt(g.getLang("table.cellprops_delta_width",0)),height:295+parseInt(g.getLang("table.cellprops_delta_height",0)),inline:1},{plugin_url:h})}},function(o,n){g.addCommand(n,function(p,q){o(q)})})}}),d.PluginManager.add("table",d.plugins.TablePlugin)}(tinymce);