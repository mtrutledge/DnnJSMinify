!function(){function b(n){function m(t){var s;if(1===t.nodeType){if(s=t.getAttribute(d),s&&"inherit"!==s)return s;if(s=t.contentEditable,"inherit"!==s)return s}return null}function g(s){for(var t;s;){if(t=m(s))return"false"===t?s:null;s=s.parentNode}}function l(s){for(;s;){if(s.id===o)return s;s=s.parentNode}}function k(s){var t;if(s)for(t=new c(s,s),s=t.current();s;s=t.next())if(3===s.nodeType)return s}function f(v,u){var s,t;return"false"===m(v)&&j.isBlock(v)?void p.select(v):(t=j.createRng(),"true"===m(v)&&(v.firstChild||v.appendChild(n.getDoc().createTextNode("Â ")),v=v.firstChild,u=!0),s=j.create("span",{id:o,"data-mce-bogus":!0},r),u?v.parentNode.insertBefore(s,v):j.insertAfter(s,v),t.setStart(s.firstChild,1),t.collapse(!0),p.setRng(t),s)}function i(s){var v,t,u;if(s)rng=p.getRng(!0),rng.setStartBefore(s),rng.setEndBefore(s),v=k(s),v&&v.nodeValue.charAt(0)==r&&(v=v.deleteData(0,1)),j.remove(s,!0),p.setRng(rng);else for(t=l(p.getStart());(s=j.get(o))&&s!==u;)t!==s&&(v=k(s),v&&v.nodeValue.charAt(0)==r&&(v=v.deleteData(0,1)),j.remove(s,!0)),u=s}function q(){function x(B,D){var A,F,E,C,z;if(A=t.startContainer,F=t.startOffset,3==A.nodeType){if(z=A.nodeValue.length,F>0&&F<z||(D?F==z:0==F))return}else{if(!(F<A.childNodes.length))return D?null:B;var G=!D&&F>0?F-1:F;A=A.childNodes[G],A.hasChildNodes()&&(A=A.firstChild)}for(E=new c(A,B);C=E[D?"prev":"next"]();){if(3===C.nodeType&&C.nodeValue.length>0)return;if("true"===m(C))return C}return B}var s,w,u,t,v;if(i(),u=p.isCollapsed(),s=g(p.getStart()),w=g(p.getEnd()),s||w)if(t=p.getRng(!0),u){s=s||w;p.getStart();(v=x(s,!0))?f(v,!0):(v=x(s,!1))?f(v,!1):p.select(s)}else t=p.getRng(!0),s&&t.setStartBefore(s),w&&t.setEndAfter(w),p.setRng(t)}function h(z,B){function u(H,G){for(;H=H[G?"previousSibling":"nextSibling"];)if(3!==H.nodeType||H.nodeValue.length>0)return H}function y(G,H){p.select(G),p.collapse(H)}function t(K){function G(O){for(var N=I;N;){if(N===O)return;N=N.parentNode}j.remove(O),q()}function L(){var O,P,N=z.schema.getNonEmptyElements();for(P=new tinymce.dom.TreeWalker(I,z.getBody());(O=K?P.prev():P.next())&&!N[O.nodeName.toLowerCase()]&&!(3===O.nodeType&&tinymce.trim(O.nodeValue).length>0);)if("false"===m(O))return G(O),!0;return!!g(O)}var J,I,M,H;if(p.isCollapsed()){if(J=p.getRng(!0),I=J.startContainer,M=J.startOffset,I=l(I)||I,H=g(I))return G(H),!1;if(3==I.nodeType&&(K?M>0:M<I.nodeValue.length))return!0;if(1==I.nodeType&&(I=I.childNodes[M]||I),L())return!1}return!0}var x,C,D,v,F=B.keyCode;if(D=p.getStart(),v=p.getEnd(),x=g(D)||g(v),x&&(F<112||F>124)&&F!=e.DELETE&&F!=e.BACKSPACE){if((tinymce.isMac?B.metaKey:B.ctrlKey)&&(67==F||88==F||86==F))return;if(B.preventDefault(),F==e.LEFT||F==e.RIGHT){var w=F==e.LEFT;if(z.dom.isBlock(x)){var A=w?x.previousSibling:x.nextSibling,s=new c(A,A),E=w?s.prev():s.next();y(E,!w)}else y(x,w)}}else if(F==e.LEFT||F==e.RIGHT||F==e.BACKSPACE||F==e.DELETE){if(C=l(D)){if(F==e.LEFT||F==e.BACKSPACE)if(x=u(C,!0),x&&"false"===m(x)){if(B.preventDefault(),F!=e.LEFT)return void j.remove(x);y(x,!0)}else i(C);if(F==e.RIGHT||F==e.DELETE)if(x=u(C),x&&"false"===m(x)){if(B.preventDefault(),F!=e.RIGHT)return void j.remove(x);y(x,!1)}else i(C)}if((F==e.BACKSPACE||F==e.DELETE)&&!t(F==e.BACKSPACE))return B.preventDefault(),!1}}var r,j=n.dom,p=n.selection,o="mce_noneditablecaret",r="\ufeff";n.onMouseDown.addToTop(function(s,u){var t=s.selection.getNode();"false"===m(t)&&t==u.target&&q()}),n.onMouseUp.addToTop(q),n.onKeyDown.addToTop(h),n.onKeyUp.addToTop(q)}var c=tinymce.dom.TreeWalker,a="contenteditable",d="data-mce-"+a,e=tinymce.VK;tinymce.create("tinymce.plugins.NonEditablePlugin",{init:function(i,k){function f(m,n){var o=j.length,p=n.content,l=tinymce.trim(g);if("raw"!=n.format){for(;o--;)p=p.replace(j[o],function(s){var r=arguments,q=r[r.length-2];return q>0&&'"'==p.charAt(q-1)?s:'<span class="'+l+'" data-mce-content="'+m.dom.encode(r[0])+'">'+m.dom.encode("string"==typeof r[1]?r[1]:r[0])+"</span>"});n.content=p}}var h,g,j;h=" "+tinymce.trim(i.getParam("noneditable_editable_class","mceEditable"))+" ",g=" "+tinymce.trim(i.getParam("noneditable_noneditable_class","mceNonEditable"))+" ",j=i.getParam("noneditable_regexp"),j&&!j.length&&(j=[j]),i.onPreInit.add(function(){b(i),j&&(i.selection.onBeforeSetContent.add(f),i.onBeforeSetContent.add(f)),i.parser.addAttributeFilter("class",function(l){for(var n,o,m=l.length;m--;)o=l[m],n=" "+o.attr("class")+" ",n.indexOf(h)!==-1?o.attr(d,"true"):n.indexOf(g)!==-1&&o.attr(d,"false")}),i.serializer.addAttributeFilter(d,function(l,m){for(var o,n=l.length;n--;)o=l[n],j&&o.attr("data-mce-content")?(o.name="#text",o.type=3,o.raw=!0,o.value=o.attr("data-mce-content")):(o.attr(a,null),o.attr(d,null))}),i.parser.addAttributeFilter(a,function(l,m){for(var o,n=l.length;n--;)o=l[n],o.attr(d,o.attr(a)),o.attr(a,null)})})},getInfo:function(){return{longname:"Non editable elements",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/noneditable",version:tinymce.majorVersion+"."+tinymce.minorVersion}}}),tinymce.PluginManager.add("noneditable",tinymce.plugins.NonEditablePlugin)}();