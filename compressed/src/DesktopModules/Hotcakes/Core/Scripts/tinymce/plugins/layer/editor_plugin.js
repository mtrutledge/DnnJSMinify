!function(){function a(b){do if(b.className&&b.className.indexOf("mceItemLayer")!=-1)return b;while(b=b.parentNode)}tinymce.create("tinymce.plugins.Layer",{init:function(b,c){var d=this;d.editor=b,b.addCommand("mceInsertLayer",d._insertLayer,d),b.addCommand("mceMoveForward",function(){d._move(1)}),b.addCommand("mceMoveBackward",function(){d._move(-1)}),b.addCommand("mceMakeAbsolute",function(){d._toggleAbsolute()}),b.addButton("moveforward",{title:"layer.forward_desc",cmd:"mceMoveForward"}),b.addButton("movebackward",{title:"layer.backward_desc",cmd:"mceMoveBackward"}),b.addButton("absolute",{title:"layer.absolute_desc",cmd:"mceMakeAbsolute"}),b.addButton("insertlayer",{title:"layer.insertlayer_desc",cmd:"mceInsertLayer"}),b.onInit.add(function(){b.dom;tinymce.isIE&&b.getDoc().execCommand("2D-Position",!1,!0)}),b.onMouseUp.add(function(f,h){var g=a(h.target);g&&f.dom.setAttrib(g,"data-mce-style","")}),b.onMouseDown.add(function(f,j){var g,h=j.target,i=f.getDoc();tinymce.isGecko&&(a(h)?"on"!==i.designMode&&(i.designMode="on",h=i.body,g=h.parentNode,g.removeChild(h),g.appendChild(h)):"on"==i.designMode&&(i.designMode="off"))}),b.onNodeChange.add(d._nodeChange,d),b.onVisualAid.add(d._visualAid,d)},getInfo:function(){return{longname:"Layer",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/layer",version:tinymce.majorVersion+"."+tinymce.minorVersion}},_nodeChange:function(c,b,f){var d,e;d=this._getParentLayer(f),e=c.dom.getParent(f,"DIV,P,IMG"),e?(b.setDisabled("absolute",0),b.setDisabled("moveforward",!d),b.setDisabled("movebackward",!d),b.setActive("absolute",d&&"absolute"==d.style.position.toLowerCase())):(b.setDisabled("absolute",1),b.setDisabled("moveforward",1),b.setDisabled("movebackward",1))},_visualAid:function(b,d,c){var f=b.dom;tinymce.each(f.select("div,p",d),function(g){/^(absolute|relative|fixed)$/i.test(g.style.position)&&(c?f.addClass(g,"mceItemVisualAid"):f.removeClass(g,"mceItemVisualAid"),f.addClass(g,"mceItemLayer"))})},_move:function(j){var g,b,c=this.editor,h=[],f=this._getParentLayer(c.selection.getNode()),e=-1,k=-1;for(b=[],tinymce.walk(c.getBody(),function(d){1==d.nodeType&&/^(absolute|relative|static)$/i.test(d.style.position)&&b.push(d)},"childNodes"),g=0;g<b.length;g++)h[g]=b[g].style.zIndex?parseInt(b[g].style.zIndex):0,e<0&&b[g]==f&&(e=g);if(j<0){for(g=0;g<h.length;g++)if(h[g]<h[e]){k=g;break}k>-1?(b[e].style.zIndex=h[k],b[k].style.zIndex=h[e]):h[e]>0&&(b[e].style.zIndex=h[e]-1)}else{for(g=0;g<h.length;g++)if(h[g]>h[e]){k=g;break}k>-1?(b[e].style.zIndex=h[k],b[k].style.zIndex=h[e]):b[e].style.zIndex=h[e]+1}c.execCommand("mceRepaint")},_getParentLayer:function(b){return this.editor.dom.getParent(b,function(c){return 1==c.nodeType&&/^(absolute|relative|static)$/i.test(c.style.position)})},_insertLayer:function(){var c=this.editor,e=c.dom,d=e.getPos(e.getParent(c.selection.getNode(),"*")),b=c.getBody();c.dom.add(b,"div",{style:{position:"absolute",left:d.x,top:d.y>20?d.y:20,width:100,height:100},class:"mceItemVisualAid mceItemLayer"},c.selection.getContent()||c.getLang("layer.content")),tinymce.isIE&&e.setHTML(b,b.innerHTML)},_toggleAbsolute:function(){var b=this.editor,c=this._getParentLayer(b.selection.getNode());c||(c=b.dom.getParent(b.selection.getNode(),"DIV,P,IMG")),c&&("absolute"==c.style.position.toLowerCase()?(b.dom.setStyles(c,{position:"",left:"",top:"",width:"",height:""}),b.dom.removeClass(c,"mceItemVisualAid"),b.dom.removeClass(c,"mceItemLayer")):(""==c.style.left&&(c.style.left="20px"),""==c.style.top&&(c.style.top="20px"),""==c.style.width&&(c.style.width=c.width?c.width+"px":"100px"),""==c.style.height&&(c.style.height=c.height?c.height+"px":"100px"),c.style.position="absolute",b.dom.setAttrib(c,"data-mce-style",""),b.addVisual(b.getBody())),b.execCommand("mceRepaint"),b.nodeChanged())}}),tinymce.PluginManager.add("layer",tinymce.plugins.Layer)}();