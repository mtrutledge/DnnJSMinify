!function(){function e(j){return"string"==typeof j?j.replace(/[^0-9%]/g,""):j}function c(m){var j,k;if(m&&!m.splice){for(j=[],k=0;!0&&m[k];k++)j[k]=m[k];return j}return m}var d,i,b=tinymce.explode("id,name,width,height,style,align,class,hspace,vspace,bgcolor,type"),a=tinymce.makeMap(b.join(",")),f=tinymce.html.Node,h=tinymce.util.JSON;d=[["Flash","d27cdb6e-ae6d-11cf-96b8-444553540000","application/x-shockwave-flash","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["ShockWave","166b1bca-3f9c-11cf-8075-444553540000","application/x-director","http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0"],["WindowsMedia","6bf52a52-394a-11d3-b153-00c04f79faa6,22d6f312-b0f6-11d0-94ab-0080c74c7e95,05589fa1-c356-11ce-bf01-00aa0055595a","application/x-mplayer2","http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701"],["QuickTime","02bf25d5-8c17-4b23-bc80-d3488abddc6b","video/quicktime","http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0"],["RealMedia","cfcdaa03-8be4-11cf-b84b-0020afbbccfa","audio/x-pn-realaudio-plugin","http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0"],["Java","8ad9c840-044e-11d1-b3e9-00805f499d93","application/x-java-applet","http://java.sun.com/products/plugin/autodl/jinstall-1_5_0-windows-i586.cab#Version=1,5,0,0"],["Silverlight","dfeaf541-f3e1-4c24-acac-99c30715084a","application/x-silverlight-2"],["Iframe"],["Video"],["EmbeddedAudio"],["Audio"]],tinymce.create("tinymce.plugins.MediaPlugin",{init:function(n,j){function o(s){return s&&"IMG"===s.nodeName&&n.dom.hasClass(s,"mceItemMedia")}var m,p,q,k,r=this,l={};for(r.editor=n,r.url=j,i="",m=0;m<d.length;m++){for(k=d[m][0],q={name:k,clsids:tinymce.explode(d[m][1]||""),mimes:tinymce.explode(d[m][2]||""),codebase:d[m][3]},p=0;p<q.clsids.length;p++)l["clsid:"+q.clsids[p]]=q;for(p=0;p<q.mimes.length;p++)l[q.mimes[p]]=q;l["mceItem"+k]=q,l[k.toLowerCase()]=q,i+=(i?"|":"")+k}tinymce.each(n.getParam("media_types","video=mp4,m4v,ogv,webm;silverlight=xap;flash=swf,flv;shockwave=dcr;quicktime=mov,qt,mpg,mpeg;shockwave=dcr;windowsmedia=avi,wmv,wm,asf,asx,wmx,wvx;realmedia=rm,ra,ram;java=jar;audio=mp3,ogg").split(";"),function(v){var s,u,t;for(v=v.split(/=/),u=tinymce.explode(v[1].toLowerCase()),s=0;s<u.length;s++)t=l[v[0].toLowerCase()],t&&(l[u[s]]=t)}),i=new RegExp("write("+i+")\\(([^)]+)\\)"),r.lookup=l,n.onPreInit.add(function(){n.schema.addValidElements("object[id|style|width|height|classid|codebase|*],param[name|value],embed[id|style|width|height|type|src|*],video[*],audio[*],source[*]"),n.parser.addNodeFilter("object,embed,video,audio,script,iframe",function(s){for(var t=s.length;t--;)r.objectToImg(s[t])}),n.serializer.addNodeFilter("img",function(s,u,t){for(var w,v=s.length;v--;)w=s[v],(w.attr("class")||"").indexOf("mceItemMedia")!==-1&&r.imgToObject(w,t)})}),n.onInit.add(function(){n.theme&&n.theme.onResolveName&&n.theme.onResolveName.add(function(s,t){"img"===t.name&&n.dom.hasClass(t.node,"mceItemMedia")&&(t.name="media")}),n&&n.plugins.contextmenu&&n.plugins.contextmenu.onContextMenu.add(function(t,u,s){"IMG"===s.nodeName&&s.className.indexOf("mceItemMedia")!==-1&&u.add({title:"media.edit",icon:"media",cmd:"mceMedia"})})}),n.addCommand("mceMedia",function(){var t,s;s=n.selection.getNode(),o(s)&&(t=n.dom.getAttrib(s,"data-mce-json"),t&&(t=h.parse(t),tinymce.each(b,function(u){var v=n.dom.getAttrib(s,u);v&&(t[u]=v)}),t.type=r.getType(s.className).name.toLowerCase())),t||(t={type:"flash",video:{sources:[]},params:{}}),n.windowManager.open({file:j+"/media.htm",width:430+parseInt(n.getLang("media.delta_width",0)),height:500+parseInt(n.getLang("media.delta_height",0)),inline:1},{plugin_url:j,data:t})}),n.addButton("media",{title:"media.desc",cmd:"mceMedia"}),n.onNodeChange.add(function(t,s,u){s.setActive("media",o(u))})},convertUrl:function(l,o){var k=this,n=k.editor,m=n.settings,p=m.url_converter,j=m.url_converter_scope||k;return l?o?n.documentBaseURI.toAbsolute(l):p.call(j,l,"src","object"):l},getInfo:function(){return{longname:"Media",author:"Moxiecode Systems AB",authorurl:"http://tinymce.moxiecode.com",infourl:"http://wiki.moxiecode.com/index.php/TinyMCE:Plugins/media",version:tinymce.majorVersion+"."+tinymce.minorVersion}},dataToImg:function(m,k){var j,q,n,l,r=this,o=r.editor;o.documentBaseURI;if(m.params.src=r.convertUrl(m.params.src,k),q=m.video.attrs,q&&(q.src=r.convertUrl(q.src,k)),q&&(q.poster=r.convertUrl(q.poster,k)),j=c(m.video.sources))for(l=0;l<j.length;l++)j[l].src=r.convertUrl(j[l].src,k);return n=r.editor.dom.create("img",{id:m.id,style:m.style,align:m.align,hspace:m.hspace,vspace:m.vspace,src:r.editor.theme.url+"/img/trans.gif",class:"mceItemMedia mceItem"+r.getType(m.type).name,"data-mce-json":h.serialize(m,"'")}),n.width=m.width=e(m.width||("audio"==m.type?"300":"320")),n.height=m.height=e(m.height||("audio"==m.type?"32":"240")),n},dataToHtml:function(j,k){return this.editor.serializer.serialize(this.dataToImg(j,k),{forced_root_block:"",force_absolute:k})},htmlToData:function(l){var k,j,m;return m={type:"flash",video:{sources:[]},params:{}},k=this.editor.parser.parse(l),j=k.getAll("img")[0],j&&(m=h.parse(j.attr("data-mce-json")),m.type=this.getType(j.attr("class")).name.toLowerCase(),tinymce.each(b,function(n){var o=j.attr(n);o&&(m[n]=o)})),m},getType:function(m){var k,j,l;for(j=tinymce.explode(m," "),k=0;k<j.length;k++)if(l=this.lookup[j[k]])return l},imgToObject:function(z,o){function r(n,J){var N,M,O,L,K;K=p.getParam("flash_video_player_url",u.convertUrl(u.url+"/moxieplayer.swf")),K&&(N=p.documentBaseURI,G.params.src=K,p.getParam("flash_video_player_absvideourl",!0)&&(n=N.toAbsolute(n||"",!0),J=N.toAbsolute(J||"",!0)),O="",M=p.getParam("flash_video_player_flashvars",{url:"$url",poster:"$poster"}),tinymce.each(M,function(Q,P){Q=Q.replace(/\$url/,n||""),Q=Q.replace(/\$poster/,J||""),Q.length>0&&(O+=(O?"&":"")+P+"="+escape(Q))}),O.length&&(G.params.flashvars=O),L=p.getParam("flash_video_player_params",{allowfullscreen:!0,allowscriptaccess:!0}),tinymce.each(L,function(Q,P){G.params[P]=""+Q}))}var C,H,j,I,y,G,w,k,s,q,A,m,x,l,B,F,u=this,p=u.editor;if(G=z.attr("data-mce-json")){if(G=h.parse(G),q=this.getType(z.attr("class")),B=z.attr("data-mce-style"),B||(B=z.attr("style"),B&&(B=p.dom.serializeStyle(p.dom.parseStyle(B,"img")))),G.width=z.attr("width")||G.width,G.height=z.attr("height")||G.height,"Iframe"===q.name){x=new f("iframe",1),tinymce.each(b,function(n){var J=z.attr(n);"class"==n&&J&&(J=J.replace(/mceItem.+ ?/g,"")),J&&J.length>0&&x.attr(n,J)});for(I in G.params)x.attr(I,G.params[I]);return x.attr({style:B,src:G.params.src}),void z.replace(x)}if(this.editor.settings.media_use_script)return x=new f("script",1).attr("type","text/javascript"),y=new f("#text",3),y.value="write"+q.name+"("+h.serialize(tinymce.extend(G.params,{width:z.attr("width"),height:z.attr("height")}))+");",x.append(y),void z.replace(x);if("Video"===q.name&&G.video.sources[0]){for(C=new f("video",1).attr(tinymce.extend({id:z.attr("id"),width:e(z.attr("width")),height:e(z.attr("height")),style:B},G.video.attrs)),G.video.attrs&&(l=G.video.attrs.poster),k=G.video.sources=c(G.video.sources),A=0;A<k.length;A++)/\.mp4$/.test(k[A].src)&&(m=k[A].src);for(k[0].type||(C.attr("src",k[0].src),k.splice(0,1)),A=0;A<k.length;A++)w=new f("source",1).attr(k[A]),w.shortEnded=!0,C.append(w);m?(r(m,l),q=u.getType("flash")):G.params.src=""}if("Audio"===q.name&&G.video.sources[0]){for(F=new f("audio",1).attr(tinymce.extend({id:z.attr("id"),width:e(z.attr("width")),height:e(z.attr("height")),style:B},G.video.attrs)),G.video.attrs&&(l=G.video.attrs.poster),k=G.video.sources=c(G.video.sources),k[0].type||(F.attr("src",k[0].src),k.splice(0,1)),A=0;A<k.length;A++)w=new f("source",1).attr(k[A]),w.shortEnded=!0,F.append(w);G.params.src=""}if("EmbeddedAudio"===q.name){j=new f("embed",1),j.shortEnded=!0,j.attr({id:z.attr("id"),width:e(z.attr("width")),height:e(z.attr("height")),style:B,type:z.attr("type")});for(I in G.params)j.attr(I,G.params[I]);tinymce.each(b,function(n){G[n]&&"type"!=n&&j.attr(n,G[n])}),G.params.src=""}if(G.params.src){/\.flv$/i.test(G.params.src)&&r(G.params.src,""),o&&o.force_absolute&&(G.params.src=p.documentBaseURI.toAbsolute(G.params.src)),H=new f("object",1).attr({id:z.attr("id"),width:e(z.attr("width")),height:e(z.attr("height")),style:B}),tinymce.each(b,function(n){var J=G[n];"class"==n&&J&&(J=J.replace(/mceItem.+ ?/g,"")),J&&"type"!=n&&H.attr(n,J)});for(I in G.params)s=new f("param",1),s.shortEnded=!0,y=G.params[I],"src"===I&&"WindowsMedia"===q.name&&(I="url"),s.attr({name:I,value:y}),H.append(s);if(this.editor.getParam("media_strict",!0))H.attr({data:G.params.src,type:q.mimes[0]});else{H.attr({classid:"clsid:"+q.clsids[0],codebase:q.codebase}),j=new f("embed",1),j.shortEnded=!0,j.attr({id:z.attr("id"),width:e(z.attr("width")),height:e(z.attr("height")),style:B,type:q.mimes[0]});for(I in G.params)j.attr(I,G.params[I]);tinymce.each(b,function(n){G[n]&&"type"!=n&&j.attr(n,G[n])}),H.append(j)}G.object_html&&(y=new f("#text",3),y.raw=!0,y.value=G.object_html,H.append(y)),C&&C.append(H)}C&&G.video_html&&(y=new f("#text",3),y.raw=!0,y.value=G.video_html,C.append(y)),F&&G.video_html&&(y=new f("#text",3),y.raw=!0,y.value=G.video_html,F.append(y));var v=C||F||H||j;v?z.replace(v):z.remove()}},objectToImg:function(C){function u(O){return new tinymce.html.Serializer({inner:!0,validate:!1}).serialize(O)}function J(P,O){return H[(P.attr(O)||"").toLowerCase()]}function p(P){var O=P.replace(/^.*\.([^.]+)$/,"$1");return H[O.toLowerCase()||""]}var L,k,F,s,M,N,y,A,x,G,E,t,q,I,B,l,K,o,m,z,w,r,D,j,H=this.lookup,v=this.editor.settings.url_converter,n=this.editor.settings.url_converter_scope;if(C.parent){if("script"===C.name){if(C.firstChild&&(m=i.exec(C.firstChild.value)),!m)return;o=m[1],K={video:{},params:h.parse(m[2])},A=K.params.width,x=K.params.height}if(K=K||{video:{},params:{}},M=new f("img",1),M.attr({src:this.editor.theme.url+"/img/trans.gif"}),N=C.name,"video"===N||"audio"==N){F=C,L=C.getAll("object")[0],k=C.getAll("embed")[0],A=F.attr("width"),x=F.attr("height"),y=F.attr("id"),K.video={attrs:{},sources:[]},z=K.video.attrs;for(N in F.attributes.map)z[N]=F.attributes.map[N];for(B=C.attr("src"),B&&K.video.sources.push({src:v.call(n,B,"src",C.name)}),l=F.getAll("source"),E=0;E<l.length;E++)B=l[E].remove(),K.video.sources.push({src:v.call(n,B.attr("src"),"src","source"),type:B.attr("type"),media:B.attr("media")});z.poster&&(z.poster=v.call(n,z.poster,"poster",C.name))}if("object"===C.name&&(L=C,k=C.getAll("embed")[0]),"embed"===C.name&&(k=C),"iframe"===C.name&&(s=C,o="Iframe"),L){for(A=A||L.attr("width"),x=x||L.attr("height"),G=G||L.attr("style"),y=y||L.attr("id"),w=w||L.attr("hspace"),r=r||L.attr("vspace"),D=D||L.attr("align"),j=j||L.attr("bgcolor"),K.name=L.attr("name"),I=L.getAll("param"),E=0;E<I.length;E++)q=I[E],N=q.remove().attr("name"),a[N]||(K.params[N]=q.attr("value"));K.params.src=K.params.src||L.attr("data")}if(k){A=A||k.attr("width"),x=x||k.attr("height"),G=G||k.attr("style"),y=y||k.attr("id"),w=w||k.attr("hspace"),r=r||k.attr("vspace"),D=D||k.attr("align"),j=j||k.attr("bgcolor");for(N in k.attributes.map)a[N]||K.params[N]||(K.params[N]=k.attributes.map[N])}if(s){A=e(s.attr("width")),x=e(s.attr("height")),G=G||s.attr("style"),y=s.attr("id"),w=s.attr("hspace"),r=s.attr("vspace"),D=s.attr("align"),j=s.attr("bgcolor"),tinymce.each(b,function(O){M.attr(O,s.attr(O))});for(N in s.attributes.map)a[N]||K.params[N]||(K.params[N]=s.attributes.map[N])}K.params.movie&&(K.params.src=K.params.src||K.params.movie,delete K.params.movie),K.params.src&&(K.params.src=v.call(n,K.params.src,"src","object")),F&&("video"===C.name?o=H.video.name:"audio"===C.name&&(o=H.audio.name)),L&&!o&&(o=(J(L,"clsid")||J(L,"classid")||J(L,"type")||{}).name),k&&!o&&(o=(J(k,"type")||p(K.params.src)||{}).name),k&&"EmbeddedAudio"==o&&(K.params.type=k.attr("type")),C.replace(M),k&&k.remove(),L&&(t=u(L.remove()),t&&(K.object_html=t)),F&&(t=u(F.remove()),t&&(K.video_html=t)),K.hspace=w,K.vspace=r,K.align=D,K.bgcolor=j,M.attr({id:y,class:"mceItemMedia mceItem"+(o||"Flash"),style:G,width:A||("audio"==C.name?"300":"320"),height:x||("audio"==C.name?"32":"240"),hspace:w,vspace:r,align:D,bgcolor:j,"data-mce-json":h.serialize(K,"'")})}}}),tinymce.PluginManager.add("media",tinymce.plugins.MediaPlugin)}();