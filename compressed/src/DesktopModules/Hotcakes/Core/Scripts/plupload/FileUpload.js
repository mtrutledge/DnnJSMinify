jQuery(function($){function InitilizeUploader(){var allowedExtensions=$("input[name=uploadfiletypes]").val(),productBvin=jQuery("#productbvin").attr("value");$('[id^="container"]').each(function(){var el=$(this),optUniqueId=el.attr("id").split("_")[1],browse_button=el.find("a.browseFiles"),uploadfiles_button=el.find("a.uploadFiles"),allowMultiple_input=el.find("input.allowmultiplefiles"),uploader=new plupload.Uploader({runtimes:"html5,flash,silverlight",browse_button:browse_button.attr("id"),container:el.attr("id"),max_file_size:"2gb",chunk_size:"1mb",multi_selection:!1,unique_names:!0,url:hcc.getResourceUrl("FileUpload.ashx"),silverlight_xap_url:hcc.getResourceUrl("Scripts/plupload/plupload.silverlight.xap"),flash_swf_url:hcc.getResourceUrl("Scripts/plupload/plupload.flash.swf"),filters:[{title:"Custom files",extensions:"*.*"}]}),allowMultipleFile=allowMultiple_input.val(),allowMutltipleUpload=!1;allowMutltipleUpload="false"!==allowMultipleFile&&"False"!==allowMultipleFile,uploader.settings.filters[0].extensions=allowedExtensions,uploader.optUniqueId=optUniqueId,uploader.productBvin=productBvin,uploader.allowMutltipleUpload=allowMutltipleUpload,uploader.bind("Init",initUploader),uploader.bind("BeforeUpload",beforeUpload),uploader.bind("FilesAdded",fileAdded),uploader.bind("FilesRemoved",filesRemoved),uploader.bind("UploadProgress",uploadProgress),uploader.bind("Error",uploadError),uploader.bind("ChunkUploaded",chunkUploaded),uploader.bind("FileUploaded",filesUploaded),uploadfiles_button.click(function(e){uploader.start(),e.preventDefault()}),uploader.init()})}function bytesToSize(bytes){var sizes=["Bytes","KB","MB","GB","TB"];if(0==bytes)return"0 Bytes";var i=parseInt(Math.floor(Math.log(bytes)/Math.log(1024))),size=bytes/Math.pow(1024,i);if(size.toString().indexOf(".")===-1)return size.toString()+" "+sizes[i];var pre=size.toString().indexOf("."),rounded=size.toString().substring(0,pre)+"."+size.toString().substring(pre+1,pre+3);return rounded.toString()+" "+sizes[i]}var initUploader=function(up,params){$("#addtocartbutton").attr("disabled","disabled"),$("#savelaterbutton").attr("disabled","disabled")},beforeUpload=function(up,file){up.settings.multipart_params={filename:file.name,bvin:up.productBvin,optUniqueId:up.optUniqueId}},fileAdded=function(up,files){var deleteHandle=function(uploaderObject,fileObject){return function(event){event.preventDefault(),fileObject.status==plupload.UPLOADING&&uploaderObject.stop(),uploaderObject.removeFile(fileObject),$(this).closest("li#li_"+fileObject.id).remove()}},maxCountError=!1,filelist=$("#filelist_"+up.optUniqueId);$.each(files,function(i,file){0==up.allowMutltipleUpload&&up.files.length>=1?(maxCountError=!0,setTimeout(function(){up.removeFile(file)},50)):(filelist.find("ul").append('<li class="upload_file_item" id="li_'+file.id+'" ><div id="'+file.id+'"><div class="upload_file_Name left" >'+file.name+'</div><div class="upload_file_size right" > ('+bytesToSize(file.size)+') </div><div class="upload_file_status right" ><b> </b></div><div class="upload_file_delete right" ><a href="#" id="deleteFile'+file.id+'">[x]</a></div><div style="clear:both" ></div></li>'),$("#deleteFile"+file.id).click(deleteHandle(up,files[i])))}),up.refresh()},filesRemoved=function(up,files){0===files.length&&($("#addtocartbutton").attr("disabled","disabled"),$("#savelaterbutton").attr("disabled","disabled"))},uploadProgress=function(up,file){$("#li_"+file.id+" .upload_file_status").html(file.percent+"%")},uploadError=function(up,err){var filelist=$("#filelist_"+up.optUniqueId);filelist.find("#"+err.file.id+" .upload_file_status").append("<div id='"+err.file.id+"'> Error: "+err.code+", Message: "+err.message+(err.file?", File: "+err.file.name:"")+"</div>"),up.refresh()},chunkUploaded=function(up,file,response){$.parseJSON(response.response)},filesUploaded=function(up,file,response){var data=$.parseJSON(response.response),downloadUrl=data.Message.replace(/["]/g,""),downloadLink='<a id="downloadFile'+file.id+'" href="'+downloadUrl+'" target="_blank">'+file.name+"</a>";$("#li_"+file.id+" .upload_file_Name").html(downloadLink),$("#li_"+file.id+" .upload_file_status").html("<b>100%</b>"),$("#deleteFile"+file.id).html("");var uploadedFileStack=$('input[name="opt'+up.optUniqueId+'"]').val();$('input[name="opt'+up.optUniqueId+'"]').val(uploadedFileStack+"|"+downloadUrl+"<"+bytesToSize(file.size));var isAddToCartDisabled=$("#addtocartbutton").attr("disabled");"undefined"!=typeof isAddToCartDisabled&&isAddToCartDisabled!==!1&&($("#addtocartbutton").removeAttr("disabled"),$("#savelaterbutton").removeAttr("disabled"))};InitilizeUploader()});