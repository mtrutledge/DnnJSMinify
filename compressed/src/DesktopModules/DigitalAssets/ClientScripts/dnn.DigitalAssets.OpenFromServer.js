"undefined"!=typeof dnnModule&&null!==dnnModule||(dnnModule={}),dnnModule.DigitalAssetsOpenFromServer=function(){function init(initResources,initController){resources=initResources,controller=initController}function getServiceUrl(serviceMethod){return controller.getContentProServiceUrl()+serviceMethod}function getOpenFromServerDialogButtons(item){var itemId=item.ItemID,dialogButtons=[{id:"readOnly_button",text:resources.readOnlyActionText,class:"dnnPrimaryAction",click:function(){openFromServer(itemId,"readOnly"),$(this).dialog("close")}},{id:"cancel_button",text:resources.cancelActionText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}];return item.Locked||(dialogButtons[0].class="dnnSecondaryAction",dialogButtons.unshift({id:"edit_button",text:resources.editDocumentActionText,class:"dnnPrimaryAction",click:function(){openFromServer(itemId,"edit"),$(this).dialog("close")}})),dialogButtons}function showOpenFromServerDialog(item){var dialogTitle=resources.openOnServerDialogTitle,dialogText=resources.openOnServerDialogBody,dialogButtons=getOpenFromServerDialogButtons(item);$("<div class='dnnDialog'></div>").html(dialogText).dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:400,height:200,resizable:!1,title:dialogTitle,buttons:dialogButtons})}function getDocumentApplicationErrorText(errorKey){return Boolean(window.ActiveXObject)?resources["activeX"+errorKey]:resources["plugin"+errorKey]}function openFromServer(itemId,mode){var self=this;$.ajax({url:getServiceUrl("GetOpenFromServerData"),data:{fileId:itemId},type:"GET",beforeSend:controller.servicesFramework.setModuleHeaders}).done(function(data){var fullUrl=dnnModule.digitalAssets.getFullUrl(data.Url);invokeApplication(mode,itemId,fullUrl,data.ProgId)}).fail(function(xhr){dnnModule.digitalAssets.isXhrHandled(xhr)||dnnModule.digitalAssets.showAlertDialog(self.resources.errorText,dnnModule.digitalAssets.getExceptionMessage(xhr))}).always(function(){dnnModule.digitalAssets.enableLoadingPanel(!1)})}function invokeApplication(mode,itemId,url,progId){var documentApplication=GetDocumentApplication();if(documentApplication)try{"edit"==mode?editFromServer(documentApplication,itemId,url,progId):"readOnly"==mode&&viewFromServer(documentApplication,itemId,url,progId)}catch(e){dnnModule.digitalAssets.showAlertDialog(resources.errorText,getDocumentApplicationErrorText("NotAllowedErrorText"))}else dnnModule.digitalAssets.showAlertDialog(resources.errorText,getDocumentApplicationErrorText("DoesNotExistErrorText"))}function viewFromServer(documentApplication,itemId,url,progId){$.ajax({url:getServiceUrl("SetReadOnlyLock"),data:{fileId:itemId},type:"POST",beforeSend:controller.servicesFramework.setModuleHeaders}).done(function(data){try{"undefined"!=typeof documentApplication.ViewDocument2?documentApplication.ViewDocument2(window,url,progId):documentApplication.ViewDocument(url,progId)}catch(e){dnnModule.digitalAssets.showAlertDialog(resources.errorText,getDocumentApplicationErrorText("NotAllowedErrorText"))}}).fail(function(xhr){dnnModule.digitalAssets.isXhrHandled(xhr)||dnnModule.digitalAssets.showAlertDialog(resources.errorText,dnnModule.digitalAssets.getExceptionMessage(xhr))}).always(function(){dnnModule.digitalAssets.enableLoadingPanel(!1)})}function editFromServer(documentApplication,itemId,url,progId){$.ajax({url:getServiceUrl("EnsureEditFromServer"),data:{fileId:itemId},type:"POST",beforeSend:controller.servicesFramework.setModuleHeaders}).done(function(data){try{documentApplication.EditDocument(url,progId)}catch(e){dnnModule.digitalAssets.showAlertDialog(resources.errorText,getDocumentApplicationErrorText("NotAllowedErrorText"))}}).fail(function(xhr){dnnModule.digitalAssets.isXhrHandled(xhr)||dnnModule.digitalAssets.showAlertDialog(resources.errorText,dnnModule.digitalAssets.getExceptionMessage(xhr))}).always(function(){dnnModule.digitalAssets.enableLoadingPanel(!1)})}function GetDocumentApplication(){return void 0!==window.ActiveXObject?new ActiveXObject("SharePoint.OpenDocuments.3"):CreateBrowserPlugin("application/x-sharepoint")}function IsPluginInstalled(strMimeType){return Boolean(navigator.mimeTypes)&&navigator.mimeTypes[strMimeType]&&navigator.mimeTypes[strMimeType].enabledPlugin}function CreateBrowserPlugin(pluginType){var plugin=null;try{if(plugin=document.getElementById(pluginType),!Boolean(plugin)&&IsPluginInstalled(pluginType)){var pluginNode=document.createElement("object");pluginNode.id=pluginType,pluginNode.type=pluginType,pluginNode.width="0",pluginNode.height="0",pluginNode.style.setProperty("visibility","hidden",""),document.body.appendChild(pluginNode),plugin=document.getElementById(pluginType)}}catch(e){plugin=null}return plugin}function setupGridContextMenuExtension(contextMenu,selectedItems){1==selectedItems.length&&contextMenu.findItemByValue("OpenFromServer").set_visible(selectedItems[0].get_dataItem().IsOpenFromServerAllowed)}function setupToolBarExtension(selectionToolBar,selectedItems){if(1==selectedItems.length){var openFromServerButton=selectionToolBar.find("#DigitalAssetsOpenFromServerSelectionBtnId");selectedItems[0].get_dataItem().IsOpenFromServerAllowed?openFromServerButton.css("display",""):openFromServerButton.hide()}}var resources,controller=null;return{init:init,showOpenFromServerDialog:showOpenFromServerDialog,setupGridContextMenuExtension:setupGridContextMenuExtension,setupToolBarExtension:setupToolBarExtension}}();