"undefined"!=typeof dnnModule&&null!==dnnModule||(dnnModule={}),dnnModule.digitalAssets=function($,$find,$telerik,dnnModal){function init(sf,rootId,controlsSettings,moduleSettings,resourcesSettings,bussinessController){if(servicesFramework=sf,rootFolderId=rootId,controls=controlsSettings,settings=moduleSettings,resources=resourcesSettings,controller=bussinessController,initEvents.length>0)for(var i=0;i<initEvents.length;i++){var event=initEvents[i];"function"==typeof event&&event.call(this)}setupDnnTabs(),setupDnnMainMenuButtons(),setupDnnMainToolbarTitles(),initUI()}function setSearchProvider(sp){searchProvider=sp,searchProvider.onSearch(function(pattern){var node=getSelectedNode();node||(node=treeView.findNodeByValue(getRootFolderId()),node.select(),$("#dnnModuleDigitalAssetsLeftPaneActions li","#"+controls.scopeWrapperId).removeClass("selected"),controller.onLoadFolder()),currentFolderId=node.get_value(),searchPattern=pattern,loadFolderFirstPage(currentFolderId)})}function getSearchProvider(){return searchProvider}function clearSearchPattern(){searchPattern=""}function getRootFolderId(){return rootFolderId}function setupDnnTabs(){$(".dnnModuleDigitalAssetsTabNav li","#"+controls.scopeWrapperId).length<=1&&$(".dnnModuleDigitalAssetsTabNav","#"+controls.scopeWrapperId).remove();var options={},selectedTab=parseInt(settings.selectedTab);NaN!=selectedTab&&null!=selectedTab&&(options.selected=selectedTab),$("#"+controls.scopeWrapperId).dnnTabs(options).bind("tabsactivate",function(event,ui){currentTab=ui.newTab.index(),controller.leftPaneTabActivated(ui.newPanel[0].id),0==currentTab&&treeViewRefreshScrollbars()})}function setupDnnMainMenuButtons(){refreshMenu=$("#DigitalAssetsSyncFolderMenuBtnId_wrapper .DigitalAssetsMenuButton_menu"),refreshMenu.find(".handle").click(function(){onOpeningRefreshMenu()}),$("#DigitalAssetsSyncFolderMenuBtnId_wrapper .DigitalAssetsMenuButton_menu ul").hover(function(){isOnSyncMenu=!0},function(){setTimeout(function(){isOnSyncMenu=!1,isOnSyncMenuBtn||closeRefreshMenu()},250)}),refreshMenu.find(".handle").hover(function(){isOnSyncMenuBtn=!0},function(){setTimeout(function(){isOnSyncMenuBtn=!1,isOnSyncMenu||closeRefreshMenu()},250)}),controller.initMainMenuButtons(settings)}function setupDnnMainToolbarTitles(){for(var leftButtons=$("#dnnModuleDigitalAssetsMainToolbar").find(".leftButton"),labels=$("#dnnModuleDigitalAssetsMainToolbarTitle span"),i=0;i<labels.length-1;i++){var currentTool=leftButtons.eq(i),nextTool=leftButtons.eq(i+1),label=labels.eq(i);currentTool.is(":visible")?label.show():label.hide(),nextTool.length>0&&label.width(nextTool.position().left-currentTool.position().left)}}function onOpeningRefreshMenu(){refreshMenu=$("#DigitalAssetsSyncFolderMenuBtnId_wrapper .DigitalAssetsMenuButton_menu"),refreshMenu.is(":visible")?closeRefreshMenu():openRefreshMenu()}function openRefreshMenu(){refreshMenu.show(),isOnSyncMenuBtn=!0,$("#DigitalAssetsRefreshFolderBtnId").addClass("expanded"),$("#DigitalAssetsSyncFolderMenuBtnId").addClass("expanded"),$("#DigitalAssetsSyncFolderMenuBtnId_wrapper .DigitalAssetsMenuButton_menu ul").focus()}function closeRefreshMenu(){refreshMenu.hide(),isOnSyncMenu=!1,$("#DigitalAssetsRefreshFolderBtnId").removeClass("expanded"),$("#DigitalAssetsSyncFolderMenuBtnId").removeClass("expanded")}function gridOnGridCreated(sender,eventArgs){$.dnnGridCreated(sender,eventArgs),grid=sender.get_masterTableView(),"undefined"!=typeof controls?initGridEvents():_gridNeedIntialize=!0}function initGridSelectAllUnselectAll(sender){var checkColumn=$("#"+controls.gridId+" table thead tr th.rgCheck:first");checkColumn.empty(),gridSelectUnselectAll=$("<input type='checkbox'>"),checkColumn.append(gridSelectUnselectAll),gridSelectUnselectAll.click(function(evt){sender._owner._selectAllRows(grid.get_element().id,"",evt)}).dnnCheckbox()}function gridOnDataBound(sender,eventArgs){refreshPager()}function initializePager(){var pageSizeContainer=$(".dnnModuleDigitalAssetsGrid td.rgPagerCell div.rgAdvPart:first");pageSizeContainer.prependTo(pageSizeContainer.parent()),$(".dnnModuleDigitalAssetsGrid input.rgPageFirst:first").val(resources.firstPageText),$(".dnnModuleDigitalAssetsGrid input.rgPageLast:first").val(resources.lastPageText),$(".dnnModuleDigitalAssetsGrid input.rgPageNext:first").val(resources.nextPageText),$(".dnnModuleDigitalAssetsGrid input.rgPagePrev:first").val(resources.previousPageText)}function refreshPager(){var totalItems=grid.get_virtualItemCount();if(0==totalItems)return $(".dnnModuleDigitalAssetsGrid .rgWrap.rgArrPart1 input").css("visibility","hidden"),$(".dnnModuleDigitalAssetsGrid .rgWrap.rgNumPart").hide(),$(".dnnModuleDigitalAssetsGrid .rgWrap.rgArrPart2").hide(),void $(".dnnModuleDigitalAssetsGrid .rgWrap.rgInfoPart").hide();$(".dnnModuleDigitalAssetsGrid .rgWrap.rgArrPart1 input").css("visibility","visible"),$(".dnnModuleDigitalAssetsGrid .rgWrap.rgNumPart").show(),$(".dnnModuleDigitalAssetsGrid .rgWrap.rgArrPart2").show(),$(".dnnModuleDigitalAssetsGrid .rgWrap.rgInfoPart").show();var currentPage=grid.get_currentPageIndex()+1,totalPages=grid.get_pageCount();if(1==currentPage&&$(".dnnModuleDigitalAssetsGrid .rgWrap.rgArrPart1 input").css("visibility","hidden"),1==totalPages){$(".dnnModuleDigitalAssetsGrid .rgWrap.rgNumPart").hide();var text=1==totalItems?resources.pagerTextFormatOnePageOneItemText:resources.pagerTextFormatOnePageText;$(".dnnModuleDigitalAssetsGrid .rgWrap.rgInfoPart").html(text.replace("[ITEMS]",totalItems))}else $(".dnnModuleDigitalAssetsGrid .rgWrap.rgInfoPart").html(resources.pagerTextFormatMultiplePagesText.replace("[PAGES]",totalPages).replace("[ITEMS]",totalItems));totalPages==currentPage&&$(".dnnModuleDigitalAssetsGrid .rgWrap.rgArrPart2").hide()}function treeViewOnLoad(sender,eventArgs){treeView=sender;var rootNode=treeView.get_nodes().getNode(0);rootNode&&("undefined"!=typeof controls?initTreeviewEvents():_treeViewNeedIntialize=!0)}function destinationTreeViewOnLoad(sender,eventArgs){destinationTreeView=sender}function contextMenuOnLoad(sender){contextMenu=sender}function emptySpaceMenuOnLoad(sender){emptySpaceMenu=sender}function emptySpaceContextMenu(event){var permissions=getCurrentNode().get_attributes().getAttribute("permissions"),menuSelector="#"+controls.emptySpaceMenuId+"_detached";checkPermissions(menuSelector,permissions,!0,!0),settings.isFilteredContent===!0&&hideMenuOptions(menuSelector+" a.rmLink.disabledIfFiltered"),emptySpaceMenu.show(event)}function emptySpaceMenuOnItemClicked(sender,args){var node=getCurrentNode();switch(args.get_item().get_value()){case"RefreshFolder":refreshFolderNode(node);break;case"NewFolder":createNewFolder(node,"treeview");break;case"UploadFiles":uploadFiles();break;case"Properties":showPropertiesDialog(node.get_value(),!0)}}function listViewOnCreated(sender,eventArgs){listView=sender}function treeViewContextMenuOnLoad(sender){treeViewContextMenu=sender}function toggleLeftPane(){var left,leftPane=$("#dnnModuleDigitalAssetsLeftPane","#"+controls.scopeWrapperId),contentPane=$("#dnnModuleDigitalAssetsContentPane","#"+controls.scopeWrapperId),toggleButton=$("#DigitalAssetsToggleLeftPaneBtnId span","#"+controls.scopeWrapperId),loadingPanel=$(".dnnModuleDigitalAssetsMainLoading","#"+controls.scopeWrapperId);leftPane.is(":visible")?(toggleButton.css("background-image","url("+settings.toggleLeftPaneShowImageUrl+")"),leftPane.animate({width:"toggle"},500),left=0):(toggleButton.css("background-image","url("+settings.toggleLeftPaneHideImageUrl+")"),leftPane.animate({width:"toggle"},500,treeViewRefreshScrollbars),left=220),contentPane.animate({"margin-left":left},500,"swing",moreItemsHint),loadingPanel.css({left:left})}function moreItemsHint(){if($("#dnnModuleDigitalAssetsListView","#"+controls.scopeWrapperId).is(":visible")){var numberOfItems=$("#dnnModuleDigitalAssetsListView .dnnModuleDigitalAssetsListViewItem","#"+controls.scopeWrapperId).length,widthOfItem=$("#dnnModuleDigitalAssetsListView .dnnModuleDigitalAssetsListViewItem","#"+controls.scopeWrapperId).first().outerWidth(),widthOfContainer=$("#dnnModuleDigitalAssetsListView","#"+controls.scopeWrapperId).width(),itemsPerRow=Math.floor(widthOfContainer/widthOfItem);numberOfItems%itemsPerRow!=0?$("#dnnModuleDigitalAssetsListView","#"+controls.scopeWrapperId).addClass("moreItems"):$("#dnnModuleDigitalAssetsListView","#"+controls.scopeWrapperId).removeClass("moreItems")}}function showAlertDialog(title,message,closeAction){message&&$.dnnAlert({okText:resources.closeText,title:title,text:message,close:closeAction})}function getCurrentFolderId(){return currentFolderId}function setCurrentFolder(folder){currentFolder=folder}function enableLoadingPanel(enable){var loadingPanel=$(".dnnModuleDigitalAssetsMainLoading","#"+controls.scopeWrapperId);enable?(loadingPanelProcesses+=1,loadingPanel.show()):(loadingPanelProcesses-=1,loadingPanelProcesses<=0&&loadingPanel.hide())}function showPropertiesFromAction(){var folderId=getCurrentNode().get_value();showPropertiesDialog(folderId,!0)}function showPropertiesDialog(itemId,isFolder){isFolder?showDialog("FolderProperties",{folderId:itemId,groupId:settings.groupId},950,550):showDialog("FileProperties",{fileId:itemId},950,550)}function showDialog(controlKey,params,width,height){var url=settings.navigateUrl.replace(/ControlKey/i,controlKey);params.skinSrc="Portals/_default/Skins/_default/popUpSkin";for(var p in params)if(params[p]){var charSep=url.indexOf("?")!=-1?"&":"?";url+=charSep+p+"="+encodeURIComponent(params[p])}$("#iPopUp").dialog("option","title",""),dnnModal.show(url,!0,height,width,!1,null)}function closeDialog(refresh){refresh&&(internalRefreshNode(getCurrentNode(),!1),loadFolderCurrentPage(currentFolderId)),dnnModal.closePopUp(!1)}function getContentServiceUrl(){return""==contentServiceUrl&&(contentServiceUrl=servicesFramework.getServiceRoot("DigitalAssets")+"ContentService/"),contentServiceUrl}function destinationTreeViewOnNodeExpanding(sender,args){internalOnNodeExpanding(args.get_node(),!1)}function destinationTreeViewRefreshScrollbars(){$("#dnnModuleDigitalAssetsDestinationFolderScroll").jScrollPane()}function destinationTreeViewOnNodeClicking(sender,args){var node=args.get_node();checkDestinationButtonState(itemsSelectedToMoveOrCopy,node)}function isSubNode(parentNodeId,node){if(parentNodeId==node.get_value())return!0;var parentFolder=node.get_parent();return!!parentFolder.get_value&&isSubNode(parentNodeId,parentFolder)}function checkDestinationButtonState(selectedItems,node){$("#destination_button").button(checkDestinationPermissions(selectedItems,node)?"enable":"disable")}function checkDestinationPermissions(selectedItems,node){for(var folderId=node.get_value(),i=0;i<selectedItems.length;i++){var item=selectedItems[i];if(item.IsFolder){if(folderId==item.ParentFolderId)return!1;if(isSubNode(item.ItemId,node))return!1}else if(destinationMove&&folderId==item.ParentFolderId)return!1}return nodeHasPermission(node,"ADD")}function nodeHasPermission(node,permissionKey){var permissionsAttribute=node.get_attributes().getAttribute("permissions"),permissions="string"==typeof permissionsAttribute?JSON.parse(permissionsAttribute):permissionsAttribute;return checkSinglePermission(permissions,permissionKey)}function treeViewOnNodeExpanding(sender,args){$("#dnnModuleDigitalAssetsLeftPaneActions","#"+controls.scopeWrapperId).hide(),internalOnNodeExpanding(args.get_node(),!0)}function treeViewOnNodeCollapsing(){$("#dnnModuleDigitalAssetsLeftPaneActions","#"+controls.scopeWrapperId).hide()}function internalOnNodeExpanding(node,isMainTree){node.get_expandMode()==Telerik.Web.UI.TreeNodeExpandMode.WebService?(node.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.ClientSide),node.showLoadingStatus('<img src="'+settings.loadingImageUrl+'" alt="'+resources.loadingAltText+'"/>',Telerik.Web.UI.TreeViewLoadingStatusPosition.BelowNodeText),loadSubFolders(node,!1,isMainTree)):isMainTree&&currentFolderId!=node.get_value()&&selectSubFolder(node,currentFolderId)}function treeViewContextMenuOnHiding(sender,args){$(args.get_targetElement()).closest("li.rtLI.selected").removeClass("selected")}function treeViewOnContextMenuShowing(sender,args){var node=args.get_node();$(node.get_element()).addClass("selected");var menuSelector="#"+controls.treeViewMenuId+"_detached";$(menuSelector+" li.rmItem").css("display",""),controller.setupTreeViewContextMenuExtension(treeViewContextMenu,node),settings.isFilteredContent===!0&&hideMenuOptions(menuSelector+" a.rmLink.disabledIfFiltered");var unlinkAllowedStatus=node.get_attributes().getAttribute("UnlinkAllowedStatus");if(unlinkAllowedStatus.indexOf("onlyUnlink")>=0){var deleteOption=treeViewContextMenu.findItemByValue("DeleteFolder");hideMenuOption(deleteOption.get_element())}else if(unlinkAllowedStatus.indexOf("false")>=0){var unlinkOption=treeViewContextMenu.findItemByValue("UnlinkFolder");hideMenuOption(unlinkOption.get_element())}var permissions=node.get_attributes().getAttribute("permissions");checkPermissions(menuSelector,permissions,!0,!0)}function treeViewOnContextMenuItemClicking(sender,args){var menuItem=args.get_menuItem(),node=args.get_node();switch(menuItem.get_menu().hide(),menuItem.get_value()){case"RefreshFolder":refreshFolderNode(node);break;case"RenameFolder":startRenameFolderNode(node);break;case"NewFolder":createNewFolder(node,"treeview");break;case"DeleteFolder":deleteItems([{ItemId:node.get_value(),IsFolder:!0,UnlinkAllowedStatus:node.get_attributes().getAttribute("UnlinkAllowedStatus")}],node.get_parent().get_value());break;case"UnlinkFolder":unlinkFolder({ItemId:node.get_value(),IsFolder:!0,ParentFolderId:node.get_parent().get_value()});break;case"Move":moveDialog([{ItemId:node.get_value(),IsFolder:!0,ParentFolderId:node.get_parent().get_value()}]);break;case"Properties":showPropertiesDialog(node.get_value(),!0);break;default:controller.executeCommandOnSelectedNode(menuItem.get_value(),node)}}function cleanItemName(name,isFolder){if(isFolder)name=name.replace(/(\s|\.)+$/,"");else if(""==name.replace(/(\s|\.)+$/,""))return"";return $.trim(name)}function treeViewOnNodeEditing(sender,args){var node=args.get_node();currentFolderId=node.get_value();var newText=cleanItemName(args.get_newText(),!0);args.set_cancel(!renameFolderNode(node,newText))}function expandNode(node){node.get_expandMode()==Telerik.Web.UI.TreeNodeExpandMode.WebService&&node.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.ClientSide),node.set_expanded(!0)}function startRenameFolderNode(node){node.startEdit()}function internalRefreshNode(node,isAfterRecursiveSych,sender){null!=node&&(currentFolderId=node.get_value(),loadSubFolders(node,isAfterRecursiveSych,!0),sender&&"treeview"==sender&&(node.get_expanded()||expandNode(node)))}function refreshFolderNode(node,sender){internalRefreshNode(node,!1,sender),loadFolderFirstPage(currentFolderId)}function refreshFolder(keepCurrentPage){if(keepCurrentPage&&keepCurrentPage===!0){internalResetGridComponents();var pageSize=grid.get_pageSize(),startIndex=grid.get_currentPageIndex()*pageSize;return void loadFolder(currentFolderId,startIndex,pageSize,null)}refreshFolderNode(getCurrentNode())}function refreshFolderAfterRecursiveSync(){internalRefreshNode(getCurrentNode(),!0),clearSearchPattern(),loadFolderFirstPage(currentFolderId)}function refresFolderFromMenu(){onOpeningRefreshMenu(),refreshFolder()}function syncFromMenu(recursive){onOpeningRefreshMenu(),syncFolder(currentFolderId,recursive)}function syncFolder(folderId,recursive){enableLoadingPanel(!0),$.ajax({url:getContentServiceUrl()+"SynchronizeFolder",data:{folderId:folderId,recursive:recursive},type:"POST",beforeSend:servicesFramework.setModuleHeaders}).done(function(data){recursive?refreshFolderAfterRecursiveSync():refreshFolder()}).fail(function(xhr){handledXhrError(xhr,resources.loadFolderContentErrorTitle)}).always(function(){enableLoadingPanel(!1)})}function getCurrentNode(){return treeView.findNodeByValue(currentFolderId)}function getSelectedNode(){return treeView.get_selectedNode()}function treeViewOnNodeClicking(sender,args){var node=args.get_node();currentFolderId=node.get_value(),$("#dnnModuleDigitalAssetsLeftPaneActions li","#"+controls.scopeWrapperId).removeClass("selected"),controller.onLoadFolder(),clearSearchPattern(),loadFolderFirstPage(currentFolderId)}function setNodeText(node,text){treeView.trackChanges(),node.set_text(text),treeView.commitChanges()}function onRenameFolderNameFail(dialogTitle,dialogText,node,oldText,newText){showAlertDialog(dialogTitle,dialogText,function(){setNodeText(node,oldText),node.startEdit();var textInput=node.get_inputElement();textInput.value=newText})}function containsInvalidChars(textValue){for(var invalidChars=resources.invalidChars,i=0;i<invalidChars.length;i++)if(textValue.indexOf(invalidChars[i])!=-1)return!0;return!1}function nameTextIsInvalid(newText,validation){return validation.isInvalid=containsInvalidChars(newText),validation.isInvalid&&(validation.errorMessage=resources.invalidCharsErrorText),validation.isInvalid}function renameFolderNode(node,newFolderName){currentFolderId=node.get_value();var oldText=node.get_text();if(""===newFolderName||newFolderName==oldText)return setNodeText(node,oldText),!1;var validation={};return nameTextIsInvalid(newFolderName,validation)?(setTimeout(function(){onRenameFolderNameFail(resources.renameFolderErrorTitle,validation.errorMessage,node,oldText,newFolderName)},0),!0):(enableLoadingPanel(!0),$.ajax({type:"POST",url:getContentServiceUrl()+"RenameFolder",data:{folderId:currentFolderId,newFolderName:newFolderName},beforeSend:servicesFramework.setModuleHeaders}).done(function(data){setNodeText(node,newFolderName);var selectedNode=getSelectedNode();if(null!=selectedNode&&selectedNode.get_value()==node.get_parent().get_value()){var selectedFolderId=selectedNode.get_value();loadFolderFirstPage(selectedFolderId)}else updateBreadcrumb(searchPattern),controller.updateModuleState(createInternalModuleState())}).fail(function(xhr,status,error){isXhrHandled(xhr)||showAlertDialog(resources.renameFolderErrorTitle,getExceptionMessage(xhr),function(){setNodeText(node,oldText),node.startEdit();var textInput=node.get_inputElement();textInput.value=newFolderName})}).always(function(){enableLoadingPanel(!1)}),!0)}function getExtension(fileName){return fileName.indexOf(".")==-1?"":fileName.split(".").pop().toLowerCase()}function extensionChanged(oldName,newName){var oldExtension=getExtension(oldName),newExtension=getExtension(newName);return oldExtension!=newExtension}function extensionChangeConfirmation(oldText,newText,renameFunction,cancelFunction){if(extensionChanged(oldText,newText)){if($(".dnnDialog").data("ui-dialog")&&$(".dnnDialog").dialog("isOpen"))return;var dialogTitle=resources.extensionChangeConfirmTitleText,dialogText=resources.extensionChangeConfirmContent;$("<div class='dnnDialog'></div>").html(dialogText).dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:400,height:200,resizable:!1,title:dialogTitle,buttons:[{id:"ok_button",text:resources.okText,class:"dnnPrimaryAction",click:function(){renameFunction(),$(this).dialog("close")}},{id:"no_button",text:resources.noText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}],close:function(){cancelFunction()}})}else renameFunction()}function renameItem(dataItem,newText,gridItem,rowId){var requestUrl=getContentServiceUrl()+(dataItem.IsFolder?"RenameFolder":"RenameFile"),requestData=dataItem.IsFolder?{folderId:dataItem.ItemID,newFolderName:newText}:{fileId:dataItem.ItemID,newFileName:newText};enableLoadingPanel(!0),$.ajax({type:"POST",url:requestUrl,data:requestData,beforeSend:servicesFramework.setModuleHeaders}).done(function(data){hideItemEdition(grid.get_selectedItems()[0]),dataItem.ItemName=newText,dataItem.IconUrl=data.IconUrl,dataItem.ThumbnailAvailable=data.ThumbnailAvailable,dataItem.ThumbnailUrl=data.ThumbnailUrl,finishRename(dataItem)}).fail(function(xhr,status,error){isXhrHandled(xhr)||onRenameItemError($("#"+rowId+"_ItemNameEdit"),dataItem.IsFolder,getExceptionMessage(xhr))}).always(function(){enableLoadingPanel(!1)})}function finishRename(dataItem){var rowId=grid.get_selectedItems()[0].get_id();$("#"+rowId+"_ItemName").text(dataItem.ItemName),$("#"+rowId+"_ItemNameEdit").val(dataItem.ItemName);var item=$(".dnnModuleDigitalAssetsListViewItem[data-index='"+grid.get_selectedItems()[0].get_itemIndexHierarchical()+"']");if(item.find("span.dnnModuleDigitalAssetsListViewItemLinkName").text(getReducedItemName(dataItem.ItemName)),item.find("span.dnnModuleDigitalAssetsListViewItemLinkName").attr("title",dataItem.ItemName),dataItem.IsFolder){var node=getCurrentNode();loadSubFolders(node,!1,!0)}else $("#"+rowId+"_ItemIcon").attr("src",dataItem.IconUrl),item.find("div.dnnModuleDigitalAssetsThumbnail>img").attr("src",controller.getThumbnailUrl(dataItem)).attr("class",controller.getThumbnailClass(dataItem))}function renameItemInListView(dataItem,item,input,span,newText){var requestUrl=getContentServiceUrl()+(dataItem.IsFolder?"RenameFolder":"RenameFile"),requestData=dataItem.IsFolder?{folderId:dataItem.ItemID,newFolderName:newText}:{fileId:dataItem.ItemID,newFileName:newText};enableLoadingPanel(!0),$.ajax({type:"POST",url:requestUrl,data:requestData,beforeSend:servicesFramework.setModuleHeaders}).done(function(data){span.show(),input.remove(),dataItem.ItemName=newText,dataItem.IconUrl=data.IconUrl,dataItem.ThumbnailAvailable=data.ThumbnailAvailable,dataItem.ThumbnailUrl=data.ThumbnailUrl,finishRename(dataItem)}).fail(function(xhr){isXhrHandled(xhr)||onRenameItemError(input,dataItem.IsFolder,getExceptionMessage(xhr))}).always(function(){enableLoadingPanel(!1)})}function onRenameItemError(input,isFolder,errorMessage){input.off("blur");var errorTitle=isFolder?resources.renameFolderErrorTitle:resources.renameFileErrorTitle;showAlertDialog(errorTitle,errorMessage,function(){reassignBlurToRenameInput(input),selectNameWithoutExtension(input[0])})}function reassignBlurToRenameInput(input){var blurEvent=input.data(tempBlurEventFunction);blurEvent&&input.on("blur",blurEvent)}function renameItemInGrid(rowId){var gridItem=$find(rowId);$(gridItem.get_element()).addClass("continueEditing");var dataItem=gridItem.get_dataItem(),isFolder=dataItem.IsFolder,oldText=$("#"+rowId+"_ItemName").text(),newText=cleanItemName($("#"+rowId+"_ItemNameEdit").val(),isFolder);if(""===newText||oldText==newText)return void cancelRenameInGrid(rowId);var validation={};if(nameTextIsInvalid(newText,validation))return void onRenameItemError($("#"+rowId+"_ItemNameEdit"),isFolder,validation.errorMessage);if(isFolder)renameItem(dataItem,newText,gridItem,rowId);else{var input=$("#"+rowId+"_ItemNameEdit");input.off("blur"),extensionChangeConfirmation(oldText,newText,function(){renameItem(dataItem,newText,gridItem,rowId)},function(){reassignBlurToRenameInput(input),selectNameWithoutExtension(input[0])})}}function rename(){if(1==grid.get_selectedItems().length)if(currentView==listViewMode){var item=$(".dnnModuleDigitalAssetsListViewItem[data-index='"+grid.get_selectedItems()[0].get_itemIndexHierarchical()+"']"),span=item.find("span");span.hide();var dataItem=grid.get_selectedItems()[0].get_dataItem(),oldText=dataItem.ItemName,input=$("<input />").val(oldText);item.append(input),selectNameWithoutExtension(input.get(0)),input.keypress(function(e){13==e.which&&(e.preventDefault(),performRenameInListView($(this),dataItem,span,item))}),input.keyup(function(e){27==e.keyCode&&cancelRenameInListView($(this),span)}),input.click(function(e){e.stopPropagation()}),input.data(tempBlurEventFunction,function(){performRenameInListView($(this),dataItem,span,item)}),input.blur(input.data(tempBlurEventFunction))}else currentView==gridViewMode&&showRowEdition(grid.get_selectedItems()[0])}function performRenameInListView(input,dataItem,span,item){var oldText=dataItem.ItemName,newText=cleanItemName(input.val(),dataItem.IsFolder);if(""===newText||newText==oldText)return void cancelRenameInListView(input,span);var validation={};return nameTextIsInvalid(newText,validation)?void onRenameItemError(input,dataItem.IsFolder,validation.errorMessage):void(dataItem.IsFolder?renameItemInListView(dataItem,item,input,span,newText):(input.off("blur"),extensionChangeConfirmation(dataItem.ItemName,newText,function(){renameItemInListView(dataItem,item,input,span,newText)},function(){reassignBlurToRenameInput(input),selectNameWithoutExtension(input[0])})))}function cancelRenameInListView(input,span){input.remove(),span.show()}function cancelRenameInGrid(rowId){var oldText=$("#"+rowId+"_ItemName").text();$("#"+rowId+"_ItemNameEdit").val(oldText);var gridItem=$find(rowId);hideItemEdition(gridItem)}function loadSubFolders(node,reset,isMainTree){var folderParentId=node.get_value();isMainTree&&enableLoadingPanel(!0),$.ajax({type:"POST",url:getContentServiceUrl()+"GetSubFolders",data:{folderId:folderParentId},async:!1,beforeSend:servicesFramework.setModuleHeaders}).done(function(data){reset?resetSubFolders(node,data):updateSubFolders(node,data,isMainTree)}).fail(function(xhr){handledXhrError(xhr,resources.loadSubFoldersErrorTitle)}).always(function(){isMainTree&&enableLoadingPanel(!1)})}function treeViewRefreshScrollbars(){var $actions=$("#dnnModuleDigitalAssetsLeftPaneActions","#"+controls.scopeWrapperId),$scroll=$("#dnnModuleDigitalAssetsLeftPaneFilesTabContentScroll","#"+controls.scopeWrapperId);$scroll.css({bottom:$actions.outerHeight()}).jScrollPane();var y=Math.min($scroll.find("div.jspPane").outerHeight(),$scroll.find("div.jspContainer").outerHeight());$actions.fadeIn(200).css({top:y})}function selectSubFolder(node,folderId){for(var nodes=node.get_allNodes(),i=0;i<nodes.length;i++)if(nodes[i].get_value()==folderId)return void nodes[i].select()}function initDroppableNode(node){$(node.get_element()).droppable({accept:".dnnModuleDigitalAssetsListViewItem, .dnnModuledigitalAssetsTreeView .rtLI, .dnnModuleDigitalAssetsGrid tr.rgRow, .dnnModuleDigitalAssetsGrid tr.rgAltRow",tolerance:"pointer",hoverClass:"dropTarget",greedy:!0,drop:function(event,ui){var element=$(event.target),destNode=treeView.findNodeByValue(element.data("FolderId"));if(ui.draggable.is(".rtLI")){var sourceNode=treeView.findNodeByValue(ui.draggable.data("FolderId")),sourceItems=[{ItemId:sourceNode.get_value(),IsFolder:!0,ParentFolderId:sourceNode.get_parent().get_value()}];canDropOnNode(sourceNode,destNode)&&moveItems(sourceItems,destNode.get_value())}else canDropOnNode(null,destNode)&&moveItems(convertToItemsFromGridItems(grid.get_selectedItems()),destNode.get_value())},over:function(event,ui){var element=$(event.target),destNode=treeView.findNodeByValue(element.data("FolderId"));dndTreeExpandTimeout=setTimeout(function(){destNode.get_expanded()||(internalOnNodeExpanding(destNode,!1),destNode.set_expanded(!0))},1e3);var sourceNode=ui.draggable.is(".rtLI")?treeView.findNodeByValue(ui.draggable.data("FolderId")):null;canDropOnNode(sourceNode,destNode)||element.removeClass("dropTarget")},out:function(event,ui){clearTimeout(dndTreeExpandTimeout)}}).data("FolderId",node.get_value()).attr("title",node.get_text()).draggable({distance:dragAndDropDistance,delay:dragAndDropDelay,helper:function(event,ui){var text=$(event.target).closest("li.rtLI").find(">div>span.rtIn").text();return getDragDropHelper(text)},start:function(event,ui){var folderId=$(event.target).closest("li.rtLI").data("FolderId");if(folderId==rootFolderId)return!1;var sourceNode=treeView.findNodeByValue(folderId);return!!nodeHasPermission(sourceNode,"COPY")&&($("#"+controls.scopeWrapperId).addClass("moving"),!0)},stop:function(event,ui){$("#"+controls.scopeWrapperId).removeClass("moving")},addClasses:!1,cursor:"move",cursorAt:{left:10,top:30},appendTo:"#"+controls.scopeWrapperId});for(var nodes=node.get_nodes(),i=0;i<nodes.get_count();i++)initDroppableNode(nodes.getNode(i))}function resetSubFolders(parentNode,subfolders){var currentTreeView=parentNode.get_treeView();currentTreeView.trackChanges(),parentNode.get_nodes().clear(),parentNode.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.ClientSide),parentNode.hideLoadingStatus();for(var i=0;i<subfolders.length;i++){var node=createNewNode(subfolders[i]);parentNode.get_nodes().add(node),initDroppableNode(node),node.get_value()==currentFolderId&&(node.select(),updateBreadcrumb())}currentTreeView.commitChanges()}function updateSubFolders(parentNode,subfolders,isMainTree){var currentTreeView=parentNode.get_treeView();parentNode.hideLoadingStatus(),parentNode.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.ClientSide),currentTreeView.trackChanges();for(var currentNodes=parentNode.get_nodes(),j=0;j<currentNodes.get_count();j++){var currentNode=currentNodes.getNode(j);null==getFolderById(subfolders,currentNode.get_value())&&(parentNode.get_nodes().removeAt(j),j--)}for(var i=0;i<subfolders.length;i++){var item=subfolders[i],node=currentTreeView.findNodeByValue(item.FolderID);null==node||"undefined"===node?(node=createNewNode(item),parentNode.get_nodes().add(node),isMainTree&&initDroppableNode(node)):node=updateNode(node,item),isMainTree&&node.get_value()==currentFolderId&&(node.select(),updateBreadcrumb())}currentTreeView.commitChanges()}function getFolderById(items,folderId){for(var i=0;i<items.length;i++)if(items[i].FolderID==folderId)return items[i];return null}function createNewNode(item){var node=new Telerik.Web.UI.RadTreeNode;return updateNode(node,item)}function updateNode(node,item){node.set_text(item.FolderName),node.set_value(item.FolderID),node.set_category(item.FolderMappingID),node.set_imageUrl(item.IconUrl),(checkSinglePermission(item.Permissions,"BROWSE")||checkSinglePermission(item.Permissions,"READ"))&&item.HasChildren?node.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.WebService):node.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.ClientSide),node.get_attributes().setAttribute("permissions",item.Permissions);for(var i=0;i<item.Attributes.length;i++){var attribute=item.Attributes[i];node.get_attributes().setAttribute(attribute.Key,attribute.Value)}return node}function copyNodeSettings(nodeCopyTo,nodeCopyFrom){nodeCopyTo.set_text(nodeCopyFrom.get_text()),nodeCopyTo.set_value(nodeCopyFrom.get_value()),nodeCopyTo.set_category(nodeCopyFrom.get_category()),nodeCopyTo.set_imageUrl(nodeCopyFrom.get_imageUrl());for(var attributesCopyFrom=nodeCopyFrom.get_attributes(),i=0;i<attributesCopyFrom.get_count();i++){var attributeKey=attributesCopyFrom._keys[i];nodeCopyTo.get_attributes().setAttribute(attributeKey,attributesCopyFrom.getAttribute(attributeKey))}nodeCopyTo.set_expandMode(nodeCopyFrom.get_expandMode()),nodeCopyTo.set_expanded(nodeCopyFrom.get_expanded())}function cloneNode(node){var clonedNode=new Telerik.Web.UI.RadTreeNode;return copyNodeSettings(clonedNode,node),clonedNode}function cloneNodeRecursive(sourceNode,destinationNode){for(var nodes=sourceNode.get_nodes(),i=0;i<nodes.get_count();i++){var currentNode=nodes.getNode(i),clonedNode=cloneNode(currentNode);destinationNode.get_nodes().add(clonedNode),cloneNodeRecursive(currentNode,clonedNode)}}function checkCurrentFolderToolBarPermissions(permissions){checkPermissions("#"+controls.mainToolBarId,permissions,!0,!1),setupDnnMainToolbarTitles()}function checkSinglePermission(permissions,permissionKey){for(var i=0;i<permissions.length;i++)if(permissions[i].Key==permissionKey)return permissions[i].Value;return!1}function checkPermissions(selectorPattern,permissionsAttribute,reset,changeParent){var permissions="string"==typeof permissionsAttribute?JSON.parse(permissionsAttribute):permissionsAttribute;reset&&$(selectorPattern+" .permission_denied").removeClass("permission_denied");for(var i=0;i<permissions.length;i++){var itemsSelector=selectorPattern+" .permission_"+permissions[i].Key;$(itemsSelector).each(function(){var $item=changeParent?$(this).parent():$(this);permissions[i].Value?($item.addClass("permission_granted"),reset&&$item.removeClass("permission_denied")):$item.hasClass("permission_granted")||$item.addClass("permission_denied")})}$(selectorPattern+" .permission_granted").removeClass("permission_granted");
}function checkPermissionsWhenItemSelectionChanged(items,selectorPattern,changeParent){$(selectorPattern+" .permission_denied").removeClass("permission_denied");for(var j=0;j<items.length;j++){var item=items[j].get_dataItem();item&&checkPermissions(selectorPattern,item.Permissions,!1,changeParent)}}function checkColumnVisibility(){var nameColumn=grid.getColumnByUniqueName("ItemName").get_element(),showColumns=nameColumn&&$(nameColumn).width()>100;toggleColumn("LastModifiedOnDate",showColumns),toggleColumn("Size",showColumns)}function gridOnColumnHidden(){$("#"+controls.gridId+">table","#"+controls.scopeWrapperId).hide().show()}function internalResetGridComponents(){toggleColumn("LastModifiedOnDate",!0),toggleColumn("ParentFolder",!1),grid.clearSort(),checkColumnVisibility(),!searchProvider||searchPattern&&""!=searchPattern||searchProvider.clearSearch()}function loadInitialContent(){loadFolderFirstPage(currentFolderId)}function loadFolderFirstPage(folderId){internalResetGridComponents(),grid.set_currentPageIndex(0),loadFolder(folderId,0,grid.get_pageSize(),null)}function createInternalModuleState(){return createModuleState("folderId",getCurrentNode().get_value())}function createModuleState(stateMode,stateValue){var state=controller.getCurrentState(grid,currentView);return state.stateMode=stateMode,state.stateValue=stateValue,state}function loadFolderCurrentPage(folderId){internalResetGridComponents(),loadFolder(folderId,grid.get_currentPageIndex(),grid.get_pageSize(),null)}function handledXhrError(xhr,message){isXhrHandled(xhr)||showAlertDialog(message,getExceptionMessage(xhr))}function loadFolder(folderId,startIndex,numItems,sortExpression){return controller.loadContent(folderId,startIndex,numItems,sortExpression,settings,controls.scopeWrapperId)?(currentFolder=null,void setupDnnMainToolbarTitles()):searchProvider&&searchPattern&&""!=searchPattern?(prepareForFilteredContent(),searchProvider.doSearch(folderId,searchPattern,startIndex,numItems,sortExpression,function(){enableLoadingPanel(!0)},function(data){itemsDatabind(data,resources.noItemsSearchText)},function(xhr,status,error){handledXhrError(xhr,resources.loadFolderContentErrorTitle)},function(){enableLoadingPanel(!1)}),void(currentFolder=null)):(undoFilterContentPreparation(),grid.clearSelectedItems(),enableLoadingPanel(!0),void $.ajax({url:getContentServiceUrl()+"GetFolderContent",data:{folderId:folderId,startIndex:startIndex,numItems:numItems,sortExpression:sortExpression},type:"POST",beforeSend:servicesFramework.setModuleHeaders}).done(function(data){settings.isFilteredContent===!0&&$("#dnnModuleDigitalAssetsMainToolbar #DigitalAssetsUploadFilesBtnId","#"+controls.scopeWrapperId).css("display",""),currentFolder=data.Folder,currentFolder.ItemID=currentFolder.FolderID,currentFolder.IsFolder=!0,checkCurrentFolderToolBarPermissions(data.Folder.Permissions),itemsDatabind(data,resources.noItemsText)}).fail(function(xhr){handledXhrError(xhr,resources.loadFolderContentErrorTitle)}).always(function(){enableLoadingPanel(!1),controller.updateModuleState(createInternalModuleState())}))}function getParentFolderName(parentFolder){return 0==parentFolder.indexOf(settings.rootFolderPath)&&(parentFolder=parentFolder.substring(settings.rootFolderPath.length)),treeView.get_nodes().getNode(0).get_text()+"/"+parentFolder}function itemsDatabind(data,noItemsText){for(var i=0;i<data.Items.length;i++)data.Items[i].ParentFolder=getParentFolderName(data.Items[i].ParentFolder);grid.set_virtualItemCount(data.TotalCount),grid.set_dataSource(data.Items),grid.dataBind(),$("#"+controls.gridId+" tbody input[type='checkbox']").dnnCheckbox().unbind("click",gridSelectionCheckboxClick).bind("click",gridSelectionCheckboxClick),gridSelectUnselectAll.prop("checked",!1),settings.isFilteredContent===!1&&$(".dnnModuleDigitalAssetsGrid tr.rgRow, .dnnModuleDigitalAssetsGrid tr.rgAltRow").draggable({distance:dragAndDropDistance,delay:dragAndDropDelay,addClasses:!1,helper:onItemHelper,cursor:"move",cursorAt:{left:10,top:30},appendTo:"#"+controls.scopeWrapperId,start:initDragAndDropGridSelection,refreshPositions:!0}).droppable({addClasses:!1,greedy:!0,hoverClass:"dropTarget",accept:".dnnModuleDigitalAssetsGrid tr.rgRow, .dnnModuleDigitalAssetsGrid tr.rgAltRow, .dnnModuledigitalAssetsTreeView .rtLI",over:onItemDragOver,drop:onItemDrop}),listView.set_dataSource(prepareListViewData(data)),listView.dataBind(),$("#dnnModuleDigitalAssetsListView .dnnModuleDigitalAssetsListViewItem .dnnModuleDigitalAssetsListViewItemLinkName").bind("click",clickOnListViewItemNameLink),$("#dnnModuleDigitalAssetsListViewToolbar input[type=checkbox]","#"+controls.scopeWrapperId).unbind("click",listviewSelectAllOnClick).bind("click",listviewSelectAllOnClick),listViewInitialize(),settings.isFilteredContent===!1&&$(".dnnModuleDigitalAssetsListViewItem").draggable({distance:dragAndDropDistance,delay:dragAndDropDelay,addClasses:!1,helper:onItemHelper,cursor:"move",cursorAt:{left:10,top:30},start:initDragAndDropGridSelection,refreshPositions:!0}).droppable({addClasses:!1,greedy:!0,hoverClass:"dropTarget",accept:".dnnModuleDigitalAssetsListViewItem, .dnnModuledigitalAssetsTreeView .rtLI",over:onItemDragOver,drop:onItemDrop}),updateSelectionToolBar(),updateBreadcrumb(),0==data.Items.length?($("#dnnModuleDigitalAssetsListViewNoItems","#"+controls.scopeWrapperId).show(),$("span.dnnModuleDigitalAssetsNoItems","#"+controls.scopeWrapperId).text(noItemsText)):$("#dnnModuleDigitalAssetsListViewNoItems","#"+controls.scopeWrapperId).hide(),treeViewRefreshScrollbars()}function prepareListViewData(data){if(data.Items)for(var i=0;i<data.Items.length;i++)data.Items[i].ThumbnailUrl=controller.getThumbnailUrl(data.Items[i]),data.Items[i].ThumbnailClass=controller.getThumbnailClass(data.Items[i]);return data.Items}function getReducedItemName(name,isFolder){return name.length>44||containsLongWords(name)?reduceItemName(name,isFolder):name}function containsLongWords(name){for(var words=name.split(" "),i=0;i<words.length;i++)if(words[i].length>22)return!0;return!1}function reduceItemName(name,isFolder){var startName=name.substring(0,8),endName=isFolder?name.substring(name.length-6):name.substring(name.length-10);return startName+"...."+endName}function triggerMouseClick(target,ctrlKey,altKey,shiftKey){var fireOnThis=target;if(document.createEvent){var evObj=document.createEvent("MouseEvents");evObj.initMouseEvent("click",!0,!0,window,0,0,0,0,0,ctrlKey,altKey,shiftKey,!1,0,null),fireOnThis.dispatchEvent(evObj)}else if(document.createEventObject){var evObjIE=document.createEventObject();evObjIE.ctrlKey=ctrlKey,evObjIE.altKey=altKey,evObjIE.shiftKey=shiftKey,fireOnThis.fireEvent("onclick",evObjIE)}}function executeViewCommand(sender,commandName){if("ClearSort"!=commandName){var masterView=sender.get_masterTableView(),pageSize=masterView.get_pageSize(),sortExpressions=masterView.get_sortExpressions(),currentPageIndex=masterView.get_currentPageIndex();"Sort"!=commandName&&"Filter"!=commandName||(currentPageIndex=0,masterView.set_currentPageIndex(0));var sortExpressionsAsSql=sortExpressions.toString();loadFolder(currentFolderId,currentPageIndex*pageSize,pageSize,sortExpressionsAsSql)}}function gridOnCommand(sender,args){args.set_cancel(!0),executeViewCommand(sender,args.get_commandName())}function getGridDataItemById(id){for(var dataItems=grid.get_dataItems(),i=0;i<dataItems.length;i++)if(dataItems[i].get_dataItem().ItemID==id)return dataItems[i].get_dataItem();return null}function hideItemEdition(gridItem){var celltd=gridItem.get_cell("ItemName");$("div > span > span",celltd).show(),$("#"+gridItem.get_id()+"_ItemNameEdit").remove()}function showRowEdition(gridItem){var celltd=gridItem.get_cell("ItemName");$("div > span > span",celltd).hide();var rowId=gridItem.get_id(),inputItemName=$("<input></input>");inputItemName.attr("id",rowId+"_ItemNameEdit"),inputItemName.addClass("ItemNameEdit"),inputItemName.val(gridItem.get_dataItem().ItemName),inputItemName.keypress(function(e){13==e.which&&(renameItemInGrid(rowId),e.cancelBubble=!0,e.returnValue=!1,e.stopPropagation&&(e.stopPropagation(),e.preventDefault()))}),inputItemName.keyup(function(e){27==e.keyCode&&cancelRenameInGrid(rowId)}),inputItemName.data(tempBlurEventFunction,function(){renameItemInGrid(rowId)}),inputItemName.blur(inputItemName.data(tempBlurEventFunction)),inputItemName.click(function(e){return!1}),$("div",celltd).append(inputItemName),selectNameWithoutExtension(inputItemName[0])}function selectNameWithoutExtension(textBox){var index=textBox.value.lastIndexOf(".");if(index==-1)return void textBox.select();if(textBox.createTextRange){var selRange=textBox.createTextRange();selRange.collapse(!0),selRange.moveStart("character",0),selRange.moveEnd("character",index),selRange.select()}else textBox.setSelectionRange?textBox.setSelectionRange(0,index):textBox.selectionStart&&(textBox.selectionStart=0,textBox.selectionEnd=index);textBox.focus()}function clickOnItemName(event,dataItem){if(event.preventDefault(),event.stopPropagation(),dataItem.IsFolder){currentFolderId=dataItem.ItemID;var node=getExpandedNodeByPath(dataItem.ParentFolder);selectSubFolder(node,dataItem.ItemID),$("#dnnModuleDigitalAssetsLeftPaneActions li","#"+controls.scopeWrapperId).removeClass("selected"),controller.onLoadFolder(),clearSearchPattern(),loadFolderFirstPage(dataItem.ItemID)}else $.each(dataItem.Permissions,function(index,p){return"READ"!=p.Key||1!=p.Value||(self.window.open(setTimeStamp(getUrlAsync(dataItem.ItemID))),!1)})}function getExpandedNodeByPath(path){$("#dnnModuleDigitalAssetsLeftPaneActions","#"+controls.scopeWrapperId).hide();var node=treeView.get_nodes().getItem(0);node.expand();for(var p=path.split("/"),i=0;i<p.length;i++){var name=p[i];if(""!=name)for(var nodes=node.get_nodes(),j=0;j<nodes.get_count();j++){var n=nodes.getItem(j);if(n.get_text()==name){node=n,internalOnNodeExpanding(node,!0),node.set_expanded(!0);break}}}return node}function getUrlAsync(fileId){var url;return enableLoadingPanel(!0),$.ajax({type:"POST",url:getContentServiceUrl()+"GetUrl",data:{fileId:fileId},async:!1,beforeSend:servicesFramework.setModuleHeaders}).done(function(data){url=data}).fail(function(xhr){handledXhrError(xhr,resources.getUrlErrorTitle)}).always(function(){enableLoadingPanel(!1)}),url}function clickOnListViewItemNameLink(event){var index=$(this).parent().attr("data-index"),gridItem=grid.get_dataItems()[index];if(gridItem){var dataItem=gridItem.get_dataItem();clickOnItemName(event,dataItem)}}function highlightItemName(itemName){return searchProvider&&(itemName=searchProvider.highlightItemName(searchPattern,itemName)),itemName}function getItemNameColumnContent(rowId,dataItem){var iconItem=$("<img></img>");iconItem.attr("id",rowId+"_ItemIcon"),iconItem.attr("src",dataItem.IconUrl),iconItem.addClass("ItemIcon");var spanItemName=$("<span></span>");spanItemName.attr("id",rowId+"_ItemName"),spanItemName.html(highlightItemName(dataItem.ItemName));var divItemName=$("<div></div>");divItemName.attr("id",rowId+"_ItemNameTemplate"),divItemName.attr("title",dataItem.ItemName),divItemName.addClass("dnnModuleDigitalAssetItemNameTemplate");var span=$("<span></span>");return span.append(iconItem),span.append(spanItemName),span.click(function(event){clickOnItemName(event,dataItem)}),divItemName.append(span),divItemName}function gridOnRowDataBound(sender,args){var item=args.get_item();$(item.get_element()).data("index",item.get_itemIndexHierarchical());var selectCell=$(item.get_cell("Select"));selectCell.html("<input type='checkbox' />");var cellItemNametd=$(item.get_cell("ItemName"));cellItemNametd.empty(),cellItemNametd.append(getItemNameColumnContent(item.get_id(),args.get_dataItem()));var cellSizetd=$(item.get_cell("Size"));cellSizetd.addClass("dnnModuleDigitalAssetsGrid-SizeColumn"),controller.gridOnRowDataBound(item,args.get_dataItem())}function onContextMenuShown(){$(".RadMenu.dnnModuleDigitalAssetsContextMenu li").each(function(){"hidden"==$(this).css("overflow")&&$(this).hide(),$(this).removeClass("rmFirst").removeClass("rmLast")}),$(".RadMenu.dnnModuleDigitalAssetsContextMenu").find("li:visible:first").addClass("rmFirst"),$(".RadMenu.dnnModuleDigitalAssetsContextMenu").find("li:visible:last").addClass("rmLast")}function isItemAlreadySelected(gridItem,items){for(var item=gridItem.get_dataItem(),i=0;i<items.length;i++)if(items[i].ItemId==item.ItemID)return!0;return!1}function setupSelectedItemsToContextMenu(gridItem,ctrlKey,shiftKey){var items=convertToItemsFromGridItems(grid.get_selectedItems());return ctrlKey&&!shiftKey?items:isItemAlreadySelected(gridItem,items)?items:(grid.clearSelectedItems(),grid.selectItem(gridItem.get_element(),!0),convertToItemsFromGridItems(grid.get_selectedItems()))}function hideMenuOptions(selector){$(selector).each(function(){$(this).parent().hide()})}function hideMenuOption(element){$(element).hide()}function setupContextMenu(index,event){var gridItem=grid.get_dataItems()[index],items=setupSelectedItemsToContextMenu(gridItem,event.ctrlKey,event.shiftKey);if(!(items.length<=0)){var menuSelector="#"+controls.gridMenuId+"_detached";$(menuSelector+" li.rmItem").css("display",""),checkPermissionsWhenItemSelectionChanged(grid.get_selectedItems(),menuSelector,!0),hideMenuOptions(items.length>1?menuSelector+" a.rmLink.singleItem":menuSelector+" a.rmLink.moreThanOneItem"),areOnlyFilesSelected(items)||hideMenuOptions(menuSelector+" a.rmLink.onlyFiles"),areOnlyFoldersSelected(items)||hideMenuOptions(menuSelector+" a.rmLink.onlyFolders"),settings.isFilteredContent===!0&&hideMenuOptions(menuSelector+" a.rmLink.disabledIfFiltered");var downloadVisible=controller.isDownloadAvailable(items);contextMenu.findItemByValue("Download").set_visible(downloadVisible);var unzip=contextMenu.findItemByValue("UnzipFile");if("zip"!=getExtension(gridItem.get_dataItem().ItemName)&&hideMenuOption(unzip.get_element()),1==items.length){var unlinkAllowedStatus=gridItem.get_dataItem().UnlinkAllowedStatus;if("onlyUnlink"==unlinkAllowedStatus){var deleteOption=contextMenu.findItemByValue("Delete");hideMenuOption(deleteOption.get_element())}else if("false"==unlinkAllowedStatus){var unlinkOption=contextMenu.findItemByValue("Unlink");hideMenuOption(unlinkOption.get_element())}}controller.setupGridContextMenuExtension(contextMenu,grid.get_selectedItems()),contextMenu.show(event)}}function gridOnRowContextMenu(sender,args){var evt=args.get_domEvent();"INPUT"!=evt.target.tagName&&"A"!=evt.target.tagName&&(setupContextMenu(args.get_itemIndexHierarchical(),evt),evt.cancelBubble=!0,evt.returnValue=!1,evt.stopPropagation&&(evt.stopPropagation(),evt.preventDefault()))}function areOnlyFilesSelected(items){for(var i=0;i<items.length;i++)if(items[i].IsFolder)return!1;return!0}function areOnlyFoldersSelected(items){for(var i=0;i<items.length;i++)if(!items[i].IsFolder)return!1;return!0}function updateSelectionToolBar(){var items=convertToItemsFromGridItems(grid.get_selectedItems());if(0==items.length)return $(".DigitalAssetsSelectionToolBar","#"+controls.scopeWrapperId).hide(),void $("#dnnModuleDigitalAssetsSelectionText").html("");if($(".DigitalAssetsSelectionToolBar","#"+controls.scopeWrapperId).css("display",""),$("#dnnModuleDigitalAssetsSelectionText").html(selectionText(items)),checkPermissionsWhenItemSelectionChanged(grid.get_selectedItems(),"#"+controls.selectionToolBarId),items.length>1?$(".DigitalAssetsSelectionToolBar.singleItem","#"+controls.scopeWrapperId).hide():$(".DigitalAssetsSelectionToolBar.moreThanOneItem","#"+controls.scopeWrapperId).hide(),areOnlyFilesSelected(items)||$(".DigitalAssetsSelectionToolBar.onlyFiles","#"+controls.scopeWrapperId).hide(),areOnlyFoldersSelected(items)||$(".DigitalAssetsSelectionToolBar.onlyFolders","#"+controls.scopeWrapperId).hide(),settings.isFilteredContent===!0&&$(".DigitalAssetsSelectionToolBar.disabledIfFiltered","#"+controls.scopeWrapperId).hide(),controller.isDownloadAvailable(items)?$("#DigitalAssetsDownloadBtnId","#"+controls.scopeWrapperId).css("display",""):$("#DigitalAssetsDownloadBtnId","#"+controls.scopeWrapperId).hide(),$("#DigitalAssetsUnzipFileBtnId","#"+controls.scopeWrapperId).is(":visible")&&("zip"==getExtension(grid.get_selectedItems()[0].get_dataItem().ItemName)?$("#DigitalAssetsUnzipFileBtnId","#"+controls.scopeWrapperId).css("display",""):$("#DigitalAssetsUnzipFileBtnId","#"+controls.scopeWrapperId).hide()),1==items.length){var unlinkAllowedStatus=items[0].UnlinkAllowedStatus;"onlyUnlink"==unlinkAllowedStatus?$("#DigitalAssetsDeleteBtnId","#"+controls.scopeWrapperId).hide():"false"==unlinkAllowedStatus&&$("#DigitalAssetsUnlinkBtnId","#"+controls.scopeWrapperId).hide()}var $selectionToolbar=$("#dnnModuleDigitalAssetsSelectionToolbar","#"+controls.scopeWrapperId);controller.updateSelectionToolBar($selectionToolbar,grid.get_selectedItems())}function getBreadcrumbFolderItem(node){var a=$("<a href='#' />").text(node.get_text()).attr("title",node.get_text()).attr("data-folderid",node.get_value()).click(function(e){e.preventDefault(),currentFolderId=$(this).attr("data-folderid"),treeView.findNodeByValue(currentFolderId).select(),clearSearchPattern(),loadFolderFirstPage(currentFolderId)});return $("<li class='dnnModuleDigitalAssetsBreadcrumbLink' />").append(a)}function updateBreadcrumb(){var node=treeView.findNodeByValue(currentFolderId),ul=$("#dnnModuleDigitalAssetsBreadcrumb ul");searchPattern&&""!=searchPattern?(ul.html(getBreadcrumbFolderItem(node)),ul.append($("<li />").text(resources.searchBreadcrumb))):ul.html($("<li />").text(node.get_text()).attr("title",node.get_text()));var currentFolderLabel=$("#dnnModuleDigitalAssetsMainToolbarTitle span.title-currentFolder");for(currentFolderLabel.html('<img src="'+$(node.get_imageElement()).attr("src")+'" />'+node.get_text());node.get_value()!=rootFolderId;)node=node.get_parent(),ul.prepend(getBreadcrumbFolderItem(node))}function selectListViewItem(index){var listViewItem=$("#dnnModuleDigitalAssetsListViewItem_"+index,"#"+controls.scopeWrapperId);listViewItem.addClass("selected"),listViewItem.find("input[type=checkbox].dnnModuleDigitalAssetsListViewItemCheckBox").attr("checked",!0),listViewItem.find(".dnnCheckbox").addClass("dnnCheckbox-checked")}function deselectListViewItem(index){var listViewItem=$("#dnnModuleDigitalAssetsListViewItem_"+index,"#"+controls.scopeWrapperId);listViewItem.removeClass("selected"),listViewItem.find("input[type=checkbox].dnnModuleDigitalAssetsListViewItemCheckBox").removeAttr("checked"),listViewItem.find(".dnnCheckbox").removeClass("dnnCheckbox-checked")}function gridOnRowSelected(sender,args){var index=args.get_itemIndexHierarchical(),selectCell=$(args.get_item().get_cell("Select"));selectCell.find("input[type='checkbox']").attr("checked",!0),selectCell.find(".dnnCheckbox").addClass("dnnCheckbox-checked"),selectListViewItem(index),clearTimeout(updateSelectionToolBarTimeout),updateSelectionToolBarTimeout=setTimeout(function(){var totalItems=grid.get_dataItems().length,totalSelectedItems=grid.get_selectedItems().length;totalItems==totalSelectedItems&&($("#dnnModuleDigitalAssetsListViewToolbar input[type=checkbox]","#"+controls.scopeWrapperId).attr("checked",!0),$("#dnnModuleDigitalAssetsListViewToolbar>span.dnnModuleDigitalAssetsListViewToolbarTitle","#"+controls.scopeWrapperId).text(resources.unselectAll)),updateSelectionToolBar()},2)}function gridOnRowDeselected(sender,args){var index=args.get_itemIndexHierarchical(),gridItem=sender.get_masterTableView().get_dataItems()[index];gridItem&&!$(gridItem.get_element()).hasClass("continueEditing")&&cancelRenameInGrid(gridItem.get_id());var selectCell=$(args.get_item().get_cell("Select"));selectCell.find("input[type='checkbox']").removeAttr("checked"),selectCell.find(".dnnCheckbox").removeClass("dnnCheckbox-checked"),deselectListViewItem(index),clearTimeout(updateSelectionToolBarTimeout),updateSelectionToolBarTimeout=setTimeout(function(){$("#dnnModuleDigitalAssetsListViewToolbar input[type=checkbox]","#"+controls.scopeWrapperId).attr("checked",!1),$("#dnnModuleDigitalAssetsListViewToolbar>span.dnnModuleDigitalAssetsListViewToolbarTitle","#"+controls.scopeWrapperId).text(resources.selectAll),updateSelectionToolBar()},2)}function createNewFolder(node,sender){$("#dnnModuleDigitalAssetsCreateFolderMessage").hide(),initializeCreateNewFolderForm(node);var $modal=$("#dnnModuleDigitalAssetsCreateFolderModal");$modal.dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",title:resources.createNewFolderTitleText,resizable:!1,width:500,height:400,buttons:[{id:"save_button",text:resources.saveText,click:function(){saveNewFolder(node,sender)},class:"dnnPrimaryAction"},{id:"cancel_button",text:resources.cancelText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}]}),$modal.off("keyup").on("keyup",function(e){e.keyCode==$.ui.keyCode.ENTER&&$modal.parent().find("button.dnnPrimaryAction").trigger("click")}).off("keypress").on("keypress",function(e){e.keyCode==$.ui.keyCode.ENTER&&e.preventDefault()})}function initializeCreateNewFolderForm(node){$("#dnnModuleDigitalAssetsCreateFolderModalParent").text(node.get_text()).attr("title",node.get_text());var comboFolderType=$find(controls.comboBoxFolderTypeId),spanFolderTypeNoEditable=$("#dnnModuleDigitalAssetsFolderTypeNoEditableLabel"),txtFolderName=$("#"+controls.txtFolderNameId),txtMappedName=$("#"+controls.txtMappedPathId);txtFolderName.val(""),txtMappedName.val(""),resetClientValidations("CreateFolder");var parentFolderProvider=node.get_category(),defaultFolderProvider=node.get_value()==rootFolderId&&""!=settings.defaultFolderTypeId?settings.defaultFolderTypeId:parentFolderProvider,item=comboFolderType.findItemByValue(defaultFolderProvider);null!=item&&(item.select(),spanFolderTypeNoEditable.text(item.get_text()));var defaultFolderProviders=""==resources.defaultFolderProviderValues?[]:resources.defaultFolderProviderValues.split(",");$.inArray(parentFolderProvider.toString(),defaultFolderProviders)==-1?(comboFolderType.set_visible(!1),$("#"+controls.comboBoxFolderTypeId).addClass("dnnModuleDigitalAssetsHideFolderTypeDropDowList"),$("#"+controls.comboBoxFolderTypeId+">table").hide(),spanFolderTypeNoEditable.css("display","inline-block"),$("#dnnModuleDigitalAssetsCreateFolderMappedPathFieldRow").hide()):(comboFolderType.set_visible(!0),$("#"+controls.comboBoxFolderTypeId).removeClass("dnnModuleDigitalAssetsHideFolderTypeDropDowList"),$("#"+controls.comboBoxFolderTypeId+">table").show(),spanFolderTypeNoEditable.css("display","none"))}function resetClientValidations(validationGroup){if("undefined"!=typeof Page_Validators)for(var i=0;i<Page_Validators.length;i++){var validator=Page_Validators[i];validator.validationGroup==validationGroup&&(validator.isvalid=!0,ValidatorUpdateDisplay(validator))}}function folderTypeComboBoxOnSelectedIndexChanged(sender,eventArgs){var item=eventArgs.get_item(),supportsMappedPath=item.get_attributes().getAttribute("SupportsMappedPaths");if(supportsMappedPath){var txtMappedName=$("#"+controls.txtMappedPathId);"true"!=supportsMappedPath?($("#dnnModuleDigitalAssetsCreateFolderMappedPathFieldRow").hide(),txtMappedName.prop("disabled",!0)):($("#dnnModuleDigitalAssetsCreateFolderMappedPathFieldRow").show(),txtMappedName.prop("disabled",!1),resetClientValidations("CreateFolder"))}}function saveNewFolder(node,sender){var saveButton=$("#save_button");saveButton.button("option","disabled",!0);var comboFolderType=$find(controls.comboBoxFolderTypeId),txtFolderName=$("#"+controls.txtFolderNameId),txtMappedName=$("#"+controls.txtMappedPathId),message=$("#dnnModuleDigitalAssetsCreateFolderMessage");if(txtFolderName.val(cleanItemName(txtFolderName.val(),!0)),Page_ClientValidate("CreateFolder"),Page_IsValid){var loadingPanel=$(".dnnModuleDigitalAssetsCreateFolderLoading");loadingPanel.show(),$.ajax({url:getContentServiceUrl()+"CreateNewFolder",data:{FolderName:cleanItemName(txtFolderName.val(),!0),ParentFolderId:node.get_value(),FolderMappingId:comboFolderType.get_value(),MappedName:cleanItemName(txtMappedName.val(),!0)},async:!1,type:"POST",beforeSend:servicesFramework.setModuleHeaders}).done(function(data){onFolderCreated(data,node.get_value(),sender)}).fail(function(xhr,status,error){isXhrHandled(xhr)||message.html(getExceptionMessage(xhr)).show(),txtFolderName.select()}).always(function(){loadingPanel.hide()})}saveButton.button("option","disabled",!1)}function onFolderCreated(folder,parentFolderId,sender){var parentNode=treeView.findNodeByValue(parentFolderId);if(parentNode){if(treeView.trackChanges(),parentNode.get_expanded()||"treeview"!=sender){var node=createNewNode(folder);parentNode.get_nodes().add(node),initDroppableNode(node)}else parentNode.set_expandMode(Telerik.Web.UI.TreeNodeExpandMode.WebService),internalOnNodeExpanding(parentNode,!0),parentNode.set_expanded(!0);treeView.commitChanges(),treeViewRefreshScrollbars()}parentFolderId==currentFolderId&&loadFolderFirstPage(currentFolderId),$("#dnnModuleDigitalAssetsCreateFolderModal").dialog("close")}function isXhrHandled(xhr){return 401==xhr.status&&(location.reload(),!0)}function getExceptionMessage(xhr){if(!xhr.responseText)return null;try{var data=eval("("+xhr.responseText+")");return data.ExceptionMessage?data.ExceptionMessage:data.Message?data.Message:null}catch(ex){return xhr.statusText}}function createFolder(){createNewFolder(getCurrentNode())}function getCurrentFolderPath(){for(var node=getCurrentNode(),folderPath="";node.get_value()!=rootFolderId;)folderPath=node.get_text()+"/"+folderPath,node=node.get_parent();return settings.rootFolderPath+folderPath}function getFileUpload(){return"undefined"==typeof fileUpload&&(fileUpload=dnn[controls.fileUploadId],$(fileUpload).on("onfileuploadclose",function(){refreshFolder()})),fileUpload}function uploadFiles(){var node=getCurrentNode(),options={folderPath:getCurrentFolderPath(),folderPicker:{disabled:!0,initialState:{selectedItem:{key:node.get_value(),value:node.get_text()}}}},instance=getFileUpload();instance.show(options)}function deleteSelectedItems(){deleteItems(convertToItemsFromGridItems(grid.get_selectedItems()),currentFolderId)}function unlinkSelectedItems(){var items=convertToItemsFromGridItems(grid.get_selectedItems());items.length>1||items[0].IsFolder&&unlinkFolder(items[0])}function unlinkFolder(item){var dialogTitle=resources.unlinkTitle,dialogText=resources.unlinkConfirmText;$("<div class='dnnDialog'></div>").html(dialogText).dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:400,height:190,resizable:!1,title:dialogTitle,buttons:[{id:"unlink_button",text:resources.unlinkText,class:"dnnPrimaryAction",click:function(){$(this).dialog("close"),enableLoadingPanel(!0),$.ajax({type:"POST",url:getContentServiceUrl()+"UnlinkFolder",data:{folderId:item.ItemId},async:!1,beforeSend:servicesFramework.setModuleHeaders}).done(function(data){if(item.ItemId==currentFolderId){var parentNode=getCurrentNode().get_parent();currentFolderId=parentNode.get_value(),parentNode.select()}loadFolderFirstPage(currentFolderId),treeView.trackChanges(),treeView.findNodeByValue(item.ParentFolderId).get_nodes().remove(treeView.findNodeByValue(item.ItemId)),treeView.commitChanges(),treeViewRefreshScrollbars()}).fail(function(xhr){handledXhrError(xhr,resources.unlinkFolderErrorText)}).always(function(){enableLoadingPanel(!1)})}},{id:"cancel_button",text:resources.cancelText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}]})}function convertToItemsFromGridItems(gridItems){for(var items=[],i=0;i<gridItems.length;i++){var item=gridItems[i].get_dataItem();gridItems[i].get_visible()&&item&&items.push({ItemId:item.ItemID,IsFolder:item.IsFolder,ParentFolderId:item.ParentFolderID,UnlinkAllowedStatus:item.UnlinkAllowedStatus})}return items}function selectionText(items){for(var numberOfFiles=0,numberOfFolders=0,i=0;i<items.length;i++)items[i].IsFolder?numberOfFolders++:numberOfFiles++;var filesText=0==numberOfFiles?"":1==numberOfFiles?resources.oneFileText:resources.nFilesText.replace("[NUM]",numberOfFiles),foldersText=0==numberOfFolders?"":1==numberOfFolders?resources.oneFolderText:resources.nFoldersText.replace("[NUM]",numberOfFolders),hasFoldersAndFiles=numberOfFolders>0&&numberOfFiles>0;return hasFoldersAndFiles?resources.andText.replace("[FILES]",filesText).replace("[FOLDERS]",foldersText):filesText+foldersText}function confirmDeleteItems(items,parentFolderId,mappedSubfoldersCount){var folderAndFileText=selectionText(items),dialogTitle=resources.deleteTitle.replace("[ITEMS]",folderAndFileText),dialogText=resources.deleteConfirmText.replace("[ITEMS]",folderAndFileText),dialogNote="",dialogHeight=190;mappedSubfoldersCount>0&&(dialogNote=1==mappedSubfoldersCount?resources.deleteConfirmWithMappedSubfolderText.replace("[COUNT]",mappedSubfoldersCount):resources.deleteConfirmWithMappedSubfoldersText.replace("[COUNT]",mappedSubfoldersCount),dialogNote="<p class='dialogNote'>"+dialogNote+"</p>",dialogHeight=230),$("<div class='dnnDialog'></div>").html(dialogText+dialogNote).dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:400,height:dialogHeight,resizable:!1,title:dialogTitle,buttons:[{id:"delete_button",text:resources.deleteText,class:"dnnPrimaryAction",click:function(){$(this).dialog("close"),enableLoadingPanel(!0),$.ajax({url:getContentServiceUrl()+"DeleteItems",data:{Items:items},type:"POST",beforeSend:servicesFramework.setModuleHeaders}).done(function(data){onItemsDeleted(items,data,parentFolderId)}).fail(function(xhr){handledXhrError(xhr,resources.deleteItemsErrorTitle)}).always(function(){enableLoadingPanel(!1)})}},{id:"cancel_button",text:resources.cancelText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}]})}function deleteItems(items,parentFolderId){enableLoadingPanel(!0),$.ajax({url:getContentServiceUrl()+"GetMappedSubfoldersCount",data:{Items:items},type:"POST",beforeSend:servicesFramework.setModuleHeaders}).done(function(data){confirmDeleteItems(items,parentFolderId,data)}).fail(function(xhr){handledXhrError(xhr,resources.deleteItemsErrorTitle)}).always(function(){enableLoadingPanel(!1)})}function onItemsDeleted(items,itemsNotDeleted,parentFolderId){for(var i=0;i<items.length;i++){var item=items[i];if(item.IsFolder){for(var hasBeenDeleted=!0,j=0;j<itemsNotDeleted.length;j++)if(item.ItemId==itemsNotDeleted[j].ItemId){hasBeenDeleted=!1;break}if(hasBeenDeleted){var deletedNode=treeView.findNodeByValue(item.ItemId);if(deletedNode){treeView.trackChanges();var parentNode=deletedNode.get_parent();deletedNode.get_value()==currentFolderId&&(currentFolderId=parentNode.get_value(),parentNode.select()),parentNode.get_nodes().remove(deletedNode),treeView.commitChanges(),treeViewRefreshScrollbars()}}}}itemsNotDeleted.length>0&&alertNotDeletedItems(itemsNotDeleted),parentFolderId==currentFolderId&&loadFolderFirstPage(currentFolderId)}function alertNotDeletedItems(items){var $table=$("#dnnModuleDigitalAssetsAlertItemsScroll table");$table.empty();for(var i=0;i<items.length;i++)$table.append("<tr><td style='width:20px;'><img src='"+items[i].IconUrl+"' alt=''/></td><td>"+items[i].DisplayPath+"</td></tr>");$("#dnnModuleDigitalAssetsAlertItems").dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:600,height:330,resizable:!1,title:resources.noItemsDeletedTitle.replace("[ITEMS]",selectionText(items)),buttons:[{id:"close_button",text:resources.closeText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}]}),$("#dnnModuleDigitalAssetsAlertItemsSubtext").html(resources.noItemsDeletedText),$("#dnnModuleDigitalAssetsAlertItemsScroll").jScrollPane()}function moveSelectedItems(){moveDialog(convertToItemsFromGridItems(grid.get_selectedItems()))}function moveDialog(selectedItems){var selText=selectionText(selectedItems);resetDestinationTreeView();var width=450,height=400;$("#dnnModuleDigitalAssetsSelectDestinationFolderModal").dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",title:resources.moveTitle.replace("[SELECTION]",selText),resizable:!0,width:width,height:height,minWidth:width,minHeight:height,maxWidth:1.5*width,maxHeight:1.5*height,
buttons:[{id:"destination_button",text:resources.moveText,click:function(){$(this).dialog("close");var destinationFolderId=destinationTreeView.get_selectedNode().get_value();moveItems(selectedItems,destinationFolderId)},class:"dnnPrimaryAction"},{id:"cancel_button",text:resources.cancelText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}],resize:function(){$("#dnnModuleDigitalAssetsDestinationFolderScroll").jScrollPane()}}),$("#dnnModuleDigitalAssetsDestinationFolderScroll").jScrollPane(),destinationMove=!0,itemsSelectedToMoveOrCopy=selectedItems,checkDestinationButtonState(selectedItems,destinationTreeView.get_selectedNode())}function moveItems(items,destinationFolderId){for(var ajaxs=[],i=0;i<items.length;i++)ajaxs.push(moveItem(items[i].ItemId,items[i].IsFolder,destinationFolderId,!1));$.when.apply(null,ajaxs).always(function(){loadFolderFirstPage(currentFolderId)})}function moveNode(nodeId,destinationNodeId){var sourceNode=treeView.findNodeByValue(nodeId),destinationNode=treeView.findNodeByValue(destinationNodeId);treeView.trackChanges(),treeView.unselectAllNodes();var sourceParentNode=null;if(sourceNode&&(sourceParentNode=sourceNode.get_parent(),sourceParentNode.get_nodes().remove(sourceNode)),destinationNode&&destinationNode.get_expandMode()!=Telerik.Web.UI.TreeNodeExpandMode.WebService){if(!sourceNode){var item=getGridDataItemById(nodeId);item&&(sourceNode=createNewNode({FolderName:item.ItemName,FolderID:item.ItemID,FolderMappingID:item.FolderMappingID,Permissions:item.Permissions,IconUrl:item.IconUrl,HasChildren:item.HasChildren}))}sourceNode&&(destinationNode.get_nodes().add(sourceNode),initDroppableNode(sourceNode))}else sourceNode&&sourceNode.get_value()==currentFolderId&&(currentFolderId=sourceParentNode.get_value());var selectedNode=treeView.findNodeByValue(currentFolderId);selectedNode&&(selectedNode.select(),null==selectedNode.get_parent()||selectedNode.get_parent().get_expanded()||selectedNode.get_parent().expand()),treeView.commitChanges(),treeViewRefreshScrollbars()}function resetDestinationTreeView(){var rootNode=destinationTreeView.findNodeByValue(rootFolderId),mainRootNode=treeView.findNodeByValue(rootFolderId);rootNode.get_nodes().clear(),copyNodeSettings(rootNode,mainRootNode),cloneNodeRecursive(mainRootNode,rootNode);var selectedNode=destinationTreeView.findNodeByValue(currentFolderId);selectedNode&&selectedNode.select()}function copySelectedItems(){var selectedItems=convertToItemsFromGridItems(grid.get_selectedItems()),selText=selectionText(selectedItems);resetDestinationTreeView();var width=450,height=400;$("#dnnModuleDigitalAssetsSelectDestinationFolderModal").dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",title:resources.copyFilesTitle.replace("[SELECTION]",selText),resizable:!0,width:width,height:height,minWidth:width,minHeight:height,maxWidth:1.5*width,maxHeight:1.5*height,buttons:[{id:"destination_button",text:resources.copyFilesText,click:function(){var destinationFolderId=destinationTreeView.get_selectedNode().get_value();copyItems(selectedItems,destinationFolderId),$(this).dialog("close")},class:"dnnPrimaryAction"},{id:"cancel_button",text:resources.cancelText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}],resize:function(){$("#dnnModuleDigitalAssetsDestinationFolderScroll").jScrollPane()}}),$("#dnnModuleDigitalAssetsDestinationFolderScroll").jScrollPane(),destinationMove=!1,itemsSelectedToMoveOrCopy=selectedItems,checkDestinationButtonState(selectedItems,destinationTreeView.get_selectedNode()),$("#dnnModuleDigitalAssetsAlertItemsSubtext").html(resources.duplicateCopySubtext),$("#dnnModuleDigitalAssetsAlertItemsScroll table").empty()}function copyItems(items,destinationFolderId){for(var ajaxs=[],i=0;i<items.length;i++)items[i].IsFolder||ajaxs.push(copyItem(items[i].ItemId,!1,destinationFolderId,!1));enableLoadingPanel(!0),$.when.apply($,ajaxs).always(function(){destinationFolderId==currentFolderId&&loadFolderFirstPage(currentFolderId),enableLoadingPanel(!1)})}function alertDuplicateItems(itemId,itemName,isFolder,destinationFolderId,replaceFunction){$("#dnnModuleDigitalAssetsAlertItemsSubtext").html(resources.duplicateMoveSubtext);var $table=$("#dnnModuleDigitalAssetsAlertItemsScroll table");$("#dnnModuleDigitalAssetsAlertItems").dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:600,height:330,resizable:!1,title:resources.duplicateFilesExistText,buttons:[{id:"replace_button",text:resources.replaceAllText,click:function(){var ajaxs=[];$table.find("tr").each(function(){var fId=$(this).attr("id"),dDestinationFolderId=$(this).attr("data-destinationFolderId"),dIsFolder="true"==$(this).attr("data-isFolder");ajaxs.push(replaceFunction(fId,dIsFolder,dDestinationFolderId,!0))}),$(this).dialog("close"),$.when.apply($,ajaxs).always(function(){loadFolderFirstPage(currentFolderId)})},class:"dnnSecondaryAction"},{id:"keep_button",text:resources.keepAllText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}],close:function(){$table.empty()}}),$table.append("<tr id='"+itemId+"' data-isFolder='"+isFolder+"' data-destinationFolderId='"+destinationFolderId+"'><td style='width: 100%;'>"+itemName+"</td><td><a href='#' class='replace'>"+resources.replaceText+"</a><a href='#' class='keep'>"+resources.keepText+"</a></td></tr>"),$table.find("tr#"+itemId+" a.replace").click(function(e){removeAlert(itemId),$.when(replaceFunction(itemId,isFolder,destinationFolderId,!0)).always(function(){loadFolderFirstPage(currentFolderId)}),e.preventDefault()}),$table.find("tr#"+itemId+" a.keep").click(function(e){removeAlert(itemId),e.preventDefault()}),$("#dnnModuleDigitalAssetsAlertItemsScroll").jScrollPane()}function removeAlert(itemId){var $table=$("#dnnModuleDigitalAssetsAlertItemsScroll table");$table.find("tr#"+itemId).remove(),$("#dnnModuleDigitalAssetsAlertItemsScroll").jScrollPane(),0==$table.find("tr").length&&$("#dnnModuleDigitalAssetsAlertItems").data("ui-dialog")&&$("#dnnModuleDigitalAssetsAlertItems").dialog("close")}function getUrl(){var items=convertToItemsFromGridItems(grid.get_selectedItems()),itemId=items[0].ItemId;items[0].IsFolder||getUrlFromFileId(itemId)}function showProperties(showCurrent){if(showCurrent)showPropertiesDialog(getCurrentFolderId(),!0);else{var items=convertToItemsFromGridItems(grid.get_selectedItems());items.length>0&&showPropertiesDialog(items[0].ItemId,items[0].IsFolder)}}function getFullUrl(relativePath){return location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+relativePath}function getUrlFromFileId(fileId){$.ajax({type:"POST",url:getContentServiceUrl()+"GetUrl",data:{fileId:fileId},beforeSend:servicesFramework.setModuleHeaders}).done(function(data){var url;url=0==data.indexOf("http://")||0==data.indexOf("https://")?data:getFullUrl(data),openGetUrlModal(url,resources.getFileUrlLabel)}).fail(function(xhr){handledXhrError(xhr,resources.getUrlErrorTitle)})}function openGetUrlModal(url,label){$("#dnnModuleDigitalAssetsGetUrlModal input").val(url).select(),$("#dnnModuleDigitalAssetsGetUrlModal span").text(label),$("#dnnModuleDigitalAssetsGetUrlModal").dialog({modal:!0,autoOpen:!0,dialogClass:"dnnFormPopup",width:500,height:250,resizable:!1,title:resources.getUrlTitle,buttons:[{id:"close_button",text:resources.closeText,click:function(){$(this).dialog("close")},class:"dnnSecondaryAction"}]})}function getTimeStamp(){var timestamp=new Date;return timestamp=timestamp.getTime(),"timestamp="+timestamp}function setTimeStamp(url){return url.indexOf("?")==-1?url+"?"+getTimeStamp():url+"&"+getTimeStamp()}function downloadUrl(url){url+="&forceDownload=true",$idown?$idown.attr("src",url):$idown=$("<iframe>",{id:"idown",src:url}).hide().appendTo("body")}function download(){var items=convertToItemsFromGridItems(grid.get_selectedItems());controller.download(items,{downloadUrl:downloadUrl,showAlertDialog:showAlertDialog,enableLoadingPanel:enableLoadingPanel,getExceptionMessage:getExceptionMessage})}function contextMenuOnItemClicked(sender,args){switch(args.get_item().get_value()){case"Rename":rename();break;case"Download":download();break;case"Delete":deleteSelectedItems();break;case"Unlink":unlinkSelectedItems();break;case"Copy":copySelectedItems();break;case"Move":moveSelectedItems();break;case"GetUrl":getUrl();break;case"UnzipFile":unzipFile();break;case"Properties":showPropertiesDialog(grid.get_selectedItems()[0].get_dataItem().ItemID,grid.get_selectedItems()[0].get_dataItem().IsFolder);break;default:controller.executeCommandOnSelectedItems(args.get_item().get_value(),grid.get_selectedItems())}}function executeCommandOnSelectedItems(commandName){controller.executeCommandOnSelectedItems(commandName,grid.get_selectedItems())}function setView(view){view==listViewMode?(currentView=listViewMode,activeListView(!0),activeGridView(!1)):view==gridViewMode&&(currentView=gridViewMode,activeListView(!1),activeGridView(!0));var state=controller.getCurrentState(grid,currentView);controller.updateModuleState(state),treeViewRefreshScrollbars()}function listViewInitialize(){currentView==listViewMode&&(moreItemsHint(),$(".dnnModuleDigitalAssetsThumbnail > img","#"+controls.scopeWrapperId).each(function(){$(this).attr("src",$(this).attr("data-src"))}),$('#dnnModuleDigitalAssetsListViewContainer input[type="checkbox"]',"#"+controls.scopeWrapperId).dnnCheckbox())}function activeListView(enabled){var button=$("#DigitalAssetsListViewBtnId span","#"+controls.scopeWrapperId),control=$("#dnnModuleDigitalAssetsListViewContainer","#"+controls.scopeWrapperId);activeView(enabled,control,button,settings.listViewActiveImageUrl,settings.listViewInactiveImageUrl),listViewInitialize()}function activeGridView(enabled){var button=$("#DigitalAssetsGridViewBtnId span","#"+controls.scopeWrapperId),control=$("#"+controls.gridId+" > table > thead, #"+controls.gridId+" > table > tbody","#"+controls.scopeWrapperId);activeView(enabled,control,button,settings.gridViewActiveImageUrl,settings.gridViewInactiveImageUrl)}function activeView(enabled,control,button,activeImageUrl,inactiveImageUrl){enabled?(button.css("background-image","url("+activeImageUrl+")"),control.show()):(button.css("background-image","url("+inactiveImageUrl+")"),control.hide())}function listviewOnContextMenu(item,event){var itemIndex=$(item).attr("data-index");event.relatedTarget&&$telerik.isDescendantOrSelf(contextMenu.get_element(),event.relatedTarget)||setupContextMenu(itemIndex,event),$telerik.cancelRawEvent(event)}function listviewOnClick(item,event){var index=$(item).attr("data-index"),dataItem=grid.get_dataItems()[index];if(dataItem){var target=dataItem.get_element(),eventTarget=event.target||event.srcElement;"INPUT"==eventTarget.tagName&&"checkbox"==eventTarget.type?toggleGridItemSelection(dataItem):event.ctrlKey?triggerMouseClick(target,!0,!1,!1):event.shiftKey?triggerMouseClick(target,!1,!1,!0):triggerMouseClick(target,!1,!1,!1)}}function listviewSelectAllOnClick(e){gridSelectUnselectAll.trigger("click")}function toggleColumn(columnName,visible){var index=grid.getColumnByUniqueName(columnName).get_element().cellIndex;visible?grid.showColumn(index):grid.hideColumn(index)}function undoFilterContentPreparation(){$("#dnnModuleDigitalAssetsMainToolbar .folderRequired","#"+controls.scopeWrapperId).show()}function prepareForFilteredContent(hideSync){grid.clearSelectedItems(),toggleColumn("LastModifiedOnDate",!1),toggleColumn("ParentFolder",!settings.isFilteredContent),$("#dnnModuleDigitalAssetsMainToolbar .folderRequired","#"+controls.scopeWrapperId).hide(),hideSync===!0&&$("#dnnModuleDigitalAssetsMainToolbar .DigitalAssetsMenuButton_menu","#"+controls.scopeWrapperId).find("#Sync, #SyncRecursively").addClass("permission_denied"),setupDnnMainToolbarTitles()}function getController(){return controller}function initDragAndDropGridSelection(){for(var items=grid.get_selectedItems(),i=0;i<items.length;i++)if(!checkSinglePermission(items[0].get_dataItem().Permissions,"COPY"))return!1;return!0}function getPathFromNode(node){if(node.get_value()==rootFolderId)return"";for(var text=node.get_text(),n=node.get_parent();null!=n.get_parent().get_parent();n=n.get_parent())text=n.get_text()+"/"+text;return text}function canDropOnItem(item,sourceNode){if(null!=sourceNode){if(sourceNode.get_value()==item.ItemID)return!1;if(!sourceNode.get_parent()||sourceNode.get_parent().get_value()==item.ItemID)return!1;if(!currentFolder||0==currentFolder.FolderPath.indexOf(getPathFromNode(sourceNode)))return!1}return item.IsFolder&&(checkSinglePermission(item.Permissions,"ADD")||checkSinglePermission(item.Permissions,"WRITE"))}function canDropOnNode(sourceNode,node){if(!nodeHasPermission(node,"ADD"))return!1;if(null!=sourceNode)return node.get_value()!=sourceNode.get_parent().get_value()&&!isSubNode(sourceNode.get_value(),node);for(var selectedItems=grid.get_selectedItems(),i=0;i<selectedItems.length;i++)if(selectedItems[i].get_dataItem().ParentFolderID==node.get_value())return!1;return!!checkDestinationPermissions(convertToItemsFromGridItems(selectedItems),node)}function onItemHelper(event,ui){var index=$(event.currentTarget).data("index");return grid.get_dataItems()[index].get_selected()||grid.selectItem(grid.get_dataItems()[index].get_element()),getDragDropHelper(selectionText(convertToItemsFromGridItems(grid.get_selectedItems())))}function getDragDropHelper(text){var dragTip=$("<div class='dnnDragdropTip'></div>");return dragTip.text(resources.moving.replace("[SELECTION]",text)),dragTip}function onItemDragOver(event,ui){var element=$(event.target),index=element.data("index"),dataItem=grid.get_dataItems()[index];if(ui.draggable.is(".rtLI")){var sourceNode=treeView.findNodeByValue(ui.draggable.data("FolderId"));canDropOnItem(dataItem.get_dataItem(),sourceNode)||element.removeClass("dropTarget")}else canDropOnItem(dataItem.get_dataItem())||element.removeClass("dropTarget")}function onItemDrop(event,ui){var index=$(event.target).data("index"),item=grid.get_dataItems()[index].get_dataItem();if(ui.draggable.is(".rtLI")){var sourceNode=treeView.findNodeByValue(ui.draggable.data("FolderId")),sourceItems=[{ItemId:sourceNode.get_value(),IsFolder:!0,ParentFolderId:sourceNode.get_parent().get_value()}];canDropOnItem(item,sourceNode)&&moveItems(sourceItems,item.ItemID)}else canDropOnItem(item)&&moveItems(convertToItemsFromGridItems(grid.get_selectedItems()),item.ItemID)}function initDragAndDrop(){$("#dnnModuleDigitalAssetsListContainer","#"+controls.scopeWrapperId).droppable({addClasses:!1,greedy:!0,accept:".dnnModuledigitalAssetsTreeView .rtLI",hoverClass:"dropTarget",over:function(event,ui){var sourceNode=treeView.findNodeByValue(ui.draggable.data("FolderId"));currentFolder&&canDropOnItem(currentFolder,sourceNode)||$(this).removeClass("dropTarget")},drop:function(event,ui){var sourceNode=treeView.findNodeByValue(ui.draggable.data("FolderId")),sourceItems=[{ItemId:sourceNode.get_value(),IsFolder:!0,ParentFolderId:sourceNode.get_parent().get_value()}];currentFolder&&canDropOnItem(currentFolder,sourceNode)&&moveItems(sourceItems,currentFolder.ItemID)}})}function unzipFile(){var item=convertToItemsFromGridItems(grid.get_selectedItems())[0];enableLoadingPanel(!0),$.ajax({url:getContentServiceUrl()+"UnzipFile",data:{FileID:item.ItemId,Overwrite:!0},type:"POST",beforeSend:servicesFramework.setModuleHeaders}).done(function(data){if(data.InvalidFiles){var title=resources.unzipFilePromptTitle,body=data.InvalidFiles.length>0?resources.unzipFileFailedPromptBody:resources.unzipFileSuccessPromptBody;body=body.replace("[COUNT]",data.InvalidFiles.length).replace("[TOTAL]",data.TotalCount).replace("[TOTAL]",data.TotalCount).replace("[FILELIST]",_generateFileList(data.InvalidFiles)),$.dnnAlert({title:title,text:body,maxHeight:400})}refreshFolder()}).fail(function(xhr){handledXhrError(xhr,resources.unzipFileErrorTitle)}).always(function(){enableLoadingPanel(!1)})}function _generateFileList(files){for(var list="<ul>",i=0;i<files.length;i++)list+="<li>"+files[i]+"</li>";return list+="</ul>"}function initUI(){initDragAndDrop(),settings.isFilteredContent===!0&&($("#DigitalAssetsCreateFolderBtnId").hide(),$("#DigitalAssetsUploadFilesBtnId").removeClass("rightButton").addClass("singleButton")),$("#dnnModuleDigitalAssetsListContainer","#"+controls.scopeWrapperId).mousedown(function(e){2==e.button&&$(e.target).hasClass("emptySpace")&&(emptySpaceContextMenu(e),e.preventDefault())}),_treeViewNeedIntialize&&initTreeviewEvents(),_gridNeedIntialize&&initGridEvents()}function initGridEvents(){initGridSelectAllUnselectAll(grid),$(".dnnModuleDigitalAssetsGrid > table > thead tr th.rgHeader a").attr("href","#"),initializePager();var selectedNode=getSelectedNode();null!=selectedNode&&(currentFolderId=selectedNode.get_value(),setView(settings.view==listViewMode?listViewMode:gridViewMode),grid.set_pageSize(settings.pageSize?settings.pageSize:10),controller.gridOnGridCreated(grid))}function initTreeviewEvents(){var rootNode=treeView.get_nodes().getNode(0);if(rootNode){initDroppableNode(rootNode);var $ul=$("#dnnModuleDigitalAssetsLeftPaneActions","#"+controls.scopeWrapperId);$ul.empty();for(var actions=controller.getLeftPaneActions(settings),i=0,size=actions.length;i<size;i++){var $li=$("<li></li>").attr("id",actions[i].id).text(actions[i].text),actionMethod=actions[i].method;$li.click(function(){var node=treeView.get_selectedNode();node&&node.unselect(),$(this).addClass("selected"),actionMethod()}),$ul.append($li)}}}var fileUpload,searchPattern="",searchProvider=null,gridViewMode="gridview",listViewMode="listview",currentView=gridViewMode,controller,initEvents=[],servicesFramework,contentServiceUrl="",rootFolderId,currentFolderId=-1,currentFolder=null,destinationMove,itemsSelectedToMoveOrCopy,controls,settings,resources,grid,treeView,contextMenu,emptySpaceMenu,destinationTreeView,listView,treeViewContextMenu,refreshMenu,isOnSyncMenuBtn,isOnSyncMenu,gridSelectUnselectAll,_gridNeedIntialize=!1,_treeViewNeedIntialize=!1,currentTab=0,dragAndDropDistance=20,dragAndDropDelay=1e3,loadingPanelProcesses=0,tempBlurEventFunction="tempBlurEventFunction",gridSelectionCheckboxClick=function(event){event.preventDefault();var index=$(this).closest("tr").data("index");toggleGridItemSelection(grid.get_dataItems()[index])},toggleGridItemSelection=function(item){item.get_selected()?grid.deselectItem(item.get_element()):grid.selectItem(item.get_element())},updateSelectionToolBarTimeout,moveItem=function(itemId,isFolder,destinationFolderId,overwrite){return $.ajax({type:"POST",url:getContentServiceUrl()+(isFolder?"MoveFolder":"MoveFile"),data:{itemId:itemId,destinationFolderId:destinationFolderId,overwrite:overwrite},beforeSend:servicesFramework.setModuleHeaders}).done(function(data){data.AlreadyExists?alertDuplicateItems(itemId,data.ItemName,isFolder,destinationFolderId,moveItem):(removeAlert(itemId),isFolder&&moveNode(itemId,destinationFolderId))}).fail(function(xhr){handledXhrError(xhr,resources.moveError)})},copyItem=function(itemId,isFolder,destinationFolderId,overwrite){return $.ajax({type:"POST",url:getContentServiceUrl()+"CopyFile",data:{itemId:itemId,destinationFolderId:destinationFolderId,overwrite:overwrite},beforeSend:servicesFramework.setModuleHeaders}).done(function(data){data.AlreadyExists?alertDuplicateItems(itemId,data.ItemName,isFolder,destinationFolderId,copyItem):removeAlert(itemId)}).fail(function(xhr){handledXhrError(xhr,resources.copyError)})},$idown,dndTreeExpandTimeout;return{init:init,initEvents:initEvents,toggleLeftPane:toggleLeftPane,destinationTreeViewOnNodeExpanding:destinationTreeViewOnNodeExpanding,destinationTreeViewRefreshScrollbars:destinationTreeViewRefreshScrollbars,destinationTreeViewOnNodeClicking:destinationTreeViewOnNodeClicking,destinationTreeViewOnLoad:destinationTreeViewOnLoad,treeViewOnNodeExpanding:treeViewOnNodeExpanding,treeViewOnNodeCollapsing:treeViewOnNodeCollapsing,treeViewOnNodeClicking:treeViewOnNodeClicking,treeViewOnContextMenuItemClicking:treeViewOnContextMenuItemClicking,treeViewOnNodeEditing:treeViewOnNodeEditing,treeViewOnContextMenuShowing:treeViewOnContextMenuShowing,treeViewOnContextMenuShown:onContextMenuShown,treeViewOnLoad:treeViewOnLoad,treeViewContextMenuOnLoad:treeViewContextMenuOnLoad,treeViewContextMenuOnHiding:treeViewContextMenuOnHiding,treeViewRefreshScrollbars:treeViewRefreshScrollbars,gridOnGridCreated:gridOnGridCreated,gridOnCommand:gridOnCommand,gridOnRowContextMenu:gridOnRowContextMenu,gridOnRowSelected:gridOnRowSelected,gridOnRowDeselected:gridOnRowDeselected,gridOnRowDataBound:gridOnRowDataBound,gridOnDataBound:gridOnDataBound,gridOnColumnHidden:gridOnColumnHidden,contextMenuOnItemClicked:contextMenuOnItemClicked,contextMenuOnLoad:contextMenuOnLoad,contextMenuOnShown:onContextMenuShown,listviewOnContextMenu:listviewOnContextMenu,listviewOnClick:listviewOnClick,listViewOnCreated:listViewOnCreated,emptySpaceMenuOnLoad:emptySpaceMenuOnLoad,emptySpaceMenuOnItemClicked:emptySpaceMenuOnItemClicked,createFolder:createFolder,uploadFiles:uploadFiles,refreshFolder:refreshFolder,showPropertiesFromAction:showPropertiesFromAction,deleteSelectedItems:deleteSelectedItems,copySelectedItems:copySelectedItems,moveSelectedItems:moveSelectedItems,download:download,rename:rename,getUrl:getUrl,setView:setView,showProperties:showProperties,unzipFile:unzipFile,highlightItemName:highlightItemName,getController:getController,prepareForFilteredContent:prepareForFilteredContent,itemsDatabind:itemsDatabind,enableLoadingPanel:enableLoadingPanel,refresFolderFromMenu:refresFolderFromMenu,syncFromMenu:syncFromMenu,onOpeningRefreshMenu:onOpeningRefreshMenu,showDialog:showDialog,closeDialog:closeDialog,getExceptionMessage:getExceptionMessage,showAlertDialog:showAlertDialog,isXhrHandled:isXhrHandled,getReducedItemName:getReducedItemName,getCurrentFolderId:getCurrentFolderId,setCurrentFolder:setCurrentFolder,folderTypeComboBoxOnSelectedIndexChanged:folderTypeComboBoxOnSelectedIndexChanged,executeCommandOnSelectedItems:executeCommandOnSelectedItems,setSearchProvider:setSearchProvider,getSearchProvider:getSearchProvider,getRootFolderId:getRootFolderId,createModuleState:createModuleState,openGetUrlModal:openGetUrlModal,loadInitialContent:loadInitialContent,getFullUrl:getFullUrl,setupDnnMainToolbarTitles:setupDnnMainToolbarTitles,unlinkSelectedItems:unlinkSelectedItems}}(jQuery,$find,$telerik,dnnModal);