function Gallery(d){var a={rowId:0,index:1,pageSize:10,orderBy:"",orderDir:"",thenBy:"",thenDir:"asc",animationSpeed:"slow",pageIdx:1,pageSze:10,smoothScrolling:!0,extensions:new Object,action:"filter",extensionFilter:"module",tagFilter:"",tagFilterName:"",ownerFilter:"",tags:new Object,loadTags:!0,pagedExtensions:new Object,protocol:"https:"==location.protocol?"https://":"http://",host:"catalog.dotnetnuke.com",ServiceRoot:"/AppGalleryService.svc",DataBaseVersion:"06.00.00",ExtensionServiceName:"/Extensions",TagsServiceName:"/Tags",TagCloudServiceName:"/GetTagCloudData",CatalogServiceName:"/Catalogs",ExtensionSearchName:"/SearchExtensions",extensionDetailDialog:$("#extensionDetail").dialog(this.DefaultDialogOptions),loading:$("#loading"),NameTextASC:"Name: A-Z",NameTextDESC:"Name: Z-A",PriceTextASC:"Price: High to Low",PriceTextDESC:"Price: Low to High",TagCount:50,CacheTimeoutMinutes:1440,searchFilters:$("#searchFilters"),tagLabel:"Tag",searchLabel:"Search",vendorLabel:"Vendor",typeLabel:"Type",noneLabel:"None",orderLabel:"Order:",errorLabel:"Error...",loadingLabel:"Loading...",BaseDownLoadUrl:"",searchText:""};d&&$.extend(a,d);for(var b in a)a.hasOwnProperty(b)&&(this[b]=a[b]);if(this.extensionList=$("#extensionList"),this.smoothScrolling){new Scroller(100,!1,function(e){_gallery.index++,_gallery.action="page",_gallery.Search()}).watch()}this.ExtensionsUrl=this.getServiceUrl(this.ExtensionServiceName),this.TagCloudUrl=this.getServiceUrl(this.TagCloudServiceName),this.TagsUrl=this.getServiceUrl(this.TagsServiceName),this.CatalogsUrl=this.getServiceUrl(this.CatalogServiceName),this.SearchUrl=this.getServiceUrl(this.ExtensionSearchName),this.Cache=new Cache("_Gallery_",this.CacheTimeoutMinutes),$("#tag-list").click(function(f){return f=f||window.event,_gallery.TagFilterGallery(f,this),!1}),$("#search-reset").click(function(f){return f=f||window.event,$("#searchText").val(""),_gallery.tagFilter="",_gallery.tagFilterName="",_gallery.ownerFilter="",_gallery.orderBy="Title",_gallery.orderDir="asc",_gallery.extensionFilter="module",$("#typeDDL").val("module"),_gallery.SearchGallery(""),_gallery.getTags(),!1}),$("#searchText").change(function(f){return f=f||window.event,_gallery.SearchGallery($("#searchText").val()),!1}),$(document).keydown(function(f){f=f||window.event,13==f.which&&(window.stop?window.stop():document.execCommand("stop"),f.stopPropagation(),f.preventDefault(),_gallery.SearchGallery($("#searchText").val()))}),$("#searchText").keyup(function(f){return f=f||window.event,27==f.which&&$("#search-reset").click(),!1}),$("#search-go").click(function(f){return f=f||window.event,_gallery.SearchGallery($("#searchText").val()),!1}),$("#NameSorter").click(function(f){return f=f||window.event,_gallery.SortExtensions("Title"),!1}),$("#PriceSorter").click(function(f){return f=f||window.event,_gallery.SortExtensions("Price"),!1})}"undefined"==typeof dnn&&(dnn={}),"undefined"==typeof dnn.log&&(dnn.log=function(){for(var b in arguments)"undefined"!=typeof console&&"undefined"!=typeof console.log&&console.log(arguments[b])}),Gallery.prototype.resolveImage=function(a){var b=a;return 0==a.indexOf("~")&&(b=this.siteRoot+a.substr(2)),b},Gallery.prototype.showLoading=function(b){this.reposition(),this.loading.css("background-color",""),this.loading.text(this.loadingLabel),this.loading.show()},Gallery.prototype.hideLoading=function(b){this.loading.hide()},Gallery.prototype.errorLoading=function(b){this.loading.css("background-color","red"),this.loading.text(this.errorText),this.loading.attr("title",b[0].statusText),this.loading.attr("alt",b[0].statusText)},Gallery.prototype.reposition=function(){var a=$(window);this.loading.css("top",a.scrollTop()),this.loading.css("left",a.width()/2-this.loading.width()/2)},Gallery.prototype.SortExtensions=function(b,a){if(this.index=1,this.action="sort",a?(this.orderBy=b,this.orderDir=a):this.ToggleSort(b),this.orderBy&&this.orderDir){var d=$("#NameSorter"),c=$("#PriceSorter");"Title"==this.orderBy?"asc"==this.orderDir?d.text(this.NameTextDESC):d.text(this.NameTextASC):"Price"==this.orderBy&&("asc"==this.orderDir?c.text(this.PriceTextDESC):c.text(this.PriceTextASC))}return this.Search()},Gallery.prototype.ToggleSort=function(a){this.orderBy!==a&&(this.thenBy=this.orderBy,this.thenDir=this.orderDir,this.orderBy=a,this.orderDir=""),this.orderDir&&""!==this.orderDir&&"desc"!=this.orderDir?this.orderDir="desc":this.orderDir="asc"},Gallery.prototype.SearchGallery=function(a){return this.action="search",a?this.searchText=a:this.searchText="",this.index=1,this.Search()},Gallery.prototype.OwnerFilterGallery=function(a){return this.action="filter",a&&(this.ownerFilter=a),this.index=1,this.Search()},Gallery.prototype.TagFilterGallery=function(d,a){d=d||window.event;var c=$(d.srcElement||d.target),b=c.attr("tagId");return this.action="filter",b&&(this.tagFilter=b,this.tagFilterName=c.html()),this.index=1,this.Search()},Gallery.prototype.FilterGallery=function(b,c){var a=$(b.srcElement||b.target).attr("value");return this.action="filter",a&&(this.extensionFilter=a),this.getTags(),this.index=1,this.Search()},Gallery.prototype.FilterGallery2=function(a){return this.action="filter",a&&(this.extensionFilter=a),this.getTags(),this.index=1,this.Search()},Gallery.prototype.Search=function(){return this.getExtensions(),this},Gallery.prototype.getServiceUrl=function(a){return this.protocol+this.host+this.ServiceRoot+a},Gallery.prototype.getExtensions=function(g){var f=this.tagLabel+" ",a="",e="",c=(this.index-1)*this.pageSize,d=c>0;if(this.tagFilter&&""!==this.tagFilter?(a=this.TagsUrl+"("+this.tagFilter+")/ExtensionTags/?$expand=Extension",e="Extension/",f+=this.tagFilterName,d=!0):(a=this.ExtensionsUrl+"?",f+=this.noneLabel),f=f+", "+this.searchLabel+" ",a+="&$inlinecount=allpages&$skip="+c+"&$top="+this.pageSize,this.searchText&&""!==this.searchText?(a=a+"&$filter="+encodeURIComponent("(substringof('"+this.searchText+"', "+e+"ExtensionName) eq true or substringof('"+this.searchText+"', "+e+"Description) eq true or substringof('"+this.searchText+"', "+e+"Title) eq true)"),f+=this.searchText,d=!0):f+=this.noneLabel,f=f+", "+this.typeLabel+" ",this.extensionFilter&&""!==this.extensionFilter&&"all"!==this.extensionFilter?("module"==this.extensionFilter?f+="Module":(d=!0,f+="Skin"),a+=a.indexOf("$filter")<0?"&$filter=":"and ",a=a+""+e+"ExtensionType eq '"+this.extensionFilter+"'"):(d=!0,f+="All"),f=f+", "+this.vendorLabel+" ",this.ownerFilter&&""!==this.ownerFilter?(f+=this.ownerFilter,a+=a.indexOf("$filter")<0?"&$filter=":"and ",a+=encodeURIComponent(""+e+"OwnerName eq '"+this.ownerFilter+"'"),d=!0):f+=this.noneLabel,this.DataBaseVersion&&""!==this.DataBaseVersion?(a+=a.indexOf("$filter")<0?"&$filter=":"and ",a+=encodeURIComponent(""+e+"MinDnnVersion lt '"+this.DataBaseVersion+"'")):f+=this.noneLabel,f=f+", "+this.orderLabel+" ",""!==this.orderBy?(a=a+"&$orderby="+encodeURIComponent(e+""+this.orderBy+" "+this.orderDir),"Title"==this.orderBy?"asc"==this.orderDir?f+=this.NameTextASC:(d=!0,f+=this.NameTextDESC):(d=!0,f+="asc"==this.orderDir?this.PriceTextASC:this.PriceTextDESC)):f+=this.noneLabel,""!==this.thenBy&&(a=a+","+encodeURIComponent(e+""+this.thenBy+" "+this.thenDir),"Title"==this.thenBy?"asc"==this.thenDir?f=f+", "+this.NameTextASC:(d=!0,f=f+", "+this.NameTextDESC):(d=!0,f="asc"==this.thenDir?f+", "+this.PriceTextASC:f+", "+this.PriceTextDESC)),this.searchFilters.text(f),a+="&$format=json",!_gallery.extensions.d||!d){var b=this.Cache.getItem("__FIRSTLOAD");if(b)return void Gallery.gotExtensions(b)}dnn.log(a),this.showLoading(),this.eXHR=this.getXHR(a,"gotExtensions")},Gallery.gotExtensions=function(){var e=arguments[0],d=_gallery;if(e&&e.d&&e.d.results)for(var b in e.d.results){var c=e.d.results[b];"undefined"!=typeof c.Extension?c.Extension.Catalog=d.getCatalog(c.Extension.CatalogID):c.Catalog=d.getCatalog(c.CatalogID)}if(_gallery.Cache.hasItem("__FIRSTLOAD")||_gallery.Cache.setItem("__FIRSTLOAD",e),e.d.results.length>0&&"undefined"!=typeof e.d.results[0].Extension)for(var a in e.d.results)for(var b in e.d.results[a].Extension)e.d.results[a].Extension.hasOwnProperty(b)&&(e.d.results[a][b]=e.d.results[a].Extension[b]);_gallery.pagedExtensions=e.d.results,_gallery.extensions&&_gallery.extensions.d&&_gallery.extensions.d.results&&"search"!=_gallery.action&&"filter"!=_gallery.action&&"sort"!=_gallery.action?_gallery.extensions.d.results=_gallery.extensions.d.results.concat(e.d.results):_gallery.extensions=e,_gallery.showExtensions(function(){}),_gallery.hideLoading()},Gallery.prototype.showExtensions=function(b){if(this.pageCount=Math.ceil(this.extensions.d.__count/this.pageSize),this.smoothScrolling||this.extensionList.empty(),"search"!=this.action&&"filter"!=this.action&&"sort"!=this.action||this.extensionList.empty(),this.pagedExtensions.length>0){var a=$("#eTmpl").tmpl(this.pagedExtensions);a.appendTo(this.extensionList).hide(),this.extensionList.children().fadeIn(this.animationSpeed)}this.pagedExtensions=[],b&&b(this)},Gallery.prototype.getExtensionById=function(c){if(this.extensions&&this.extensions.d)for(var b=this.extensions.d.results,a=b.length;a--;a>=0)if(b[a].ExtensionID==c)return b[a]},Gallery.prototype.FormatCurrency=function(a){a=a.toString().replace(/\$|\,/g,""),isNaN(a)&&(a="0"),sign=a==(a=Math.abs(a)),a=Math.floor(100*a+.50000000001),cents=a%100,a=Math.floor(a/100).toString(),cents<10&&(cents="0"+cents);for(var b=0;b<Math.floor((a.length-(1+b))/3);b++)a=a.substring(0,a.length-(4*b+3))+","+a.substring(a.length-(4*b+3));return(sign?"":"-")+"$"+a+"."+cents},Gallery.prototype.DefaultDialogOptions={modal:!0,autoOpen:!1,width:800,height:600,resizable:!0,closeOnEscape:!0},Gallery.prototype.getDownloadUrl=function(a){return this.BaseDownLoadUrl.replace(escape("{{ExtensionID}}"),a).replace("{{ExtensionID}}",a)},Gallery.prototype.ShowDetails=function(c){var b=this.getExtensionById(c);if(b){var a=$("#extensionDetailInner");a.empty(),$("#extDetailTmpl").tmpl(b).appendTo(a),$("#extensionDetail-tabs").tabs(),this.extensionDetailDialog.dialog({title:b.ExtensionName}),this.extensionDetailDialog.dialog("open")}return!1},Gallery.prototype.getCatalog=function(b){for(var a in this.cats.d)if(this.cats.d[a].CatalogID==b)return this.cats.d[a];return null},Gallery.gotCatalogs=function(b){var b=arguments[0],a=_gallery;a.cats=b,_gallery.Cache.hasItem("catalogs")||_gallery.Cache.setItem("catalogs",b)},Gallery.prototype.getCatalogs=function(c){var b=this.CatalogsUrl;b+="?$format=json";var a=this.Cache.getItem("catalogs");return a?(Gallery.gotCatalogs(a),void("undefined"!=typeof c&&$.isFunction(c)&&c())):(this.showLoading(),dnn.log(b),this.tagXHR=this.getXHR(b,"gotCatalogs"),void("undefined"!=typeof c&&$.isFunction(c)&&this.tagXHR.complete(function(){c()})))},Gallery.prototype.getTags=function(d){var a=this.TagCount?this.TagCount:15,c=this.TagCloudUrl+"?Tagcount="+a;c=c+"&ExtensionType='"+this.extensionFilter+"'",c+="&MinDnnVersion=''",c+="&$format=json";var b=this.Cache.getItem("tags_"+this.extensionFilter);return b?(_gallery.tags=b.sort(Gallery.tagSort),_gallery.loadTags=!1,void _gallery.showTags()):(this.showLoading(),dnn.log(c),void(this.tagXHR=this.getXHR(c,"gotTags")))},Gallery.gotTags=function(a){_gallery.resolveTags(a)},Gallery.prototype.resolveTags=function(h){var d,f=new Array,b=h.d.length-1,c=0,g=250,e=75,a=0;for(a=b;a>=0;a--)d=h.d[a],Gallery.validTag(d)&&(d.TagCount>c&&(c=d.TagCount),f.push(d));b=f.length;for(a in f)d=f[a],d.fontSize=(d.TagCount/c*g).toFixed(2),d.fontSize<e&&(d.fontSize=e);this.loadTags=!1,this.tags=f.sort(Gallery.tagSort),this.Cache.setItem("tags_"+this.extensionFilter,_gallery.tags),this.showTags(),this.hideLoading()},Gallery.tagSort=function(d,c){var f=d.tagName.toLowerCase(),e=c.tagName.toLowerCase();return f<e?-1:f>e?1:0},Gallery.prototype.showTags=function(c){var a=$("#tag-list"),b=$("#tag-tmpl");a.empty(),this.tags?(b.tmpl(this.tags).appendTo(a),a.fadeIn(this.animationSpeed)):a.fadeOut(this.animationSpeed),c&&c(this)},Gallery.validTag=function(a){return a&&a.tagName&&a.tagName.indexOf("DotNetNuke")<0&&a.TagCount>0},Gallery.prototype.getXHR=function(a,b){return $.getJSON(a+"&$callback=?",Gallery[b]).error(function(){_gallery.errorLoading(arguments)})},Cache=function(a,d,c,b){return this.StorageType=c||"localStorage","localStorage"==this.StorageType&&"sessionStorage"==this.StorageType&&"globalStorage"==this.StorageType||(this.StorageType="localStorage"),this.Scope=a||"",this.TimeoutInMinutes=d,this.expireCallback=b,this.loadStore(),Cache.isEnabled="undefined"!=typeof this.store&&"undefined"!=typeof JSON&&("undefined"==typeof this.TimeoutInMinutes||"undefined"!=typeof this.TimeoutInMinutes&&this.TimeoutInMinutes>0),Cache.isEnabled&&"undefined"!=typeof this.TimeoutInMinutes&&($(document).ready(function(){Cache.ClearInterval()}),this.cacheExpire=window.setInterval(Cache.ClearInterval,6e4*d,this)),this},Cache.isEnabled=!1,Cache.prototype.loadStore=function(){switch(this.StorageType){case"globalStorage":try{window.globalStorage&&(this.store=window.globalStorage[window.location.hostname])}catch(a){}break;case"sessionStorage":try{window.sessionStorage&&(this.store=window.sessionStorage)}catch(b){}break;default:try{window.localStorage&&(this.store=window.localStorage)}catch(b){}}return this},Cache.ClearInterval=function(b){if("undefined"==typeof b&&(b=_gallery.Cache),"undefined"!=typeof b.TimeoutInMinutes)if(b.hasItem(b.Scope+"_expire")){var c=b.getItem(b.Scope+"_expire"),a=(new Date-Date.parse(c))/6e4;a>b.TimeoutInMinutes&&(b.EmptyCache(),"undefined"!=typeof b.expireCallback&&b.expireCallback(i))}else b.setItem(b.Scope+"_expire",new Date);return this},Cache.prototype.EmptyCache=function(){var a,c;try{for(c in this.store)this.store.hasOwnProperty(c)&&c.substr(0,this.Scope.length)==this.Scope&&this.store.removeItem(c)}catch(d){try{for(a=this.store.length-1,x=a;x>=0;x--)c=this.store[x],this.store.hasOwnProperty(c)&&c.substr(0,this.Scope.length)==this.Scope&&this.store.removeItem(c)}catch(b){this.store.clear()}}return this},Cache.prototype.hasItem=function(a){var b;return!!Cache.isEnabled&&(b=this.store.getItem(this.Scope+a),b&&null!==b&&!("undefined"==typeof b))},Cache.prototype.getItem=function(b){var f,a;if(Cache.isEnabled){f=this.store.getItem(this.Scope+b);try{a=$.parseJSON(f)}catch(c){this.store.removeItem(this.Scope+b)}}return a},Cache.prototype.setItem=function(a,b){return Cache.isEnabled&&this.store.setItem(this.Scope+a,JSON.stringify(b)),this},Scroller=function(b,c,a){this.page=1,this.maxPage=b?b:100,this.loadScroll="undefined"!=typeof c&&c,this.scrollcallback=a,this.loadScroll&&this.loadScroller()},Scroller.prototype.handleScroll=function(){this.page++,this.scrollcallback&&this.scrollcallback(this),this.page>=this.maxPage&&this.unwatch()},Scroller.prototype.loadScroller=function(){for(var a=!0;a;)a=$(window).scrollTop()>=$(document).height()-$(window).height(),a&&this.handleScroll(),this.page>=this.maxPage&&(a=!1)},Scroller.prototype.watch=function(){window.Scroller=this;var a=$(window);a.scroll||(a=$(document)),a.scroll(function(){var b=window.Scroller;$(window).scrollTop()>=$(document).height()-$(window).height()&&b.handleScroll()})},Scroller.prototype.unwatch=function(){$(document).unbind("scroll")},Math.random.range=function(c,b,a){return"undefined"==typeof a&&a||(c-=1),b+=1,Math.floor(b+(1+c-b)*Math.random())};