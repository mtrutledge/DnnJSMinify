!function($){$.fn.previewEmulator=function(options){var handler=this;if(handler.data("previewEmulator"))return handler.data("previewEmulator");var hDimension=this.find(".dimension_h"),vDimension=this.find(".dimension_v"),viewContainer=this.find(".emulator_c"),viewAddr=this.find(".emulator_addr"),viewer=this.find("iframe"),sendAgent=!0,bindElement=function(){viewContainer=handler.find(".emulator_c"),viewer=handler.find("iframe"),viewContainer.scroll(),viewContainer.bind("resize",function(e){var width=$(this).width(),height=$(this).height();hDimension.width(width),vDimension.height(height),viewAddr.width(width);var hContentWidth=width-hDimension.find(".left").width()-hDimension.find(".right").width();hDimension.find(".center").width(hContentWidth).html(width+"px");var vContentHeight=height-vDimension.find(".top").height()-vDimension.find(".bottom").height();vDimension.find(".middle").height(vContentHeight).css("line-height",vContentHeight+"px").html(height+"px"),viewer.width()<viewContainer.width()&&viewer.width(viewContainer.width()),viewer.height()<viewContainer.height()&&viewer.height(viewContainer.height()),$(this).scroll()}),viewer.bind("load",function(){var frameWin=this.contentWindow,frameDoc=frameWin.document,body=void 0!=frameDoc.documentElement?frameDoc.documentElement:frameDoc.body,width=body.scrollWidth,height=body.scrollHeight;$(this).width(width).height(height),viewAddr.html(frameWin.dnnPreviewUrl),viewContainer.trigger("resize")})};bindElement();var updateViewer=function(userAgent){var url=location.href+(location.href.indexOf("?")>-1?"&":"?")+"UserAgent="+userAgent+"&SendAgent="+sendAgent;viewer.attr("src",url)};return this.setPreview=function(width,height,userAgent){updateViewer(userAgent),viewContainer.width(width).height(height),viewContainer.trigger("resize")},this.showDimension=function(show){var visible=show?"visible":"hidden";hDimension.css("visibility",visible),vDimension.css("visibility",visible)},this.previewWithAgent=function(send){sendAgent=send},hDimension.html('<span class="left"></span><span class="center"></span><span class="right"></span>'),vDimension.html('<span class="top"></span><span class="middle"></span><span class="bottom"></span>'),handler.data("previewEmulator",this),this},$.fn.scroll=function(options){var handler=this,scrollTemplate='<div class="scroll" unselectable="on"><div class="bar" unselectable="on"></div></div>',mask=$('<div class="mask"></div'),hScroll=this.find(".horizontal"),vScroll=this.find(".vertical"),contentArea=this.find("iframe");0==hScroll.length&&(hScroll=$(scrollTemplate).addClass("horizontal").appendTo(handler)),0==vScroll.length&&(vScroll=$(scrollTemplate).addClass("vertical").appendTo(handler));var hScrollBar=hScroll.find(".bar"),vScrollBar=vScroll.find(".bar"),init=function(){initVScroll(),initHScroll(),initHandler()},initHandler=function(){handler.attr("unselectable","on"),scrollTo(0,0),contentArea.width()<=handler.width()?hScroll.hide():hScroll.show(),contentArea.height()<=handler.height()?vScroll.hide():vScroll.show()},initVScroll=function(){vScroll.height(handler.height()-hScroll.height()),handler.data("viewHeight",handler.height()-hScroll.height()),vScrollBar.height(parseInt(handler.data("viewHeight")/contentArea.height()*vScroll.height())),vScrollBar.unbind("mousedown").mousedown(function(e){startDragOnY($(this),e)})},initHScroll=function(){hScroll.width(handler.width()-vScroll.width()),handler.data("viewWidth",handler.width()-vScroll.width()),hScrollBar.width(parseInt(handler.data("viewWidth")/contentArea.width()*hScroll.width())),0===hScroll.next(".status").length&&hScroll.after('<div class="status"></div>'),hScrollBar.unbind("mousedown").mousedown(function(e){startDragOnX($(this),e)})},startDragOnY=function(bar,event){initDrag(bar),bar.data("position",event.pageY),$(document).mousemove(function(e){if(void 0!==bar.data("position")&&null!==bar.data("position")){var offset=e.pageY-bar.data("position");scrollOnY(offset),bar.data("position",e.pageY)}}).mouseup(function(e){endDrag(bar)})},startDragOnX=function(bar,event){initDrag(bar),bar.data("position",event.pageX),$(document).mousemove(function(e){if(void 0!==bar.data("position")&&null!==bar.data("position")){var offset=e.pageX-bar.data("position");scrollOnX(offset),bar.data("position",e.pageX)}}).mouseup(function(e){endDrag(bar)})},initDrag=function(bar){mask.appendTo(handler).width(handler.data("viewWidth")).height(handler.data("viewHeight")).css({opacity:0})},endDrag=function(bar){bar.data("position",null),$(document).unbind(),mask.remove()},scrollOnY=function(offset){var margin=parseInt(vScrollBar.css("top"))+offset;if(margin>=0&&margin<=vScroll.height()-vScrollBar.height()){vScrollBar.css({top:margin+"px"});var percent=margin/(vScroll.height()-vScrollBar.height()),contentTop=(contentArea.height()-handler.data("viewHeight"))*percent*-1;contentArea.css({top:contentTop+"px"})}},scrollOnX=function(offset){var margin=parseInt(hScrollBar.css("left"))+offset;if(margin>=0&&margin<=hScroll.width()-hScrollBar.width()){hScrollBar.css({left:margin+"px"});var percent=margin/(hScroll.width()-hScrollBar.width()),contentLeft=(contentArea.width()-handler.data("viewWidth"))*percent*-1;contentArea.css({left:contentLeft+"px"})}},scrollTo=function(x,y){var offsetX=x-parseInt(hScrollBar.css("margin-left"));scrollOnX(offsetX);var offsetY=y-parseInt(vScrollBar.css("margin-top"));scrollOnY(offsetY)};return init(),this.data("scroll","initialed"),this}}(jQuery);