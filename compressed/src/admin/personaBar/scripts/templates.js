define(["jquery","knockout","knockout.mapping","knockout.validation.min","../scripts/templatesCreateManager","jquery-ui.min","../scripts/koBindingHandlers/jScrollPane","../scripts/koBindingHandlers/slideToggleVisible","dnn.jquery","dnn.extensions","dnn.jquery.extensions","jquery.tokeninput","dnn.jScrollBar","css!../css/pages-settings.css","css!../css/pages-hierarchy.css","css!../css/tags-input.css","css.jScrollBar"],function($,ko,koMapping,validation,templatesCreateManager){"use strict";var koBinded,isMobile,utility,container,init,initMobile,load,loadMobile,addEventListeners,onHidePanelClick,changeView,initializeView,showPagesList,callPageSettings;koBinded=!1,isMobile=!1,utility=null,container=null,ko.mapping=koMapping;var creationManager=templatesCreateManager;return init=function(wrapper,util,params,callback){utility=util,container=wrapper,addEventListeners(),"undefined"!=typeof dnn&&"undefined"!=typeof dnn.dnnTemplatesHierarchy||(window.Sys=window.Sys?window.Sys:window.top.Sys,window.dnn=window.dnn?window.dnn:window.top.dnn),creationManager.init(utility.sf,utility.resx.ContentPB),changeView(),"function"==typeof callback&&callback()},initMobile=function(wrapper,util,params,callback){isMobile=!0,this.init(wrapper,util,params,callback)},load=function(params,callback){creationManager.refreshConfiguration(),changeView(),dnn&&dnn.dnnTemplatesHierarchy&&dnn.dnnTemplatesHierarchy.load()},loadMobile=function(params,callback){isMobile=!0,this.load(params,callback)},onHidePanelClick=function(e){"undefined"!=typeof dnn.dnnTemplatesHierarchy&&dnn.dnnTemplatesHierarchy.hasPendingChanges()&&dnn.dnnTemplatesHierarchy.handlePendingChanges(e)},addEventListeners=function(){$("#topLevelMenu .personabarnav li, #topLevelMenu .hovermenu ul li").click(onHidePanelClick).each(function(){var events=$._data(this,"events").click,first=events.pop();events.splice(0,0,first)})},changeView=function(action){var initView,params;return"undefined"==typeof action?(initView=container.data("init-view"))?(container.data("init-view",null),void changeView(initView)):void initializeView():(params=container.data("init-view-params"),container.data("init-view-params",null),void initializeView(function(){switch(action){case"edit":this._closePersonaBarOnUpdate=!0,callPageSettings("edit",params)}}))},initializeView=function(callback){setTimeout(function(){showPagesList(callback)},100)},showPagesList=function(callback){"undefined"==typeof dnn.dnnTemplatesHierarchy?window.require(["../templatesHierarchy"],function(){dnn.dnnTemplatesHierarchy=dnn.dnnTemplatesHierarchy||{},dnn.dnnTemplatesHierarchy.resx=utility.resx.ContentPB,dnn.dnnTemplatesHierarchy.utility=utility,dnn.dnnTemplatesHierarchy._viewModel=creationManager.getViewModel(),dnn.dnnTemplatesHierarchy.init(callback,creationManager.onDeleteCallback),$(window).trigger("resize")}):("function"==typeof callback&&callback.call(dnn.dnnTemplatesHierarchy),$(window).trigger("resize"))},{init:init,load:load,initMobile:initMobile,loadMobile:loadMobile}});