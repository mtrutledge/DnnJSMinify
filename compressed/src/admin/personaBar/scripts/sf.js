"use strict";define(["jquery"],function($){var cmxLoaded=!1,cmxLoading=function(loadingbarId){if(!cmxLoaded){var loadingbar=$(loadingbarId),progressbar=$(loadingbarId+" > div"),width=loadingbar.width();loadingbar.show(),progressbar.css({width:0}).animate({width:.75*width},300,"linear",function(){var checkloaded=function(){cmxLoaded?(cmxLoaded=!1,clearTimeout(checkloaded),checkloaded=null,progressbar.animate({width:width},100,"linear",function(){loadingbar.hide()})):setTimeout(checkloaded,20)};checkloaded()})}};return{init:function(siteRoot,tabId,antiForgeryToken,loadingbarId){return{moduleRoot:"dnncorp/personaBar",controller:"",antiForgeryToken:antiForgeryToken,setHeaders:function(xhr){tabId&&xhr.setRequestHeader("TabId",tabId),antiForgeryToken&&xhr.setRequestHeader("RequestVerificationToken",antiForgeryToken)},getServiceRoot:function(){var self=this;return siteRoot+"DesktopModules/"+self.moduleRoot+"/API/"},getSiteRoot:function(){return siteRoot},rawCall:function(httpMethod,url,params,success,failure,loading,beforeSend,sync,silence){var beforeCallback,self=this;beforeCallback="function"==typeof beforeSend?function(xhr){return self.setHeaders(xhr),beforeSend(xhr)}:self.setHeaders;var options={url:url,beforeSend:beforeCallback,type:httpMethod,async:0==sync,success:function(d){loadingbarId&&!silence&&(cmxLoaded=!0),"function"==typeof loading&&loading(!1),"function"==typeof success&&success(d||{})},error:function(xhr,status,err){loadingbarId&&!silence&&(cmxLoaded=!0),"function"==typeof loading&&loading(!1),"function"==typeof failure&&(xhr?failure(xhr,err):failure(null,"Unknown error"))}};return"GET"==httpMethod?options.data=params:(options.contentType="application/json; charset=UTF-8",options.data=JSON.stringify(params),options.dataType="json"),"function"==typeof loading&&loading(!0),loadingbarId&&!silence&&cmxLoading(loadingbarId),$.ajax(options)},call:function(httpMethod,method,params,success,failure,loading,beforeSend,sync,silence){var self=this,url=self.getServiceRoot()+self.controller+"/"+method;return self.moduleRoot="dnncorp/personaBar",self.controller="",this.rawCall(httpMethod,url,params,success,failure,loading,beforeSend,sync,silence)},post:function(method,params,success,failure,loading,beforeSend){return this.call("POST",method,params,success,failure,loading,beforeSend,!1,!1)},postsilence:function(method,params,success,failure,loading,beforeSend){return this.call("POST",method,params,success,failure,loading,beforeSend,!1,!0)},get:function(method,params,success,failure,loading,beforeSend){return this.call("GET",method,params,success,failure,loading,beforeSend,!1,!1)},getsilence:function(method,params,success,failure,loading,beforeSend){return this.call("GET",method,params,success,failure,loading,beforeSend,!1,!0)}}}}});