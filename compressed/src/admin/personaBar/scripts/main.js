!function(){"use strict";var v=function(){var d=function(s){return decodeURIComponent(s.replace(/\+/g," "))},q=location.search.substring(1),k=q.split("&");for(var i in k){var l=k[i].split("=");if(l.length>1&&"cdv"===d(l[0]))return d(l[1])}return""}(),debugMode=window.top.dnn&&"true"===window.top.dnn.getVar("pb_debugMode");requirejs.config({baseUrl:"scripts/contrib/",paths:{templatePath:"../../",cssPath:"../../css/"},urlArgs:(v?"cdv="+v:"")+(debugMode?"&t="+Math.random():""),shim:{"jquery.hoverintent.min":["jquery"],"jquery.qatooltip":["jquery.hoverintent.min"]},map:{"*":{"dnn.jquery":["../../../../Resources/Shared/Scripts/dnn.jquery"],"dnn.jquery.extensions":["../../../../Resources/Shared/Scripts/dnn.jquery.extensions"],"dnn.extensions":["../../../../Resources/Shared/scripts/dnn.extensions"],"jquery.tokeninput":["../../../../Resources/Shared/components/Tokeninput/jquery.tokeninput"],"dnn.jScrollBar":["../../../../Resources/Shared/scripts/jquery/dnn.jScrollBar"],"dnn.servicesframework":["../../../../js/dnn.servicesframework"],"dnn.DataStructures":["../../../../Resources/Shared/scripts/dnn.DataStructures"],"jquery.mousewheel":["../../../../Resources/Shared/scripts/jquery/jquery.mousewheel"],"dnn.TreeView":["../../../../Resources/Shared/scripts/TreeView/dnn.TreeView"],"dnn.DynamicTreeView":["../../../../Resources/Shared/scripts/TreeView/dnn.DynamicTreeView"],"dnn.DropDownList":["../../../../Resources/Shared/Components/DropDownList/dnn.DropDownList"],"css.DropDownList":["css!../../../../Resources/Shared/components/DropDownList/dnn.DropDownList.css"],"css.jScrollBar":["css!../../../../Resources/Shared/scripts/jquery/dnn.jScrollBar.css"]}}}),requirejs.onError=function(err){if("timeout"!==err.requireType)throw console.error(err),err;console.error(err),location.reload()}}(),require(["jquery","knockout","moment","../util","../sf","../config","../persistent","domReady!"],function($,ko,moment,ut,sf,cf,persistent){var iframe=window.parent.document.getElementById("personaBar-iframe");if(iframe){var activepanel="",activemodule="",parentBody=window.parent.document.body,body=window.document.body,config=cf.init(),utility=ut.init(config),inAnimation=!1,rootPath=location.protocol+"//"+location.host+(location.port?":"+location.port:"");"/"==rootPath.substr(rootPath.length-1,1)&&(rootPath=rootPath.substr(0,rootPath.length-1)),window.requirejs.config({paths:{rootPath:rootPath}});var onTouch="ontouchstart"in document.documentElement,width=parent.document.body.clientWidth,socialTasksleft=946;width<=1024&&width>768?(socialTasksleft=786,$(".socialtasks").addClass("view-ipad landscape"),$(".socialpanel-placeholder").css({width:"700px"}),$(".socialpanel").addClass("view-ipad landscape")):width<=768?(socialTasksleft=586,$(".socialtasks").addClass("view-ipad portrait"),$(".socialpanel-placeholder").css({width:"500px"}),$(".socialpanel").addClass("view-ipad portrait")):$(".socialpanel,.socialtasks").removeClass("view-ipad landscape portrait");var isTouch="ontouchstart"in window||navigator.msMaxTouchPoints>0;isTouch&&($("#topLevelMenu .personabarnav li").click(function(){var attribute=$(this).attr("data-hovermenu-id");if($("#topLevelMenu > div").hide(),attribute){var thisId=attribute.replace("#","");$("#topLevelMenu > div#"+thisId).length&&$("#topLevelMenu > div#"+thisId).toggle()}}),$(document).on("touchstart",function(event){$(event.target).closest("#topLevelMenu > div").length||$("#topLevelMenu > div").hide()})),isTouch?$("body").addClass("touch"):$("body").addClass("non-touch");var isMac=navigator.appVersion.indexOf("Mac")>-1;isMac&&$("body").addClass("mac");var isSafari=Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0;isSafari&&$("body").addClass("safari");var isIe=function(){if("Microsoft Internet Explorer"==navigator.appName)return!0;if("Netscape"==navigator.appName){var ua=navigator.userAgent;if(ua.indexOf("Trident")>-1)return!0}return!1}();isIe&&$("body").addClass("ie");var mouseOnHovermenu=!1,util={sf:sf.init(config.siteRoot,config.tabId,config.antiForgeryToken,"#personaBar-loadingbar"),onTouch:onTouch,moment:moment,persistent:persistent.init(config,sf),inAnimation:inAnimation,closePersonaBar:function(cb){var buttons,persistentSaveCallback,self=this;$(".socialpanel-placeholder").is(":hidden")||(buttons=$(".btn_panel"),$(".btn_panel, .hovermenu > ul > li").removeClass("selected"),parentBody.style.overflow="auto",body.style.overflow="hidden",persistentSaveCallback=function(){inAnimation=!0,$(".socialpanel-placeholder").hide(),$(".socialtasks").animate({left:-300},189,"linear",function(){$(activepanel).animate({left:-860},189,"linear",function(){$(".socialpanel").css({left:-860}).hide(),$(".socialmask").animate({opacity:0},200,function(){iframe.style.width="85px",onTouch&&(iframe.style["min-width"]="0",iframe.style.position="fixed"),$(".socialmask").css("display","none"),$(".btn_showsite").hide(),$(".btn_edit").show(),activepanel=null,inAnimation=!1,$(document).unbind("keyup"),buttons.trigger("closingPersonaBar"),"function"==typeof cb&&cb()})})})},self.persistent.save({expandPersonaBar:!1},persistentSaveCallback))},loadPanel:function(panelId,$btn,params){var savePersistentCallback;if(!inAnimation){var self=this,moduleName=self.getModuleNameByParams(params);if(activepanel!=panelId||activemodule!=moduleName){$(".btn_panel, .hovermenu > ul > li").removeClass("selected");var wrapper=$(panelId),template=wrapper.data("template");"none"==$(".socialmask").css("display")?(iframe.style.width="100%",parentBody.style.overflow="hidden",body.style.overflow="auto",onTouch&&(iframe.style["min-width"]="1245px",iframe.style.position="fixed"),$btn.addClass("selected"),savePersistentCallback=function(){activepanel=panelId,activemodule=moduleName,$(".btn_showsite").show(),$(".btn_edit").hide(),$(".socialmask").css("display","block"),inAnimation=!0,$(".socialmask").animate({opacity:.85},200,function(){$(activepanel).show().delay(100).animate({left:85},189,"linear",function(){$(".socialtasks").delay(100).animate({left:socialTasksleft},189,"linear",function(){inAnimation=!1,$(".socialpanel-placeholder").show(),self.loadTemplate("tasks",$("div.socialtasks > div")),self.loadTemplate(template,wrapper,params),$(document).keyup(function(e){27==e.keyCode&&(e.preventDefault(),util.closePersonaBar())})})})})},self.persistent.save({expandPersonaBar:!0,btnIndex:$(".btn_panel").index($btn),activePanelId:panelId},savePersistentCallback)):activepanel!==panelId?(inAnimation=!0,$(activepanel).fadeOut("fast",function(){$(panelId).css({left:85}).fadeIn("fast",function(){$(".btn_panel, .hovermenu > ul > li").removeClass("selected"),$btn.addClass("selected"),savePersistentCallback=function(){activepanel=panelId,activemodule=moduleName,inAnimation=!1,self.loadTemplate(template,wrapper,params)};var panelButton=$btn.hasClass("btn_panel")?$btn:$("ul.personabarnav li[data-hovermenu-id='#"+$btn.parent().parent().attr("id")+"']");self.persistent.save({expandPersonaBar:!0,btnIndex:$(".btn_panel").index(panelButton),activePanelId:panelId},savePersistentCallback)})})):activemodule!==moduleName&&(activemodule=moduleName,self.loadTemplate(template,wrapper,params))}}},loadModuleDashboard:function(moduleName){var self=this;self.loadPanel("#social-dashboard-panel",$(".btn_dashboard"),{moduleName:moduleName})},loadPageAnalytics:function(){var self=this;self.loadPanel("#pagetraffic-panel",$(".btn_analytics"))}};util=$.extend(util,utility);for(var setupHoverMenu=function(){if(!onTouch){var showMenuHandler=[];$(".btn_panel").each(function(){var mouseOnButton=!1;mouseOnHovermenu=!1;var $this=$(this),hoverMenuId=$this.data("hovermenu-id");if(void 0!==hoverMenuId){var $hoverMenu=$(hoverMenuId);$this.hover(function(){mouseOnButton=!0,"none"==$hoverMenu.css("display")&&(showMenuHandler.length>0&&($.each(showMenuHandler,function(index,item){clearTimeout(item)}),showMenuHandler=[]),showMenuHandler.push(setTimeout(function(){"none"==$hoverMenu.css("display")&&mouseOnButton&&(activepanel||(iframe.style.width="100%"),$hoverMenu.css({position:"absolute",left:"-1000px"}),$(".btn_panel").each(function(){var menuId=$(this).data("hovermenu-id");void 0!==menuId&&$(menuId).hide()}),$hoverMenu.show(),showMenuHandler.push(setTimeout(function(){$(".hovermenu > ul").css("list-style-type","square"),showMenuHandler.push(setTimeout(function(){$(".hovermenu > ul").css("list-style-type","none"),showMenuHandler.push(setTimeout(function(){$hoverMenu.hide(),$hoverMenu.removeAttr("style"),showMenuHandler.push(setTimeout(function(){$hoverMenu.fadeIn("fast")}))},100))}))})))},50)))},function(){mouseOnButton=!1,"block"!=$hoverMenu.css("display")||mouseOnHovermenu||setTimeout(function(){"block"!=$hoverMenu.css("display")||mouseOnButton||mouseOnHovermenu||(activepanel||(iframe.style.width="85px"),$hoverMenu.hide())},50)})}}),$(".hovermenu").each(function(){var $this=$(this),mouseOnButton=!1;mouseOnHovermenu=!1,$this.hover(function(){mouseOnHovermenu=!0},function(){mouseOnHovermenu=!1,"block"!=$this.css("display")||mouseOnButton||setTimeout(function(){"block"!=$this.css("display")||mouseOnButton||mouseOnHovermenu||(activepanel||(iframe.style.width="85px"),$this.hide())},800)})}),$(".btn_analytics").each(function(){var mouseOnButton=!1;mouseOnHovermenu=!1;var $this=$(this),$hoverMenu=$(".incontext-analytics");$hoverMenu.hover(function(){mouseOnHovermenu=!0},function(){mouseOnHovermenu=!1}),$this.hover(function(){mouseOnButton=!0,"none"==$hoverMenu.css("display")&&setTimeout(function(){"none"==$hoverMenu.css("display")&&mouseOnButton&&(activepanel||(iframe.style.width="100%"),$hoverMenu.fadeIn("fast",function(){util.loadInContextAnalytics("analytics-in-context",$(".incontext-analytics > div"),function(){})}))},50)},function(){mouseOnButton=!1,"block"!=$hoverMenu.css("display")||mouseOnHovermenu||setTimeout(function(){"block"!=$hoverMenu.css("display")||mouseOnButton||mouseOnHovermenu||(activepanel||(iframe.style.width="85px"),$hoverMenu.hide())},50)})})}},javascriptMainModuleNames=config.javascriptMainModuleNames.split(","),i=0;i<javascriptMainModuleNames.length;i++)if(javascriptMainModuleNames[i]){var moduleName="../"+javascriptMainModuleNames[i],moduleCss="css!cssPath"+javascriptMainModuleNames[i]+".css";require([moduleName,moduleCss],function(mainModule){if(mainModule)if("object"==typeof mainModule)mainModule.init(util);else if("function"==typeof mainModule)switch(mainModule.type){case"Class":new mainModule(util);break;case"Static Class":mainModule.init(util)}})}if(config.hasValidLicenseOrTrial){if(setupHoverMenu(),!onTouch){var mouseOnBtnAnalytics=!1,mouseOnInContextAnalytics=!1,$hoverMenu=$(".incontext-analytics");$(".btn_analytics").hover(function(){mouseOnBtnAnalytics=!0,"none"==$hoverMenu.css("display")&&setTimeout(function(){"none"==$hoverMenu.css("display")&&mouseOnBtnAnalytics&&(activepanel||(iframe.style.width="100%"),$hoverMenu.fadeIn("fast",function(){util.loadInContextAnalytics("analytics-in-context",$(".incontext-analytics > div"),function(){})}))},800)},function(){mouseOnBtnAnalytics=!1,"block"!=$hoverMenu.css("display")||mouseOnHovermenu||setTimeout(function(){"block"!=$hoverMenu.css("display")||mouseOnBtnAnalytics||mouseOnInContextAnalytics||(activepanel||(iframe.style.width="85px"),$hoverMenu.hide())},800)}),$hoverMenu.hover(function(){mouseOnInContextAnalytics=!0},function(){mouseOnInContextAnalytics=!1,"block"!=$hoverMenu.css("display")||mouseOnHovermenu||setTimeout(function(){"block"!=$hoverMenu.css("display")||mouseOnBtnAnalytics||mouseOnInContextAnalytics||(activepanel||(iframe.style.width="85px"),$hoverMenu.hide())},800)})}var setupMenu=function(){$(".btn_panel, .hovermenu > ul > li").click(function(evt){evt.preventDefault();var $this=$(this);if(!$this.hasClass("selected")){var panelId=$this.data("panel-id");if(void 0!==panelId){var params=null,moduleName=$this.data("module-name");void 0!==moduleName&&(params={moduleName:moduleName}),util.loadPanel(panelId,$this,params)}}}),$(".btn_showsite").click(function(e){e.preventDefault();var needRefresh=$(this).data("need-refresh"),needHomeRedirect=$(this).data("need-homeredirect");util.closePersonaBar(function(){needHomeRedirect?window.top.location.href=config.siteRoot:needRefresh&&window.top.location.reload()})})};setupMenu()}else $(".personabarnav > li.btn_panel, .hovermenu > ul > li").addClass("disabled");$(".socialmanageravatar img").attr("src",config.avatarUrl),iframe.style.width="85px";var resizeWindows=function(){var evt=document.createEvent("HTMLEvents");evt.initEvent("resize",!0,!1),window.top.dispatchEvent(evt),function($){$(parent.document).trigger("personabaropened")}(parent.$)};util.asyncParallel([function(cb1){util.loadResx(function(){ko.applyBindings(util.resx.PersonaBar,document.getElementById("personabar")),cb1()})},function(cb2){$(parent.document).find("body").hasClass("dnnEditState")?($(".personabar").css({left:0,display:"block"}),$(parentBody).animate({marginLeft:85},1,"linear",resizeWindows)):($(".personabar").show(),$(".personabar").css({left:-100}),$(parentBody).animate({marginLeft:85},200,"linear",resizeWindows),$(".personabar").animate({left:0},200,"linear",cb2))}],function(){var persistedSettings=util.persistent.load();if(persistedSettings.expandPersonaBar&&persistedSettings.btnIndex>=0){var btn=$($(".btn_panel")[persistedSettings.btnIndex]);util.loadPanel(persistedSettings.activePanelId,btn)}})}});