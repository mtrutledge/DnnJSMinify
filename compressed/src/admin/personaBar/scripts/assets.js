"use strict";define(["jquery","knockout","knockout.mapping","../scripts/validator","../scripts/config","../scripts/tabpanel","jquery.tokeninput.min","../scripts/permissionGrid","../scripts/permissionGridManager","../../../Resources/Shared/Scripts/dnn.jquery","../scripts/koBindingHandlers/folderPicker","../scripts/koBindingHandlers/tagsInput","css!../../../Resources/Shared/components/DropDownList/dnn.DropDownList.css","css!../../../Resources/Shared/Components/FileUpload/dnn.FileUpload.css","css!../../../Resources/Shared/scripts/jquery/dnn.jScrollBar.css"],function($,ko,komapping,validator,cf,tabpanel){ko.mapping=komapping;var permissionGrid,fileUpload,config=cf.init(),utility=null,wrapper=null,isMobile=!1,itemContainer=null,containerTop=0,scrollItem=null,itemsPerRow=0,itemsPerPage=0,animationDuration=300,viewModel={currentFolder:ko.observable(),rootFolderId:config.rootFolderId,breadcrumb:ko.observableArray(),folderContent:ko.observableArray(),lastPage:ko.observable(),totalItemCount:ko.observable(),inputSearchText:ko.observable(""),searchText:ko.observable(""),selectedItem:ko.observable(),itemEditing:{itemId:ko.observable(null),isFolder:ko.observable(),itemName:ko.observable(),fileNameFocused:ko.observable(!1),folderNameFocused:ko.observable(!1),iconUrl:ko.observable(),createdOnDate:ko.observable(),createdBy:ko.observable(),lastModifiedOnDate:ko.observable(),lastModifiedBy:ko.observable(),size:ko.observable(),title:ko.observable(),subscribed:ko.observable(),url:ko.observable(),tags:ko.observable(),folderType:ko.observable(),workflows:ko.observableArray(),workflowId:ko.observable(),originalWorkflowId:ko.observable(),workflowAction:ko.observable(),versioning:ko.observable()},folderAdding:{folderName:ko.observable(""),folderNameFocused:ko.observable(!1),folderTypes:ko.observableArray(),parentFolderType:ko.observable(),selectedFolderType:ko.observable(),mappedName:ko.observable()},uploading:{imageUrl:ko.observable(),fileName:ko.observable(),showConfirmation:ko.observable(!1),pendingfiles:null,overwrite:!1},itemToHighlight:ko.observable(),loading:ko.observable(!0)},mappingOptions={create:function(options){var item=ko.mapping.fromJS(options.data,{observe:["ItemName"]});return item.selected=ko.observable(!1),item.saved=ko.observable(!1),item.highlight=ko.computed(function(){return item.saved()||viewModel.itemToHighlight()&&item.IsFolder===viewModel.itemToHighlight().isFolder&&item.ItemName()===viewModel.itemToHighlight().itemName}),item}},throttledSearchText=ko.computed(viewModel.inputSearchText).extend({throttle:400});throttledSearchText.subscribe(function(text){(0==text.length||text.length>=3)&&viewModel.searchText(text)},viewModel),viewModel.doSearch=function(text){0===text.length?refreshCurrentFolder():search(viewModel.currentFolder().FolderID,text)},viewModel.searchText.subscribe(viewModel.doSearch),viewModel.folderAdding.folderTypeDisabled=ko.computed(function(){return!viewModel.folderAdding.parentFolderType()||viewModel.folderAdding.parentFolderType().IsDefault===!1}),viewModel.folderAdding.mappedNameHidden=ko.computed(function(){return!viewModel.folderAdding.selectedFolderType()||viewModel.folderAdding.selectedFolderType().IsDefault||!viewModel.folderAdding.parentFolderType()||!viewModel.folderAdding.parentFolderType().IsDefault});var showTopPanel=function(panelClass,complete){var panel=wrapper.find("div."+panelClass);return panel.is(":visible")?void(!complete||complete()):void closeTopPanel(function(){$("div.body").animate({scrollTop:220});var h=panel.outerHeight();panel.slideDown(animationDuration,complete),itemContainer.addClass("disabled").animate({top:containerTop+h}),viewModel.hideDetails()})},closeTopPanel=function(complete){itemContainer.removeClass("disabled");var panel=wrapper.find("div.top-panel:visible");1==panel.length?(panel.slideUp(animationDuration,complete),itemContainer.animate({top:containerTop})):!complete||complete()};viewModel.addFolder=function(){var firstTab=wrapper.find("div.add-folder > ul.tabControl > li:first-child");firstTab.trigger("click"),viewModel.folderAdding.folderName(""),loadTypes(),showTopPanel("add-folder"),viewModel.folderAdding.folderNameFocused(!0),viewModel.folderAdding.mappedName("")};var assetsService=function(){return utility.sf.moduleRoot="dnncorp/personaBar",utility.sf.controller="assets",utility.sf},getFolderType=function(d,id){for(var i=0;i<d.length;i++)if(d[i].FolderMappingID==id)return d[i];return null},loadTypes=function(){assetsService().get("GetFolderMappings",null,function(d){viewModel.folderAdding.folderTypes.removeAll(),ko.utils.arrayPushAll(viewModel.folderAdding.folderTypes,d);var defaultFolderTypeId=viewModel.currentFolder().FolderID==config.rootFolderId?config.defaultFolderMappingId:viewModel.currentFolder().FolderMappingID;viewModel.folderAdding.parentFolderType(getFolderType(d,viewModel.currentFolder().FolderMappingID)),viewModel.folderAdding.selectedFolderType(getFolderType(d,defaultFolderTypeId))})},loadWorkflows=function(){assetsService().get("GetWorkflows",null,function(d){viewModel.itemEditing.workflows.removeAll(),ko.utils.arrayPushAll(viewModel.itemEditing.workflows,d)})};viewModel.cancelFolder=function(){closeTopPanel()},viewModel.saveFolder=function(){if(validator.validate(wrapper.find("div.top-panel.add-folder"))){var params={FolderName:viewModel.folderAdding.folderName(),ParentFolderId:viewModel.currentFolder().FolderID,FolderMappingId:viewModel.folderAdding.selectedFolderType().FolderMappingID,MappedName:viewModel.folderAdding.mappedName()};assetsService().post("CreateNewFolder",params,function(){closeTopPanel(),refreshCurrentFolder({itemName:params.FolderName,isFolder:!0})},function(x){failed(x),viewModel.folderAdding.folderNameFocused(!0)})}};var getCurrentFolderPath=function(){for(var path="",i=1;i<viewModel.breadcrumb().length;i++)path+=viewModel.breadcrumb()[i].FolderName+"/";return path};viewModel.addAsset=function(){viewModel.uploading.showConfirmation(!1),viewModel.uploading.imageUrl(""),viewModel.uploading.overwrite=!1,wrapper.find("#uploader").val(""),fileUpload.setUploadPath(getCurrentFolderPath()),showTopPanel("add-asset")},viewModel.closeAddAsset=function(){closeTopPanel()},viewModel.itemClick=function(item,e){if(!itemContainer.is(".disabled"))return $("body").is(".touch")&&!item.selected()?void viewModel.setSelectedItem(item):void(item.IsFolder?getFolderContent(item.ItemID):assetsService().get("GetFileDetails",{fileId:item.ItemID},function(data){window.open(getFullUrl(data.Url))},failed))},viewModel.itemTap=function(item,e){if(!itemContainer.is(".disabled"))if(item.IsFolder){item.selected(!0);var uiElement=$(e.currentTarget).closest("div.item");itemContainer.find("div.item:not(.selected)").fadeOut(),scrollTopElement(uiElement,function(){getFolderContent(item.ItemID)})}else viewModel.showDetails(item,e)};var scrollTopElement=function(uiElement,callback){var scrollPos=scrollItem[0].scrollTop+uiElement.position().top-4;scrollItem.animate({scrollTop:scrollPos},0!=uiElement.position().top?animationDuration:0,"swing",callback)};viewModel.setSelectedItem=function(item){!viewModel.selectedItem()||viewModel.selectedItem().selected(!1),viewModel.selectedItem(item),item.selected(!0)};var focusEditName=function(){viewModel.itemEditing.isFolder()?viewModel.itemEditing.folderNameFocused(!0):viewModel.itemEditing.fileNameFocused(!0),wrapper.find('div.dnnTagsInput input[id$="_tag"]').each(function(){var $input=$("#"+$(this).attr("id").replace("_tag",""));$input.data("dnnTagInput")&&$(this).dnnResetAutosize($input.data("dnnTagInput"))})};viewModel.showDetails=function(item,e){if(viewModel.itemEditing.itemId()!==item.ItemID){viewModel.setSelectedItem(item),item.saved(!1),viewModel.itemEditing.itemId(item.ItemID);var itemDetails=wrapper.find("div.item-details");itemDetails.slideUp(itemDetails.is(":visible")?animationDuration:0,function(){if(null!=viewModel.itemEditing.itemId()){viewModel.itemEditing.isFolder(item.IsFolder),viewModel.itemEditing.itemName(item.ItemName()),viewModel.itemEditing.iconUrl(viewModel.iconUrl(item,wrapper.find("div.details-icon")[0]));var uiElement=$(e.currentTarget).closest("div.item");scrollTopElement(uiElement,function(){if(null!=viewModel.itemEditing.itemId()){var left=uiElement.position().left-parseInt(uiElement.parent().css("padding-left"));wrapper.find("div.details-selector > div").css({left:left}),item.IsFolder?assetsService().get("GetFolderDetails",{folderId:item.ItemID},bindFolderDetails,failed):assetsService().get("GetFileDetails",{fileId:item.ItemID},bindFileDetails,failed);var i=viewModel.folderContent.indexOf(item),pos=Math.floor(i/itemsPerRow)*itemsPerRow+itemsPerRow-1,rightmostItem=itemContainer.find("div.item").eq(pos);0===rightmostItem.length&&(rightmostItem=itemContainer.find("div.item").last()),itemDetails.insertAfter(rightmostItem).slideDown(animationDuration,focusEditName);var firstTab=$(this).find("ul.tabControl > li:first-child");firstTab.trigger("click")}})}})}},viewModel.showMobileFolderDetails=function(){viewModel.itemEditing.itemId(viewModel.currentFolder().FolderID),viewModel.itemEditing.isFolder(!0),viewModel.itemEditing.itemName(viewModel.currentFolder().FolderName),assetsService().get("GetFolderDetails",{folderId:viewModel.currentFolder().FolderID},bindFolderDetails,failed);var folderDetails=wrapper.find("div.folder-details");folderDetails.slideDown(animationDuration)},viewModel.mobileFolderArrow=function(){wrapper.find("div.folder-details").is(":visible")?viewModel.hideMobileFolderDetails():viewModel.goToParentFolder()},viewModel.hideMobileFolderDetails=function(notifySaved){!viewModel.selectedItem()||viewModel.selectedItem().selected(!1),viewModel.itemEditing.itemId(null),wrapper.find("div.folder-details").slideUp(animationDuration,function(){if(notifySaved===!0){var folder=viewModel.breadcrumb.pop();folder.FolderName=viewModel.itemEditing.itemName(),viewModel.breadcrumb.push(folder),wrapper.find("div.parent > div.item").addClass("saved")}})},viewModel.delete=function(item,e){viewModel.setSelectedItem(item);var msg=item.IsFolder?utility.resx.PersonaBar.txt_ConfirmDeleteFolder:utility.resx.PersonaBar.txt_ConfirmDeleteAsset;utility.confirm(msg.replace("[NAME]",item.ItemName()),utility.resx.PersonaBar.btn_Delete,utility.resx.PersonaBar.btn_Cancel,function(){item.IsFolder?assetsService().post("DeleteFolder",{folderId:item.ItemID,UnlinkAllowedStatus:!1},refreshCurrentFolder,failed):assetsService().post("DeleteFile",{fileId:item.ItemID},refreshCurrentFolder,failed)},function(){isMobile||item.selected(!1)})},viewModel.deleteCurrentFolder=function(){var msg=utility.resx.PersonaBar.txt_ConfirmDeleteFolder.replace("[NAME]",viewModel.currentFolder().FolderName);utility.confirm(msg,utility.resx.PersonaBar.btn_Delete,utility.resx.PersonaBar.btn_Cancel,function(){assetsService().post("DeleteFolder",{folderId:viewModel.currentFolder().FolderID,UnlinkAllowedStatus:!1},viewModel.goToParentFolder(),failed)})};var changeSusbcription=function(value){var method=value?"Subscribe":"Unsubscribe",params={ItemId:viewModel.itemEditing.itemId(),IsFolder:viewModel.itemEditing.isFolder()};assetsService().post(method,params,null,failed)},getFullUrl=function(url){return 0==url.indexOf("http://")||0==url.indexOf("https://")?url:location.protocol+"//"+location.hostname+(location.port?":"+location.port:"")+url},bindFileDetails=function(data){viewModel.itemEditing.createdOnDate(data.CreatedOnDate),viewModel.itemEditing.createdBy(data.CreatedBy),viewModel.itemEditing.lastModifiedOnDate(data.LastModifiedOnDate),viewModel.itemEditing.lastModifiedBy(data.LastModifiedBy),viewModel.itemEditing.size(data.Size),viewModel.itemEditing.title(data.Title),viewModel.itemEditing.url(getFullUrl(data.Url)),viewModel.itemEditing.tags(data.Tags),!viewModel.subscribedSubscription||viewModel.subscribedSubscription.dispose(),viewModel.itemEditing.subscribed(data.IsUserSubscribed),viewModel.subscribedSubscription=viewModel.itemEditing.subscribed.subscribe(changeSusbcription)},bindFolderDetails=function(data){viewModel.itemEditing.createdOnDate(data.CreatedOnDate),viewModel.itemEditing.createdBy(data.CreatedBy),viewModel.itemEditing.lastModifiedOnDate(data.LastModifiedOnDate),viewModel.itemEditing.lastModifiedBy(data.LastModifiedBy),viewModel.itemEditing.folderType(data.Type),viewModel.itemEditing.versioning(data.IsVersioned),viewModel.itemEditing.workflowId(data.WorkflowId),viewModel.itemEditing.originalWorkflowId(data.WorkflowId),viewModel.itemEditing.workflowAction("publishAll"),!viewModel.subscribedSubscription||viewModel.subscribedSubscription.dispose(),viewModel.itemEditing.subscribed(data.IsUserSubscribed),viewModel.subscribedSubscription=viewModel.itemEditing.subscribed.subscribe(changeSusbcription),buildPermissionGrid(data.Permissions)},failed=function(x){var message=x.responseJSON.Message||"Failed...";utility.notifyError(message)},buildPermissionGrid=function(data){var gridContainer=wrapper.find("#folderPermissionsPanel > .folderPermissionsContainer");permissionGrid&&(permissionGrid.getLayout().remove(),permissionGrid=null),dnn.controls.PermissionGrid.resx=viewModel.resx,permissionGrid=new dnn.controls.PermissionGrid({_getService:assetsService},data),gridContainer.prepend(permissionGrid.getLayout())};viewModel.hideDetails=function(notifySaved){!viewModel.selectedItem()||viewModel.selectedItem().selected(!1),viewModel.itemEditing.itemId(null),wrapper.find("div.item-details").slideUp(animationDuration,function(){wrapper.find("div.item-details").appendTo("div.item-details-container"),notifySaved===!0&&(viewModel.selectedItem().saved(!0),viewModel.selectedItem().ItemName(viewModel.itemEditing.itemName()))})},viewModel.breadcrumbNavigate=function(folder){""!=viewModel.searchText()?(viewModel.breadcrumb.splice(viewModel.breadcrumb.indexOf(folder)),viewModel.currentFolder(folder),viewModel.inputSearchText(""),viewModel.searchText("")):viewModel.currentFolder().FolderID!=folder.FolderID&&(viewModel.breadcrumb.splice(viewModel.breadcrumb.indexOf(folder)),getFolderContent(folder.FolderID))},viewModel.goToParentFolder=function(){var i=viewModel.breadcrumb().length-2;viewModel.breadcrumbNavigate(viewModel.breadcrumb()[i])},viewModel.saveFileDetails=function(){if(validator.validate(wrapper.find("div.file-details"))){var params={fileId:viewModel.itemEditing.itemId(),fileName:viewModel.itemEditing.itemName(),title:viewModel.itemEditing.title(),tags:viewModel.itemEditing.tags()};assetsService().post("SaveFileDetails",params,function(){viewModel.hideDetails(!0)},function(x){failed(x),viewModel.itemEditing.fileNameFocused(!0)})}},viewModel.saveFolderDetails=function(){if(validator.validate(wrapper.find("div.folder-details"))){var params={folderId:viewModel.itemEditing.itemId(),folderName:viewModel.itemEditing.itemName(),workflowId:viewModel.itemEditing.workflowId(),workflowAction:viewModel.itemEditing.workflowAction(),versioning:viewModel.itemEditing.versioning(),permissions:permissionGrid.getPermissions()},hide=isMobile?viewModel.hideMobileFolderDetails:viewModel.hideDetails;assetsService().post("SaveFolderDetails",params,function(){hide(!0)},function(x){failed(x),viewModel.itemEditing.folderNameFocused(!0)})}};var search=function(folderId,searchText,page){page||(page=0);var params={folderId:folderId,search:searchText,pageIndex:1,pageSize:itemsPerPage,sorting:null,culture:config.culture};assetsService().get("Search",params,function(d){$("div.item-details").appendTo("div.item-details-container"),0==page&&(viewModel.folderContent.removeAll(),scrollTop(),viewModel.lastPage(page));var items=ko.mapping.fromJS(d.Items,mappingOptions);ko.utils.arrayPushAll(viewModel.folderContent,items()),viewModel.totalItemCount(d.TotalCount)})},scrollTop=function(){scrollItem[0].scrollTop=0},refreshCurrentFolder=function(itemToHighlight){getFolderContent(viewModel.currentFolder().FolderID,0,itemToHighlight)},getFolderContent=function(folderId,page,itemToHighlight){viewModel.itemToHighlight(itemToHighlight),viewModel.loading(!0),page||(page=0);var params={folderId:folderId,startIndex:page*itemsPerPage,numItems:itemsPerPage};viewModel.itemEditing.itemId(null),assetsService().get("GetFolderContent",params,function(d){d.Folder.FolderID==config.rootFolderId&&(d.Folder.FolderName=viewModel.resx.lbl_Root),0==page&&($("div.item-details").appendTo("div.item-details-container"),viewModel.folderContent.removeAll(),viewModel.currentFolder(d.Folder),isMobile&&folderId!=config.rootFolderId?scrollItem[0].scrollTop=310:scrollTop(),viewModel.lastPage(page)),0!=viewModel.breadcrumb().length&&viewModel.breadcrumb()[viewModel.breadcrumb().length-1].FolderID==d.Folder.FolderID||viewModel.breadcrumb.push({FolderID:d.Folder.FolderID,FolderName:d.Folder.FolderName});var items=ko.mapping.fromJS(d.Items,mappingOptions);ko.utils.arrayPushAll(viewModel.folderContent,items()),viewModel.totalItemCount(d.TotalCount),viewModel.loading(!1)},failed)},goToFolder=function(folderId){assetsService().get("GetFolderPath",{folderId:folderId},function(d){viewModel.breadcrumb.removeAll(),ko.utils.arrayPushAll(viewModel.breadcrumb,d)}),getFolderContent(folderId)};viewModel.selectedFolderChanged=function(folder){viewModel.currentFolder().FolderID!==folder.key&&goToFolder(folder.key)};var initFileUpload=function(){var panel=wrapper.find("div.add-asset > div.file-upload-panel");fileUpload=parent.dnn[config.fileUploadClientId],panel.is(":empty")&&(fileUpload.$element.appendTo(panel),fileUpload.$element.on("show-statuses-container",function(){var h=wrapper.find("div.add-asset").outerHeight();itemContainer.animate({top:150+h})}).on("onfileuploadcomplete",function(e,d){var data=JSON.parse(d);data.fileId&&data.alreadyExists===!1&&(closeTopPanel(),refreshCurrentFolder({itemName:data.fileName,isFolder:!1}))})),itemContainer.on("dragover",function(e){e.stopPropagation(),e.preventDefault(),$(e.delegateTarget).addClass("drop-target"),e.originalEvent.dataTransfer.dropEffect="copy"}).on("dragleave",function(e){e.stopPropagation(),e.preventDefault(),e.target==e.delegateTarget&&$(e.delegateTarget).removeClass("drop-target")}).on("drop",function(e){e.stopPropagation(),e.preventDefault(),$(e.delegateTarget).removeClass("drop-target");var files=e.originalEvent.dataTransfer.files;fileUpload.setUploadPath(getCurrentFolderPath()),showTopPanel("add-asset",function(){fileUpload.addFiles(files)})})},isImage=function(url){for(var imageExtensions=["JPG","JPE","BMP","GIF","PNG","JPEG","ICO"],ext=url.split(".").reverse()[0].toUpperCase(),i=0;i<imageExtensions.length;i++)if(imageExtensions[i]==ext)return!0;return!1};viewModel.replaceFile=function(){viewModel.uploading.overwrite=!0,wrapper.find("#uploader").fileupload("add",{files:viewModel.uploading.pendingFiles})};var initFileUploadMobile=function(){var uploadUrl=utility.sf.getSiteRoot()+"DesktopModules/InternalServices/API/FileUpload/UploadFromLocal";wrapper.find("#uploader").fileupload({url:uploadUrl,beforeSend:utility.sf.setHeaders,replaceFileInput:!1,submit:function(e,d){return d.formData||(d.formData={folder:getCurrentFolderPath(),overwrite:viewModel.uploading.overwrite}),!0},done:function(e,d){var result=JSON.parse(d.result);return result.alreadyExists===!0?(viewModel.uploading.pendingFiles=d.files,viewModel.uploading.showConfirmation(!0),viewModel.uploading.fileName(result.fileName),void viewModel.uploading.imageUrl(isImage(result.path)?result.path:result.fileIconUrl)):null!=result.message?void utility.notify(result.message):(refreshCurrentFolder(),void viewModel.closeAddAsset())},error:failed})};return viewModel.highlightItemName=function(itemName){var pattern=viewModel.searchText();if(!pattern||""==pattern||pattern.indexOf("?")!=-1)return itemName;for(var words=pattern.split(" "),w=0;w<words.length;w++){var word=words[w];if(0!=word.indexOf("[")&&0!=word.indexOf("after:")){0==word.indexOf('"')&&word.lastIndexOf('"')==word.length-1&&(word=word.substring(1,word.length-1)),word=word.replace("*","");var matches=itemName.match(new RegExp(word,"i"));if(matches)for(var i=0;i<matches.length;i++)itemName=itemName.replace(matches[i],"<font class='highlight'>"+matches[i]+"</font>")}}return itemName},viewModel.iconUrl=function(item,element){if(item.IsFolder)return item.IconUrl;var $element=$(element);return item.ThumbnailAvailable?item.ThumbnailUrl.replace(/(width=)[^\&]+/,"$1"+$element.width()).replace(/(height=)[^\&]+/,"$1"+$element.height()):item.IconUrl},viewModel.pendingPages=ko.computed(function(){var loadedItems=(viewModel.lastPage()+1)*itemsPerPage;return loadedItems<viewModel.totalItemCount()}),viewModel.getNextPage=function(){viewModel.lastPage(viewModel.lastPage()+1),getFolderContent(viewModel.currentFolder().FolderID,viewModel.lastPage(),viewModel.itemToHighlight())},{init:function(wrap,util,params,callback){wrapper=wrap,utility=util,tabpanel.init(viewModel);var defaults={numberOfRows:6},p=$.extend({},defaults,params);itemContainer=wrapper.find("div.item-container"),containerTop=parseInt(itemContainer.css("top")),scrollItem=p.scrollItem||itemContainer;var itemElement=itemContainer.find("div.item"),itemWidth=itemElement.outerWidth(!0);itemsPerRow=Math.floor(itemContainer.width()/itemWidth),itemsPerPage=itemsPerRow*p.numberOfRows,wrapper.find("div.item-details").width(itemsPerRow*itemWidth-parseInt(itemElement.css("margin-right"))-parseInt(itemElement.css("margin-left"))),itemContainer.on("scroll",function(){wrapper.find("div.breadcrumbs-container").toggleClass("shadow",0!=$(this).scrollTop());var scrollHeight=$(this)[0].scrollHeight,scrollPosition=$(this).scrollTop()+$(this).outerHeight();scrollPosition>=scrollHeight-50-parseInt($(this).css("padding-bottom"))&&viewModel.pendingPages()&&viewModel.getNextPage()}),loadWorkflows(),initFileUpload(),wrapper.find('input[type="checkbox"].switch').dnnCheckbox(),utility.localizeErrMessages(validator);var container=wrapper[0];viewModel.resx=utility.resx.PersonaBar,ko.applyBindings(viewModel,container);var folderId=params&&params.folderId?params.folderId:config.rootFolderId;getFolderContent(folderId),"function"==typeof callback&&callback()},initMobile:function(wrap,util,params,callback){isMobile=!0;var defaults={numberOfRows:10},p=$.extend({},defaults,params);p.scrollItem=$("div.body"),this.init(wrap,util,p,callback),window.require(["jquery.fileupload"],initFileUploadMobile)},load:function(params,callback){var folderId=params&&params.folderId?params.folderId:config.rootFolderId;goToFolder(folderId),"function"==typeof callback&&callback()},loadMobile:function(params,callback){this.load(params,callback)}}});