function CountryRegionService($){var baseServicepath=$.dnnSF(-1).getServiceRoot("InternalServices")+"CountryRegion/";this.listCountries=function(searchString,success){$.ajax({type:"GET",url:baseServicepath+"Countries",data:{searchString:searchString}}).done(function(data){void 0!=success&&success(data)}).fail(function(xhr,status){alert(eval("("+xhr.responseText+")").ExceptionMessage)})},this.listRegions=function(country,success){$.ajax({type:"GET",url:baseServicepath+"Regions",data:{country:country}}).done(function(data){void 0!=success&&success(data)}).fail(function(xhr,status){alert(eval("("+xhr.responseText+")").ExceptionMessage)})}}function setupRegionLists(){$('div[data-list="Region"]').each(function(index,value){var stringValue=$(value).children('input[data-editor="DNNRegionEditControl_Hidden"]').val(),$row=$(value),$label=$row.prev().find("label"),$textControl=$row.children('input[data-editor="DNNRegionEditControl_Text"]'),$selectControl=$row.children("select");$selectControl.children("option").length<2?($selectControl.hide(),$textControl.show(),$textControl.val(stringValue),$label.attr("for",$textControl.attr("id"))):($selectControl.show(),$textControl.hide(),$selectControl.children('option[value="'+stringValue+'"]').prop("selected",!0),$label.attr("for",$selectControl.attr("id")))}),$('select[data-editor="DNNRegionEditControl_DropDown"]').change(function(){$(this).parent().children('input[data-editor="DNNRegionEditControl_Hidden"]').val($(this).val())})}function loadRegionList(category,country){var selector=category?'div[data-list="Region"][data-category="'+category+'"]':'div[data-list="Region"]';$(selector).each(function(index,value){var dd=$(value).children("select");$(dd).children().not(":first").remove(),""!=country&&(void 0==dnnCountryRegionService&&(dnnCountryRegionService=new CountryRegionService($)),dnnCountryRegionService.listRegions(country,function(data){$.each(data,function(index,value){$(dd).append($("<option>").text(value.Text).attr("value",value.Value))}),setupRegionLists()}))})}function clearCountryValue(countryControl){$("#"+$(countryControl).attr("id").replace("_name","")+"_id").val(""),$(countryControl).attr("data-value",""),$(countryControl).attr("value",""),loadRegionList($(countryControl).attr("data-category"),""),setupRegionLists()}function setupCountryAutoComplete(){$('input[data-editor="DnnCountryAutocompleteControl"]').autocomplete({minLength:2,source:function(request,response){var control=this.element;void 0==dnnCountryRegionService&&(dnnCountryRegionService=new CountryRegionService($)),dnnCountryRegionService.listCountries(request.term,function(data){0==data.length&&clearCountryValue(control),response($.map(data,function(item){return{label:item.FullName,id:item.Id,value:item.Id,name:item.Name}}))})},select:function(event,ui){$("#"+$(this).attr("id").replace("_name","")+"_id").val(ui.item.id),$(this).attr("data-value",ui.item.id),$(this).attr("data-text",ui.item.name)},close:function(){void 0!=$(this).attr("data-text")?($(this).val($(this).attr("data-text")),loadRegionList($(this).attr("data-category"),$(this).attr("data-value"))):clearCountryValue(this)}}),$('input[data-editor="DnnCountryAutocompleteControl"]').change(function(){$(this).val().length<2&&clearCountryValue(this)})}function initCountryRegionControls(){setupCountryAutoComplete(),setupRegionLists()}var dnnCountryRegionService;Sys.WebForms.PageRequestManager.getInstance().add_endRequest(initCountryRegionControls),function($){$(document).ready(function(){initCountryRegionControls()})}(jQuery);