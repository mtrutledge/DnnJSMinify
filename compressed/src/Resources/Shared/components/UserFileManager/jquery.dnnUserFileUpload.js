!function($){"use strict";var supportAjaxUpload=function(){var xhr=new XMLHttpRequest;return!!(xhr&&"upload"in xhr&&"onprogress"in xhr.upload)};$.fn.dnnUserFileUpload=function(options){function displayError(message){$(opts.progressContextSelector).hide("fade");var $message=$(opts.errorMessageSelector);$message.text(message).show(),setTimeout(function(){$message.hide("fade")},4e3)}var opts=$.extend({},$.fn.dnnUserFileUpload.defaultOptions,options),$wrap=$(this),$fileUploadWrapperSelector=$(opts.fileUploadWrapperSelector);$fileUploadWrapperSelector.bind("fileuploadfail",function(e,data){opts.complete(data),displayError(opts.serverErrorMessage)}),$fileUploadWrapperSelector.bind("fileuploaddone",function(e,data){opts.complete(data);var result;result=data.result[0].body?$.parseJSON(data.result[0].body.innerText)[0]:data.result[0],result.success?opts.callback(result):displayError(result.message)});var url=opts.addImageServiceUrl;if(!supportAjaxUpload()){var antiForgeryToken=$('input[name="__RequestVerificationToken"]').val();url+="?__RequestVerificationToken="+antiForgeryToken}var $fileupload=$fileUploadWrapperSelector;$fileupload.data("loaded")||$fileupload.fileupload({dataType:"json",url:url,maxFileSize:opts.maxFileSize,beforeSend:opts.beforeSend,add:function(e,data){data.context=$(opts.progressContextSelector),data.context.find($(opts.progressFileNameSelector)).html(data.files[0].name),data.context.show("fade"),data.submit()},progress:function(e,data){if(data.context){var progress=parseInt(data.loaded/data.total*100,10);data.context.find(opts.progressBarSelector).css("width",progress+"%").find("span").html(progress+"%")}},done:function(e,data){data.context&&(data.context.find(opts.progressBarSelector).css("width","100%").find("span").html("100%"),setTimeout(function(){data.context.hide("fade")},2e3))}}).data("loaded",!0),$wrap.show()},$.fn.dnnUserFileUpload.defaultOptions={fileUploadWrapperSelector:".fileUploadArea",addImageServiceUrl:"/DesktopModules/Journal/API/FileUpload/UploadFile",progressContextSelector:".progress_context",progressFileNameSelector:".upload_file_name",progressBarSelector:".progress-bar div",errorMessageSelector:".fileupload-error",serverErrorMessage:"Unexpected error. This generally happens when the file is too large.",beforeSend:null,callback:function(result){},complete:function(data){}}}(jQuery);