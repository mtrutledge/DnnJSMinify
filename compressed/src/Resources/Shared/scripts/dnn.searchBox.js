!function($,window){$.dnnSearchBox=function(options,element){this.$el=$(element),this._init(options)},$.dnnSearchBox.defaults={defaultText:"Enter Search term",advancedText:"Advanced",seemoreText:"See more results",noresultText:"No any results",showAdvanced:!1,advancedId:null,enablePreview:!0,refreshSearchResult:!1,refreshSearchResultDelay:400,refreshSearchResultMinChars:2,previewUrl:null,previewMinChars:2,previewDelay:400,previewQueryParamName:"keywords",previewOnError:null,searchQueryParamName:"search",searchFiltersParamName:"filter",searchFunction:null},$.dnnSearchBox.prototype={_init:function(options){this.options=$.extend(!0,{},$.dnnSearchBox.defaults,options),this._generateTemplate(),this._attachEvents()},_generateTemplate:function(){var originalVal=this.$el.val(),markup='<div class="dnnSearchBox">',advancedEnabled=this.options.showAdvanced&&this.options.advancedId&&$("#"+this.options.advancedId).length;advancedEnabled&&(markup+='<span class="dnnSearchBox_advanced_query" /><a class="dnnSearchBoxClearAdvanced"></a>'),markup+='<input id="'+this.options.id+'_input" type="text" value="'+originalVal+'" autocomplete="off" /><a class="dnnSearchBoxClearText"></a>',markup+='<a class="dnnSearchButton"></a>',advancedEnabled&&(markup+='<div class="dnnSearchBox_advanced"><a class="dnnSearchBox_advanced_label">'+this.options.advancedText+'</a><div class="dnnSearchBox_advanced_dropdown">',markup+="</div></div>"),markup+='<div class="dnnClear"></div></div>',this.$el.hide(),this.$wrap=$(markup).insertAfter(this.$el);var wrapWidth=this.$wrap.width();this.realInput=$("#"+this.options.id+"_input");var realInputRight=50,advancedDropdown=$(".dnnSearchBox_advanced_dropdown",this.$wrap),advancedForm=$("#"+this.options.advancedId);if(advancedEnabled){advancedForm.appendTo(advancedDropdown);var w=$(".dnnSearchBox_advanced",this.$wrap).width(),w2=$(".dnnSearchBox_advanced_query",this.$wrap).width();realInputRight=w+w2+50,$(".dnnSearchBox_advanced_query",this.$wrap).hide()}this.realInput.css({right:realInputRight,width:wrapWidth-realInputRight-8}),originalVal&&this.realInput.next().addClass("dnnShow").css({right:realInputRight-15})},_makeUrl:function(param,service){var url=this.options.previewUrl?this.options.previewUrl:service?service.getServiceRoot("internalservices")+"searchService/preview":null;if(!url)return null;var params={};params[this.options.previewQueryParamName]=param.replace(/^\s+|\s+$/g,"");var urlAppend=[];return $.each(params,function(index,value){urlAppend.push([index,encodeURIComponent(value)].join("="))}),urlAppend.length&&(url+=url.indexOf("?")===-1?"?":"&",url+=urlAppend.join("&")),url},_generatePreviewTemplate:function(keyword,data){var preview=$(".dnnSearchBox_preview",this.$wrap);preview.length&&preview.remove();var markup='<ul class="dnnSearchBox_preview">';if(data&&data.length){for(var i=0;i<data.length;i++){var group=data[i];if(group.Results&&group.Results.length){var groupTitle=group.ContentItemTypeName;markup+='<li class="dnnSearchBox_preview_group">'+groupTitle+"</li>";for(var j=0;j<group.Results.length;j++){var item=group.Results[j],itemTitle=item.Title,itemUrl=item.DocumentUrl,itemSnippet=item.Snippet;markup+='<li data-url="'+itemUrl+'"><span>'+itemTitle+"</span>",markup+=itemSnippet?"<p>"+itemSnippet+"</p></li>":"</li>"}}}markup+='<li><a href="javascript:void(0)" class="dnnSearchBox_preview_more">'+this.options.seemoreText+"</a></li>",markup+="</ul>"}else markup+="<li>"+this.options.noresultText+"</li><ul>";this.$wrap.append(markup),preview=$(".dnnSearchBox_preview",this.$wrap),$("li",preview).on("click",function(){var navigateUrl=$(this).attr("data-url");return navigateUrl&&(window.location.href=navigateUrl),!1});var searchBtn=$(".dnnSearchButton",this.$wrap);$(".dnnSearchBox_preview_more",this.$wrap).on("click",function(){return searchBtn.triggerHandler("click"),!1})},_search:function(val){if(this.options.searchFunction&&"function"==typeof this.options.searchFunction){var params={};params[this.options.searchQueryParamName]=encodeURIComponent(val);var urlAppend=[];$.each(params,function(index,value){urlAppend.push([index,encodeURIComponent(value)].join("="))}),urlAppend.push([this.options.searchFiltersParamName,""].join("=")),this.options.searchFunction(val,urlAppend)}},_ignoreKeyCodes:[9,13,16,17,18,19,20,27,33,34,35,36,37,38,39,40,45],_attachEvents:function(){var self=this,realInput=this.realInput,clearTextBtn=$("a.dnnSearchBoxClearText",this.$wrap),advanced=$(".dnnSearchBox_advanced",this.$wrap),placeholderSupported="placeholder"in document.createElement("input");if(placeholderSupported?realInput.attr("placeholder",this.options.defaultText):realInput.on("focus",function(){realInput.hasClass("dnnPlaceholder")&&realInput.val("").removeClass("dnnPlaceholder")}).on("blur",function(){var val=realInput.val();val?realInput.removeClass("dnnPlaceholder"):realInput.val(self.options.defaultText).addClass("dnnPlaceholder")}).blur(),realInput.on("keyup",function(e){var k=e.keyCode||e.witch;if(!($.inArray(k,self._ignoreKeyCodes)>-1)){var val=realInput.val(),right=parseInt(realInput.css("right").replace("px",""))-15;val?(clearTextBtn.css({right:right}).addClass("dnnShow"),self.options.enablePreview&&val.length>=self.options.previewMinChars?(self.throttle&&(clearTimeout(self.throttle),delete self.throttle),self.throttle=setTimeout(function(){var service=self.options.moduleId&&$.dnnSF?$.dnnSF(self.options.moduleId):null,url=self._makeUrl(val,service);url&&$.ajax({url:url,beforeSend:service?service.setModuleHeaders:null,success:function(result){result&&self._generatePreviewTemplate(val,result)},error:function(jqXhr,textStatus,errorThrown){$.isFunction(self.options.previewOnError)&&self.options.previewOnError(jqXhr,textStatus,errorThrown)},type:"GET",dataType:"json",contentType:"application/json"})},self.options.previewDelay)):self.options.refreshSearchResult&&self.options.searchFunction&&"function"==typeof self.options.searchFunction&&val.length>=self.options.refreshSearchResultMinChars&&(self.throttle&&(clearTimeout(self.throttle),delete self.throttle),self.throttle=setTimeout(function(){self.options.searchFunction(val)},self.options.refreshSearchResultDelay))):(clearTextBtn.removeClass("dnnShow"),$(".dnnSearchBox_preview",this.$wrap).remove())}}).on("paste",function(){realInput.triggerHandler("keyup")}).on("keypress",function(e){var k=e.keyCode||e.witch;13==k&&($(".dnnSearchButton",this.$wrap).trigger("click"),e.preventDefault())}),clearTextBtn.on("click",function(){return realInput.val("").focus(),clearTextBtn.removeClass("dnnShow"),$(".dnnSearchBox_preview",this.$wrap).remove(),!1}),this.options.showAdvanced){var advancedLabel=$(".dnnSearchBox_advanced_label",advanced),advancedContent=$(".dnnSearchBox_advanced_dropdown",advanced);advancedLabel.on("click",function(){return advancedLabel.toggleClass("dnnExpanded"),advancedContent.toggle(),!1}).mouseup(function(){return!1}),$("body").mouseup(function(){advancedContent.is(":visible")&&(advancedContent.hide(),advancedLabel.removeClass("dnnExpanded"))}),advancedContent.mouseup(function(){return!1}),realInput.mouseup(function(){return!1})}$(".dnnSearchButton",this.$wrap).on("click",function(){if(self.options.refreshSearchResult)return self.options.beforeRefreshSearchResult&&"function"==typeof self.options.beforeRefreshSearchResult&&self.options.beforeRefreshSearchResult(),self.realInput.triggerHandler("keyup"),!1;var val=realInput.val();return val&&self._search(val),!1})}},$.fn.dnnSearchBox=function(options){var instance=$.data(this,"dnnSearchBox");instance?instance._init():instance=$.data(this,"dnnSearchBox",new $.dnnSearchBox(options,this))}}(jQuery,window);