"undefined"==typeof dnn&&(dnn={}),dnn.controlBar=dnn.controlBar||{},dnn.controlBar.init=function(settings){function addCreateModule(){if("EDIT"!==currentUserMode){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);return $.ajax({url:serviceUrl+"ToggleUserMode",type:"POST",data:{UserMode:"EDIT"},beforeSend:service.setModuleHeaders,success:function(){dnn.dom.setCookie("ControlBarInit","CreateModule",0,dnn.controlBar.getSiteRoot()),window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}}),!1}dnn.controlBar.forceCategorySelection=!0,$find(settings.categoryComboId).findItemByValue("Developer").select(),addModule()}function addModule(){if("EDIT"!==currentUserMode){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);return $.ajax({url:serviceUrl+"ToggleUserMode",type:"POST",data:{UserMode:"EDIT"},beforeSend:service.setModuleHeaders,success:function(){dnn.dom.setCookie("ControlBarInit","AddNewModule",0,dnn.controlBar.getSiteRoot()),window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}}),!1}return dnn.controlBar.resetModuleSearch(),dnn.controlBar.status&&dnn.controlBar.status.moduleLoadIndex&&(dnn.controlBar.forceModuleLoadIndex=dnn.controlBar.status.moduleLoadIndex),dnn.controlBar.status&&dnn.controlBar.status.forceScrollX&&(dnn.controlBar.forceScrollX=dnn.controlBar.status.forceScrollX),dnn.controlBar.getDesktopModulesForNewModule(dnn.controlBar.getSelectedCategory(),dnn.controlBar.getSearchTermValue()),dnn.controlBar.cleanViewPort(),dnn.controlBar.addNewModule=!0,toggleModulePane($("#ControlBar_Module_AddNewModule"),!0),$("#ControlBar_Action_Menu").addClass("onActionMenu"),$("#ControlBar_ModuleListMessage_NewModule").hide(),dnn.controlBar.forceModuleLoadIndex=null,!1}dnn.controlBar.selectedPage=null,dnn.controlBar.selectedModule=null,dnn.controlBar.addNewModule=!0,dnn.controlBar.addingModule=!1,dnn.controlBar.addModuleDataVar=null,dnn.controlBar.isMouseDown=!1,dnn.controlBar.hideModuleLocationMenu=!0,dnn.controlBar.showSelectedModule=!1,dnn.controlBar.status=null,dnn.controlBar.scrollBarFixedSize=980,dnn.controlBar.moduleLoadingPageIndex=0,dnn.controlBar.moduleLoadingInitialPageSize=15,dnn.controlBar.moduleLoadingSize=7,dnn.controlBar.allModulesLoaded=!1,dnn.controlBar.forceLoadingPane=!1,dnn.controlBar.forceCategorySelection=!1,dnn.controlBar.forceCategorySearch=!1,dnn.controlBar.scrollTrigger=!0,dnn.controlBar.minInputLength=2,dnn.controlBar.inputDelay=400,dnn.controlBar.lastVal="",dnn.controlBar.searchTimeout=null,dnn.controlBar.bookmarkModuleCategory=settings.bookmarkModuleCategory,dnn.controlBar.bookmarkedModuleKeys=settings.bookmarkedModuleKeys.split(","),dnn.controlBar.initialDragPosition=null,dnn.controlBar.initialScrollPosition=null,dnn.controlBar.arrowScrollingContainer=null,dnn.controlBar.arrowScrollingButtonSpeed=10,dnn.controlBar.mouseWheelScrollingContainer=null,dnn.controlBar.getService=function(){return $.dnnSF()},dnn.controlBar.getServiceUrl=function(service){return service=service||dnn.controlBar.getService(),service.getServiceRoot("internalservices")+"controlbar/"},dnn.controlBar.getPageServiceUrl=function(service){return service=service||dnn.controlBar.getService(),service.getServiceRoot("internalservices")+"PageService/"},dnn.controlBar.getSiteRoot=function(){return dnn.getVar("sf_siteRoot","/")},dnn.controlBar.saveStatus=function(){var categoryComboVal=$find(settings.categoryComboId).get_value(),selectedPageId=dnn.controlBar.selectedPage?dnn.controlBar.selectedPage.id:"",selectedPageName=dnn.controlBar.selectedPage?dnn.controlBar.selectedPage.name:"",visibilityComboVal=$find(settings.visibilityComboId).get_value(),moduleLoadIndex=dnn.controlBar.moduleLoadingPageIndex,forceScrollX=dnn.controlBar.getCurrentScrollPositionX($("#ControlBar_ModuleListHolder_NewModule").next().data("jsp")),searchTerm=dnn.controlBar.getSearchTermValue(),persistValue=[dnn.controlBar.addNewModule,categoryComboVal,selectedPageId,selectedPageName,visibilityComboVal,moduleLoadIndex,forceScrollX,searchTerm].join("|");dnn.dom.setCookie("ControlBarInitStatus",persistValue,0,dnn.controlBar.getSiteRoot()),dnn.controlBar.status=null},dnn.controlBar.loadStatus=function(){if(!dnn.controlBar.status){var persistValue=dnn.dom.getCookie("ControlBarInitStatus");if(persistValue){var persits=persistValue.split("|");dnn.controlBar.status={addNewModule:"true"==persits[0],category:persits[1],pageId:persits[2],pageName:persits[3],visibility:persits[4],moduleLoadIndex:persits[5],forceScrollX:persits[6],searchTerm:persits[7]}}else dnn.controlBar.status=null;dnn.dom.setCookie("ControlBarInitStatus","",-1,dnn.controlBar.getSiteRoot())}},dnn.controlBar.removeStatus=function(){dnn.controlBar.status=null,dnn.dom.setCookie("ControlBarInitStatus","",-1,dnn.controlBar.getSiteRoot())},dnn.controlBar.responseError=function(xhr){xhr&&"401"==xhr.status&&dnnModal.show(settings.loginUrl+(settings.loginUrl.indexOf("?")==-1?"?":"&")+"popUp=true",!0,300,650,!0,"")},dnn.controlBar.getBookmarkItems=function(ul){var items=[];return $("li",ul).each(function(){var tabname=$(this).data("tabname");tabname&&items.push(tabname)}),items.join(",")},dnn.controlBar.saveBookmarkModules=function(title,bookmarkModules,$bookmarkLink,removedBookmarkModuleId){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"SaveBookmark",type:"POST",data:{Title:title,Bookmark:bookmarkModules},beforeSend:service.setModuleHeaders,success:function(){if($bookmarkLink.addClass("hideBookmark"),dnn.controlBar.isBookmarkModuleCategorySelected()){var $moduleItem=$("#ControlBar_Module_AddNewModule ul.ControlBar_ModuleList .ControlBar_ModuleDiv[data-module="+removedBookmarkModuleId+"]");$moduleItem&&$moduleItem.parent().hide()}else $find(settings.categoryComboId).findItemByValue(dnn.controlBar.bookmarkModuleCategory).select()},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.saveBookmark=function(title,ul){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service),bookmark=dnn.controlBar.getBookmarkItems(ul);$.ajax({url:serviceUrl+"SaveBookmark",type:"POST",data:{Title:title,Bookmark:bookmark},beforeSend:service.setModuleHeaders,success:function(){},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.showModuleListLoading=function(containerId,showPanel,showNoResultMessage){var loadingContainer=$(containerId),shouldShowMessage=showNoResultMessage;dnn.controlBar.isFirstModuleLoadingPage()?loadingContainer.removeClass("NextElements"):(loadingContainer.addClass("NextElements"),shouldShowMessage=shouldShowMessage&&!1),dnn.controlBar.setModuleListLoading(containerId,!showPanel,shouldShowMessage)},dnn.controlBar.setModuleListLoading=function(containerId,hideLoading,showNoResultMessage){var loadingContainer=$(containerId),messageContainer=loadingContainer.prev(),listContainer=loadingContainer.next(),scrollContainer=listContainer.next();hideLoading?showNoResultMessage?(listContainer.hide(),scrollContainer.hide(),loadingContainer.hide(),messageContainer.show(),$("p.ControlBar_ModuleListMessage_InitialMessage",messageContainer).hide(),$("p.ControlBar_ModuleListMessage_NoResultMessage",messageContainer).show()):(listContainer.show(),scrollContainer.show(),loadingContainer.hide(),messageContainer.hide()):(dnn.controlBar.isFirstModuleLoadingPage()?listContainer.hide():listContainer.show(),scrollContainer.hide(),loadingContainer.show(),messageContainer.hide())},dnn.controlBar.getModuleLoadingCurrentIndex=function(){return dnn.controlBar.isFirstModuleLoadingPage()?0:dnn.controlBar.moduleLoadingInitialPageSize+dnn.controlBar.moduleLoadingSize*(dnn.controlBar.moduleLoadingPageIndex-1)},dnn.controlBar.getModuleLoadingCurrentPageSize=function(){return dnn.controlBar.isFirstModuleLoadingPage()?dnn.controlBar.forceModuleLoadIndex?dnn.controlBar.moduleLoadingInitialPageSize+dnn.controlBar.forceModuleLoadIndex*dnn.controlBar.moduleLoadingSize:dnn.controlBar.moduleLoadingInitialPageSize:dnn.controlBar.moduleLoadingSize},dnn.controlBar.isFirstModuleLoadingPage=function(){return 0==dnn.controlBar.moduleLoadingPageIndex},dnn.controlBar.getWaitingTime=function(startDate){var minimumTimeToLoading=300,elapsedTime=new Date-startDate,waitingTime=elapsedTime>minimumTimeToLoading?0:minimumTimeToLoading-elapsedTime;return waitingTime},dnn.controlBar.getDesktopModulesForNewModule=function(category,val){if(!dnn.controlBar.allModulesLoaded){dnn.controlBar.isFirstModuleLoadingPage()||(dnn.controlBar.scrollTrigger=!1);var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);dnn.controlBar.showModuleListLoading("#ControlBar_ModuleListWaiter_NewModule",!0);var startDate=new Date,currentIndex=dnn.controlBar.getModuleLoadingCurrentIndex(),pageSize=dnn.controlBar.getModuleLoadingCurrentPageSize();$.ajax({url:serviceUrl+"GetPortalDesktopModules",type:"GET",data:"category="+category+"&loadingStartIndex="+currentIndex+"&loadingPageSize="+pageSize+"&searchTerm="+val,beforeSend:service.setModuleHeaders,success:function(d){setTimeout(function(){if(d&&d.length){dnn.controlBar.showModuleListLoading("#ControlBar_ModuleListWaiter_NewModule",!1),dnn.controlBar.forceLoadingPane=!1,dnn.controlBar.setLoadingModulesMessage(settings.loadingModulesMessage);var containerId="#ControlBar_ModuleListHolder_NewModule";if((dnn.controlBar.isFirstModuleLoadingPage()&&d.length<dnn.controlBar.moduleLoadingInitialPageSize||!dnn.controlBar.isFirstModuleLoadingPage()&&d.length<dnn.controlBar.moduleLoadingSize)&&(dnn.controlBar.allModulesLoaded=!0),dnn.controlBar.isFirstModuleLoadingPage()&&d.length>dnn.controlBar.moduleLoadingInitialPageSize&&(d.length-dnn.controlBar.moduleLoadingInitialPageSize)%dnn.controlBar.moduleLoadingSize!=0&&(dnn.controlBar.allModulesLoaded=!0),dnn.controlBar.renderModuleList(containerId,d),dnn.controlBar.isFirstModuleLoadingPage()&&d.length>dnn.controlBar.moduleLoadingInitialPageSize){var pageCount=d.length-dnn.controlBar.moduleLoadingInitialPageSize;pageCount%dnn.controlBar.moduleLoadingSize==0?dnn.controlBar.moduleLoadingPageIndex=parseInt(pageCount/dnn.controlBar.moduleLoadingSize)+1:dnn.controlBar.moduleLoadingPageIndex=parseInt(pageCount/dnn.controlBar.moduleLoadingSize)+2}else dnn.controlBar.moduleLoadingPageIndex=dnn.controlBar.moduleLoadingPageIndex+1}else dnn.controlBar.getSelectedCategory()==settings.defaultCategoryValue?(dnn.controlBar.showModuleListLoading("#ControlBar_ModuleListWaiter_NewModule",!1,!0),dnn.controlBar.setLoadingModulesMessage(settings.loadingModulesMessage),dnn.controlBar.allModulesLoaded=!0):(dnn.controlBar.setLoadingModulesMessage(String.format(settings.loadingModulesOnNoDefaultCategoryMessage,dnn.controlBar.getSelectedCategory())),dnn.controlBar.forceCategorySearch=!0,$find(settings.categoryComboId).findItemByValue(settings.defaultCategoryValue).select())},dnn.controlBar.getWaitingTime(startDate))},error:function(xhr){dnn.controlBar.responseError(xhr),dnn.controlBar.isFirstModuleLoadingPage()||(dnn.controlBar.scrollTrigger=!0)}})}},dnn.controlBar.setLoadingModulesMessage=function(message){var $loadingMessageElement=$("#"+settings.loadingModulesId);$loadingMessageElement.text(message)},dnn.controlBar.getSearchTermValue=function(){var $searchInput=$("#"+settings.searchInputId);return $searchInput.val()},dnn.controlBar.initModuleSearch=function(){var $searchInput=$("#"+settings.searchInputId);$searchInput.mouseup(function(){return!1}).keypress(function(e){if(13==e.keyCode){var val=$(this).val();return clearTimeout(dnn.controlBar.searchTimeout),dnn.controlBar.searchModules(val),!1}}).keyup(function(e){var val=$(this).val();dnn.controlBar.lastVal.length!=val.length&&(0==val.length||val.length>=dnn.controlBar.minInputLength)&&(clearTimeout(dnn.controlBar.searchTimeout),dnn.controlBar.searchTimeout=setTimeout(function(){dnn.controlBar.searchModules(val)},dnn.controlBar.inputDelay)),dnn.controlBar.lastVal=val});var $searchButton=$("#ControlBar_Module_AddNewModule .search-container .search-button");$searchButton.click(function(){dnn.controlBar.searchModules(dnn.controlBar.getSearchTermValue())});var $clearButton=$("#ControlBar_Module_AddNewModule .search-container .clear-button");$clearButton.click(function(){dnn.controlBar.resetModuleSearch(),dnn.controlBar.searchModules(dnn.controlBar.getSearchTermValue())})},dnn.controlBar.initModuleSearch(),dnn.controlBar.searchModules=function(val){dnn.controlBar.moduleLoadingPageIndex=0,dnn.controlBar.allModulesLoaded=!1,dnn.controlBar.getDesktopModulesForNewModule(dnn.controlBar.getSelectedCategory(),val)},dnn.controlBar.getTabModules=function(tab){dnn.controlBar.resetModuleSearch();var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);dnn.controlBar.setModuleListLoading("#ControlBar_ModuleListWaiter_ExistingModule"),$.ajax({url:serviceUrl+"GetTabModules",type:"GET",data:"tab="+tab,beforeSend:service.setModuleHeaders,success:function(d){if(d&&d.length){dnn.controlBar.setModuleListLoading("#ControlBar_ModuleListWaiter_ExistingModule",!0);var containerId="#ControlBar_ModuleListHolder_ExistingModule";dnn.controlBar.allModulesLoaded=!0,dnn.controlBar.renderModuleList(containerId,d),dnn.controlBar.moduleLoadingPageIndex=dnn.controlBar.moduleLoadingPageIndex+1}else dnn.controlBar.setModuleListLoading("#ControlBar_ModuleListWaiter_ExistingModule",!0,!0);dnn.controlBar.allModulesLoaded=!0},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.addModule=function(module,page,pane,position,sort,visibility,addExistingModule,copyModule){var dataVar={Module:module,Page:page,Pane:pane,Position:position,Sort:sort,Visibility:visibility,AddExistingModule:addExistingModule,CopyModule:copyModule},sharing="true"==(dnn.getVar("moduleSharing")||"false");if(sharing&&!dnn.controlBar.addNewModule){var selectedTabId=page,selectedModuleId=module,parameters={ModuleId:selectedModuleId,TabId:selectedTabId},moduleShareableUrl=$.dnnSF().getServiceRoot("internalservices")+"ModuleService/GetModuleShareable";$.ajax({url:moduleShareableUrl,type:"GET",async:!1,data:parameters,success:function(m){return m?void(m.RequiresWarning?(dnn.controlBar.popupShareableWarning(),dnn.controlBar.addModuleDataVar=dataVar):dnn.controlBar.doAddModule(dataVar)):void(dnn.controlBar.addingModule=!1)},error:function(xhr){dnn.controlBar.addingModule=!1,dnn.controlBar.responseError(xhr)}})}else dnn.controlBar.doAddModule(dataVar)},dnn.controlBar.doAddModule=function(dataVar){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"AddModule",type:"POST",data:dataVar,beforeSend:service.setModuleHeaders,success:function(d){dnn.controlBar.addingModule=!1,dnn.dom.setCookie("FadeModuleID",d.TabModuleID,0,dnn.controlBar.getSiteRoot()),dnn.controlBar.saveStatus(),window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.addingModule=!1,dnn.controlBar.responseError(xhr)}})},dnn.controlBar.clearHostCache=function(){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"ClearHostCache",type:"POST",beforeSend:service.setModuleHeaders,success:function(){window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.copyPermissionsToChildren=function(){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"CopyPermissionsToChildren",type:"POST",beforeSend:service.setModuleHeaders,success:function(){window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.publishPage=function(){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getPageServiceUrl(service),requestData={Publish:"true"!=settings.publishedPage};$.ajax({url:serviceUrl+"PublishPage",type:"POST",data:requestData,beforeSend:service.setModuleHeaders,success:function(){window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.recycleAppPool=function(){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"RecycleApplicationPool",type:"POST",beforeSend:service.setModuleHeaders,success:function(){window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}})},dnn.controlBar.switchSite=function(site){if(site){var dataVar={Site:site},service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"SwitchSite",type:"POST",data:dataVar,beforeSend:service.setModuleHeaders,success:function(d){d&&d.RedirectURL&&(window.location.href=d.RedirectURL)},error:function(xhr){dnn.controlBar.responseError(xhr)}})}},dnn.controlBar.switchLanguage=function(language){if(language){var dataVar={Language:language},service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"SwitchLanguage",type:"POST",data:dataVar,beforeSend:service.setModuleHeaders,success:function(){window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}})}},dnn.controlBar.popupShareableWarning=function(){$("#shareableWarning").dialog({autoOpen:!0,resizable:!1,modal:!0,width:"500px",zIndex:1e3,stack:!1,title:settings.moduleShareableTitle,dialogClass:"dnnFormPopup dnnClear",open:function(){},close:function(){}})},dnn.controlBar.hideShareableWarning=function(){$("#shareableWarning").dialog("close")},dnn.controlBar.isActiveElementEmpty=function(){var $activeElement=$(document.activeElement);return!($activeElement&&$activeElement.length>0)||"INPUT"!=$activeElement.get(0).tagName&&"TEXTAREA"!=$activeElement.get(0).tagName||0==$activeElement.val().length},dnn.controlBar.initialiseArrowScrolling=function(container){dnn.controlBar.arrowScrollingContainer=container},dnn.controlBar.initialiseMouseWheelScrolling=function(container){dnn.controlBar.mouseWheelScrollingContainer=container.parent()},dnn.controlBar.isValidArrowScrollingContainer=function(){return!(!dnn.controlBar.arrowScrollingContainer||!dnn.controlBar.arrowScrollingContainer.is(":visible"))},dnn.controlBar.isValidMouseWheelScrollingContainer=function(targetElement){return!!(dnn.controlBar.mouseWheelScrollingContainer&&dnn.controlBar.mouseWheelScrollingContainer.has(targetElement).length>0)},dnn.controlBar.getWheelEventDelta=function(event){return event.deltaY?event.deltaY:event.wheelDelta?event.wheelDelta*-1:event.detail},dnn.controlBar.moveScrollingContainer=function(direction,speed){if(speed||(speed=1),dnn.controlBar.scrollTrigger){var xOffset="left"==direction?dnn.controlBar.arrowScrollingButtonSpeed*-1*speed:"right"==direction?dnn.controlBar.arrowScrollingButtonSpeed*speed:0,scrollContainer=dnn.controlBar.arrowScrollingContainer.next(),jspapi=scrollContainer.data("jsp");jspapi&&0!=xOffset&&jspapi.scrollByX(xOffset)}},dnn.controlBar.moveArrowScrollingContainer=function(keyCode){37==keyCode?dnn.controlBar.moveScrollingContainer("left",1):39==keyCode&&dnn.controlBar.moveScrollingContainer("right",1)},dnn.controlBar.moveMouseWheelScrollingContainer=function(delta){delta<0?dnn.controlBar.moveScrollingContainer("left",3):dnn.controlBar.moveScrollingContainer("right",3)},dnn.controlBar.addBookmarkModule=function(moduleId){return dnn.controlBar.bookmarkedModuleKeys.indexOf(moduleId)<0&&dnn.controlBar.bookmarkedModuleKeys.push(moduleId),dnn.controlBar.bookmarkedModuleKeys.join(",")},dnn.controlBar.removeBookmarkModule=function(moduleId){var index=dnn.controlBar.bookmarkedModuleKeys.indexOf(moduleId);return index>=0&&dnn.controlBar.bookmarkedModuleKeys.splice(index,1),dnn.controlBar.bookmarkedModuleKeys.join(",")},dnn.controlBar.isBookmarkModuleCategorySelected=function(){return dnn.controlBar.getSelectedCategory()==dnn.controlBar.bookmarkModuleCategory},dnn.controlBar.getBookmarkClass=function(bookmarked,existsInBookmarkCategory){return existsInBookmarkCategory?"bookmark hideBookmark":dnn.controlBar.isBookmarkModuleCategorySelected()?bookmarked?"removeBookmark":"bookmark hideBookmark":bookmarked?"bookmark hideBookmark":"bookmark"},dnn.controlBar.getBookmarkTooltip=function(bookmarkClass){return bookmarkClass.indexOf("removeBookmark")>=0?settings.removeBookmarksTip:settings.addToBookmarksTip},dnn.controlBar.fillModuleList=function(ul,moduleList){dnn.controlBar.isFirstModuleLoadingPage()&&ul.empty().css("left",1e3),$("li.moreModules",ul).remove();for(var i=0;i<moduleList.length;i++){var bookmarkClass=dnn.controlBar.getBookmarkClass(moduleList[i].Bookmarked,moduleList[i].ExistsInBookmarkCategory),bookmarkTooltip=dnn.controlBar.getBookmarkTooltip(bookmarkClass);ul.append('<li><div class="ControlBar_ModuleDiv" data-module='+moduleList[i].ModuleID+'><div class="ModuleLocator_Menu"></div><a href="javascript:void(0)" class="'+bookmarkClass+'" title="'+bookmarkTooltip+'"/><img src="'+moduleList[i].ModuleImage+'" alt="" /><span>'+moduleList[i].ModuleName+"</span></div></li>")}},dnn.controlBar.cleanViewPort=function(){$(".viewportSeparator").each(function(){$(this).get(0).style.display=""})},dnn.controlBar.setViewPort=function(windowWidth,margin){var viewportRelativeSize=Math.round(100*margin/windowWidth);$(".viewportSeparator").css("width",viewportRelativeSize+"%").show()},dnn.controlBar.getScrollBarMargin=function(windowWidth){return Math.round((windowWidth-dnn.controlBar.scrollBarFixedSize)/2)},dnn.controlBar.renderModuleList=function(containerId,moduleList){var currentModuleLoadingPageIndex=dnn.controlBar.moduleLoadingPageIndex,container=$(containerId);dnn.controlBar.initialiseArrowScrolling(container),dnn.controlBar.initialiseMouseWheelScrolling(container);var scrollContainer=container.next();if(dnn.controlBar.isFirstModuleLoadingPage()){var api=scrollContainer.data("jsp");api&&(api.scrollToX(0,null),api.destroy()),scrollContainer=container.next()}var ul=$("ul.ControlBar_ModuleList",container);dnn.controlBar.fillModuleList(ul,moduleList),$("#ControlBar_Module_ModulePosition").hide();var windowWidth=$(window).width(),margin=dnn.controlBar.getScrollBarMargin(windowWidth),ulWidth=160*dnn.controlBar.getModuleLoadingCurrentIndex()+160*moduleList.length+(dnn.controlBar.allModulesLoaded?margin:0);ul.css("width",ulWidth+"px"),dnn.controlBar.setViewPort(windowWidth,margin);var dummyScrollWidth=Math.round(dnn.controlBar.scrollBarFixedSize*(ulWidth+margin)/windowWidth),ulLeft=margin,oldX=0,reloading=!1,isFirstModuleLoadingPage=dnn.controlBar.isFirstModuleLoadingPage(),modulesInitFunc=function(){if($("div.controlBar_ModuleListScrollDummy_Content",scrollContainer).css("width",dummyScrollWidth),0==currentModuleLoadingPageIndex)scrollContainer.jScrollPane({arrowButtonSpeed:dnn.controlBar.arrowScrollingButtonSpeed});else{var jspapi=scrollContainer.data("jsp");jspapi&&(dnn.controlBar.scrollTrigger=!1,jspapi.reinitialise(),dnn.controlBar.scrollTrigger=!0)}var $searchInput=$("#"+settings.searchInputId);if($searchInput.focus(),scrollContainer.unbind("jsp-scroll-x"),scrollContainer.bind("jsp-scroll-x",function(e,x,isAtleft,isAtRight){var xOffset,leftOffset;if(dnn.controlBar.scrollTrigger){if(isAtleft)oldX=0,ulLeft=margin,reloading=!1;else if(isAtRight){var justAtRight=oldX==x;oldX=Math.round(dnn.controlBar.scrollBarFixedSize*(ulWidth+margin)/windowWidth)-dnn.controlBar.scrollBarFixedSize,0!=moduleList.length&&justAtRight&&!reloading&&(reloading=!0,dnn.controlBar.getDesktopModulesForNewModule(dnn.controlBar.getSelectedCategory(),dnn.controlBar.getSearchTermValue())),ulLeft=-(ulWidth-windowWidth)}else reloading=!1,x>oldX?(xOffset=x-oldX,leftOffset=(ulWidth+margin)/(dnn.controlBar.scrollBarFixedSize*(ulWidth+margin)/windowWidth)*xOffset,ulLeft-=Math.abs(leftOffset)):(xOffset=oldX-x,leftOffset=(ulWidth+margin)/(dnn.controlBar.scrollBarFixedSize*(ulWidth+margin)/windowWidth)*xOffset,ulLeft+=Math.abs(leftOffset)),oldX=x;ul.css("left",ulLeft+"px")}}),$("#ControlBar_Module_AddNewModule .ControlBar_ModuleDiv a.bookmark").on("click",function(){var moduleId=$(this).parent().attr("data-module"),bookmarTitle="module",bookmarkModules=dnn.controlBar.addBookmarkModule(moduleId);dnn.controlBar.saveBookmarkModules(bookmarTitle,bookmarkModules,$(this))}).hover(function(){if(!($(this).attr("class").indexOf("hideBookmark")>0)){$(this).addClass("highlight");var $self=$(this).parent();$self.dnnHelperTipDestroy()}},function(){$(this).removeClass("highlight");var holderId=$(this).parent().attr("id"),$self=$(this).parent();$self.dnnHelperTip({helpContent:settings.dragModuleToolTip,holderId:holderId,show:!0})}),$("#ControlBar_Module_AddNewModule .ControlBar_ModuleDiv a.removeBookmark").on("click",function(){var moduleId=$(this).parent().attr("data-module"),bookmarTitle="module",bookmarkModules=dnn.controlBar.removeBookmarkModule(moduleId);dnn.controlBar.saveBookmarkModules(bookmarTitle,bookmarkModules,$(this),moduleId)}).hover(function(){if(!($(this).attr("class").indexOf("hideBookmark")>0)){$(this).addClass("highlight");var $self=$(this).parent();$self.dnnHelperTipDestroy()}},function(){$(this).removeClass("highlight");var holderId=$(this).parent().attr("id"),$self=$(this).parent();$self.dnnHelperTip({helpContent:settings.dragModuleToolTip,holderId:holderId,show:!0})}),$("div.ControlBar_ModuleDiv",ul).each(function(){this.id||(this.id="ControlBar_ModuleDiv_"+$(this).data("module"))}).hover(function(){if(!dnn.controlBar.isMouseDown){var $this=$(this),dataModuleId=$this.data("module");dnn.controlBar.selectedModule&&dnn.controlBar.selectedModule.data("module")!==dataModuleId&&!$("#ControlBar_Module_ModulePosition").is(":visible")&&dnn.controlBar.unselectModule(dnn.controlBar.selectedModule),$this.addClass("ControlBar_Module_Selected"),$this.mousedown(function(){$(this).addClass("grabbing")}),$("#ControlBar_Module_ModulePosition").is(":visible")||$this.find("div.ModuleLocator_Menu").removeClass("ModuleLocator_Hover"),dnn.controlBar.selectedModule=$this,dnn.controlBar.showSelectedModule=!0;var holderId=this.id,$self=$(this);$self.dnnHelperTip({helpContent:settings.dragModuleToolTip,holderId:holderId,show:!0}),$this.find("a.bookmark").show(),$this.find("a.removeBookmark").show()}},function(){if(!dnn.controlBar.isMouseDown){dnn.controlBar.showSelectedModule=!1;$(this);setTimeout(function(){dnn.controlBar.showSelectedModule||!dnn.controlBar.selectedModule||$("#ControlBar_Module_ModulePosition").is(":visible")||dnn.controlBar.unselectModule(dnn.controlBar.selectedModule)},600)}$(this).dnnHelperTipDestroy()}).mousedown(function(){$(".DNNEmptyPane").each(function(){$(this).removeClass("DNNEmptyPane").addClass("dnnDropEmptyPanes")}),$(".contentPane").each(function(){this.className=this.className}),dnn.controlBar.addGrabbingStyle($(this))}).mouseup(function(){$(".dnnDropEmptyPanes").each(function(){$(this).removeClass("dnnDropEmptyPanes").addClass("DNNEmptyPane")}),$(".contentPane").each(function(){this.className=this.className}),dnn.controlBar.removeGrabbingStyle($("div.ControlBar_ModuleDiv",ul))}).draggable({dropOnEmpty:!0,cursor:"move",placeholder:"dnnDropTarget",helper:function(event,ui){var dragTip=$('<div class="dnnDragdropTip helperGrabbing ControlBar_ModuleDiv"></div>'),title=$("span",this).html();return dragTip.html(title),dragTip.mouseup(function(){dnn.controlBar.removeGrabbingStyle($("div.ControlBar_ModuleDiv",ul))}),$("body").append(dragTip),$(this).dnnHelperTipDestroy(),dnn.controlBar.dragdropModule=$(this).data("module"),dnn.controlBar.dragdropPage=dnn.controlBar.selectedPage?dnn.controlBar.selectedPage.id:null,dnn.controlBar.dragdropVisibility=$find(settings.visibilityComboId).get_value(),dnn.controlBar.dragdropCopyModule=$("#ControlBar_Module_chkCopyModule").get(0).checked,dnn.controlBar.dragdropAddExistingModule=!dnn.controlBar.addNewModule,dragTip},drag:function(e,ui){if(dnn.controlBar.isCursorOutsideY(e,container))return $("div.helperGrabbing").removeClass("helperGrabbing"),void(navigator.userAgent.match(/MSIE/i)&&$("div.dnnDragdropTip").css("cursor","move"));$("div.dnnDragdropTip").addClass("helperGrabbing"),navigator.userAgent.match(/MSIE/i)&&$("div.dnnDragdropTip").css("cursor","");var xOffset=dnn.controlBar.initialDragPosition.X-e.pageX,scrollNewX=dnn.controlBar.initialScrollPosition.X+dnn.controlBar.scrollBarFixedSize*(ulWidth+margin)/windowWidth*xOffset/(ulWidth+margin),jspapi=scrollContainer.data("jsp");jspapi&&jspapi.scrollToX(scrollNewX)},cursorAt:{left:10,top:30},connectToSortable:".dnnSortable",stop:function(event,ui){$(".dnnDropEmptyPanes").each(function(){$(this).removeClass("dnnDropEmptyPanes").addClass("DNNEmptyPane")}),$(".contentPane").each(function(){this.className=this.className}),$("div.actionMenu").show()},start:function(event,ui){dnn.controlBar.setInitialPositions(event,scrollContainer),$("div.actionMenu").hide()}}),$("div.ModuleLocator_Menu",ul).hover(function(){var $this=$(this);$this.addClass("ModuleLocator_Hover");var left=$this.offset().left;dnn.controlBar.hideModuleLocationMenu=!1,dnn.controlBar.showSelectedModule=!0,$("#ControlBar_Module_ModulePosition").css({left:left-177,top:135}).slideDown("fast",function(){$(this).jScrollPane()}).hover(function(){dnn.controlBar.hideModuleLocationMenu=!1,dnn.controlBar.showSelectedModule=!0},function(){dnn.controlBar.hideModuleLocationMenu=!0,dnn.controlBar.showSelectedModule=!1,setTimeout(function(){dnn.controlBar.hideModuleLocationMenu&&($this.removeClass("ModuleLocator_Hover"),$("#ControlBar_Module_ModulePosition").slideUp("fast",function(){dnn.controlBar.selectedModule&&dnn.controlBar.selectedModule.data("module")!=$this.parent().data("module")&&dnn.controlBar.unselectModule($this.parent())})),!dnn.controlBar.showSelectedModule&&dnn.controlBar.selectedModule&&dnn.controlBar.unselectModule(dnn.controlBar.selectedModule)},200)}),$this.parent().dnnHelperTipDestroy()},function(){var $this=$(this);dnn.controlBar.hideModuleLocationMenu=!0,setTimeout(function(){dnn.controlBar.hideModuleLocationMenu&&($this.removeClass("ModuleLocator_Hover"),$("#ControlBar_Module_ModulePosition").slideUp("fast",function(){dnn.controlBar.selectedModule&&dnn.controlBar.selectedModule.data("module")!=$this.parent().data("module")&&dnn.controlBar.unselectModule($this.parent())})),!dnn.controlBar.showSelectedModule&&dnn.controlBar.selectedModule&&dnn.controlBar.unselectModule(dnn.controlBar.selectedModule)},200)}),isFirstModuleLoadingPage&&dnn.controlBar.forceScrollX){var jspapi=scrollContainer.data("jsp");jspapi&&(jspapi.scrollToX(dnn.controlBar.forceScrollX,null),dnn.controlBar.forceScrollX=null)}};!dnn.controlBar.isFirstModuleLoadingPage()||dnn.controlBar.forceScrollX&&0!=dnn.controlBar.forceScrollX||ul.animate({left:margin},300),setTimeout(modulesInitFunc,0)},dnn.controlBar.addGrabbingStyle=function($selector){$selector.addClass("grabbing"),(navigator.userAgent.match(/MSIE/i)||navigator.userAgent.match(/Safari/i))&&$selector.css("cursor","url('/images/icon_cursor_grabbing.cur'), move")},dnn.controlBar.removeGrabbingStyle=function($selector){$selector.removeClass("grabbing"),(navigator.userAgent.match(/MSIE/i)||navigator.userAgent.match(/Safari/i))&&$selector.css("cursor","")},dnn.controlBar.getCurrentScrollPositionX=function(jspapi){var scrollX=0;if(jspapi){var scrollPosX=parseInt(jspapi.getContentPositionX());scrollPosX&&(scrollX=scrollPosX)}return scrollX},dnn.controlBar.setInitialPositions=function(dragEvent,$scrollContainer){dnn.controlBar.initialDragPosition={X:dragEvent.pageX,Y:dragEvent.pageY};var scrollX=dnn.controlBar.getCurrentScrollPositionX($scrollContainer.data("jsp"));dnn.controlBar.initialScrollPosition={X:scrollX,Y:0}},dnn.controlBar.isCursorOutsideY=function(dragEvent,$container){var containerOffSet=$container.offset();return dragEvent.pageY>containerOffSet.top+$container.height()},dnn.controlBar.unselectModule=function($selectedModule){
$selectedModule.removeClass("ControlBar_Module_Selected"),$selectedModule.find("a.bookmark").length>0&&($selectedModule.find("a.bookmark").get(0).style.display=""),$selectedModule.find("a.removeBookmark").length>0&&($selectedModule.find("a.removeBookmark").get(0).style.display="")},dnn.controlBar.resetModuleSearch=function(){var $searchInput=$("#"+settings.searchInputId);$searchInput.val("").focus(),dnn.controlBar.status&&dnn.controlBar.status.searchTerm&&$searchInput.val(dnn.controlBar.status.searchTerm),dnn.controlBar.resetModuleLoadingSettings()},dnn.controlBar.resetModuleLoadingSettings=function(){dnn.controlBar.moduleLoadingPageIndex=0,dnn.controlBar.allModulesLoaded=!1,dnn.controlBar.mousedown=!1},dnn.controlBar.getSelectedCategory=function(){var category=null;if(dnn.controlBar.status&&dnn.controlBar.status.addNewModule){var selectedCategory=dnn.controlBar.status.category;selectedCategory&&(category=selectedCategory,dnn.controlBar.removeStatus(),$find(settings.categoryComboId).get_value()!=selectedCategory&&(dnn.controlBar.forceCategorySelection=!0,$find(settings.categoryComboId).findItemByValue(selectedCategory).select()))}else{var $categoryCombo=$find(settings.categoryComboId);category=$categoryCombo?$categoryCombo.get_value():settings.defaultCategoryValue}return category},dnn.controlBar.ControlBar_Module_CategoryList_Changed=function(sender,e){var item=e.get_item();item&&!dnn.controlBar.forceCategorySelection?(dnn.controlBar.forceCategorySearch?(dnn.controlBar.forceCategorySearch=!1,dnn.controlBar.resetModuleLoadingSettings()):dnn.controlBar.resetModuleSearch(),dnn.controlBar.getDesktopModulesForNewModule(item.get_value(),dnn.controlBar.getSearchTermValue())):dnn.controlBar.forceCategorySelection&&(dnn.controlBar.forceCategorySelection=!1)},dnn.controlBar.ControlBar_Module_PageList_Changed=function(selectedNode){selectedNode.key?dnn.controlBar.selectedPage={id:parseInt(selectedNode.key,10),name:selectedNode.value}:dnn.controlBar.selectedPage=null;var visibilityCombo=$find(settings.visibilityComboId),makeCopyCheckbox=$("#"+settings.makeCopyCheckboxId);dnn.controlBar.selectedPage?(dnn.controlBar.getTabModules(dnn.controlBar.selectedPage.id),visibilityCombo.enable(),makeCopyCheckbox.attr("disabled",!1).parent().removeClass("disabled"),dnn.controlBar.status&&!dnn.controlBar.status.addNewModule&&visibilityCombo.findItemByValue(dnn.controlBar.status.visibility).select()):(visibilityCombo.disable(),makeCopyCheckbox.attr("disabled",!0).parent().addClass("disabled"))},$(document).mousedown(function(){dnn.controlBar.isMouseDown=!0}),$(document).mouseup(function(){dnn.controlBar.isMouseDown=!1}),$(window).resize(function(){if((!dnn.controlBar.addNewModule||$("#ControlBar_ModuleListHolder_NewModule").is(":visible"))&&(dnn.controlBar.addNewModule||$("#ControlBar_ModuleListHolder_ExistingModule").is(":visible"))){var windowWidth=$(window).width(),margin=dnn.controlBar.getScrollBarMargin(windowWidth);dnn.controlBar.setViewPort(windowWidth,margin)}});var currentUserMode=settings.currentUserMode;$("div.subNav").hide(),$("#ControlNav > li").hoverIntent({over:function(){$("#ControlNav > li").each(function(){var subNav=$(this).find("div.subNav");subNav.is(":visible")&&($("div[class*=RadComboBox]",subNav).each(function(){var combo=$find($(this).attr("id"));null!=combo&&combo.hideDropDown()}),$(this).prop("hoverIntent_s",1).trigger("mouseleave"))}),$(".onActionMenu").removeClass("onActionMenu"),toggleModulePane($(".ControlModulePanel"),!1),$(this).addClass("hover");var subNav=$(this).find("div.subNav");subNav.slideDown(300,function(){dnn.addIframeMask(subNav[0])})},out:function(){if(!dnn.controlBar.focused){$(this).removeClass("hover");var subNav=$(this).find("div.subNav");subNav.slideUp(200,function(){dnn.removeIframeMask(subNav[0])})}},timeout:300,interval:150}),$("#ControlActionMenu > li").hoverIntent({over:function(){$(".onActionMenu").removeClass("onActionMenu"),toggleModulePane($(".ControlModulePanel"),!1);var subNav=$(this).find("ul");subNav.slideDown(200,function(){dnn.addIframeMask(subNav[0])})},out:function(){var subNav=$(this).find("ul");subNav.slideUp(150,function(){dnn.removeIframeMask(subNav[0])})},timeout:300,interval:150}),$("ul#ControlEditPageMenu > li").hoverIntent({over:function(){$(".onActionMenu").removeClass("onActionMenu"),toggleModulePane($(".ControlModulePanel"),!1);var subNav=$(this).find("ul");subNav.slideDown(400,function(){dnn.addIframeMask(subNav[0])})},out:function(){var subNav=$(this).find("ul");subNav.slideUp(300,function(){dnn.removeIframeMask(subNav[0])})},timeout:300,interval:150}),$(".subNavToggle li a").click(function(event){var ul=$(this).closest("ul"),divSubNav=ul.parent();if(!$(this).parent("li").hasClass("active")){$("li",ul).removeClass("active"),$(this).parent("li").addClass("active");var anchorTarget=$(this).attr("href");$("dl",divSubNav).hide(),$(anchorTarget).show()}return!1}),$("#controlBar_AddNewModule").click(addModule),$("#controlBar_CreateModule").click(addCreateModule),$("#controlBar_AddExistingModule").click(function(){if("EDIT"!==currentUserMode){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);return $.ajax({url:serviceUrl+"ToggleUserMode",type:"POST",data:{UserMode:"EDIT"},beforeSend:service.setModuleHeaders,success:function(){dnn.dom.setCookie("ControlBarInit","AddExistingModule",0,dnn.controlBar.getSiteRoot()),window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}}),!1}if(dnn.controlBar.status&&!dnn.controlBar.status.addNewModule){var selectedPageId=dnn.controlBar.status.pageId;if(selectedPageId){dnn.controlBar.selectedPage={id:parseInt(selectedPageId,10),name:dnn.controlBar.status.pageName},dnn[settings.pagePickerId].selectedItem({key:selectedPageId,value:dnn.controlBar.status.pageName});var visibilityCombo=$find(settings.visibilityComboId),makeCopyCheckbox=$("#"+settings.makeCopyCheckboxId);dnn.controlBar.getTabModules(selectedPageId),visibilityCombo.enable(),makeCopyCheckbox.attr("disabled",!1).parent().removeClass("disabled"),dnn.controlBar.status&&!dnn.controlBar.status.addNewModule&&visibilityCombo.findItemByValue(dnn.controlBar.status.visibility).select()}}dnn.controlBar.cleanViewPort(),dnn.controlBar.addNewModule=!1,toggleModulePane($("#ControlBar_Module_AddExistingModule"),!0),$("#ControlBar_Action_Menu").addClass("onActionMenu");var messageContainer=$("#ControlBar_ModuleListMessage_ExistingModule"),loadingContainer=messageContainer.next(),listContainer=loadingContainer.next(),scrollContainer=listContainer.next();return messageContainer.show(),loadingContainer.hide(),listContainer.hide(),scrollContainer.hide(),$("p.ControlBar_ModuleListMessage_InitialMessage",messageContainer).show(),$("p.ControlBar_ModuleListMessage_NoResultMessage",messageContainer).hide(),!1}),$("#ControlBar_Module_ModulePosition > li").click(function(){if(dnn.controlBar.addingModule)return!1;dnn.controlBar.addingModule=!0;var module=dnn.controlBar.selectedModule,page=dnn.controlBar.selectedPage?dnn.controlBar.selectedPage.id:-1,pane=$(this).data("pane"),position=$(this).data("position"),visibility=$find(settings.visibilityComboId).get_value(),copyModule=$("#ControlBar_Module_chkCopyModule").get(0).checked,addExistingModule=!dnn.controlBar.addNewModule;return dnn.controlBar.addModule(module.data("module")+"",page,pane,position,"-1",visibility,addExistingModule+"",copyModule+""),!1}),$("#controlBar_ClearCache").click(function(){return dnn.controlBar.clearHostCache(),!1}),$("#controlBar_RecycleAppPool").click(function(){return dnn.controlBar.recycleAppPool(),!1}),$("a#controlBar_CopyPermissionsToChildren").dnnConfirm({text:settings.copyPermissionsToChildrenText,yesText:settings.yesText,noText:settings.noText,title:settings.titleText,callbackTrue:function(){dnn.controlBar.copyPermissionsToChildren()}}),$("#controlBar_SwitchSite_DropDown, #controlBar_SwitchLanguage_DropDown").mouseenter(function(e){dnn.controlBar.focused=!0}).mouseleave(function(e){dnn.controlBar.focused=!1}).click(function(e){dnn.controlBar.focused=!1}),$("#controlBar_SwitchSiteButton").click(function(){var site=$find("controlBar_SwitchSite").get_value();return dnn.controlBar.switchSite(site),!1}),$("#controlBar_SwitchLanguageButton").click(function(){var language=$find("controlBar_SwitchLanguage").get_value();return dnn.controlBar.switchLanguage(language),!1});var toggleModulePane=function(pane,show){var paneVisible=pane.is(":visible");show?paneVisible||pane.animate({height:"show"},100,function(){$("#Form").addClass("showModulePane"),$(window).resize()}):paneVisible&&pane.animate({height:"hide"},100,function(){$("#Form").removeClass("showModulePane"),$(window).resize()})};$("a.ControlBar_PopupLink").click(function(){var href=$(this).attr("href");return href&&dnnModal.show(href+(href.indexOf("?")==-1?"?":"&")+"popUp=true",!0,550,950,!0,""),!1}),$("a.ControlBar_PopupLink_EditMode").click(function(){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service),that=this;if("EDIT"!==currentUserMode){var mode="EDIT";$.ajax({url:serviceUrl+"ToggleUserMode",type:"POST",data:{UserMode:mode},beforeSend:service.setModuleHeaders,success:function(){var href=$(that).attr("href");href&&dnnModal.show(href+(href.indexOf("?")==-1?"?":"&")+"popUp=true",!0,550,950,!0,"")},error:function(xhr){dnn.controlBar.responseError(xhr)}})}else{var href=$(that).attr("href");href&&dnnModal.show(href+(href.indexOf("?")==-1?"?":"&")+"popUp=true",!0,550,950,!0,"")}return!1}),$("a#ControlBar_DeletePage").dnnConfirm({text:settings.deleteText,yesText:settings.yesText,noText:settings.noText,title:settings.titleText}),$("a#ControlBar_PublishPage").dnnConfirm({text:settings.publishConfirmText,yesText:settings.yesText,noText:settings.noText,title:settings.publishConfirmHeader,callbackTrue:function(){dnn.controlBar.publishPage()},width:"500px"}),$("a#shareableWarning_cmdConfirm").click(function(){return dnn.controlBar.hideShareableWarning(),dnn.controlBar.addModuleDataVar&&dnn.controlBar.doAddModule(dnn.controlBar.addModuleDataVar),dnn.controlBar.addModuleDataVar=null,dnn.controlBar.addingModule=!1,!1}),$("a#shareableWarning_cmdCancel").click(function(){return dnn.controlBar.hideShareableWarning(),dnn.controlBar.addModuleDataVar=null,dnn.controlBar.addingModule=!1,!1}),$("a#ControlBar_EditPage").click(function(){var service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service),mode="EDIT"===currentUserMode?"VIEW":"EDIT";return $.ajax({url:serviceUrl+"ToggleUserMode",type:"POST",data:{UserMode:mode},beforeSend:service.setModuleHeaders,success:function(){"VIEW"===mode&&dnn.dom.setCookie("StayInEditMode","NO","",dnn.controlBar.getSiteRoot()),window.location.href=window.location.href.split("#")[0]},error:function(xhr){dnn.controlBar.responseError(xhr)}}),!1}),$("#ControlBar_StayInEditMode").change(function(){var mode=this.checked?"YES":"NO";this.checked?$("#ControlBar_ViewInLayout").attr("disabled","disabled"):$("#ControlBar_ViewInLayout").removeAttr("disabled"),dnn.dom.setCookie("StayInEditMode",mode,"",dnn.controlBar.getSiteRoot()),this.checked&&"EDIT"!==currentUserMode&&$("a#ControlBar_EditPage").click()}).change(),$("#ControlBar_ViewInLayout").change(function(){if(!this.disabled){var mode=this.checked?"LAYOUT":"VIEW",service=dnn.controlBar.getService(),serviceUrl=dnn.controlBar.getServiceUrl(service);$.ajax({url:serviceUrl+"ToggleUserMode",type:"POST",data:{UserMode:mode},beforeSend:service.setModuleHeaders,success:function(){window.location.href=window.location.href},error:function(xhr){dnn.controlBar.responseError(xhr)}})}}),$(document.body).on("click","div.subNav a.bookmark",function(){var $this=$(this);if($this.hasClass("hideBookmark"))return!1;var wrapper=$this.closest("dl"),title=wrapper.attr("id").indexOf("host")>0?"host":"admin",outerWrapper=wrapper.parent(),bookmarkWrapper=$("dl",outerWrapper).last(),ul=$("ul",bookmarkWrapper),bookmarkList=$("ul > li > a",bookmarkWrapper).not(".bookmark"),bookmarkUrl=$this.prev(),bookmarkTabname=$this.parent().data("tabname"),bookmarkHtml=bookmarkUrl.html(),isConflict=!1;if(bookmarkList.each(function(n,v){var html=$(v).html();return bookmarkHtml!==html||(isConflict=!0,!1)}),!isConflict){var li=$('<li data-tabname="'+bookmarkTabname+'"></li>');li.append(bookmarkUrl.clone()),li.append($("<a href='javascript:void(0)' class='removeBookmark' title='"+settings.removeBookmarksTip+"'><span></span></a>")),ul.append(li);var bookmarkTitle=$this.attr("title");$this.addClass("hideBookmark").removeAttr("title").attr("data-title",bookmarkTitle),dnn.controlBar.saveBookmark(title,ul),$("li.BookmarkToggle > a",outerWrapper).click()}}),$(document.body).on("keydown",function(e){dnn.controlBar.isActiveElementEmpty()&&(37!=e.keyCode&&39!=e.keyCode||!dnn.controlBar.isValidArrowScrollingContainer()||dnn.controlBar.moveArrowScrollingContainer(e.keyCode))}),$(document.body).mousewheel(function(event){var wheelEvent=event.originalEvent;wheelEvent&&dnn.controlBar.isValidMouseWheelScrollingContainer(wheelEvent.target)&&(dnn.controlBar.moveMouseWheelScrollingContainer(dnn.controlBar.getWheelEventDelta(wheelEvent)),event.preventDefault())}),$(document.body).on("click","div.subNav a.removeBookmark",function(){var $this=$(this),li=$this.parent(),tabname=li.attr("data-tabname"),wrapper=$this.closest("dl"),title=wrapper.attr("id").indexOf("host")>0?"host":"admin",outerWrapper=wrapper.parent(),bookmarkWrapper=$("dl",outerWrapper).last(),ul=$("ul",bookmarkWrapper);"admin"===title?$("#controlbar_admin_basic li, #controlbar_admin_advanced li").each(function(){if($(this).data("tabname")===tabname){var addbookmarkLink=$(this).find("a.bookmark"),addbookmarktitle=addbookmarkLink.data("title");return addbookmarkLink.removeClass("hideBookmark").removeAttr("data-title").attr("title",addbookmarktitle),!1}return!0}):$("#controlbar_host_basic li, #controlbar_host_advanced li").each(function(){if($(this).data("tabname")===tabname){var addbookmarkLink=$(this).find("a.bookmark"),addbookmarktitle=addbookmarkLink.data("title");return addbookmarkLink.removeClass("hideBookmark").removeAttr("data-title").attr("title",addbookmarktitle),!1}return!0}),li.remove(),dnn.controlBar.saveBookmark(title,ul)}),$("a.controlBar_CloseAddModules").click(function(){var modulePane=dnn.controlBar.addNewModule?$("#ControlBar_Module_AddNewModule"):$("#ControlBar_Module_AddExistingModule");toggleModulePane(modulePane,!1)}),$("#Form").addClass("showControlBar");var initAction=dnn.dom.getCookie("ControlBarInit");if(initAction)switch(dnn.dom.setCookie("ControlBarInit","",-1,dnn.controlBar.getSiteRoot()),dnn.controlBar.loadStatus(),initAction){case"AddNewModule":setTimeout(function(){$("#controlBar_AddNewModule").click()},500);break;case"AddExistingModule":setTimeout(function(){$("#controlBar_AddExistingModule").click()},500);break;case"CreateModule":setTimeout(function(){$("#controlBar_CreateModule").click()},500)}else{var fadeModule=dnn.dom.getCookie("FadeModuleID");if(fadeModule){dnn.dom.setCookie("FadeModuleID","",-1,dnn.controlBar.getSiteRoot());var anchorLink=$('a[name="'+fadeModule+'"]'),module=anchorLink.parent();if(module&&module.length>0){module.css("background-color","#fffacd"),setTimeout(function(){module.css("background","#fffff0"),setTimeout(function(){module.css("background","transparent")},300)},2500);var moduleTop=module.offset().top-50;moduleTop>0&&$("body").scrollTop(moduleTop),dnn.controlBar.loadStatus(),dnn.controlBar.status&&(dnn.controlBar.status.addNewModule?setTimeout(function(){$("#controlBar_AddNewModule").click()},500):setTimeout(function(){$("#controlBar_AddExistingModule").click()},500))}}}},$(function(){dnn.controlBarSettings&&dnn.controlBar.init(dnn.controlBarSettings),"undefined"==typeof $.fn.dnnControlPanel&&($.fn.dnnControlPanel={},$.fn.dnnControlPanel.show=function(){$("#ControlBar").slideDown()},$.fn.dnnControlPanel.hide=function(){$("#ControlBar").slideUp()}),$(window).scroll(function(e){$(e.target).hasClass("rcbScroll")||$("div[id^=ControlBar][id$=_DropDown][class*=RadComboBoxDropDown]").each(function(){var id=$(this).attr("id").replace("_DropDown",""),combo=$find(id);null!=combo&&combo.get_dropDownVisible()&&combo.hideDropDown()})}),$('#ControlBar input[type="checkbox"]').dnnCheckbox()});