
window.dnn=dnn||{};window.dnn.HTMLPro=window.dnn.HTMLPro||{};window.dnn.HTMLPro.RedactorFacade=function(){"use strict";var TIME_NEEDED_AFTER_SYNC=100;var ACTION_SYNC='code.sync',ACTION_TOGGLE='code.toggle',ACTION_GET='code.get',ACTION_DESTROY='core.destroy',BUTTON_INSERT_LINK_SELECTOR='redactor-dropdown-link',BUTTON_REMOVE_LINK_SELECTOR='redactor-dropdown-unlink',BUTTON_HTML_SELECTOR='li a.re-icon.re-html:first',REDACTOR_NAMESPACE='redactor',REDACTOR_BOX_CLASS='.redactor-box',REDACTOR_TOOLBAR_CLASS='.redactor-toolbar',REDACTOR_MODAL_LINK_INSERT_ID='#redactor-modal-link-insert',REDACTOR_FORMATTING_DROPDOWN_SELECTOR='.redactor-dropdown.redactor-dropdown-box-formatting',ICONS_SELECTOR='.redactor-toolbar li a',ON_SELECT_LINK_TOOLTIP_CLASS='.redactor-link-tooltip',CUSTOM_TOOLBAR_EVENTS_IDENTIFIER='click.customToolbarEvents',ON_KEYDOWN_IE_EVENT_IDENTIFIER='keydown.dnnRedactorIE',REDACTOR_LINK_BLACK_CHECKBOX_ID='#redactor-link-blank',REDACTOR_FADE_OPERATION_INIT_DURATION=100,REDACTOR_FADE_OPERATION_END_DURATION=400,DEFAULT_LANG_IN_REDACTOR='en',MODAL_REMOVE_LINK_SELECTORS={MAIN_MODAL:'#redactor-modal-link-insert',INNER_MODAL:'#redactor_modal_inner',BUTTON_CLOSE:'.redactor_btn_modal_close'},RTL_CULTURES=['ar','arc','bcc','bqi','ckb','dv','fa','glk','he','mzn','pnb','ps','sd','ug','ur','yi'];var initRedactor,setConfig,setModule,sync,toggle,get,destroy,isBlurCommingFromModal,hideIcons,setCustomToolbarEvent,getToolbar,getHTMLButton,setCustomHtmlToggle,onOnKeyDownIE,setCustomShowInsertLinkModal,wasInsertLinkClicked,hideModalInsertLinkTextElements,setCustomInsertLinkAction,setCustomRemoveLinkFromImage,wasRemoveLinkClicked,getModalRemoveLink,focusOnElement,selectElement,fadeInOutRedactor,synchronizeToolbarScroll,observeScroll,isRtlCulture;var config,module,redactor,resxSettings,resxRedactor,previousToggle;fadeInOutRedactor=function fadeInOutRedactorHandler(element,callbackFirstStep,callbackSecondStep){element.fadeOut(REDACTOR_FADE_OPERATION_INIT_DURATION,function(){if(typeof callbackFirstStep==="function"){callbackFirstStep();}
element.fadeIn(REDACTOR_FADE_OPERATION_END_DURATION,function(){if(typeof callbackSecondStep==="function"){callbackSecondStep();}});});};isRtlCulture=function isRtlCultureHandler(culture){for(var i=0;i<RTL_CULTURES.length;i++){var rtlCulture=RTL_CULTURES[i];if(culture.indexOf(rtlCulture)===0){return true;}}
return false;};initRedactor=function initHandler(resxRedactor,postInitRedactorCallback,extraOptions){var options={maxFileSize:resxRedactor.maxFileSize,};options=$.extend(options,extraOptions);if(isRtlCulture($.dnnRedactor.opts.lang)){options=$.extend(options,{direction:'rtl'});}
fadeInOutRedactor(module,function(){redactor=module.dnnRedactor(options);postInitRedactorCallback();});};setConfig=function setConfigHandler(configuration,resxSettings){config=configuration;$.dnnRedactor.opts.maxFileSize=config.maxFileSize;if(resxSettings&&resxSettings.culture&&Object.keys(resxSettings.resxRedactor).length>0){resxRedactor=resxSettings.resxRedactor;$.dnnRedactor.opts.langs[resxSettings.culture]=$.dnnRedactor.opts.langs[resxSettings.culture]||{};if(Object.keys($.dnnRedactor.opts.langs[resxSettings.culture]).length===0){$.extend($.dnnRedactor.opts.langs[resxSettings.culture],$.dnnRedactor.opts.langs[DEFAULT_LANG_IN_REDACTOR]);}
$.extend($.dnnRedactor.opts.langs[resxSettings.culture],resxSettings.resxRedactor);$.dnnRedactor.opts.lang=resxSettings.culture;}};setModule=function setModuleHandler(intlineEditingModule){module=intlineEditingModule;};sync=function syncHandler(syncRedactorCallback){module.dnnRedactor(ACTION_SYNC);if(syncRedactorCallback){setTimeout(function(){syncRedactorCallback();},TIME_NEEDED_AFTER_SYNC);}};toggle=function toggleHandler(){var redactorData=redactor.data("redactor");if(typeof previousToggle==="function"){previousToggle.call(redactorData);}else{module.dnnRedactor(ACTION_TOGGLE);}};get=function getHandler(){return module.dnnRedactor(ACTION_GET);};destroy=function destroyHandler(destroyRedactorCallback){fadeInOutRedactor(module.parent().parent(),function(){module.dnnRedactor(ACTION_DESTROY);},function(){if(destroyRedactorCallback){destroyRedactorCallback();}});};isBlurCommingFromModal=function isBlurCommingFromModal(event){var redactorModalLinkInsert,redactorLinkTooltip,redactorFormattingDropdown;redactorModalLinkInsert=$(REDACTOR_MODAL_LINK_INSERT_ID);redactorFormattingDropdown=$(REDACTOR_FORMATTING_DROPDOWN_SELECTOR);redactorLinkTooltip=$(ON_SELECT_LINK_TOOLTIP_CLASS);return event.namespace!==REDACTOR_NAMESPACE||redactorModalLinkInsert.length>0||(redactorFormattingDropdown&&redactorFormattingDropdown.is(':visible'))||(redactorLinkTooltip.length>0&&redactorLinkTooltip.is(':visible'));};hideIcons=function hideIcons(){$(ICONS_SELECTOR).hide();};setCustomToolbarEvent=function setCustomToolbarEvent(redactor,newCustomToolbarCallback){redactor.$toolbar.off(CUSTOM_TOOLBAR_EVENTS_IDENTIFIER).on(CUSTOM_TOOLBAR_EVENTS_IDENTIFIER,newCustomToolbarCallback);};getToolbar=function getToolbar(redactor){return $(redactor.$element).closest(REDACTOR_BOX_CLASS).find(REDACTOR_TOOLBAR_CLASS);};getHTMLButton=function getHTMLButton(redactor){return getToolbar(redactor).find(BUTTON_HTML_SELECTOR);};setCustomHtmlToggle=function setCustomHtmlToggleHandler(customHtmlToggleCallback){var redactorData=redactor.data("redactor");previousToggle=redactorData.code.toggle;redactorData.code.toggle=function(e){customHtmlToggleCallback(e);};};onOnKeyDownIE=function onOnKeyDownIE(callback){$(window).on(ON_KEYDOWN_IE_EVENT_IDENTIFIER,callback);};setCustomShowInsertLinkModal=function setCustomShowInsertLinkModalHandler(showInsertLinkModalCallback){var redactorData=redactor.data("redactor");var previousShow=redactorData.link.show;redactorData.link.show=function(e){previousShow.call(redactorData,e);showInsertLinkModalCallback(e);};};setCustomRemoveLinkFromImage=function setCustomRemoveLinkFromImageHandler(removeLinkWithImageCallback){var redactorData=redactor.data("redactor");var previousUnlink=redactorData.link.unlink;redactorData.link.unlink=function(e){previousUnlink.call(redactorData,e);removeLinkWithImageCallback(e);};};wasInsertLinkClicked=function wasInsertLinkClickedHandler(eventTarget){return eventTarget.hasClass(BUTTON_INSERT_LINK_SELECTOR);};hideModalInsertLinkTextElements=function hideModalInsertLinkTextElementsHandler(){var redactorData=redactor.data("redactor");redactorData.link.$inputText.hide();redactorData.link.$inputText.prev().hide();};setCustomInsertLinkAction=function setCustomInsertLinkActionHandler(imageEditing,callback){var redactorData=redactor.data("redactor");var previousInsert=redactorData.link.insert;redactorData.link.insert=function(e){var openInANewPage=false;if(!imageEditing.getActiveImage()){previousInsert.call(redactorData,e);return;}
openInANewPage=$(REDACTOR_LINK_BLACK_CHECKBOX_ID).prop('checked');callback(redactorData.link.$inputUrl.val(),openInANewPage);redactorData.modal.close();};};wasRemoveLinkClicked=function wasRemoveLinkClickedHandler(eventTarget){return eventTarget.hasClass(BUTTON_REMOVE_LINK_SELECTOR);};getModalRemoveLink=function getModalRemoveLinkHandler(){var modalLink,innerModal;modalLink=$(MODAL_REMOVE_LINK_SELECTORS.MAIN_MODAL);innerModal=modalLink.closest(MODAL_REMOVE_LINK_SELECTORS.INNER_MODAL);return{modal:modalLink,innerModal:innerModal,closeButton:innerModal.find(MODAL_REMOVE_LINK_SELECTORS.BUTTON_CLOSE)};};focusOnElement=function focusOnElementHandler(element){var redactorData=redactor.data("redactor");if(redactorData.utils.browser('msie')){redactorData.focus.setStart();}else{redactorData.caret.setAfter(element);}};selectElement=function selectElementHandler(element){var redactorData;if(element&&element.length!==0){redactorData=redactor.data("redactor");redactorData.selection.selectElement(element);}}
var isRedactorToolbarFloating=function isRedactorToolbarFloatingHandler(redactorToolbar){return redactorToolbar.css('position')==='absolute';};var overrideToolbarAttributes=function overrideToolbarAttributesHandler(sourceToolbar,targetToolbar){var attributesToCopy;attributesToCopy=['position','left','visibility'];for(var i=0;i<attributesToCopy.length;i++){targetToolbar.css(attributesToCopy[i],sourceToolbar.css(attributesToCopy[i]));}};var calculateNewOffset=function calculateNewOffsetHandler(sourceToolbar,targetToolbar){if(isRedactorToolbarFloating(targetToolbar)){targetToolbar.offset(sourceToolbar.offset());targetToolbar.css('top',sourceToolbar.position().top+sourceToolbar.height()-2);}else{targetToolbar.css('top',0);}};observeScroll=function observeScrollHandler(toolbar){var redactorData,redactorToolbar;redactorData=redactor.data("redactor");redactorToolbar=redactorData.$toolbar;overrideToolbarAttributes(redactorToolbar,toolbar);calculateNewOffset(redactorToolbar,toolbar);};synchronizeToolbarScroll=function synchronizeToolbarScrollHandler(toolbar){var redactorData=redactor.data("redactor");if(!redactorData.utils.isDesktop())return;if(redactorData.opts.toolbarExternal)return;if(!redactorData.opts.toolbarFixed)return;observeScroll(toolbar);$(redactorData.opts.toolbarFixedTarget).on('scroll.redactor.'+redactorData.uuid,function(){observeScroll(toolbar);});};return{setConfig:setConfig,setModule:setModule,initRedactor:initRedactor,sync:sync,toggle:toggle,get:get,destroy:destroy,isBlurCommingFromModal:isBlurCommingFromModal,hideIcons:hideIcons,setCustomToolbarEvent:setCustomToolbarEvent,getToolbar:getToolbar,getHTMLButton:getHTMLButton,setCustomHtmlToggle:setCustomHtmlToggle,onOnKeyDownIE:onOnKeyDownIE,setCustomShowInsertLinkModal:setCustomShowInsertLinkModal,wasInsertLinkClicked:wasInsertLinkClicked,hideModalInsertLinkTextElements:hideModalInsertLinkTextElements,setCustomInsertLinkAction:setCustomInsertLinkAction,setCustomRemoveLinkFromImage:setCustomRemoveLinkFromImage,wasRemoveLinkClicked:wasRemoveLinkClicked,getModalRemoveLink:getModalRemoveLink,focusOnElement:focusOnElement,selectElement:selectElement,synchronizeToolbarScroll:synchronizeToolbarScroll,updateToolbarPosition:observeScroll};};