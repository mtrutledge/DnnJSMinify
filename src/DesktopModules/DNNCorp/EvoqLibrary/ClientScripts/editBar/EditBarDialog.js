
window.dnn=window.dnn||{};window.dnn.editBar=window.dnn.editBar||{};(function IIFE(){var EditBarDialogClass;EditBarDialogClass=(function IIFE(){'use strict';var _options,_html,_viewModel,_htmlForPannels,_editBarDialogMask,_editBarDialog,_originalHeight,_top,_win;var addDialog,applyBindings,closeDialog,acceptDialog,initDialog,showDialog,updateHeight;EditBarDialog.class='EditBarDialog';EditBarDialog.type='Class';EditBarDialog.active=false;_html='<div class="editBarDialogMask" style="display:none;"></div>'+'<div class="editBarDialog" style="display:none;">'+'<div class="dialogContainer">'+'<div class="dialogTitle">'+'<span class="dialogTitle" data-bind="html: title"></span>'+'<span class="btn-close" data-bind="click: closeDialog"></span>'+'</div>'+'<div class="dialogContent">'+'<div class="dialogTitle" data-bind="html: innerTitle"></div>'+'<div class="panels" data-bind="with: dialogHTML"></div>'+'</div>'+'</div>'+'<div class="actions">'+'<span class="btn btn-accept" data-bind="visible: showAcceptBtn, text: acceptBtnLbl, click: acceptDialog"></span>'+'<span class="btn btn-cancel" data-bind="visible: showCancelBtn, text: cancelBtnLbl, click: closeDialog"></span>'+'</div>'+'</div>';_options=null;_viewModel=null;_editBarDialog=null;_editBarDialogMask=null;function EditBarDialog(options,htmlForPannels,koObserveCallback,afterBindCallback,afterShowDialogCallback){if(EditBarDialog.active){console.log('EditBarDialog already opened');return;}
EditBarDialog.active=true;if(!options){options={scrollPrevented:true,inObject:$(document.body),animation:true,width:650,title:'Notice',innerTitle:'',showAcceptBtn:true,acceptBtnLbl:'Accept',showCancelBtn:true,cancelBtnLbl:'Cancel',onAcceptCallback:null,onCloseCallback:null,closeOnAccept:true};}
_options=options;if(options.scrollPrevented!==false){options.scrollPrevented=true;}
_options.scrollPrevented=options.scrollPrevented;if(!options.width)_options.width=650;if(!options.title)_options.title='Notice';if(!options.inObject)_options.inObject=$(document.body);if(!options.animation)_options.animation=true;if(!options.innerTitle)_options.innerTitle='';if(!options.acceptBtnLbl)_options.acceptBtnLbl='Accept';if(!options.showAcceptBtn)_options.showAcceptBtn=true;if(!options.cancelBtnLbl)_options.cancelBtnLbl='Cancel';if(!options.showCancelBtn)_options.showCancelBtn=true;if(!options.animation)_options.animation=true;if(!options.closeOnAccept&&typeof options.closeOnAccept!="boolean")_options.closeOnAccept=true;if(options.maxWidth)_options.maxWidth=options.maxWidth;_options.onAcceptCallback=options.onAcceptCallback;_options.onCancelCallback=options.onCancelCallback;_options.onCloseCallback=options.onCloseCallback;_options.afterShowDialogCallback=function(){if(typeof afterShowDialogCallback==='function'){afterShowDialogCallback();}};_viewModel={};if(!htmlForPannels)htmlForPannels='';addDialog();setTimeout(function(){initDialog();var editBarDialog=$('.editBarDialog');editBarDialog.width(_options.width);if(_options.maxWidth){editBarDialog.css('max-width',_options.maxWidth);}
editBarDialog.css('margin-left',-1*editBarDialog.width()/2);if(htmlForPannels)editBarDialog.find('.panels').prepend(htmlForPannels);setTimeout(function(){if(typeof koObserveCallback==='function')applyBindings(koObserveCallback());else applyBindings(undefined);if(typeof afterBindCallback==='function')afterBindCallback();showDialog();},0);},0);}
applyBindings=function(viewModel){setTimeout(function(){_viewModel={dialogHTML:'',title:ko.observable(_options.title),innerTitle:ko.observable(_options.innerTitle),acceptBtnLbl:ko.observable(_options.acceptBtnLbl),showAcceptBtn:ko.observable(_options.showAcceptBtn),cancelBtnLbl:ko.observable(_options.cancelBtnLbl),showCancelBtn:ko.observable(_options.showCancelBtn),acceptDialog:acceptDialog,closeDialog:closeDialog,enableAccept:ko.observable(true)};if(typeof viewModel==='object'){_viewModel.dialogHTML=viewModel;if(viewModel.enableAcceptForDialog){_viewModel.enableAccept=viewModel.enableAcceptForDialog;}}
ko.applyBindings(_viewModel,_editBarDialog[0]);},0);};addDialog=function(){return $('body').prepend(_html);};closeDialog=function(){var node;if(_win)_win.off('.editBarDialog');if(_editBarDialog&&_options.scrollPrevented)_editBarDialog.off('DOMMouseScroll mousewheel');node=$('.editBarDialog');if(typeof _options.beforeCloseCallback==='function')_options.beforeCloseCallback();if(node.length>0){ko.cleanNode($('.editBarDialog')[0]);}
_options.inObject.height(_originalHeight);_editBarDialog.remove();_editBarDialogMask.remove();if(typeof _options.onCloseCallback==='function')_options.onCloseCallback();EditBarDialog.active=false;};acceptDialog=function(){if(typeof _viewModel.enableAccept==='boolean'&&!_viewModel.enableAccept)return;if(typeof _viewModel.enableAccept==='function'&&!_viewModel.enableAccept())return;if(typeof _options.onAcceptCallback==='function')_options.onAcceptCallback();if(_options.closeOnAccept===true)closeDialog();};initDialog=function(){var doc,bottom,left,top,scrollDown,currentWinPos,lastWinPos,topPercent,percent;_win=$(window);doc=$(document);_editBarDialogMask=$('.editBarDialogMask');_editBarDialog=$('.editBarDialog');_editBarDialog.draggable({handle:'.dialogTitle',cursor:'move',start:function(){$(this).data("startingScrollTop",$(this).parent().parent().scrollTop());},drag:function(event,ui){var st=parseInt($(this).data("startingScrollTop"));ui.position.top-=st;}});left='-'+Math.round(_options.width/2)+'px';top=100+doc.scrollTop()+'px';bottom='40px';_editBarDialog.css({top:top,'margin-left':left,'margin-bottom':bottom,});_editBarDialogMask.css({height:doc.height()+_editBarDialog.height()});setTimeout(function(){_top=doc.scrollTop();_editBarDialogMask.css({'min-height':doc.scrollTop()+_editBarDialog.height()+100+'px'});},0);_win.off('scroll.editBarDialog').on('scroll.editBarDialog',function(){if(doc.scrollTop()<_top)doc.scrollTop(_top);});_win.off('keydown.editBarDialog').on('keydown.editBarDialog',function(evt){if(evt.keyCode===27)closeDialog();});if(_options.scrollPrevented){_editBarDialog.off('DOMMouseScroll mousewheel').on('DOMMouseScroll mousewheel',function(evt){var self,scrollTop,scrollHeight,height,delta,up,prevent;self=$(this);scrollTop=this.scrollTop;scrollHeight=this.scrollHeight;height=self.height();delta=evt.originalEvent.wheelDelta;up=delta>0;prevent=function(){evt.stopPropagation();evt.preventDefault();evt.returnValue=false;return false;};if(!up&&-delta>scrollHeight-height-scrollTop){self.scrollTop(scrollHeight);return prevent();}else if(up&&delta>scrollTop){self.scrollTop(0);return prevent();}});}};showDialog=function(){_editBarDialogMask.show();if(_options.animation){_editBarDialog.fadeIn(100,function(){_options.afterShowDialogCallback();});}else{_editBarDialog.show();_options.afterShowDialogCallback();}};updateHeight=function(){_editBarDialogMask.css({'min-height':$(document).scrollTop()+_editBarDialog.height()+400+'px'});};EditBarDialog.prototype.updateHeight=updateHeight;EditBarDialog.prototype.close=closeDialog;return EditBarDialog;})();window.dnn.editBar.EditBarDialog=EditBarDialogClass;}).call(this);