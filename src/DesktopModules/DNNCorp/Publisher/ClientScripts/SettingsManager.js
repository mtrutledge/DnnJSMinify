
window.dnn=dnn||{};window.dnn.modules=dnn.modules||{};window.dnn.modules.publisher=dnn.modules.publisher||{};window.dnn.modules.publisher.SettingsManager=(function($,ko){"use strict";var Workflow=function(data){this.workflowId=data.WorkflowId;this.workflowName=data.WorkflowName;};var viewModel,requestService,settings;var init,request,createViewModel,updateWorkflows,getSettingsFromBackend,getSettingsFromBackendCallback200,getSettingsFromBackendCallbackError,save,saveCallback200,saveCallbackError,show,hide,cancel;init=function(config){requestService=dnn.modules.publisher.RequestUtils;requestService.init(config.moduleId);createViewModel();getSettingsFromBackend();var viewModelBinding=$(config.bindingElementSelector);ko.applyBindings(viewModel,viewModelBinding[0]);};createViewModel=function(){viewModel={visible:ko.observable(false),ready:ko.observable(false),workflows:ko.observableArray([]),selectedWorkflowId:ko.observable(-1),twitterEnabled:ko.observable(),facebookEnabled:ko.observable(),linkedInEnabled:ko.observable(),pinterestEnabled:ko.observable(),rssEnabled:ko.observable(),hide:hide,cancel:cancel,save:save};};updateWorkflows=function(workflows){viewModel.workflows.removeAll();workflows.forEach(function(data){viewModel.workflows.push(new Workflow(data));});};getSettingsFromBackendCallback200=function(data){settings=data.settings;updateWorkflows(data.workflows);viewModel.selectedWorkflowId(settings.WorkflowId);viewModel.twitterEnabled(settings.TwitterEnabled);viewModel.facebookEnabled(settings.FacebookEnabled);viewModel.linkedInEnabled(settings.LinkedInEnabled);viewModel.pinterestEnabled(settings.PinterestEnabled);viewModel.rssEnabled(settings.RssEnabled);viewModel.ready(true);};getSettingsFromBackendCallbackError=function(e){viewModel.ready(true);};getSettingsFromBackend=function(){viewModel.ready(false);requestService.request('Publisher','Settings','Get','GET',{},getSettingsFromBackendCallback200,getSettingsFromBackendCallbackError);};saveCallback200=function(){settings.WorkflowId=viewModel.selectedWorkflowId();viewModel.visible(false);};saveCallbackError=function(error){};save=function(){var data={ModuleId:settings.ModuleId,WorkflowId:viewModel.selectedWorkflowId(),TwitterEnabled:viewModel.twitterEnabled(),FacebookEnabled:viewModel.facebookEnabled(),LinkedInEnabled:viewModel.linkedInEnabled(),PinterestEnabled:viewModel.pinterestEnabled(),RssEnabled:viewModel.rssEnabled()};requestService.request('Publisher','Settings','Save','POST',data,saveCallback200,saveCallbackError);};cancel=function(){viewModel.selectedWorkflowId(settings.WorkflowId);viewModel.visible(false);};show=function(){viewModel.visible(true);};hide=function(){viewModel.visible(false);};return{request:request,init:init,show:show,};}(jQuery||$,ko));