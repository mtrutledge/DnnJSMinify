
window.dnn=dnn||{};window.dnn.modules=dnn.modules||{};window.dnn.modules.publisher=dnn.modules.publisher||{};window.dnn.modules.publisher.ChangeAuthorManager=(function($,ko){"use strict";var viewModel,configuration;var setAuthor,sort,sortColumnClass,show,hide,createViewModel,loadAuthors,sortUserList;createViewModel=function(){viewModel={visible:ko.observable(false),users:ko.observableArray([]),author:ko.observable(),orderBy:ko.observable("displayName"),orderAsc:ko.observable(true),setAuthor:setAuthor,sort:sort,sortColumnClass:sortColumnClass,hide:hide};};var init=function(config){configuration=config;createViewModel();viewModel.author({userId:config.authorUserId,avatar:config.authorAvatar,displayName:config.authorDisplayName});viewModel.author.subscribe(function(){$.dnnNotif({dialogClass:'noTittle',height:50,styleBlue:true,text:configuration.resx.authorSuccessfullyChanged});});var viewModelBinding=$(config.bindingElementSelector);ko.applyBindings(viewModel,viewModelBinding[0]);};loadAuthors=function(){dnn.modules.publisher.RequestUtils.request('Publisher','Author','GetAuthors','GET',null,function(data){ko.utils.arrayPushAll(viewModel.users,data);sortUserList(viewModel.orderBy(),viewModel.orderAsc());});};show=function(){if(viewModel.users().length===0){loadAuthors();}
viewModel.visible(true);};hide=function(){viewModel.visible(false);};sort=function(d,e){var column=$(e.target).attr("data-column");if(viewModel.orderBy()===column){viewModel.orderAsc(!viewModel.orderAsc());}else{viewModel.orderBy(column);viewModel.orderAsc(true);}
sortUserList(viewModel.orderBy(),viewModel.orderAsc());};sortUserList=function(column,ascending){var operator=ascending?'<':'>';var sortFunction=new Function('left','right','return left.'+column+' == right.'+column+' ? 0 : (left.'+column+' '+operator+' right.'+column+' ? -1 : 1);');viewModel.users.sort(sortFunction);};sortColumnClass=function(column){if(column===viewModel.orderBy()){return viewModel.orderAsc()?'asc':'desc';}
return'';};setAuthor=function(author){if(viewModel.author().userId===author.userId){return;}
if(configuration.contentItemId===0){viewModel.author(author);return;}
var params={contentItemId:configuration.contentItemId,userId:author.userId};dnn.modules.publisher.RequestUtils.request('Publisher','Author','SetPostAuthor','POST',params,function(){viewModel.author(author);});};return{init:init,show:show,hide:hide,getAuthorUserId:function(){return viewModel.author().userId;}};}(jQuery||$,ko));