
window.dnn=dnn||{};window.dnn.modules=dnn.modules||{};window.dnn.modules.publisher=dnn.modules.publisher||{};window.dnn.modules.publisher.SearchManager=(function($,ko){"use strict";var configuration;var viewModel={inputSearchText:ko.observable(),viewing:ko.observableArray()};viewModel.throttledInputSearchText=ko.computed(function(){return viewModel.inputSearchText();}).extend({throttle:500});viewModel.throttledInputSearchText.subscribe(function(){viewModel.searchText(viewModel.inputSearchText());});viewModel.keyPress=function(d,event){var keyCode=(event.which?event.which:event.keyCode);if(keyCode===13){viewModel.doSearch();return false;}
return true;};viewModel.doSearch=function(){viewModel.searchText(viewModel.inputSearchText());};var disableEvent=false;viewModel.onRemovedFilter=function(value){if(disableEvent)return;if(value.type==="tag"){var index=viewModel.selectedTags.indexOf(value.id);viewModel.selectedTags.splice(index,1);}else if(value.type==="author"){viewModel.selectedAuthor(null);}};function updateViewing(){disableEvent=true;viewModel.viewing.removeAll();var tags=viewModel.selectedTags();for(var i=0;i<tags.length;i++){viewModel.viewing.push({type:'tag',id:tags[i],name:tags[i]});}
if(viewModel.selectedAuthor()!==null){viewModel.viewing.push({type:'author',id:viewModel.selectedAuthor().key,name:viewModel.selectedAuthor().name});}
disableEvent=false;}
function init(config){configuration=config;viewModel.searchText=config.searchText;viewModel.selectedTags=config.selectedTags;viewModel.selectedAuthor=config.selectedAuthor;var text=dnn.modules.publisher.RequestUtils.getQueryParameters()["text"];viewModel.inputSearchText(text);updateViewing();var viewModelBinding=$(config.bindingElementSelector);var node=viewModelBinding[0];ko.applyBindings(viewModel,node);viewModel.selectedTags.subscribe(updateViewing);viewModel.selectedAuthor.subscribe(updateViewing);}
return{init:init};})(jQuery||$,ko);