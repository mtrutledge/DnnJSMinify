
﻿
window.dnn=dnn||{};window.dnn.personalizedTabs=dnn.personalizedTabs||{};window.dnn.personalizedTabs.rules=dnn.personalizedTabs.rules||{};(function IIFE(){var RolesRuleClass;RolesRuleClass=(function IIFE(){'use strict';var HTML_PATH="Assests/Html/Rules/RolesRuleTemplate.html";var _templateLoader,_service,_resx;var getService,getServiceUrl,getViewModel,remove,tokenInputResultsFormatter;RolesRule.class='RolesRule';RolesRule.type='Class';RolesRule.template=null;RolesRule.allowMultipleInstances=true;function RolesRule(onDeleteRuleCallback,resx){_resx=resx;this._id="";this._viewModel={};this._ruleElement=null;this.onDeleteRuleCallback=onDeleteRuleCallback;_templateLoader=window.dnn.personalizedTabs.TemplateLoader;if(!RolesRule.template){_templateLoader.readHtmlTemplate(dnn.getVar('dnn_content_personalization_resourceroot')+HTML_PATH,function(template){RolesRule.template=template;});}}
getService=function(){if(!_service){_service=$.dnnSF();}
return _service;};getServiceUrl=function(service,controller){return getService().getServiceRoot(service)+controller+'/';};getViewModel=function(self,data){self._viewModel={id:self._id,url:getServiceUrl("ContentPersonalization","UserRole")+"SearchRole",tokens:ko.observableArray([]).extend({required:true,}),remove:remove,tokenInputResultsFormatter:tokenInputResultsFormatter,self:self,resx:_resx,};if(data){var roles=data.Roles;roles.forEach(function(role,idx){self._viewModel.tokens.push({name:role});});}
self._viewModel.validationObservable=ko.validatedObservable({tokens:self._viewModel.tokens});};remove=function(){if(this.self.onDeleteRuleCallback&&typeof this.self.onDeleteRuleCallback==='function'){this.self.onDeleteRuleCallback(this.id);}};tokenInputResultsFormatter=function(item){return"<li class='user'><img src='"+item.iconfile+"' title='"+item.name+"' style='width:25px;height:25px;display:inline-block;' /><span>"+item.name+"</span></li>";};RolesRule.getId=function(){return"UserRoleRule";};RolesRule.getName=function(resx){return resx.RulesRolesName;};RolesRule.loadTemplate=function(callback){if(!RolesRule.template){_templateLoader.readHtmlTemplate(dnn.getVar('dnn_content_personalization_resourceroot')+HTML_PATH,function(template){RolesRule.template=template;callback();});}else{callback();}};RolesRule.prototype.getId=function(){return this._id;};RolesRule.prototype.injectRule=function(parentElement,afterInjectCallback,data){var self=this;RolesRule.loadTemplate(function(){var dateNow,html;dateNow=new Date().getTime();html=RolesRule.template.replace(/\{0\}/g,dateNow);parentElement.append(html);self._id=dateNow;self._ruleElement=$("#{0}".replace(/\{0\}/g,self._id));getViewModel(self,data);ko.applyBindings(self._viewModel,self._ruleElement[0]);afterInjectCallback(self,parentElement,self._viewModel.validationObservable);});};RolesRule.prototype.getDataToBeSent=function(){if(!this._viewModel){return;}
var roles=[];this._viewModel.tokens().forEach(function(role,idx){roles.push(role.name);});return{type:"UserRoleRule",Roles:roles,PortalId:parseInt(dnn.getVar('dnn_content_personalization_portalId'))};};RolesRule.prototype.freeContext=function(){var element=$("#{0}".replace(/\{0\}/g,this._id));ko.cleanNode(element);};RolesRule.prototype.doesRuleAllowMultipleInstances=function(){return RolesRule.allowMultipleInstances;};RolesRule.prototype.getRuleClass=function(){return RolesRule.class;};return RolesRule;})();window.dnn.personalizedTabs.rules.RolesRule=RolesRuleClass;}).call(this);